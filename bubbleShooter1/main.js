!function(){var i="updateCase",t="createCase",r="flashCase",o="destroyCase",e="failLaunch",h="gameOverC2",s=8,g=[[[-1,0],[1,0],[-1,-1],[0,-1]],[[-1,0],[1,0],[0,-1],[1,-1]]],n=11,c=[[[-1,0],[1,0],[-1,-1],[0,-1],[-1,1],[0,1]],[[-1,0],[1,0],[0,-1],[1,-1],[0,1],[1,1]]],l=function(){};l.prototype.grid=[],l.prototype.gridInfo={},l.prototype.allNeighbor=[],l.prototype.init=function(i,t,r,o,e,h,s){this.grid=[],this.gridInfo.GRID_WIDTH=i,this.gridInfo.GRID_HEIGHT=t,this.gridInfo.GRID_ROW_OFFSET=h,this.gridInfo.CASE_TYPE_NB=r,this.gridInfo.CASE_WIDTH=o,this.gridInfo.CASE_HEIGHT=e,this.createGrid(i,t),this.fillGrid(r),this.isInit=!0},l.prototype.createGrid=function(i,t){for(var r=0;r<i;r++){this.grid.push([]);for(var o=0;o<t;o++)this.grid[r].push((new d).create(r,o))}},l.prototype.fillGrid=function(i){for(var t=0;t<this.grid.length;t++)for(var r=0;r<this.grid[t].length;r++)r<9?(this.grid[t][r].type=Math.floor(Math.random()*this.gridInfo.CASE_TYPE_NB),this.grid[t][r].createC2()):this.grid[t][r].type=-1},l.prototype.getInfoCase=function(i,t){return"_"&this.grid[t].type&this.grid[t].id},l.prototype.getType=function(i,t){return this.grid[i][t].type},l.prototype.getGridLogic=function(i,t){var r=Math.round(t/this.gridInfo.CASE_HEIGHT),o=0;(r+this.gridInfo.GRID_ROW_OFFSET)%2&&(o=this.gridInfo.CASE_WIDTH/2);var e=Math.round((i-o)/this.gridInfo.CASE_WIDTH);return e<this.grid.length&&e>=0&&r>=0&&r<this.grid[e].length?this.grid[e][r]:{logicX:e,logicY:r}},l.prototype.getGridPhysic=function(i,t){var r=t*this.gridInfo.CASE_HEIGHT,o=0;return(t+this.gridInfo.GRID_ROW_OFFSET)%2&&(o=this.gridInfo.CASE_WIDTH/2),{x:i*this.gridInfo.CASE_WIDTH+o,y:r}},l.prototype.checkBubbleTarget=function(i,t,r){for(var o,e,g=0,n=0,c={type:-1,x:i,y:t},l=[];-1==c.type;)if(g=c.x+Math.cos(a(r))*s,n=c.y+Math.sin(a(r))*s,c=this.getGridLogic(g,n),e=this.checkNearestCaseCollision(g,n,c),void 0===c.type){if(c.logicX<0&&r<270||c.logicX>this.grid.length-1&&r>270){l.push({x:g,y:n});var d=180-r;r=d<0?360+d:d}if(c.logicY<0)break;c={type:-1,x:g,y:n}}else if(e&&void 0!==o){if(this.allNeighbor=[],this.resetChecked(),this.checkNeigbor(o,!1,!1,!1),this.allNeighbor.length<=0){var f;this.allNeighbor=[],this.resetChecked(),this.checkNeigbor({logicX:e.logicX,logicY:e.logicY,type:-1},!1,!1,!0);for(var p in this.allNeighbor)((y=this.getGridPhysic(this.allNeighbor[p].logicX,this.allNeighbor[p].logicY)).x-g)*(y.x-g)+(y.y-n)*(y.y-n)<Infinity&&(f=this.allNeighbor[p]);o=f}c={type:99999,x:g,y:n}}else-1==c.type&&(o=c),c={type:c.type,x:g,y:n};if(o){var y=this.getGridPhysic(o.logicX,o.logicY);l.push({x:y.x,y:y.y});for(p=0;p<l.length-1;p++)l[p].y<l[p+1].y&&l.splice(p,1);o.type=Math.floor(Math.random()*this.gridInfo.CASE_TYPE_NB),c2_callFunction("launchBullet",[this.pathToString(l),o.type,o.setNewId()])}else c2_callFunction(h,[])},l.prototype.pathToString=function(i){var t="";for(var r in i)t+=i[r].x+"_"+i[r].y+"|";return t},l.prototype.checkNearestCaseCollision=function(i,t,r){var o,e=g[0];for(var h in(r.logicY+this.gridInfo.GRID_ROW_OFFSET)%2&&(e=g[1]),e){if(void 0!==(o=this.getCaseByLogicAndOffset(r.logicX,r.logicY,e[h][0],e[h][1]))&&-1!=o.type)if(this.circleCollisionByLogic(i,t,n,o.logicX,o.logicY,n))return o}return!1},l.prototype.circleCollisionByLogic=function(i,t,r,o,e,h){var s=this.getGridPhysic(o,e);return function(i,t,r,o,e,h){if((i-o)*(i-o)+(t-e)*(t-e)>(r+h)*(r+h))return!1;return!0}(i,t,r,s.x,s.y,h)},l.prototype.rowGoDown=function(){this.gridInfo.GRID_ROW_OFFSET++;for(var i=0;i<this.gridInfo.GRID_WIDTH;i++)if(-1!=this.grid[i][this.gridInfo.GRID_HEIGHT-1].type){c2_callFunction(h,[]);break}i=0;for(var t=0;t<this.grid.length;t++)for(var r=this.grid[t].length-2;r>=0;r--)this.grid[t][r+1].type=this.grid[t][r].type,this.grid[t][r+1].id=this.grid[t][r].id;for(t=0;t<this.grid.length;t++)this.grid[t][0].logicY--,this.grid[t][0].type=Math.floor(Math.random()*this.gridInfo.CASE_TYPE_NB),this.grid[t][0].createC2(),this.grid[t][0].logicY++},l.prototype.rowGoUp=function(){this.gridInfo.GRID_ROW_OFFSET++;for(var i=0;i<this.grid.length;i++)for(var t=1;t<this.grid[i].length;t++)this.grid[i][t-1].type=this.grid[i][t].type,this.grid[i][t-1].id=this.grid[i][t].id,this.grid[i][t].type=-1,this.grid[i][t].id=void 0},l.prototype.setColorBubbleById=function(i,t){this.getCaseById(i).type=t},l.prototype.getCaseById=function(i){for(var t=0;t<this.grid.length;t++)for(var r=0;r<this.grid[t].length;r++)if(this.grid[t][r].id==i)return this.grid[t][r]},l.prototype.checkCaseDestroy=function(i){var t=this.getCaseById(i);this.allNeighbor=[],this.resetChecked(),this.allNeighbor.push(t),t.checked=!0,this.checkNeigbor(t,!0,!0,!1);var r=this.allNeighbor.length;if(this.allNeighbor.length>=3)for(var o in this.allNeighbor)this.allNeighbor[o].type=-1,setTimeout(function(i){i.destroy()}.bind(this,this.allNeighbor[o]),50*o);setTimeout(function(){this.checkFloatingCase()}.bind(this),50*r),r<3&&c2_callFunction(e,[])},l.prototype.checkNeigbor=function(i,t,r,o){var e,h=c[0];for(var s in(i.logicY+this.gridInfo.GRID_ROW_OFFSET)%2&&(h=c[1]),h)void 0!==(e=this.getCaseByLogicAndOffset(i.logicX,i.logicY,h[s][0],h[s][1]))&&(-1!=e.type||o)&&(e.type!=i.type&&t||e.checked||(e.checked=!0,this.allNeighbor.push(e),r&&this.checkNeigbor(e,t,r,o)))},l.prototype.resetChecked=function(){for(var i=0;i<this.grid.length;i++)for(var t=0;t<this.grid[i].length;t++)this.grid[i][t].checked=!1},l.prototype.getCaseByLogicAndOffset=function(i,t,r,o){if(this.grid[i+r]&&this.grid[i+r][t+o])return this.grid[i+r][t+o]},l.prototype.checkFloatingCase=function(){var i=[],t=!0;this.resetChecked();for(var r=0;r<this.grid.length;r++)for(var o=0;o<this.grid[r].length;o++)if(-1!=this.grid[r][o].type&&!this.grid[r][o].checked){for(var e in this.allNeighbor=[],this.checkNeigbor(this.grid[r][o],!1,!0,!1),t=!0,this.allNeighbor.length<=0&&this.allNeighbor.push(this.grid[r][o]),this.allNeighbor)if(0==this.allNeighbor[e].logicY){t=!1;break}t&&(i=i.concat(this.allNeighbor))}for(var e in i)i[e].destroy()},l.prototype.checkCaseToDestroy=function(i){for(var t={},r=0;r<this.grid.length;r++)for(var e=0;e<this.grid[r].length;e++)t[this.grid[r][e].id]=1;for(var h in i)null==t[h]&&c2_callFunction(o,[h])};var d=function(){};function a(i){return i*(Math.PI/180)}d.id=0,d.prototype.create=function(i,t){return this.logicX=i,this.logicY=t,this.type=-1,this.checked=!1,this},d.prototype.setNewId=function(){return this.id=d.id++},d.prototype.createC2=function(){c2_callFunction(t,[this.logicX,this.logicY,this.type,this.setNewId()])},d.prototype.flashCase=function(){c2_callFunction(r,[this.logicX,this.logicY])},d.prototype.update=function(){c2_callFunction(i,[this.logicX,this.logicY,this.type,this.id])},d.prototype.destroy=function(){this.type=-1,c2_callFunction(o,[this.id])},"object"!=typeof window.playtouch&&(window.playtouch={}),playtouch.gameMain=new l}();