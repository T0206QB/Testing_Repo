(function(){class e{constructor(){}static result_continue(){return-1}static result_handleFalse(){return 0}static result_handleTrue(){return 1}static match_getPosibilities(e){let t=[["y","-x"],["-x","-y"],["-y","x"],["-x","y"],["y","x"],["x","-y"],["-y","-x"]],s=[e];for(let r=0;r<t.length;r++){let l=[];for(let s=0;s<e.length;s++)l.push(this.match_applyRule(t[r],e[s]));s.push(l)}return this.match_clearDuplicate(s)}static match_applyRule(e,t){let s=t.getCopy();for(let r=0;r<e.length;r++){let l=0==r?"x":"y";switch(e[r]){case"x":s[l]=parseInt(t.x);break;case"-x":s[l]=parseInt(-t.x);break;case"y":s[l]=parseInt(t.y);break;case"-y":s[l]=parseInt(-t.y)}}return s}static match_clearDuplicate(e){for(let t=0;t<e.length;t++)for(let s=e.length-1;s>=0;s--)t!=s&&JSON.stringify(e[t])===JSON.stringify(e[s])&&e.splice(s,1);return e}static match_3(){return[new t(0,1),new t(0,2)]}static match_4(){return[new t(0,1),new t(0,2),new t(0,3)]}static match_5(){return[new t(0,1),new t(0,2),new t(0,3),new t(0,4)]}static match_T5(){return[new t(0,1),new t(0,2),new t(1,2),new t(-1,2)]}static match_T6(){return[new t(0,1),new t(0,2),new t(1,2),new t(-1,2),new t(2,2)]}static match_T7(){return[new t(0,1),new t(0,2),new t(1,2),new t(-1,2),new t(2,2),new t(-2,2)]}static match_L4(){return[new t(0,1),new t(0,2),new t(1,2)]}static match_L5(){return[new t(0,1),new t(0,2),new t(1,2),new t(2,2)]}static match_Cross5(){return[new t(0,1),new t(-1,1),new t(1,1),new t(0,2)]}static match_Cross6(){return[new t(0,1),new t(0,2),new t(-1,2),new t(1,2),new t(0,3)]}static match_Cross7(){return[new t(0,1),new t(0,2),new t(-1,2),new t(1,2),new t(0,3),new t(0,4)]}static match_Cross7_2(){return[new t(0,1),new t(0,2),new t(-1,2),new t(1,2),new t(2,2),new t(0,3)]}static match_Cross8(){return[new t(0,1),new t(0,2),new t(-1,2),new t(-2,2),new t(1,2),new t(0,3),new t(0,4)]}static match_Cross9(){return[new t(0,1),new t(0,2),new t(-1,2),new t(-2,2),new t(1,2),new t(2,2),new t(0,3),new t(0,4)]}static matchItems_all(e,t){return this.result_handleTrue()}static matchItems_color(e,t){return e.uid===t.uid?this.result_continue():e.color===t.color?this.result_handleTrue():this.result_handleFalse()}static matchItems_type_blockLife(e,t){return"blockLife"===e.type||"blockLife"===t.type?this.result_handleFalse():this.result_continue()}static matchItems_type_colorBomb(e,t){return"colorBomb"===e.type||"colorBomb"===t.type?this.result_handleFalse():this.result_continue()}static matchItems_type_virus(e,t){return"virus"===e.type||"virus"===t.type?this.result_handleFalse():this.result_continue()}static matchItems_type_totem(e,t){return"totem"===e.type||"totem"===t.type?this.result_handleFalse():this.result_continue()}static matchItems_type_sinker(e,t){return"sinker"===e.type||"sinker"===t.type?this.result_handleFalse():this.result_continue()}static matchItems_type_copyer(e,t){return"copyer"===e.type||"copyer"===t.type?this.result_handleFalse():this.result_continue()}static matchItems_cell_type_chest(e,t){return"chest"===e.cell.type||"chest"===t.cell.type?this.result_handleFalse():this.result_continue()}static matchItems_type_popper(e,t){return"popper"===e.type||"popper"===t.type?this.result_handleFalse():this.result_continue()}static swapItems_all(e,t){return this.result_handleTrue()}static swapItems_near1Cell(e,s,r){if(!e.cell||!s.cell)return this.result_handleFalse();let l=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let t=0;t<l.length;t++)if(e.cell.x+l[t].x===s.cell.x&&e.cell.y+l[t].y===s.cell.y)return this.result_continue();return this.result_handleFalse()}static swapItems_near1CellAndMatch(e,s,r){if(!e.cell||!s.cell)return this.result_handleFalse();let l=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let t=0;t<l.length;t++)if(e.cell.x+l[t].x===s.cell.x&&e.cell.y+l[t].y===s.cell.y){r.swapItemByPos(e,s,!0,!0);let t=r.rules.onlyOneMatch;r.rules.onlyOneMatch=!0;let l=r.checkMatch(!1,!1,!0);if(r.rules.onlyOneMatch=t,r.swapItemByPos(e,s,!0,!0),l.length<=0)continue;return this.result_handleTrue()}return this.result_handleFalse()}static swapItems_blockLife(e,t){return"blockLife"==e.type||"blockLife"==t.type?this.result_handleFalse():"blockLife"==e.cell.type&&e.cell.life>0||"blockLife"==t.cell.type&&t.cell.life>0?this.result_handleFalse():this.result_continue()}static swapItems_noSwap(e,t){let s=["chest","copyer","virus","popper"];return s.includes(e.type)||s.includes(t.type)?this.result_handleFalse():s.includes(e.cell.type)||s.includes(t.cell.type)?this.result_handleFalse():this.result_continue()}static swapItems_match(e,t,s){if(!e.cell||!t.cell)return this.result_handleFalse();s.swapItemByPos(e,t,!0,!0);let r=s.rules.onlyOneMatch;s.rules.onlyOneMatch=!0;let l=s.checkMatch(!1,!1,!0);return s.rules.onlyOneMatch=r,s.swapItemByPos(e,t,!0,!0),l.length<=0?this.result_handleFalse():this.result_handleTrue()}static swapItems_bonus(e,t){let s=["line_v","line_h","line","colorBomb","bomb"];if(s.includes(e.type)&&s.includes(t.type))return this.result_handleTrue();let r=["totem","chest","sinker","copyer","popper"];return"colorBomb"!=e.type&&"colorBomb"!=t.type||r.includes(e.type)||r.includes(t.type)||r.includes(e.cell.type)||r.includes(t.cell.type)?this.result_continue():this.result_handleTrue()}static sortCells_top(e,t){return e.y>=t.y?1:-1}static sortCells_bottom(e,t){return e.y<=t.y?1:-1}static sortCells_left(e,t){return e.x>=t.x?1:-1}static sortCells_right(e,t){return e.x<=t.x?1:-1}static move_bottom_1(){return new t(0,1)}static move_bottomLeftRight_1(){return[new t(1,1),new t(-1,1)]}static move_bottomLeft_1(){return new t(1,1)}static move_bottomRight_1(){return new t(-1,1)}static move_bottomLeftRight_nearBorder_1(e,s){return s.x<=e.logicWidth/2?new t(-1,1):new t(1,1)}static canMove_empty(e,t){return t.item?this.result_continue():this.result_handleTrue()}static canMove_type_void(e,t){return"void"===t.type?this.result_handleFalse():this.result_continue()}static canMove_type_blockLife(e,t){return"blockLife"===e.type||"blockLife"==e.cell.type&&e.cell.life>0?this.result_handleFalse():this.result_continue()}static canMove_type_noMove(e,t){let s=["copyer","virus","chest","popper"];return s.includes(e.type)?this.result_handleFalse():s.includes(e.cell.type)?this.result_handleFalse():s.includes(t.type)?this.result_handleFalse():this.result_continue()}static posCreateItem_top(e,s,r){let l=[];for(let s=0;s<e;s++)l.push(new t(s,0));return l}static posCreateItem_bottom(e,s,r){let l=[];for(let r=0;r<e;r++)l.push(new t(r,s-1));return l}static posCreateItem_left(e,s,r){let l=[];for(let e=0;e<s;e++)l.push(new t(0,e));return l}static posCreateItem_right(e,s,r){let l=[];for(let r=0;r<s;r++)l.push(new t(e-1,r));return l}static posCreateItem_centerTop_1(e,s,r){return new t(Math.floor((e-1)/2),0)}static canCreateItem_void(e){return"void"!=e.type&&!e.item}static createItemDefault(e,t,s){return t.item=new e.itemClass(t,e),e.applyOption(t.item,s),t.item.create(),t.item}static createItemDefault_type_random4(e,t,s){return t.item=new e.itemClass(t,e,Math.floor(4*Math.random())),e.applyOption(t.item,s),t.item.create(),t.item}static createItemOptionDefault(){return{}}static createItemOption_type_random4(){return{color:Math.floor(4*Math.random())}}static canDestroyItem_all(e){return this.result_handleTrue()}static canDestroyItem_life(e,t,s){let r=["switcher","sinker","blockLife","popper"];return r.includes(e.item.type)?(e.item.baseLife||(e.item.baseLife=e.item.life),e.item.life--,e.item.updated(),"switcher"==e.item.type&&e.item.switcherArrColor.length>0&&e.item.life>0&&e.item.setColor(e.item.switcherArrColor.shift()),e.item.life>0?this.result_handleFalse():this.result_handleTrue()):this.result_continue()}static canDestroyItem_blockLifeNearDestroyed(e,s){if("blockLife"==e.item.type)return this.result_continue();let r=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let l=0;l<r.length;l++){let i=s.getCellByPos(t.sumPos(e.pos,r[l]));i&&i.item&&("blockLife"===i.item.type&&s.checkRules.checkDestroyItem(i,s,void 0,[this.canDestroyItem_oneTime_cell,this.canDestroyItem_cellChest,this.canDestroyItem_life],[]))}return this.result_continue()}static canDestroyItem_totem(e){return"totem"!=e.item.type?this.result_continue():this.result_handleFalse()}static canDestroyItem_cellBlockLife(e,t,s,r){return"blockLife"!=e.type?this.result_continue():e.life<=0?this.result_continue():(e.baseLife||(e.baseLife=e.life),e.life--,e.updated(r),e.life<=0&&e.setType(""),this.result_handleFalse())}static canDestroyItem_cellBGLife(e){return"bgLife"!=e.type?this.result_continue():e.life<=0?this.result_continue():(e.baseLife||(e.baseLife=e.life),e.life--,e.updated(),e.life<=0&&e.setType(""),this.result_continue())}static canDestroyItem_virusNearDestroyed(e,s){if("virus"==e.item.type)return this.result_continue();let r=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let l=0;l<r.length;l++){let i=s.getCellByPos(t.sumPos(e.pos,r[l]));i&&i.item&&("virus"===i.item.type&&s.checkRules.checkDestroyItem(i,s,void 0,[this.canDestroyItem_all],[]))}return this.result_continue()}static canDestroyItem_cellChest(e){return"chest"!=e.type?this.result_continue():this.result_handleFalse()}static canDestroyItem_sinkerNearDestroyed(e,s){if("sinker"==e.item.type)return this.result_continue();let r=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let l=0;l<r.length;l++){let i=s.getCellByPos(t.sumPos(e.pos,r[l]));if(i&&i.item&&"sinker"===i.item.type){if("blockLife"==i.type)continue;s.checkRules.checkDestroyItem(i,s,void 0,[this.canDestroyItem_oneTime_cell,this.canDestroyItem_cellChest,this.canDestroyItem_life],[])}}return this.result_continue()}static canDestroyItem_copyerNearDestroyed(e,s,r){if("copyer"==e.item.type)return this.result_handleFalse();if(r.match.length<=1)return this.result_continue();let l=e.item.color;void 0!==r.color&&-1!=r.color?l=r.color:r.color=l;let i=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let n=0;n<i.length;n++){let c=s.getCellByPos(t.sumPos(e.pos,i[n]));c&&c.item&&("copyer"===c.item.type&&(r.triggered_copyer||(r.triggered_copyer=[]),r.triggered_copyer.includes(c.id)||1==r.match.length&&r.match[0].x!=c.x&&r.match[0].y!=c.y||(void 0!==c.item.colorCopyer&&-1!=c.item.colorCopyer||(c.item.colorCopyer=l,c.item.updated()),c.item.colorCopyer===l&&(r.triggered_copyer.push(c.id),s.checkRules.checkDestroyItem(c,s,void 0,[this.canDestroyItem_cellChest,this.canDestroyItem_life_copyer],[])))))}return this.result_continue()}static canDestroyItem_life_copyer(e,t,s){let r=["copyer"];return r.includes(e.item.type)?(e.item.baseLife||(e.item.baseLife=e.item.life),void 0!==e.item.colorCopyer&&-1!=e.item.colorCopyer||!s||void 0===s.color||-1==s.color||(e.item.colorCopyer=s.color,e.item.updated()),void 0===s.color||-1!=s.color&&e.item.colorCopyer===s.color?void 0===e.item.colorCopyer||-1==e.item.colorCopyer?this.result_continue():(e.item.life--,e.item.updated(),e.item.life>0?this.result_handleFalse():this.result_handleTrue()):this.result_continue()):this.result_continue()}static canDestroyItem_popperNearDestroyed(e,s,r){if("popper"==e.item.type)return this.result_continue();if(r.match.length<3)return this.result_continue();let l=[new t(0,1),new t(1,0),new t(0,-1),new t(-1,0)];for(let i=0;i<l.length;i++){let n=s.getCellByPos(t.sumPos(e.pos,l[i]));n&&n.item&&("popper"===n.item.type&&(r.triggered_popper||(r.triggered_popper=[]),r.triggered_popper.includes(n.id)||1==r.match.length&&r.match[0].x!=n.x&&r.match[0].y!=n.y||(r.triggered_popper.push(n.id),s.checkRules.checkDestroyItem(n,s,void 0,[this.canDestroyItem_oneTime_cell,this.canDestroyItem_cellChest,this.canDestroyItem_life],[]))))}return this.result_continue()}static canDestroyItem_life_popper_os(e,t,s){return"popper"!=e.item.type?this.result_continue():s.match.length<=0?this.result_continue():"popper"!==s.name?this.result_continue():(e.item.life=0,e.item.updated(),this.result_handleTrue())}static canDestroyItem_oneTime_cell(e,t,s){return t.rulesCache||(t.rulesCache={}),t.rulesCache.checkMove||(t.rulesCache.checkMove={}),t.rulesCache.checkMove.oneTime_cell||(t.rulesCache.checkMove.oneTime_cell=[]),-1==t.rulesCache.checkMove.oneTime_cell.indexOf(e.id)?(t.rulesCache.checkMove.oneTime_cell.push(e.id),this.result_continue()):this.result_handleFalse()}static canDestroyItem_oneTime_cell_rulesNoItem(e,t,s){return t.rulesCache||(t.rulesCache={}),t.rulesCache.checkMove||(t.rulesCache.checkMove={}),t.rulesCache.checkMove.oneTime_cell||(t.rulesCache.checkMove.oneTime_cell=[]),-1==t.rulesCache.checkMove.oneTime_cell.indexOf(e.id)?this.result_continue():this.result_handleFalse()}static canTouch_type_item_blockLife(e){return e.item&&"blockLife"===e.item.type?this.result_handleFalse():this.result_continue()}static canTouch_type_item_virus(e){return e.item&&"virus"===e.item.type?this.result_handleFalse():this.result_continue()}static canTouch_type_item_copyer(e){return e.item&&"copyer"===e.item.type?this.result_handleFalse():this.result_continue()}static canTouch_type_cell_blockLife(e){return"blockLife"===e.type?this.result_handleFalse():this.result_continue()}static canTouch_type_cell_chest(e){return"chest"===e.type?this.result_handleFalse():this.result_continue()}static canTouch_type_item_popper(e){return e.item&&"popper"===e.item.type?this.result_handleFalse():this.result_continue()}}void 0===window.playtouchGame&&(window.playtouchGame={}),void 0===window.playtouchGame.match3&&(window.playtouchGame.match3={}),window.playtouchGame.match3.RulesClass=e;var t=window.playtouchGame.match3.Pos})();