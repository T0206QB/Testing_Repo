function Board(){this.gridWidth=0,this.gridHeight=0,this.grid=[],this.boardData=[],this.changeLog={},this.equationsList={},this.gameInitialised=!1,this.gameOver=!1,this.boardSolutionsSheet={},this.equationCount=0}function Tile(){this.id=Tile.prototype.currId++,this.value=0,this.ghost=!1,this.isMoveable=!1,this.homeCell="",this.board=void 0}function shuffleArray(t){for(var e,i,r=t.length;r;)i=Math.floor(Math.random()*r--),e=t[r],t[r]=t[i],t[i]=e;return t}function shuffleObject(t){for(var e=shuffleArray(Object.keys(t)),i={},r=0;r<e.length;r++){var o=e[r];i[o]=t[o]}return i}function emptyArray(t){return 0!==t.length&&(t.length=0),t}function padValue(t,e){var i=(""+t).length,r="",o="",n=0;if(i<e)for(n=0;n<e-i;n++)n%2==0?r+=" ":o+=" ";return"[ "+r+t+o+" ]"}function stringifyArray(t,e){var i="";if(0==t.length)return i;for(var r=0;r<t.length;r++)r===t.length-1?i+=t[r]:i+=t[r]+e;return i}function generateRandom(t){var e=[.5,.8,1],i=0;t<2&&(t=2);for(var r=[t-1,t,t+1],o=Math.random(),n=0;n<e.length;n++)if(i=0,n-1>=0&&(i=e[n-1]),i<o&&o<=e[n])return r[n]}Board.prototype.initLevelFromPack=function(t){return Tile.prototype.currId=0,this.boardLog("initializeBoardLog").setWidth(parseInt(t.w)).setHeight(parseInt(t.h)).setBoardData(t.d.split(",")).setUpBoardAssets().setGameOver(!1).setGameInitialised()},Board.prototype.setUpBoardAssets=function(){for(var t=this.getBoardData(),e=this.getWidth(),i=this.getHeight(),r=0;r<e;r++)for(var o=0;o<i;o++){var n=t[r+o*e],a=r+"_"+o,s={canAccomodate:this.getValueFromDataSegment("canAccomodate",n),isPartOfEquation:this.getValueFromDataSegment("isPartOfEquation",n),logicX:r,logicY:o,tile:{}},u={value:this.getValueFromDataSegment("value",n),ghost:!1,isMoveable:this.getValueFromDataSegment("isMoveable",n),board:this};this.setCell(a,s),u.value&&this.createTileIntoCell(a,this.createTile(u))}return this.detectAndSaveEquations(),this.initSolutionFinder(),this},Board.prototype.getValueFromDataSegment=function(t,e){switch(t){case"canAccomodate":case"isMoveable":return"L"!=e[0];case"isPartOfEquation":return"E"==e[0]||"L"==e[0];case"value":return("M"==e[0]||"L"==e[0])&&e.slice(1);default:return!1}},Board.prototype.createTileIntoCell=function(t,e){return this.addTileToCell(t,e),this.boardLog("create",t),this},Board.prototype.addTileToCell=function(t,e){return this.grid[t].tile=e,this},Board.prototype.removeTileFromCell=function(t){return this.grid[t].tile={},this},Board.prototype.createTile=function(t){return(new Tile).loadConfig(t).setBoard(this)},Board.prototype.detectAndSaveEquations=function(){for(var t=this.getWidth(),e=this.getHeight(),i={},r=0,o=0;o<t;o++)i["column_"+o]=this.returnEquationArrayInColumn(o),i["column_"+o].length>0&&(r+=1);for(var n=0;n<e;n++)i["row_"+n]=this.returnEquationArrayInRow(n),i["row_"+n].length>0&&(r+=1);return this.setEquationsList(i),this.setEquationCount(r),this},Board.prototype.returnEquationArrayInColumn=function(t){for(var e=this.getHeight(),i=0;i<=e-4;i++)if(this.checkFor5ConsecutiveVerticalCells(t,i))return[t+"_"+i,t+"_"+(i+1),t+"_"+(i+2),t+"_"+(i+3),t+"_"+(i+4)];return[]},Board.prototype.returnEquationArrayInRow=function(t){for(var e=this.getWidth(),i=0;i<=e-4;i++)if(this.checkFor5ConsecutiveHorizontalCells(i,t))return[i+"_"+t,i+1+"_"+t,i+2+"_"+t,i+3+"_"+t,i+4+"_"+t];return[]},Board.prototype.checkFor5ConsecutiveVerticalCells=function(t,e){for(var i=0;i<5;i++){if(!this.getCell(t+"_"+e).isPartOfEquation)return!1;e+=1}return!0},Board.prototype.checkFor5ConsecutiveHorizontalCells=function(t,e){for(var i=0;i<5;i++){if(!this.getCell(t+"_"+e).isPartOfEquation)return!1;t+=1}return!0},Board.prototype.log=function(){var t="",e=0,i=0,r="",o=this.getHeight(),n=this.getWidth(),a=this.getMaxDataWidth()<3?3:this.getMaxDataWidth();for(e=0;e<n;e++)r+=padValue(e,a).replace("["," ").replace("]"," ");for(t+=padValue("Y\\X",a).replace("["," ").replace("]"," ")+r,i=0;i<o;i++)for(e=0;e<n;e++){var s=this.getTileAt(e,i),u=padValue(s.getValue(),a);s.canMove()&&(u=u.replace("[",">").replace("]","<")),this.getCell(e+"_"+i).isPartOfEquation||(u=u.replace("["," ").replace("]"," ")),t+=0===e?"\n"+padValue(i,a).replace("["," ").replace("]"," ")+u:u}return window.console.log("%c"+t,"color: DodgerBlue"),this},Board.prototype.getMaxDataWidth=function(){var t=0,e=0,i=0,r=this.getHeight(),o=this.getWidth();for(e=0;e<r;e++)for(t=0;t<o;t++){var n=this.getTileAt(t,e).getValueWidth();i<n&&(i=n)}return i},Board.prototype.getTileAt=function(t,e){var i=t;t>=0&&e>=0&&(i=t+"_"+e);var r=this.getCell(i).tile;return void 0===r||JSON.stringify(r)===JSON.stringify({})?this.createTile({value:"",ghost:!0,isMoveable:!1,board:void 0}):r},Board.prototype.boardLog=function(t,e,i){switch(t){case"initializeBoardLog":this.changeLog={isInUse:!1,merge:{},destroy:[],swapTiles:[],posChange:[],create:[]};break;case"refresh":this.changeLog.isInUse&&(this.changeLog={isInUse:!1,merge:{},destroy:[],swapTiles:[],posChange:[],create:[]});break;case"export":if(this.changeLog.isInUse){this.changeLog.isInUse=this.changeLog.isInUse.asInt();var r=JSON.stringify(this.changeLog);return this.boardLog("refresh"),r}return!1;case"merge":this.changeLog.isInUse||(this.changeLog.isInUse=!0),this.changeLog.merge={logicX:"",logicY:"",value:""};break;case"destroy":this.changeLog.isInUse||(this.changeLog.isInUse=!0),this.changeLog.destroy.push({logicX:"",logicY:""});break;case"swapTiles":this.changeLog.isInUse||(this.changeLog.isInUse=!0),this.changeLog.swapTiles.push({initLogicX:i.split("_")[0],initLogicY:i.split("_")[1],finalLogicX:e.split("_")[0],finalLogicY:e.split("_")[1]});break;case"posChange":this.changeLog.isInUse||(this.changeLog.isInUse=!0),this.changeLog.posChange.push({initLogicX:i.split("_")[0],initLogicY:i.split("_")[1],finalLogicX:e.split("_")[0],finalLogicY:e.split("_")[1]});break;case"create":this.changeLog.isInUse||(this.changeLog.isInUse=!0),this.changeLog.create.push({logicX:e.split("_")[0],logicY:e.split("_")[1],value:this.getTileAt(e).getValue(),tag:e,canAccomodate:this.getCell(e).canAccomodate.asInt(),isMoveable:this.getTileAt(e).canMove().asInt()});break;default:return!1}return this},Board.prototype.isTileMoveableConstruct=function(t){return this.getTileAt(t).canMove().asInt()},Board.prototype.computeX=function(t,e,i){var r=e+(.5+t)*i;return Math.floor(10*r)/10},Board.prototype.computeY=function(t,e,i){var r=e+(.5+t)*i;return Math.floor(10*r)/10},Board.prototype.isMoveArrayValid=function(t){return!(!this.getTileAt(t[0]).canMove()||!this.getCell(t[1]).canAccomodate)},Board.prototype.moveTileToCell=function(t){var e=t[0],i=t[1],r=this.getTileAt(e),o=this.getTileAt(i);return this.removeTileFromCell(e),this.removeTileFromCell(i),o.isGhost()?(this.addTileToCell(i,r),this.boardLog("posChange",i,e)):(this.addTileToCell(e,o),this.addTileToCell(i,r),this.boardLog("swapTiles",e,i)),this.checkBoardSolutions()},Board.prototype.checkBoardSolutions=function(){var t=this.getEquationsList(),e=!0;for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if(Array.isArray(r)&&0!==r.length&&!this.isEquationSolutionValid(r)){e=!1;break}}return this.setGameOver(e),this},Board.prototype.isEquationSolutionValid=function(t){if(!this.isEquationArrayFullOfTiles(t))return!1;var e=this.extractValuesArray(t);return this.checkEquationSolution(e)},Board.prototype.doesCellContainTile=function(t){return!this.getTileAt(t).isGhost()&&!this.getTileAt(t).isGhost()},Board.prototype.doesCellContainTileConstruct=function(t){return this.getTileAt(t).isGhost()||this.getTileAt(t).isGhost()?(!1).asInt():(!0).asInt()},Board.prototype.isEquationArrayFullOfTiles=function(t){for(var e=0;e<t.length;e++)if(!this.doesCellContainTile(t[e]))return!1;return!0},Board.prototype.extractValuesArray=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=this.getTileAt(t[i]).getValue();return e},Board.prototype.checkEquationIntegrity=function(t){return!!(this.isANumber(t[0])&&this.isEqualitySign(t[1])&&this.isANumber(t[2])&&this.isArithmeticOperator(t[3])&&this.isANumber(t[4]))||!!(this.isANumber(t[0])&&this.isEqualitySign(t[3])&&this.isANumber(t[2])&&this.isArithmeticOperator(t[1])&&this.isANumber(t[4]))},Board.prototype.isANumber=function(t){return parseInt(t)>0},Board.prototype.isEqualitySign=function(t){return"="===t},Board.prototype.isArithmeticOperator=function(t){return"+"===t||"-"===t||"/"===t||"*"===t},Board.prototype.checkEquationSolution=function(t){if(!this.checkEquationIntegrity(t))return!1;var e=0,i=0,r=0,o="";if(this.isEqualitySign(t[3])){if(e=parseInt(t[4]),i=parseInt(t[0]),r=parseInt(t[2]),o=t[1],e===this.doCalculation(o,i,r))return!0}else{if(!this.isEqualitySign(t[1]))return!1;if(e=parseInt(t[0]),i=parseInt(t[2]),r=parseInt(t[4]),o=t[3],e===this.doCalculation(o,i,r))return!0}return!1},Board.prototype.doCalculation=function(t,e,i){switch(t){case"+":return this.addNumbers(e,i);case"-":return this.substractNumbers(e,i);case"/":return this.divideNumbers(e,i);case"*":return this.multiplyNumbers(e,i);default:return!1}},Board.prototype.addNumbers=function(t,e){return t+e},Board.prototype.substractNumbers=function(t,e){return Math.abs(t-e)},Board.prototype.divideNumbers=function(t,e){return t/e},Board.prototype.multiplyNumbers=function(t,e){return t*e},Board.prototype.solveOneEquation=function(){for(var t=this.fetchNextUnsolvedEquation(),e=this.extractValuesArray(t),i=this.getBoardSolutionsSheet(),r=this.getGrid(),o=0;o<t.length;o++)if(this.getCell(t[o]).canAccomodate&&this.getCell(t[o]).isPartOfEquation){var n=t[o],a=i[n],s=!1;if(e[o]===a)continue;for(var u in r){if(r.hasOwnProperty(u))if(u!==n)if(this.doesCellContainTile(u))if((l=this.getTileAt(u)).canMove()&&l.getValue()===a&&!this.getCell(u).isPartOfEquation){this.moveTileToCell([u,n]),s=!0;break}}if(!s)for(var u in r){var l;if(r.hasOwnProperty(u))if(u!==n)if(this.doesCellContainTile(u))if((l=this.getTileAt(u)).canMove()&&l.getValue()===a&&this.getCell(u).isPartOfEquation&&!this.doesTileSatisfyAllEquations(u)){this.moveTileToCell([u,n]);break}}}return this},Board.prototype.fetchNextUnsolvedEquation=function(){var t=this.getEquationsList(),e=[];for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if(Array.isArray(r)&&0!==r.length&&!this.isEquationSolutionValid(r)){e=r;break}}return e},Board.prototype.doesTileSatisfyAllEquations=function(t){var e=this.getTileAt(t),i=this.getEquationsList();if(e.isGhost())return!1;for(var r in i)if(i.hasOwnProperty(r)&&0!==i[r].length)for(var o=i[r],n=0;n<o.length;n++)if(o[n]===t&&!this.checkEquationSolution(this.extractValuesArray(o)))return!1;return!0},Board.prototype.doesTileSatisfyAtleastOneEquation=function(t){var e=this.getTileAt(t),i=this.getEquationsList();if(e.isGhost())return!1;for(var r in i)if(i.hasOwnProperty(r)&&0!==i[r].length)for(var o=i[r],n=0;n<o.length;n++)if(o[n]===t&&this.checkEquationSolution(this.extractValuesArray(o)))return!0;return!1},Board.prototype.doesTileNotSatisfyAtleastOneFullEquation=function(t){var e=this.getTileAt(t),i=this.getEquationsList();if(e.isGhost())return!1;for(var r in i)if(i.hasOwnProperty(r)&&0!==i[r].length)for(var o=i[r],n=0;n<o.length;n++)if(o[n]===t&&this.isEquationArrayFullOfTiles(o)&&!this.checkEquationSolution(this.extractValuesArray(o)))return!0;return!1},Board.prototype.returnTileColorConstruct=function(t){return 0===this.checkIfPartOfEquation(t)?0:this.doesTileSatisfyAtleastOneEquation(t)?2:this.doesTileNotSatisfyAtleastOneFullEquation(t)?1:0},Board.prototype.initSolutionFinder=function(){var t=JSON.parse(JSON.stringify(this.getEquationsList())),e=this.fetchMoveableTileValues();t._keys=Object.keys(t);var i=this.iterateEquations(t,e,0);return i?(this.setBoardSolutionsSheet(i.solutionsObject),this):this.initSolutionFinder()},Board.prototype.iterateEquations=function(t,e,i){if(i>1e3)return!1;for(var r=!0,o={solved:!1,moveableTileValuesStack:[],currSolution:{}},n={moveableTileValuesStack:Object.assign([],e),solutionsObject:{}},a=t._keys,s=0;s<a.length;s++){var u=t[a[s]];if(0!==u.length){if(!0!==(o=this.iterateEquationForSolution(u,n)).solved){r=!1;break}var l=o.moveableTileValuesStack,h=o.currSolution;n.moveableTileValuesStack=l,h!=={}&&(n.solutionsObject=this.addToObject(h,n.solutionsObject))}}return r?n:(i+=1,t._keys=shuffleArray(t._keys),e=shuffleArray(e),this.iterateEquations(t,e,i))},Board.prototype.iterateEquationForSolution=function(t,e){for(var i=!0,r=this.extractAndUpdateValuesArray(t,e.solutionsObject),o=this.countNbOfMissingTiles(t),n=[],a=[],s={},u=0;i;){a=Object.assign([],r),s={},n=shuffleArray(n=Object.assign([],e.moveableTileValuesStack));for(var l=0;l<a.length;l++)if(""===a[l]){n=shuffleArray(n);var h,c=this.findIndexOfBestValue(a,l,n),g=t[l];h=n[c],a[l]=h,s[g]=h,n.splice(c,1)}this.checkEquationSolution(a)?(i=!1,e={solved:!0,moveableTileValuesStack:n,currSolution:s}):(u>1e3&&(i=!1,e={solved:!1,moveableTileValuesStack:[],currSolution:{}}),o===e.moveableTileValuesStack.length&&u>120&&(i=!1,e={solved:!1,moveableTileValuesStack:[],currSolution:{}})),u+=1}return e},Board.prototype.findIndexOfBestValue=function(t,e,i){switch(e){case 0:case 2:case 4:return this.getNumberIndex(i);case 1:return this.isEqualitySign(t[3])?this.getArithmeticOperatorIndex(i):this.isArithmeticOperator(t[3])?this.getEqualityIndex(i):this.getArithmeticOperatorOrEqualityIndex(i);case 3:return this.isEqualitySign(t[1])?this.getArithmeticOperatorIndex(i):this.isArithmeticOperator(t[1])?this.getEqualityIndex(i):this.getArithmeticOperatorOrEqualityIndex(i);default:return i.length-1}},Board.prototype.getNumberIndex=function(t){for(var e=0;e<t.length;e++)if(this.isANumber(t[e]))return e;return t.length-1},Board.prototype.getEqualityIndex=function(t){for(var e=0;e<t.length;e++)if(this.isEqualitySign(t[e]))return e;return t.length-1},Board.prototype.getArithmeticOperatorIndex=function(t){for(var e=0;e<t.length;e++)if(this.isArithmeticOperator(t[e]))return e;return t.length-1},Board.prototype.getArithmeticOperatorOrEqualityIndex=function(t){for(var e=0;e<t.length;e++)if(this.isEqualitySign(t[e])||this.isArithmeticOperator(t[e]))return e;return t.length-1},Board.prototype.addToObject=function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},Board.prototype.extractAndUpdateValuesArray=function(t,e){var i=this.extractValuesArray(t);if(0===Object.keys(e).length)return i;for(var r=0;r<t.length;r++)if(""===i[r])for(var o in e)e.hasOwnProperty(o)&&t[r]===o&&(i[r]=e[o]);return i},Board.prototype.countNbOfMissingTiles=function(t){for(var e=0,i=0;i<t.length;i++)this.doesCellContainTile(t[i])||(e+=1);return e},Board.prototype.fetchMoveableTiles=function(){var t=[],e=this.getGrid();for(var i in e)if(e.hasOwnProperty(i)&&this.doesCellContainTile(i)){var r=this.getTileAt(i);r.canMove()&&t.push(r)}return t},Board.prototype.fetchMoveableTileValues=function(){for(var t=[],e=this.fetchMoveableTiles(),i=0;i<e.length;i++){var r=e[i];t.push(r.getValue())}return t},Board.prototype.playerMove=function(t){if(this.getGameOver())return!1;var e=t.split(",");return!!this.isMoveArrayValid(e)&&(this.boardLog("refresh"),this.moveTileToCell(e),DEBUG_MODE&&this.log(),this.boardLog("export"))},Board.prototype.useHints=function(){return!this.getGameOver()&&(this.boardLog("refresh"),this.solveOneEquation(),DEBUG_MODE&&this.log(),this.boardLog("export"))},Board.prototype.setWidth=function(t){return"number"==typeof t&&(this.gridWidth=t),this},Board.prototype.getWidth=function(){return this.gridWidth},Board.prototype.setHeight=function(t){return"number"==typeof t&&(this.gridHeight=t),this},Board.prototype.getHeight=function(){return this.gridHeight},Board.prototype.setEquationCount=function(t){return"number"==typeof t&&(this.equationCount=t),this},Board.prototype.getEquationCount=function(){return this.equationCount},Board.prototype.getGrid=function(){return this.grid},Board.prototype.setBoardData=function(t){return this.boardData=t,this},Board.prototype.getBoardData=function(){return this.boardData},Board.prototype.setBoardSolutionsSheet=function(t){return this.boardSolutionsSheet=t,this},Board.prototype.getBoardSolutionsSheet=function(){return this.boardSolutionsSheet},Board.prototype.setCell=function(t,e){return this.grid[t]=e,this},Board.prototype.getCell=function(t){return this.grid[t]},Board.prototype.checkIfCanAccomodate=function(t){return this.getCell(t).canAccomodate.asInt()},Board.prototype.checkIfPartOfEquation=function(t){return this.getCell(t).isPartOfEquation.asInt()},Board.prototype.setEquationsList=function(t){return this.equationsList=t,this},Board.prototype.getEquationsList=function(){return this.equationsList},Board.prototype.setGameOver=function(t){return this.gameOver=t,this},Board.prototype.getGameOver=function(){return this.gameOver},Board.prototype.setGameInitialised=function(){return this.gameInitialised=!0,DEBUG_MODE&&this.log(),this},Board.prototype.getGameInitialised=function(){return this.gameInitialised},Tile.prototype.loadConfig=function(t){for(var e in t)t.hasOwnProperty(e)&&void 0!==this[e]&&(this[e]=t[e]);return this},Tile.prototype.getValue=function(){return this.ghost?"":this.value},Tile.prototype.getValueWidth=function(){return this.ghost?0:(""+this.getValue()).length},Tile.prototype.setValue=function(t){return"number"==typeof t&&(this.value=t),this},Tile.prototype.getBoard=function(){return this.board},Tile.prototype.setBoard=function(t){return this.board=t,this},Tile.prototype.getHomeCell=function(){return this.homeCell},Tile.prototype.setHomeCell=function(t){return this.homeCell=t,this},Tile.prototype.isGhost=function(){return this.ghost},Tile.prototype.setGhost=function(){return this.ghost=!0,this.id=-1,this},Tile.prototype.getId=function(){return this.id},Tile.prototype.canMove=function(){return this.isMoveable},Tile.prototype.setIsMoveable=function(){return this.isMoveable=!0,this},Boolean.prototype.asInt=function(){return this.valueOf()?1:0};var logicaLoaded=!0,DEBUG_MODE=!1;DEBUG_MODE&&console.log("Logic Loaded"),"object"!=typeof window.playtouch&&(window.playtouch={}),playtouch.Board=Board;