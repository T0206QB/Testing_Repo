!function(){var e=window.playtouchGame.match3.Pos;class t extends window.playtouchGame.match3.Grid{constructor(){super()}init(){return super.init(...arguments),this.addRules("match",[this.rulesClass.match_Cross9,this.rulesClass.match_Cross8,this.rulesClass.match_Cross7,this.rulesClass.match_Cross7_2,this.rulesClass.match_T7,this.rulesClass.match_5,this.rulesClass.match_Cross6,this.rulesClass.match_Cross5,this.rulesClass.match_T6,this.rulesClass.match_T5,this.rulesClass.match_L5,this.rulesClass.match_4,this.rulesClass.match_3]),this.addRules("matchItems",[this.rulesClass.matchItems_type_popper,this.rulesClass.matchItems_cell_type_chest,this.rulesClass.matchItems_type_sinker,this.rulesClass.matchItems_type_copyer,this.rulesClass.matchItems_type_virus,this.rulesClass.matchItems_type_blockLife,this.rulesClass.matchItems_type_colorBomb,this.rulesClass.matchItems_type_totem,this.rulesClass.matchItems_color,this.rulesClass.matchItems_all]),this.addRules("swapItems",[this.rulesClass.swapItems_near1Cell,this.rulesClass.swapItems_noSwap,this.rulesClass.swapItems_blockLife]),this.addRules("swapItemsMatch",[this.rulesClass.swapItems_bonus,this.rulesClass.swapItems_match]),this.addRules("sortCells",this.rulesClass.sortCells_bottom),this.addRules("move",[this.rulesClass.move_bottom_1,this.rulesClass.move_bottomLeftRight_nearBorder_1,this.rulesClass.move_bottomLeftRight_1]),this.addRules("canMove",[this.rulesClass.canMove_type_noMove,this.rulesClass.canMove_type_blockLife,this.rulesClass.canMove_type_void,this.rulesClass.canMove_empty]),this.addRules("canCreateItem",[this.rulesClass.canCreateItem_void]),this.addRules("canDestroyNoItem",[this.rulesClass.canDestroyItem_oneTime_cell_rulesNoItem,this.rulesClass.canDestroyItem_cellBGLife]),this.addRules("canDestroyItem",[this.rulesClass.canDestroyItem_oneTime_cell,this.rulesClass.canDestroyItem_cellChest,this.rulesClass.canDestroyItem_cellBlockLife,this.rulesClass.canDestroyItem_totem,this.rulesClass.canDestroyItem_popperNearDestroyed,this.rulesClass.canDestroyItem_virusNearDestroyed,this.rulesClass.canDestroyItem_blockLifeNearDestroyed,this.rulesClass.canDestroyItem_sinkerNearDestroyed,this.rulesClass.canDestroyItem_copyerNearDestroyed,this.rulesClass.canDestroyItem_life,this.rulesClass.canDestroyItem_all]),this.addRules("createItem",this.rulesClass.createItemDefault_type_random4),this.addRules("canTouch",[this.rulesClass.canTouch_type_item_popper,this.rulesClass.canTouch_type_item_copyer,this.rulesClass.canTouch_type_cell_chest]),this}}class s extends window.playtouchGame.match3.Cell{constructor(){super(...arguments)}}void 0===window.playtouchGame&&(window.playtouchGame={}),void 0===window.playtouchGame.match3&&(window.playtouchGame.match3={}),window.playtouchGame.main=new class{constructor(){}createGrid(e,i,r,l=0){return this.grid=new t,this.grid.init(e,i,s),this.timeoutId=[],this.TIME_BETWEEN_DESTROY=r,this.TIME_BETWEEN_DESTROY_START=l,this}destroy(){for(var e=0;e<this.timeoutId.length;e++)clearTimeout(this.timeoutId[e]);delete this.grid,playtouch.seedsField.uproot("createItem_color")}clearTimeoutId(e){for(var t=0;t<this.timeoutId.length;t++)this.timeoutId[t]===e&&this.timeoutId.splice(t,1)}isTimeoutExist(){return Math.min(1,this.timeoutId.length)}createItem(e,t,s,i=!1){let r=this.grid.getCell(e,t);if(r.item){if(i)return this.destroyItem(e,t),this.createItem(...arguments);this.grid.applyOption(r.item,s),r.item.updated()}else this.grid.itemCreateOnPos(e,t,s)}loadLd(t,s){"string"==typeof t&&(t=JSON.parse(t)),this.ld=t,this.lvl=s,window.saveStateLvl||(window.saveStateLvl={}),window.saveStateLvl[s]={st:"ok",mp:void 0,pack:t.old.split("_")[0],lvl:t.old.split("_")[1]};var i="createItem_color";playtouch.seedsField.plant(i,s+(t.seed?"_"+t.seed:0)),window.saveStateLvl[s].seedValue=t.seed?t.seed:"";let r=[];for(let s=0;s<t.grid.length;s++)t.grid[s].spawnPoint&&r.push(new e(t.grid[s].x,t.grid[s].y));this.grid.rules.posCreateItem=[],this.grid.addRules("posCreateItem",[function(e,t,s,i){return e}.bind(void 0,r)]),this.grid.addRules("createItemOption",function(e,t){var s=0;return s=c2_callFunction("tuto_gameMain_isOnTuto",[],"match3:dev")?playtouch.seedsField.random(e):Math.random(),{color:Math.floor(s*t)}}.bind(void 0,i,t.nbColor)),this.currentLDColor=t.nbColor,this.grid.addRules("createItem",function(e,t,s,i,r){for(i.item=new s.itemClass(i,s,Math.floor(playtouch.seedsField.random(t)*e)),s.applyOption(i.item,r);s.checkMatch(!1,!1,!0).length>0;)i.item.color=Math.floor(playtouch.seedsField.random(t)*e);return i.item.create(),i.item}.bind(void 0,t.nbColor,i)),this.grid.ld_load(t.grid,t.nbColor);for(let e=0;e<r.length;e++)this.grid.getCell(r[e].x,r[e].y).isSpawn=!0;this.grid.addRules("createItem",function(e,t,s,i){s.item=new t.itemClass(s,t),t.applyOption(s.item,i);let r=c2_callFunction("cnd_totemLeftToCreate");if(s&&s.isSpawn&&r>0&&c2_callFunction("canCreateTotem")){let i=t.cells.filter((function(e){if(e.item&&"totem"==e.item.type)return e})).length;i<e&&i<r&&(s.item.type="totem")}return s.item.create(),s.item}.bind(void 0,this.grid.cells.filter((function(e){if(e.item&&"totem"==e.item.type)return e})).length)),this.grid.movePossible(!0)}add1ColorOnCreate(e=6){this.currentLDColor=Math.min(e,this.currentLDColor+1),this.grid.addRules("createItemOption",function(e){return{color:Math.floor(Math.random()*e)}}.bind(void 0,this.currentLDColor))}scoreDestroyBonus(){c2_callFunction("addScoreGlobal",[100])}destroyBombRadius(t,s,i,r=-1,l=-1,o=-1,a=!0,h=void 0){if(-1!==l){let e=this.grid.getCell(s,i),t=this.grid.getCell(r,l);e.item&&e.item.setType(""),t.item&&t.item.setType("")}let c=o,m=[];for(let s=-t;s<=t;s++)for(let i=-t;i<=t;i++)a&&Math.abs(i)==t&&Math.abs(s)==t||m.push(new e(s,i));let n=new e(s,i),d=this.grid.getCellByPos(n);if(d.item){["totem","key","copyer","sinker","switcher","exploder","popper","blockLife","virus"].includes(d.item.type)||d.item.setType(""),-1==c&&(c=d.item.color)}this.destroyBombR(n,m,c,h)}destroyBombR(t,s,i,r="bonus_Bomb"){let l=[],o={match:[],name:r,color:i};for(let i=0;i<s.length;i++){let r,a=e.sumPos(t,s[i]),h=this.grid.getCellByPos(a),c=o;h&&(l.push(h),h.item&&"copyer"==h.item.type&&(c.match=[t],r=[this.grid.rulesClass.canDestroyItem_oneTime_cell,this.grid.rulesClass.canDestroyItem_life_copyer]),h.item&&"popper"==h.item.type&&(c.match=[t],r=[this.grid.rulesClass.canDestroyItem_life_popper_os,this.grid.rulesClass.canDestroyItem_oneTime_cell,this.grid.rulesClass.canDestroyItem_life]),this.destroyItemByTimeout(this.grid.checkRules.checkDestroyItem.bind(this.grid.checkRules,h,this.grid,c,r,void 0,"bonus"),t,h.pos))}this.check_coat([t],l)}destroyLineCross(e,t,s,i){let r=this.grid.getCell(e,t),l=this.grid.getCell(s,i);r.item&&r.item.setType(""),l.item&&l.item.setType(""),this.destroyLineVertical(e,t),this.destroyLineHorizontal(e,t)}destroyLineVertical(t,s,i=1,r=-1,l=-1,o=-1){if(-1!==l){let e=this.grid.getCell(t,s),i=this.grid.getCell(r,l);e.item&&e.item.setType(""),i.item&&i.item.setType("")}for(var a=0;a<i;a++){let r=[],l=t-Math.floor(i/2)+a;for(let e=0;e<this.grid.cells.length;e++)this.grid.cells[e].x==l&&r.push(this.grid.cells[e]);this.destroyLine(new e(t,s),r,o)}}destroyLineHorizontal(t,s,i=1,r=-1,l=-1,o=-1){if(-1!==l){let e=this.grid.getCell(t,s),i=this.grid.getCell(r,l);e.item&&e.item.setType(""),i.item&&i.item.setType("")}for(var a=0;a<i;a++){let r=[],l=s-Math.floor(i/2)+a;for(let e=0;e<this.grid.cells.length;e++)this.grid.cells[e].y==l&&r.push(this.grid.cells[e]);this.destroyLine(new e(t,s),r,o)}}destroyLine(t,s,i=-1){let r=[],l=[];for(let e=0;e<s.length;e++)s[e].item&&"sinker"==s[e].item.type&&r.push(s[e]);let o=this.grid.getCellByPos(t),a=i;o&&o.item&&-1==a&&(a=o.item.color);for(var h=0;h<s.length;h++){let i,o=s[h],m=!0;for(var c=0;c<r.length;c++){if(e.equal(o.pos,r[c].pos))continue;if(o.pos.x!=r[c].pos.x&&o.pos.y!=r[c].pos.y)continue;let s=e.distPos(t,r[c].pos),i=e.distPos(t,o.pos);if((s>0&&i>0||s<0&&i<0)&&Math.abs(i)>Math.abs(s)){m=!1;break}}m&&(l.push(o),o.item&&"copyer"==o.item.type&&(i=[this.grid.rulesClass.canDestroyItem_life_copyer]),this.destroyItemByTimeout(this.grid.checkRules.checkDestroyItem.bind(this.grid.checkRules,o,this.grid,{match:[t],name:"bonus_line",color:a},i,void 0,"bonus"),t,o.pos))}this.check_coat([t],l)}destroyColorBomb(t,s,i,r=""){let l=[],o=0,a=this.grid.grid[t][s];a.item&&l.push(a);for(let e=0;e<this.grid.cellsSortTop.length;e++){let t=this.grid.cellsSortTop[e];t.item&&("colorBomb"!==t.item.type&&"blockLife"!==t.item.type&&"chest"!==t.type&&t.item.color===i&&(""!==r&&""===t.item.type&&t.item.setType(r,!1),l.push(t)))}for(let t=0;t<l.length;t++)l[t].item&&(this.destroyItemByTimeout(this.grid.checkRules.checkDestroyItem.bind(this.grid.checkRules,l[t],this.grid,void 0,void 0,void 0,"bonus_colorBomb"),new e(0,0),l[t].pos,o/2),o++);this.check_coat([new e(t,s)],l)}destroyColorBomb_all(t,s){let i=0,r=[];for(let t=0;t<this.grid.cellsSortTop.length;t++){let s=this.grid.cellsSortTop[t];s.item&&(this.destroyItemByTimeout(this.grid.checkRules.checkDestroyItem.bind(this.grid.checkRules,s,this.grid,void 0,void 0,void 0,"bonus_colorBomb"),new e(0,0),s.pos,i/10),r.push(s),i++)}this.check_coat([new e(t,s)],r)}destroyTotem(e,t){let s=this.grid.getCell(e,t);return!!s.item&&("totem"==s.item.type&&(!("blockLife"==s.type&&s.life>0)&&(!("chest"==s.type&&s.life>0)&&this.grid.checkRules.checkDestroyItem(s,this.grid,void 0,[this.grid.rulesClass.canDestroyItem_all],[]))))}destroyItem(e,t,s=""){let i=this.grid.grid[e][t];i.item&&this.grid.checkRules.checkDestroyItem(i,this.grid,void 0,void 0,void 0,s)}destroyKey(){let e=!1;for(let t=0;t<this.grid.cells.length;t++)"chest"==this.grid.cells[t].type&&(this.grid.cells[t].life--,this.grid.cells[t].life<=0&&(this.grid.cells[t].setType(""),e=!0),this.grid.cells[t].updated());e&&this.grid.checkMatch(!0)}destroyItemByTimeout(t,s,i,r){var l=playtouch.arrayWaitForFunction.waitForFunctionJS(this.TIME_BETWEEN_DESTROY_START+(void 0===r?Math.abs(e.distPos(s,i)):r)*this.TIME_BETWEEN_DESTROY,(()=>{this.clearTimeoutId(l),t()}));this.timeoutId.push(l)}setItemType(e,t,s=""){let i=this.grid.getCell(e,t);i.item&&i.item.setType(s)}addStarterItem(t,s){let i=[],r={used:0,type:t};for(let t=0;t<this.grid.cellsSortTop.length;t++){let s=this.grid.cellsSortTop[t];"bgLife"!==s.type&&"coat"!==s.type&&""!==s.type||s.item&&""===s.item.type&&(playtouchGame.main.ld.grid.find((t=>t.items&&e.equal(s.pos,new e(t.x,t.y))))||i.push(s))}if(i.length<=0)return JSON.stringify(r);let l=i[Math.floor(Math.random()*i.length)],o={type:t};return void 0!==s&&(o.color=s),window.eventToFire.fireEvent("c2:libJewel:itemStarter",this.grid.getCell(l.x,l.y).item.uid),this.createItem(l.x,l.y,o),r.color=this.grid.getCell(l.x,l.y).item.color,r.used=1,r.x=l.x,r.y=l.y,JSON.stringify(r)}addVirus(){let t=[new e(0,1),new e(1,0),new e(0,-1),new e(-1,0)],s=[],i=["line_h","line_v","bomb","colorBomb"];for(let r=0;r<this.grid.cells.length;r++){let l=this.grid.cells[r];if(l.item&&"virus"==l.item.type)for(let r=0;r<t.length;r++){let o=this.grid.getCellByPos(e.sumPos(l.pos,t[r]));o&&(""!=o.type&&"coat"!=o.type||(o.item?(""===o.item.type||i.includes(o.item.type))&&s.push(o):s.push(o)))}}if(s.length<=0)return!1;let r=s[Math.floor(Math.random()*s.length)];return r.item?!(""!==r.item.type&&!i.includes(r.item.type))&&(r.setType(""),r.item.setType("virus"),!0):(r.setType(""),this.grid.itemCreateOnCell(r,{type:"virus"}),!0)}victory_destroyAllBonus(){let e=["line","line_h","line_v","bomb","colorBomb"],t=["blockLife","chest"],s=!1;for(let i=0;i<this.grid.cells.length;i++){let r=this.grid.cells[i];r.item&&(t.includes(r.type)||e.includes(r.item.type)&&(this.destroyItem(r.x,r.y,"victory"),s=!0))}return s}victory_createBonusLine(e){let t=!1,s=[],i=["blockLife","chest"];for(let e=0;e<this.grid.cells.length;e++){let r=this.grid.cells[e];r.item&&(""!=!r.item.type&&(i.includes(r.type)||(s.push(r.item),t=!0)))}!function(e){for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}(s);for(var r=0;r<e&&!(r>=s.length);r++)this.createItem(s[r].x,s[r].y,{type:Math.random()>.5?"line_v":"line_h"});return t}exploder_addTurn(e){for(let t=0;t<this.grid.cells.length;t++){let s=this.grid.cells[t];s.item&&("exploder"==s.item.type&&(s.item.timer=Math.max(e,s.item.timer+e)))}}check_coat_fromC2Match(t={match:[]}){"string"==typeof t&&(t=JSON.parse(t));let s=[];for(var i=0;i<t.match.length;i++)s.push(new e(t.match[i].x,t.match[i].y));this.check_coat(s)}check_coat(e=[],t=[],s=!1){if(e.length<=0)return!1;let i=!1;for(let t=0;t<e.length;t++)(e[t].pos||(e[t]=this.grid.getCellByPos(e[t]),e[t]))&&"coat"==e[t].type&&(i=!0);if(!i)return!1;for(let e=0;e<t.length;e++)t[e].pos||(t[e]=this.grid.getCellByPos(t[e]));t.push(...e);for(let e=0;e<t.length;e++)t[e].item&&"popper"!=t[e].item.type&&"copyer"!=t[e].item.type&&"blockLife"!=t[e].item.type&&(""!=t[e].type&&"totem"!=t[e].type||t[e].setType("coat"))}createOnMatch(t,s){"string"==typeof t&&(t=JSON.parse(t));let i,r=!1;t.match.unshift(new e(t.posCreate.x,t.posCreate.y));for(var l=0;l<t.match.length&&(0!=l&&t.match[l].x==t.posCreate.x&&t.match[l].y==t.posCreate.y||(i=this.grid.getCellByPos(t.match[l]),!i||(i.item?""==i.item.type&&(r=!0):r=!0,!r)));l++);if(r){let e={type:"",color:s};switch(t.name){case"match_4":e.type=["line_v","line_h"][Math.round(Math.random())];break;case"match_4_v":e.type="line_v";break;case"match_4_h":e.type="line_h";break;case"match_T7":case"match_5":case"match_Cross9":case"match_Cross8":case"match_Cross7":case"match_Cross7_2":e.type="colorBomb";break;case"match_T5":case"match_T6":case"match_L4":case"match_L5":case"match_Cross6":case"match_Cross5":e.type="bomb"}""!=e.type&&this.createItem(i.x,i.y,e)}}resetPopper(e,t){let s=this.grid.getCell(e,t);if(!s)return;let i=s.item;i&&"popper"==i.type&&(i.baseLife||(i.baseLife=i.life),i.life=i.baseLife,i.updated())}forceUpdateItem(e,t){let s=this.grid.getCell(e,t);s.item&&s.item.updated()}},window.playtouchGame.utils=new class{constructor(){this.timerMatch={}}sortPosWall(e){for(var t=[(e=Object.values(e)).splice(0,1)[0]];e.length>0;){for(var s=!1,i=0;i<e.length;i++){var r=t[t.length-1];if(r.destX==e[i].startX&&r.destY==e[i].startY){t.push(e.splice(i,1)[0]),s=!0;break}var l=t[0];if(l.destX==e[i].startX&&l.destY==e[i].startY){t.unshift(e.splice(i,1)[0]),s=!0;break}if((r=t[t.length-1]).destX==e[i].destX&&r.destY==e[i].destY){let r=e.splice(i,1)[0];t.push({startX:r.destX,startY:r.destY,destX:r.startX,destY:r.startY}),s=!0;break}if((l=t[0]).startX==e[i].startX&&l.startY==e[i].startY){let r=e.splice(i,1)[0];t.unshift({startX:r.destX,startY:r.destY,destX:r.startX,destY:r.startY}),s=!0;break}}s||t.push(e.splice(0,1)[0])}return JSON.stringify(t)}getBezierXY(e,t,s,i,r,l,o,a,h,c){switch(e){case"x":return Math.pow(1-t,3)*s+3*t*Math.pow(1-t,2)*r+3*t*t*(1-t)*o+t*t*t*h;case"y":return Math.pow(1-t,3)*i+3*t*Math.pow(1-t,2)*l+3*t*t*(1-t)*a+t*t*t*c}}startTime(e="default"){this.timerMatch[e]||(this.timerMatch[e]={lastTime:-1,arr:[],countZero:0}),this.timerMatch[e].lastTime=window.performance.now()}endTime(e="default"){if(!this.timerMatch[e])return;let t=window.performance.now()-this.timerMatch[e].lastTime;t<=0?this.timerMatch[e].countZero++:(this.timerMatch[e].arr.push(t),this.timerMatch[e].average=this.getTimeAverage(e),this.timerMatch[e].allTime=this.getAllTime(e),this.timerMatch[e].sum=this.sumAllTime(e))}getTimeAverage(e="default"){return this.timerMatch[e]?this.timerMatch[e].arr.length<=0?0:Math.round(this.timerMatch[e].arr.reduce(((e,t)=>e+t))/this.timerMatch[e].arr.length*100)/100:0}getAllTime(e="default"){if(!this.timerMatch[e])return 0;if(this.timerMatch[e].arr.length<=0)return 0;let t=this.timerMatch[e].arr.sort(((e,t)=>t-e));return Math.round(100*t[t.length-1])/100+">"+this.getTimeAverage(e)+"<"+Math.round(100*t[0])/100}resetAllTime(e="default"){this.timerMatch[e]&&(this.timerMatch[e].arr=[])}sumAllTime(e="default"){return this.timerMatch[e]?this.timerMatch[e].arr.length<=0?0:this.timerMatch[e].arr.reduce(((e,t)=>e+t),0):0}decompressString(e,t){var s,i=e.split("|");if((1===i.length||i[0].length>16)&&i.unshift("plain"),s=i.shift(),e=i.join("|"),void 0===t&&(t=s),"lz_Base64"===t)e=LZUTF8.decompress(e,{inputEncoding:t.split("_")[1]});let r={width:"w",height:"h",cells:"c",option:"o",life:"l",starValues:"S",nbColor:"n",grid:"g",type:"t",void:"v",items:"i",color:"C",spawnPoint:"s",value:"V",bgLife:"b",blockLife:"B",sinker:"si",key:"k",totem:"to",exploder:"e",switcher:"sw",virus:"vi",chest:"ch",copyer:"Co",popper:"p",cndLose:"cl",cndWin:"cw",cndType:"ct",turns:"T"};for(let t in r){let s=new RegExp('"'+r[t]+'"',"g");e=e.replace(s,'"'+t+'"')}return e}getLastNotifByName(e,t){e="string"==typeof e?JSON.parse(e):e;var s={name:"",timeEnd:-1};for(var i in e)"active"==e[i].state&&-1!=e[i].name.indexOf(t)&&e[i].timeEnd>s.timeEnd&&(s.name=e[i].name,s.timeEnd=e[i].timeEnd);return s.name}}}();