function flood_fill(t,e,i,s,n,r){function o(e){return g==t[e]&&y==t[e+1]&&m==t[e+2]}function a(e){t[e]=u,t[e+1]=p,t[e+2]=d,t[e+3]=255}function h(t){o(f+t*l)?b[t]||(_.push([s+t,n]),b[t]=!0):b[t]&&(b[t]=!1)}if(!(s<0||s>e||n<0||n>i)){var c=$("<div></div>").css("background-color",r).css("background-color");"transparent"==c&&(c="rgb(0,0,0)"),c=c.slice(4,-1).split(",");var l=4,u=c[0],p=c[1],d=c[2],f=(n*e+s)*l,g=t[f],y=t[f+1],m=t[f+2];if(u!=g||p!=y||d!=m)for(var _=[[s,n]];_.length;){var v;for(v=_.pop(),s=v[0],n=v[1],f=(n*e+s)*l;n-- >=0&&o(f);)f-=e*l;f+=e*l,++n;var b=[];for(b[-1]=!1,b[1]=!1;n++<i-1&&o(f);)a(f),s>0&&h(-1),s<e-1&&h(1),f+=e*l}}}var cr={plugins_:{},behaviors:{}};"function"!=typeof Object.getPrototypeOf&&("object"==typeof"test".__proto__?Object.getPrototypeOf=function(t){return t.__proto__}:Object.getPrototypeOf=function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,s){this.set(t,e,i,s),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}function s(t,e,i,s){t<e?i<s?(m=t<i?t:i,_=e>s?e:s):(m=t<s?t:s,_=e>i?e:i):i<s?(m=e<i?e:i,_=t>s?t:s):(m=e<s?e:s,_=t>i?t:i)}function n(){this.s=null,this.items=null,this.item_count=0,T&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}function r(t){C[O++]=t}function o(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function a(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function h(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function c(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function l(t,e,i){var s;return h.prototype.totalCellCount++,P.length?(s=P.pop(),s.grid=t,s.x=e,s.y=i,s):new cr.GridCell(t,e,i)}function u(t){h.prototype.totalCellCount--,t.objects.clear(),P.length<1e3&&P.push(t)}function p(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}function d(t,e,i){var s;return c.prototype.totalCellCount++,k.length?(s=k.pop(),s.grid=t,s.x=e,s.y=i,s):new cr.RenderCell(t,e,i)}function f(t){c.prototype.totalCellCount--,t.reset(),k.length<1e3&&k.push(t)}function g(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function y(t,e){return t.zindex-e.zindex}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return t>0&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return t>e?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return t>=0?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:e+1},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,s,n,r,o,a){var h,c,l,u,p,d,f,g;if(t<i?(c=t,h=i):(c=i,h=t),n<o?(d=n,p=o):(d=o,p=n),h<d||c>p)return!1;if(e<s?(u=e,l=s):(u=s,l=e),r<a?(g=r,f=a):(g=a,f=r),l<g||u>f)return!1;var y=n-t+o-i,m=r-e+a-s,_=i-t,v=s-e,b=o-n,x=a-r,w=cr.abs(v*b-x*_),S=b*m-x*y;if(cr.abs(S)>w)return!1;var T=_*m-v*y;return cr.abs(T)<=w},e.prototype.set=function(t,e,i,s){this.left=t,this.top=e,this.right=i,this.bottom=s},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){if(0===e)this.set_from_rect(t);else{var i=Math.sin(e),s=Math.cos(e),n=t.left*i,r=t.top*i,o=t.right*i,a=t.bottom*i,h=t.left*s,c=t.top*s,l=t.right*s,u=t.bottom*s;this.tlx=h-r,this.tly=c+n,this.trx=l-r,this.try_=c+o,this.brx=l-a,this.bry=u+o,this.blx=h-a,this.bly=u+n}},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var m=0,_=0;i.prototype.bounding_box=function(t){s(this.tlx,this.trx,this.brx,this.blx),t.left=m,t.right=_,s(this.tly,this.try_,this.bry,this.bly),t.top=m,t.bottom=_},i.prototype.contains_pt=function(t,e){var i=this.tlx,s=this.tly,n=this.trx-i,r=this.try_-s,o=this.brx-i,a=this.bry-s,h=t-i,c=e-s,l=n*n+r*r,u=n*o+r*a,p=n*h+r*c,d=o*o+a*a,f=o*h+a*c,g=1/(l*d-u*u),y=(d*p-u*f)*g,m=(l*f-u*p)*g;if(y>=0&&m>0&&y+m<1)return!0;n=this.blx-i,r=this.bly-s;l=n*n+r*r,u=n*o+r*a,p=n*h+r*c;return g=1/(l*d-u*u),y=(d*p-u*f)*g,m=(l*f-u*p)*g,y>=0&&m>0&&y+m<1},i.prototype.at=function(t,e){if(e)switch(t){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:default:return this.tlx}else switch(t){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:default:return this.tly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,s){if(this.contains_pt(t,e)||this.contains_pt(i,s))return!0;var n,r,o,a,h;for(h=0;h<4;h++)if(n=this.at(h,!0),r=this.at(h,!1),o=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,s,n,r,o,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,s,n,r,o,a,h,c,l,u=t.midX(),p=t.midY();if(this.contains_pt(u,p))return!0;if(u=this.midX(),p=this.midY(),t.contains_pt(u,p))return!0;for(c=0;c<4;c++)for(l=0;l<4;l++)if(e=this.at(c,!0),i=this.at(c,!1),s=this.at(c+1,!0),n=this.at(c+1,!1),r=t.at(l,!0),o=t.at(l,!1),a=t.at(l+1,!0),h=t.at(l+1,!1),cr.segments_intersect(e,i,s,n,r,o,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16},cr.GetRValue=function(t){return 255&t},cr.GetGValue=function(t){return(65280&t)>>8},cr.GetBValue=function(t){return(16711680&t)>>16},cr.shallowCopy=function(t,e,i){var s;for(s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},cr.arrayRemove=function(t,e){var i,s;if(e=cr.floor(e),!(e<0||e>=t.length)){for(i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];cr.truncateArray(t,s)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,s;for(cr.clearArray(t),i=0,s=e.length;i<s;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){var i,s;for(i=0,s=t.length;i<s;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){var i=cr.fastIndexOf(t,e);-1!==i&&cr.arrayRemove(t,i)},cr.clamp=function(t,e,i){return t<e?e:t>i?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return t%=360,t<0&&(t+=360),t},cr.clamp_angle=function(t){return t%=2*cr.PI,t<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,s){var n=i-t,r=s-e;return Math.atan2(r,n)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),r=Math.cos(e),o=i*n+s*r;return o>=1?0:o<=-1?cr.PI:Math.acos(o)},cr.angleRotate=function(t,e,i){var s=Math.sin(t),n=Math.cos(t),r=Math.sin(e),o=Math.cos(e);return Math.acos(s*r+n*o)>i?n*r-s*o>0?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),r=Math.cos(e);return s*n-i*r<=0},cr.rotatePtAround=function(t,e,i,s,n,r){if(0===i)return r?t:e;var o=Math.sin(i),a=Math.cos(i);t-=s,e-=n;var h=t*o,c=e*o,l=t*a,u=e*a;return t=l-c,e=u+h,t+=s,e+=n,r?t:e},cr.distanceTo=function(t,e,i,s){var n=i-t,r=s-e;return Math.sqrt(n*n+r*r)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var s=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+s*i:t-s*i},cr.qarp=function(t,e,i,s){return cr.lerp(cr.lerp(t,e,s),cr.lerp(e,i,s),s)},cr.cubic=function(t,e,i,s,n){return cr.lerp(cr.qarp(t,e,i,n),cr.qarp(e,i,s,n),n)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e]};var v=+new Date;cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-v};var b=!1,x=!1,w=!1,S=!1;"undefined"!=typeof window&&(b=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),x=!b&&/safari/i.test(navigator.userAgent),w=/(iphone|ipod|ipad)/i.test(navigator.userAgent),S=window.c2ejecta);var T=!x&&!S&&!w&&"undefined"!=typeof Set&&void 0!==Set.prototype.forEach;n.prototype.contains=function(t){return!this.isEmpty()&&(T?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},n.prototype.add=function(t){if(T)this.s.has(t)||(this.s.add(t),this.cache_valid=!1);else{var e=t.toString(),i=this.items;i?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1)}},n.prototype.remove=function(t){if(!this.isEmpty())if(T)this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1);else if(this.items){var e=t.toString(),i=this.items;i.hasOwnProperty(e)&&(delete i[e],this.item_count--,this.cache_valid=!1)}},n.prototype.clear=function(){this.isEmpty()||(T?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},n.prototype.isEmpty=function(){return 0===this.count()},n.prototype.count=function(){return T?this.s.size:this.item_count};var C=null,O=0;n.prototype.update_cache=function(){if(!this.cache_valid){if(T)cr.clearArray(this.values_cache),C=this.values_cache,O=0,this.s.forEach(r),C=null,O=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,s=this.items;if(s)for(e in s)s.hasOwnProperty(e)&&(t[i++]=s[e])}this.cache_valid=!0}},n.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=n;var A=new cr.ObjectSet;cr.removeArrayDuplicates=function(t){var e,i;for(e=0,i=t.length;e<i;++e)A.add(t[e]);cr.shallowAssignArray(t,A.valuesRef()),A.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){T?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){var i,s,n,r;for(i=0,s=0,n=t.length;i<n;++i)r=t[i],e.has(r)||(t[s++]=r);cr.truncateArray(t,s)},cr.arrayRemoveAll_arr=function(t,e){var i,s,n,r;for(i=0,s=0,n=t.length;i<n;++i)r=t[i],-1===cr.fastIndexOf(e,r)&&(t[s++]=r);cr.truncateArray(t,s)},o.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},o.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=o,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},a.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},a.prototype.is_empty=function(){return!this.pts_array.length},a.prototype.update_bbox=function(){for(var t,e,i,s=this.pts_cache,n=s[0],r=n,o=s[1],a=o,h=1,c=this.pts_count;h<c;++h)i=2*h,t=s[i],e=s[i+1],t<n&&(n=t),t>r&&(r=t),e<o&&(o=e),e>a&&(a=e);this.bboxLeft=n,this.bboxRight=r,this.bboxTop=o,this.bboxBottom=a},a.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var s=this.pts_cache;s[0]=t.left-e,s[1]=t.top-i,s[2]=t.right-e,s[3]=t.top-i,s[4]=t.right-e,s[5]=t.bottom-i,s[6]=t.left-e,s[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},a.prototype.set_from_quad=function(t,e,i,s,n){this.pts_cache.length=8,this.pts_count=4;var r=this.pts_cache;r[0]=t.tlx-e,r[1]=t.tly-i,r[2]=t.trx-e,r[3]=t.try_-i,r[4]=t.brx-e,r[5]=t.bry-i,r[6]=t.blx-e,r[7]=t.bly-i,this.cache_width=s,this.cache_height=n,this.update_bbox()},a.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},a.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var s,n,r,o,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var c=0,l=1,u=this.pts_array,p=this.pts_cache;for(0!==i&&(c=Math.sin(i),l=Math.cos(i)),s=0,o=this.pts_count;s<o;s++)n=2*s,r=n+1,a=u[n]*t,h=u[r]*e,p[n]=a*l-h*c,p[r]=h*l+a*c;this.update_bbox()}},a.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;var s,n,r,o,a,h,c,l=this.pts_count,u=this.bboxLeft-110,p=this.bboxTop-101,d=this.bboxRight+131,f=this.bboxBottom+120,g=0,y=0;for(s=0;s<l;s++)n=2*s,r=(s+1)%l*2,o=i[n],a=i[n+1],h=i[r],c=i[r+1],cr.segments_intersect(u,p,t,e,o,a,h,c)&&g++,cr.segments_intersect(d,f,t,e,o,a,h,c)&&y++;return g%2==1||y%2==1},a.prototype.intersects_poly=function(t,e,i){var s,n,r,o,a,h,c,l,u,p,d,f,g,y,m,_,v=t.pts_cache,b=this.pts_cache;if(this.contains_pt(v[0]+e,v[1]+i))return!0;if(t.contains_pt(b[0]-e,b[1]-i))return!0;for(s=0,o=this.pts_count;s<o;s++)for(n=2*s,r=(s+1)%o*2,u=b[n],p=b[n+1],d=b[r],f=b[r+1],a=0,l=t.pts_count;a<l;a++)if(h=2*a,c=(a+1)%l*2,g=v[h]+e,y=v[h+1]+i,m=v[c]+e,_=v[c+1]+i,cr.segments_intersect(u,p,d,f,g,y,m,_))return!0;return!1},a.prototype.intersects_segment=function(t,e,i,s,n,r){var o,a,h,c,l,u,p,d,f=this.pts_cache;if(this.contains_pt(i-t,s-e))return!0;for(o=0,a=this.pts_count;o<a;o++)if(h=2*o,c=(o+1)%a*2,l=f[h]+t,u=f[h+1]+e,p=f[c]+t,d=f[c+1]+e,cr.segments_intersect(i,s,n,r,l,u,p,d))return!0;return!1},a.prototype.mirror=function(t){var e,i,s;for(e=0,i=this.pts_count;e<i;++e)s=2*e,this.pts_cache[s]=2*t-this.pts_cache[s]},a.prototype.flip=function(t){var e,i,s;for(e=0,i=this.pts_count;e<i;++e)s=2*e+1,this.pts_cache[s]=2*t-this.pts_cache[s]},a.prototype.diag=function(){var t,e,i,s,n;for(t=0,e=this.pts_count;t<e;++t)i=2*t,s=i+1,n=this.pts_cache[i],this.pts_cache[i]=this.pts_cache[s],this.pts_cache[s]=n},cr.CollisionPoly=a,h.prototype.totalCellCount=0,h.prototype.getCell=function(t,e,i){var s,n=this.cells[t];return n?(s=n[e],s||(i?(s=l(this,t,e),this.cells[t][e]=s,s):null)):i?(s=l(this,t,e),this.cells[t]={},this.cells[t][e]=s,s):null},h.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},h.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},h.prototype.update=function(t,e,i){var s,n,r,o,a;if(e)for(s=e.left,n=e.right;s<=n;++s)for(r=e.top,o=e.bottom;r<=o;++r)i&&i.contains_pt(s,r)||(a=this.getCell(s,r,!1),a&&(a.remove(t),a.isEmpty()&&(u(a),this.cells[s][r]=null)));if(i)for(s=i.left,n=i.right;s<=n;++s)for(r=i.top,o=i.bottom;r<=o;++r)e&&e.contains_pt(s,r)||this.getCell(s,r,!0).insert(t)},h.prototype.queryRange=function(t,e){var i,s,n,r,o,a;for(i=this.XToCell(t.left),n=this.YToCell(t.top),s=this.XToCell(t.right),o=this.YToCell(t.bottom);i<=s;++i)for(r=n;r<=o;++r)a=this.getCell(i,r,!1),a&&a.dump(e)},cr.SparseGrid=h,c.prototype.totalCellCount=0,c.prototype.getCell=function(t,e,i){var s,n=this.cells[t];return n?(s=n[e],s||(i?(s=d(this,t,e),this.cells[t][e]=s,s):null)):i?(s=d(this,t,e),this.cells[t]={},this.cells[t][e]=s,s):null},c.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},c.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},c.prototype.update=function(t,e,i){var s,n,r,o,a;if(e)for(s=e.left,n=e.right;s<=n;++s)for(r=e.top,o=e.bottom;r<=o;++r)i&&i.contains_pt(s,r)||(a=this.getCell(s,r,!1),a&&(a.remove(t),a.isEmpty()&&(f(a),this.cells[s][r]=null)));if(i)for(s=i.left,n=i.right;s<=n;++s)for(r=i.top,o=i.bottom;r<=o;++r)e&&e.contains_pt(s,r)||this.getCell(s,r,!0).insert(t)},c.prototype.queryRange=function(t,e,i,s,n){var r,o,a,h,c,l;for(r=this.XToCell(t),a=this.YToCell(e),o=this.XToCell(i),c=this.YToCell(s);r<=o;++r)for(h=a;h<=c;++h)l=this.getCell(r,h,!1),l&&l.dump(n)},c.prototype.markRangeChanged=function(t){var e,i,s,n,r,o;for(e=t.left,s=t.top,i=t.right,r=t.bottom;e<=i;++e)for(n=s;n<=r;++n)o=this.getCell(e,n,!1),o&&(o.is_sorted=!1)},cr.RenderGrid=c;var P=[];p.prototype.isEmpty=function(){return this.objects.isEmpty()},p.prototype.insert=function(t){this.objects.add(t)},p.prototype.remove=function(t){this.objects.remove(t)},p.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=p;var k=[];g.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},g.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));if(this.objects.length){var e=this.objects[this.objects.length-1];e.get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)}else this.objects.push(t),this.is_sorted=!0},g.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,this.pending_removal.count()>=30&&this.flush_pending()},g.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},g.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(y),this.is_sorted=!0)},g.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},g.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=g;var E=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||t>=11?"source-over":E[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||(e===document||e===window||(!(!document||!document.body||e!==document.body)||!!cr.equals_nocase(e.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var i=t[0],s=t[1],n=t[2],r=Math.sqrt(i*i+s*s+n*n);return r?1===r?(e[0]=i,e[1]=s,e[2]=n,e):(r=1/r,e[0]=i*r,e[1]=s*r,e[2]=n*r,e):(e[0]=0,e[1]=0,e[2]=0,e)},vec3.cross=function(t,e,i){i||(i=t);var s=t[0],n=t[1],r=(t=t[2],e[0]),o=e[1];e=e[2];return i[0]=n*e-t*o,i[1]=t*r-s*e,i[2]=s*o-n*r,i},vec3.length=function(t){var e=t[0],i=t[1];t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i||(i=t);var s=t[0]-e[0],n=t[1]-e[1];t=t[2]-e[2],e=Math.sqrt(s*s+n*n+t*t);return e?(e=1/e,i[0]=s*e,i[1]=n*e,i[2]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},vec3.lerp=function(t,e,i,s){return s||(s=t),s[0]=t[0]+i*(e[0]-t[0]),s[1]=t[1]+i*(e[1]-t[1]),s[2]=t[2]+i*(e[2]-t[2]),s},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],s=t[2],n=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=s,t[7]=n,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},mat3.toMat4=function(t,e){return e||(e=mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],s=t[2],n=t[3],r=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=s,t[9]=r,t[11]=t[14],t[12]=n,t[13]=o,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},mat4.determinant=function(t){var e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],p=t[11],d=t[12],f=t[13],g=t[14];t=t[15];return d*l*a*n-c*f*a*n-d*o*u*n+r*f*u*n+c*o*g*n-r*l*g*n-d*l*s*h+c*f*s*h+d*i*u*h-e*f*u*h-c*i*g*h+e*l*g*h+d*o*s*p-r*f*s*p-d*i*a*p+e*f*a*p+r*i*g*p-e*o*g*p-c*o*s*t+r*l*s*t+c*i*a*t-e*l*a*t-r*i*u*t+e*o*u*t},mat4.inverse=function(t,e){e||(e=t);var i=t[0],s=t[1],n=t[2],r=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],p=t[10],d=t[11],f=t[12],g=t[13],y=t[14],m=t[15],_=i*a-s*o,v=i*h-n*o,b=i*c-r*o,x=s*h-n*a,w=s*c-r*a,S=n*c-r*h,T=l*g-u*f,C=l*y-p*f,O=l*m-d*f,A=u*y-p*g,P=u*m-d*g,k=p*m-d*y,E=1/(_*k-v*P+b*A+x*O-w*C+S*T);return e[0]=(a*k-h*P+c*A)*E,e[1]=(-s*k+n*P-r*A)*E,e[2]=(g*S-y*w+m*x)*E,e[3]=(-u*S+p*w-d*x)*E,e[4]=(-o*k+h*O-c*C)*E,e[5]=(i*k-n*O+r*C)*E,e[6]=(-f*S+y*b-m*v)*E,e[7]=(l*S-p*b+d*v)*E,e[8]=(o*P-a*O+c*T)*E,e[9]=(-i*P+s*O-r*T)*E,e[10]=(f*w-g*b+m*_)*E,e[11]=(-l*w+u*b-d*_)*E,e[12]=(-o*A+a*C-h*T)*E,e[13]=(i*A-s*C+n*T)*E,e[14]=(-f*x+g*v-y*_)*E,e[15]=(l*x-u*v+p*_)*E,e},mat4.toRotationMat=function(t,e){return e||(e=mat4.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],s=t[1],n=t[2],r=t[4],o=t[5],a=t[6],h=t[8],c=t[9],l=t[10],u=l*o-a*c,p=-l*r+a*h,d=c*r-o*h,f=i*u+s*p+n*d;return f?(f=1/f,e||(e=mat3.create()),e[0]=u*f,e[1]=(-l*s+n*c)*f,e[2]=(a*s-n*o)*f,e[3]=p*f,e[4]=(l*i-n*h)*f,e[5]=(-a*i+n*r)*f,e[6]=d*f,e[7]=(-c*i+s*h)*f,e[8]=(o*i-s*r)*f,e):null},mat4.multiply=function(t,e,i){i||(i=t);var s=t[0],n=t[1],r=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],g=t[12],y=t[13],m=t[14],_=(t=t[15],e[0]),v=e[1],b=e[2],x=e[3],w=e[4],S=e[5],T=e[6],C=e[7],O=e[8],A=e[9],P=e[10],k=e[11],E=e[12],I=e[13],L=e[14];e=e[15];return i[0]=_*s+v*a+b*u+x*g,i[1]=_*n+v*h+b*p+x*y,i[2]=_*r+v*c+b*d+x*m,i[3]=_*o+v*l+b*f+x*t,i[4]=w*s+S*a+T*u+C*g,i[5]=w*n+S*h+T*p+C*y,i[6]=w*r+S*c+T*d+C*m,i[7]=w*o+S*l+T*f+C*t,i[8]=O*s+A*a+P*u+k*g,i[9]=O*n+A*h+P*p+k*y,i[10]=O*r+A*c+P*d+k*m,i[11]=O*o+A*l+P*f+k*t,i[12]=E*s+I*a+L*u+e*g,i[13]=E*n+I*h+L*p+e*y,i[14]=E*r+I*c+L*d+e*m,i[15]=E*o+I*l+L*f+e*t,i},mat4.multiplyVec3=function(t,e,i){i||(i=e);var s=e[0],n=e[1];e=e[2];return i[0]=t[0]*s+t[4]*n+t[8]*e+t[12],i[1]=t[1]*s+t[5]*n+t[9]*e+t[13],i[2]=t[2]*s+t[6]*n+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i||(i=e);var s=e[0],n=e[1],r=e[2];e=e[3];return i[0]=t[0]*s+t[4]*n+t[8]*r+t[12]*e,i[1]=t[1]*s+t[5]*n+t[9]*r+t[13]*e,i[2]=t[2]*s+t[6]*n+t[10]*r+t[14]*e,i[3]=t[3]*s+t[7]*n+t[11]*r+t[15]*e,i},mat4.translate=function(t,e,i){var s,n,r,o,a,h,c,l,u,p,d,f,g=e[0],y=e[1];e=e[2];return i&&t!==i?(s=t[0],n=t[1],r=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],i[0]=s,i[1]=n,i[2]=r,i[3]=o,i[4]=a,i[5]=h,i[6]=c,i[7]=l,i[8]=u,i[9]=p,i[10]=d,i[11]=f,i[12]=s*g+a*y+u*e+t[12],i[13]=n*g+h*y+p*e+t[13],i[14]=r*g+c*y+d*e+t[14],i[15]=o*g+l*y+f*e+t[15],i):(t[12]=t[0]*g+t[4]*y+t[8]*e+t[12],t[13]=t[1]*g+t[5]*y+t[9]*e+t[13],t[14]=t[2]*g+t[6]*y+t[10]*e+t[14],t[15]=t[3]*g+t[7]*y+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var s=e[0],n=e[1];e=e[2];return i&&t!==i?(i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=s,t[1]*=s,t[2]*=s,t[3]*=s,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,s){var n,r,o,a,h,c,l,u,p,d,f,g,y,m,_,v,b,x,w,S,T=i[0],C=i[1],O=(i=i[2],Math.sqrt(T*T+C*C+i*i));return O?(1!==O&&(O=1/O,T*=O,C*=O,i*=O),n=Math.sin(e),r=Math.cos(e),o=1-r,e=t[0],O=t[1],a=t[2],h=t[3],c=t[4],l=t[5],u=t[6],p=t[7],d=t[8],f=t[9],g=t[10],y=t[11],m=T*T*o+r,_=C*T*o+i*n,v=i*T*o-C*n,b=T*C*o-i*n,x=C*C*o+r,w=i*C*o+T*n,S=T*i*o+C*n,T=C*i*o-T*n,C=i*i*o+r,s?t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]):s=t,s[0]=e*m+c*_+d*v,s[1]=O*m+l*_+f*v,s[2]=a*m+u*_+g*v,s[3]=h*m+p*_+y*v,s[4]=e*b+c*x+d*w,s[5]=O*b+l*x+f*w,s[6]=a*b+u*x+g*w,s[7]=h*b+p*x+y*w,s[8]=e*S+c*T+d*C,s[9]=O*S+l*T+f*C,s[10]=a*S+u*T+g*C,s[11]=h*S+p*T+y*C,s):null},mat4.rotateX=function(t,e,i){var s=Math.sin(e),n=(e=Math.cos(e),t[4]),r=t[5],o=t[6],a=t[7],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=n*e+h*s,i[5]=r*e+c*s,i[6]=o*e+l*s,i[7]=a*e+u*s,i[8]=n*-s+h*e,i[9]=r*-s+c*e,i[10]=o*-s+l*e,i[11]=a*-s+u*e,i},mat4.rotateY=function(t,e,i){var s=Math.sin(e),n=(e=Math.cos(e),t[0]),r=t[1],o=t[2],a=t[3],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*-s,i[1]=r*e+c*-s,i[2]=o*e+l*-s,i[3]=a*e+u*-s,i[8]=n*s+h*e,i[9]=r*s+c*e,i[10]=o*s+l*e,i[11]=a*s+u*e,i},mat4.rotateZ=function(t,e,i){var s=Math.sin(e),n=(e=Math.cos(e),t[0]),r=t[1],o=t[2],a=t[3],h=t[4],c=t[5],l=t[6],u=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*s,i[1]=r*e+c*s,i[2]=o*e+l*s,i[3]=a*e+u*s,i[4]=n*-s+h*e,i[5]=r*-s+c*e,i[6]=o*-s+l*e,i[7]=a*-s+u*e,i},mat4.frustum=function(t,e,i,s,n,r,o){o||(o=mat4.create());var a=e-t,h=s-i,c=r-n;return o[0]=2*n/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n/h,o[6]=0,o[7]=0,o[8]=(e+t)/a,o[9]=(s+i)/h,o[10]=-(r+n)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-r*n*2/c,o[15]=0,o},mat4.perspective=function(t,e,i,s,n){return t=i*Math.tan(t*Math.PI/360),e*=t,mat4.frustum(-e,e,-t,t,i,s,n)},mat4.ortho=function(t,e,i,s,n,r,o){o||(o=mat4.create());var a=e-t,h=s-i,c=r-n;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(t+e)/a,o[13]=-(s+i)/h,o[14]=-(r+n)/c,o[15]=1,o},mat4.lookAt=function(t,e,i,s){s||(s=mat4.create());var n,r,o,a,h,c,l,u,p=t[0],d=t[1];t=t[2];return r=i[0],o=i[1],n=i[2],i=e[1],c=e[2],p===e[0]&&d===i&&t===c?mat4.identity(s):(i=p-e[0],c=d-e[1],l=t-e[2],u=1/Math.sqrt(i*i+c*c+l*l),i*=u,c*=u,l*=u,e=o*l-n*c,n=n*i-r*l,r=r*c-o*i,(u=Math.sqrt(e*e+n*n+r*r))?(u=1/u,e*=u,n*=u,r*=u):r=n=e=0,o=c*r-l*n,a=l*e-i*r,h=i*n-c*e,(u=Math.sqrt(o*o+a*a+h*h))?(u=1/u,o*=u,a*=u,h*=u):h=a=o=0,s[0]=e,s[1]=o,s[2]=i,s[3]=0,s[4]=n,s[5]=a,s[6]=c,s[7]=0,s[8]=r,s[9]=h,s[10]=l,s[11]=0,s[12]=-(e*p+n*d+r*t),s[13]=-(o*p+a*d+h*t),s[14]=-(i*p+c*d+l*t),s[15]=1,s)},mat4.fromRotationTranslation=function(t,e,i){i||(i=mat4.create());var s=t[0],n=t[1],r=t[2],o=t[3],a=s+s,h=n+n,c=r+r,l=(t=s*a,s*h);s*=c;var u=n*h;return n*=c,r*=c,a*=o,h*=o,o*=c,i[0]=1-(u+r),i[1]=l+o,i[2]=s-h,i[3]=0,i[4]=l-o,i[5]=1-(t+r),i[6]=n+a,i[7]=0,i[8]=s+h,i[9]=n-a,i[10]=1-(t+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],s=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=s,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-s*s-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-s*s-n*n)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],s=t[2];t=t[3];return Math.sqrt(e*e+i*i+s*s+t*t)},quat4.normalize=function(t,e){e||(e=t);var i=t[0],s=t[1],n=t[2],r=t[3],o=Math.sqrt(i*i+s*s+n*n+r*r);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(o=1/o,e[0]=i*o,e[1]=s*o,e[2]=n*o,e[3]=r*o,e)},quat4.multiply=function(t,e,i){i||(i=t);var s=t[0],n=t[1],r=t[2],o=(t=t[3],e[0]),a=e[1],h=e[2];e=e[3];return i[0]=s*e+t*o+n*h-r*a,i[1]=n*e+t*a+r*o-s*h,i[2]=r*e+t*h+s*a-n*o,i[3]=t*e-s*o-n*a-r*h,i},quat4.multiplyVec3=function(t,e,i){i||(i=e);var s=e[0],n=e[1],r=e[2],o=(e=t[0],t[1]),a=t[2],h=(t=t[3],
t*s+o*r-a*n),c=t*n+a*s-e*r,l=t*r+e*n-o*s;s=-e*s-o*n-a*r;return i[0]=h*t+s*-e+c*-a-l*-o,i[1]=c*t+s*-o+l*-e-h*-a,i[2]=l*t+s*-a+h*-o-c*-e,i},quat4.toMat3=function(t,e){e||(e=mat3.create());var i=t[0],s=t[1],n=t[2],r=t[3],o=i+i,a=s+s,h=n+n,c=i*o,l=i*a;i*=h;var u=s*a;return s*=h,n*=h,o*=r,a*=r,r*=h,e[0]=1-(u+n),e[1]=l+r,e[2]=i-a,e[3]=l-r,e[4]=1-(c+n),e[5]=s+o,e[6]=i+a,e[7]=s-o,e[8]=1-(c+u),e},quat4.toMat4=function(t,e){e||(e=mat4.create());var i=t[0],s=t[1],n=t[2],r=t[3],o=i+i,a=s+s,h=n+n,c=i*o,l=i*a;i*=h;var u=s*a;return s*=h,n*=h,o*=r,a*=r,r*=h,e[0]=1-(u+n),e[1]=l+r,e[2]=i-a,e[3]=0,e[4]=l-r,e[5]=1-(c+n),e[6]=s+o,e[7]=0,e[8]=i+a,e[9]=s-o,e[10]=1-(c+u),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,s){s||(s=t);var n,r,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(o)>=1?(s!==t&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3]),s):(n=Math.acos(o),r=Math.sqrt(1-o*o),Math.abs(r)<.001?(s[0]=.5*t[0]+.5*e[0],s[1]=.5*t[1]+.5*e[1],s[2]=.5*t[2]+.5*e[2],s[3]=.5*t[3]+.5*e[3],s):(o=Math.sin((1-i)*n)/r,i=Math.sin(i*n)/r,s[0]=t[0]*o+e[0]*i,s[1]=t[1]*o+e[1]*i,s[2]=t[2]*o+e[2]*i,s[3]=t[3]*o+e[3]*i,s))},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){function t(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function e(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelWidth=t.getUniformLocation(e,"pixelWidth"),this.locPixelHeight=t.getUniformLocation(e,"pixelHeight"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.locViewOrigin=t.getUniformLocation(e,"viewOrigin"),this.locScrollPos=t.getUniformLocation(e,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&t.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&t.uniform2f(this.locScrollPos,0,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function i(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function s(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}var n=8e3,r=n/2*3,o=8e3,a=4,h=0,c=1,l=2,u=3,p=4,d=5,f=6,g=7,y=8,m=9,_=10,v=12,b=13,x=14,w=mat4.create();t.prototype.initState=function(){var t,e,i=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.CULL_FACE),i.disable(i.STENCIL_TEST),i.disable(i.DITHER),this.enableFrontToBack?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.lastSrcBlend=i.ONE,this.lastDestBlend=i.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(n*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(2*n),this.pointData=new Float32Array(4*o),this.pointBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.pointBuffer),i.bufferData(i.ARRAY_BUFFER,this.pointData.byteLength,i.DYNAMIC_DRAW),this.vertexBuffers=new Array(a),this.texcoordBuffers=new Array(a),t=0;t<a;t++)this.vertexBuffers[t]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffers[t]),i.bufferData(i.ARRAY_BUFFER,this.vertexData.byteLength,i.DYNAMIC_DRAW),this.texcoordBuffers[t]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.texcoordBuffers[t]),i.bufferData(i.ARRAY_BUFFER,this.texcoordData.byteLength,i.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var s=new Uint16Array(r);t=0,e=r;for(var h,c,l=0;t<e;)s[t++]=l,s[t++]=l+1,s[t++]=l+2,s[t++]=l,s[t++]=l+2,s[t++]=l+3,l+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,s,i.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],h=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),c=this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"].join("\n"):["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"].join("\n");var u=this.createShaderProgram({src:h},c,"<default>");this.shaderPrograms.push(u),h=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var p=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");u=this.createShaderProgram({src:h},p,"<point>"),this.shaderPrograms.push(u),h=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");u=this.createShaderProgram({src:h},c,"<earlyz>");this.shaderPrograms.push(u),h=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");u=this.createShaderProgram({src:h},c,"<fill>");for(var d in this.shaderPrograms.push(u),cr.shaders)cr.shaders.hasOwnProperty(d)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[d],c,d));i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=i.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=i.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var f=i.getParameter(i.ALIASED_POINT_SIZE_RANGE);this.minPointSize=f[0],this.maxPointSize=f[1],this.maxPointSize>2048&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},e.prototype.updateMatMV=function(t){i(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},t.prototype.createShaderProgram=function(t,i,s){var n=this.gl,r=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(r,t.src),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))return n.deleteShader(r),null;var o=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(o,i),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))return n.deleteShader(r),n.deleteShader(o),null;var a=n.createProgram();if(n.attachShader(a,r),n.attachShader(a,o),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS))return n.deleteShader(r),n.deleteShader(o),n.deleteProgram(a),null;n.useProgram(a),n.deleteShader(r),n.deleteShader(o);var h,c,l=new e(n,a,s);for(l.extendBoxHorizontal=t.extendBoxHorizontal||0,l.extendBoxVertical=t.extendBoxVertical||0,l.crossSampling=!!t.crossSampling,l.preservesOpaqueness=!!t.preservesOpaqueness,l.animated=!!t.animated,l.parameters=t.parameters||[],h=0,c=l.parameters.length;h<c;h++)l.parameters[h][1]=n.getUniformLocation(a,l.parameters[h][0]),l.lastCustomParams.push(0),n.uniform1f(l.parameters[h][1],0);return cr.seal(l),l},t.prototype.getShaderIndex=function(t){var e,i;for(e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},t.prototype.project=function(t,e,i){var s=this.matMV,n=this.matP,r=[0,0,0,0,0,0,0,0];r[0]=s[0]*t+s[4]*e+s[12],r[1]=s[1]*t+s[5]*e+s[13],r[2]=s[2]*t+s[6]*e+s[14],r[3]=s[3]*t+s[7]*e+s[15],r[4]=n[0]*r[0]+n[4]*r[1]+n[8]*r[2]+n[12]*r[3],r[5]=n[1]*r[0]+n[5]*r[1]+n[9]*r[2]+n[13]*r[3],r[6]=n[2]*r[0]+n[6]*r[1]+n[10]*r[2]+n[14]*r[3],r[7]=-r[2],0!==r[7]&&(r[7]=1/r[7],r[4]*=r[7],r[5]*=r[7],r[6]*=r[7],i[0]=(.5*r[4]+.5)*this.width,i[1]=(.5*r[5]+.5)*this.height)},t.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var s,n,r,o=this.gl;if(this.width=t,this.height=e,o.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP);var a=[0,0],h=[0,0];this.project(0,0,a),this.project(1,1,h),this.worldScale[0]=1/(h[0]-a[0]),this.worldScale[1]=-1/(h[1]-a[1])}for(s=0,n=this.shaderPrograms.length;s<n;s++)r=this.shaderPrograms[s],r.hasCurrentMatMV=!1,r.locMatP&&(o.useProgram(r.shaderProgram),o.uniformMatrix4fv(r.locMatP,!1,this.matP));o.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(o.bindFramebuffer(o.FRAMEBUFFER,this.fbo),o.bindRenderbuffer(o.RENDERBUFFER,this.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),this.renderToTex=null)}},t.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},t.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},t.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},t.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},t.prototype.updateModelView=function(){if(!i(this.lastMV,this.matMV)){var t=this.pushBatch();t.type=d,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(t>32760&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},s.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},s.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},s.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},s.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;var i=e.currentShader;i.locOpacity&&i.lpOpacity!==t&&(i.lpOpacity=t,this.gl.uniform1f(i.locOpacity,t))},s.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},s.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},s.prototype.doUpdateModelView=function(){var t,e,i,s=this.glwrap.shaderPrograms,n=this.glwrap.currentProgram;for(t=0,e=s.length;t<e;t++)i=s[t],t===n&&i.locMatMV?(i.updateMatMV(this.mat4param),i.hasCurrentMatMV=!0):i.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},s.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},s.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},s.prototype.doSetDepthTestEnabled=function(){var t=this.gl,e=this.startIndex;0!==e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},s.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},s.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},s.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},s.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,s=this.gl,n=this.mat4param;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,s.activeTexture(s.TEXTURE0));var r,o=n[0];if(i.locPixelWidth&&o!==i.lpPixelWidth&&(i.lpPixelWidth=o,s.uniform1f(i.locPixelWidth,o)),o=n[1],i.locPixelHeight&&o!==i.lpPixelHeight&&(i.lpPixelHeight=o,s.uniform1f(i.locPixelHeight,o)),o=n[2],r=n[3],!i.locDestStart||o===i.lpDestStartX&&r===i.lpDestStartY||(i.lpDestStartX=o,i.lpDestStartY=r,s.uniform2f(i.locDestStart,o,r)),o=n[4],r=n[5],!i.locDestEnd||o===i.lpDestEndX&&r===i.lpDestEndY||(i.lpDestEndX=o,i.lpDestEndY=r,s.uniform2f(i.locDestEnd,o,r)),o=n[6],i.locLayerScale&&o!==i.lpLayerScale&&(i.lpLayerScale=o,s.uniform1f(i.locLayerScale,o)),o=n[7],i.locLayerAngle&&o!==i.lpLayerAngle&&(i.lpLayerAngle=o,s.uniform1f(i.locLayerAngle,o)),o=n[8],r=n[9],!i.locViewOrigin||o===i.lpViewOriginX&&r===i.lpViewOriginY||(i.lpViewOriginX=o,i.lpViewOriginY=r,s.uniform2f(i.locViewOrigin,o,r)),o=n[10],r=n[11],!i.locScrollPos||o===i.lpScrollPosX&&r===i.lpScrollPosY||(i.lpScrollPosX=o,i.lpScrollPosY=r,s.uniform2f(i.locScrollPos,o,r)),o=n[12],i.locSeconds&&o!==i.lpSeconds&&(i.lpSeconds=o,s.uniform1f(i.locSeconds,o)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)o=this.shaderParams[t],o!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=o,s.uniform1f(i.parameters[t][1],o))},t.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new s(h,this)),this.batch[this.batchPtr++]},t.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var t,e,i,s=this.gl;if(this.pointPtr>0&&(s.bindBuffer(s.ARRAY_BUFFER,this.pointBuffer),s.bufferSubData(s.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),n&&n.locAPos>=0&&"<point>"===n.name&&s.vertexAttribPointer(n.locAPos,4,s.FLOAT,!1,0,0)),this.vertexPtr>0){var n=this.currentShader;s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),n&&n.locAPos>=0&&"<point>"!==n.name&&s.vertexAttribPointer(n.locAPos,this.enableFrontToBack?3:2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),s.bufferSubData(s.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),n&&n.locATex>=0&&"<point>"!==n.name&&s.vertexAttribPointer(n.locATex,2,s.FLOAT,!1,0,0)}for(t=0,e=this.batchPtr;t<e;t++)switch(i=this.batch[t],i.type){case 1:i.doQuad();break;case 2:i.doSetTexture();break;case 3:i.doSetOpacity();break;case 4:i.doSetBlend();break;case 5:i.doUpdateModelView();break;case 6:i.doRenderToTexture();break;case 7:i.doClear();break;case 8:i.doPoints();break;case 9:i.doSetProgram();break;case 10:i.doSetProgramParameters();break;case 11:i.doSetTexture1();break;case 12:i.doSetColor();break;case 13:i.doSetDepthTestEnabled();break;case 14:i.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,this.curBuffer>=a&&(this.curBuffer=0)}},t.prototype.setOpacity=function(t){if(t!==this.lastOpacity&&!this.isEarlyZPass){var e=this.pushBatch();e.type=u,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.setTexture=function(t){if(t!==this.lastTexture0){var e=this.pushBatch();e.type=l,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.setBlend=function(t,e){if((t!==this.lastSrcBlend||e!==this.lastDestBlend)&&!this.isEarlyZPass){var i=this.pushBatch();i.type=p,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},t.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};var S=2*n-8;t.prototype.quad=function(t,e,i,s,n,r,o,a){this.vertexPtr>=S&&this.endBatch();var h=this.vertexPtr,l=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var f=this.pushBatch();f.type=c,f.startIndex=this.enableFrontToBack?h:h/2*3,f.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(u[h++]=t,u[h++]=e,u[h++]=d,u[h++]=i,u[h++]=s,u[h++]=d,u[h++]=n,u[h++]=r,u[h++]=d,u[h++]=o,u[h++]=a,u[h++]=d):(u[h++]=t,u[h++]=e,u[h++]=i,u[h++]=s,u[h++]=n,u[h++]=r,u[h++]=o,u[h++]=a),p[l++]=0,p[l++]=0,p[l++]=1,p[l++]=0,p[l++]=1,p[l++]=1,p[l++]=0,p[l++]=1,this.vertexPtr=h,this.texPtr=l},t.prototype.quadTex=function(t,e,i,s,n,r,o,a,h){this.vertexPtr>=S&&this.endBatch();var l=this.vertexPtr,u=this.texPtr,p=this.vertexData,d=this.texcoordData,f=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var g=this.pushBatch();g.type=c,g.startIndex=this.enableFrontToBack?l:l/2*3,g.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var y=h.left,m=h.top,_=h.right,v=h.bottom;this.enableFrontToBack?(p[l++]=t,p[l++]=e,p[l++]=f,p[l++]=i,p[l++]=s,p[l++]=f,p[l++]=n,p[l++]=r,p[l++]=f,p[l++]=o,p[l++]=a,p[l++]=f):(p[l++]=t,p[l++]=e,p[l++]=i,p[l++]=s,p[l++]=n,p[l++]=r,p[l++]=o,p[l++]=a),d[u++]=y,d[u++]=m,d[u++]=_,d[u++]=m,d[u++]=_,d[u++]=v,d[u++]=y,d[u++]=v,this.vertexPtr=l,this.texPtr=u},t.prototype.quadTexUV=function(t,e,i,s,n,r,o,a,h,l,u,p,d,f,g,y){this.vertexPtr>=S&&this.endBatch();var m=this.vertexPtr,_=this.texPtr,v=this.vertexData,b=this.texcoordData,x=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var w=this.pushBatch();w.type=c,w.startIndex=this.enableFrontToBack?m:m/2*3,w.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(v[m++]=t,v[m++]=e,v[m++]=x,v[m++]=i,v[m++]=s,v[m++]=x,v[m++]=n,v[m++]=r,v[m++]=x,v[m++]=o,v[m++]=a,v[m++]=x):(v[m++]=t,v[m++]=e,v[m++]=i,v[m++]=s,v[m++]=n,v[m++]=r,v[m++]=o,v[m++]=a),b[_++]=h,b[_++]=l,b[_++]=u,b[_++]=p,b[_++]=d,b[_++]=f,b[_++]=g,b[_++]=y,this.vertexPtr=m,this.texPtr=_},t.prototype.convexPoly=function(t){var e,i,s,n,r,o,a,h,c=t.length/2,l=c-2,u=l-1,p=t[0],d=t[1];for(e=0;e<l;e+=2)i=2*e,s=t[i+2],n=t[i+3],r=t[i+4],o=t[i+5],e===u?this.quad(p,d,s,n,r,o,r,o):(a=t[i+6],h=t[i+7],this.quad(p,d,s,n,r,o,a,h))};var T=o-4;t.prototype.point=function(t,e,i,s){this.pointPtr>=T&&this.endBatch();var n=this.pointPtr,r=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var o=this.pushBatch();o.type=y,o.startIndex=n,o.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}r[n++]=t,r[n++]=e,r[n++]=i,r[n++]=s,this.pointPtr=n},t.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}var i=this.pushBatch();i.type=m,i.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.programUsesDest=function(t){var e=this.shaderPrograms[t];return!(!e.locDestStart&&!e.locDestEnd)},t.prototype.programUsesCrossSampling=function(t){var e=this.shaderPrograms[t];return!!(e.locDestStart||e.locDestEnd||e.crossSampling)},t.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},t.prototype.programExtendsBox=function(t){var e=this.shaderPrograms[t];return 0!==e.extendBoxHorizontal||0!==e.extendBoxVertical},t.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},t.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},t.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},t.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},t.prototype.setProgramParameters=function(t,e,i,s,n,r,o,a,h,c,l,u,p,d,f){var g,y,m,v,b,x=this.shaderPrograms[this.lastProgram];if(x.hasAnyOptionalUniforms||f.length){if(m=this.pushBatch(),m.type=_,m.mat4param?mat4.set(this.matMV,m.mat4param):m.mat4param=mat4.create(),v=m.mat4param,v[0]=e,v[1]=i,v[2]=s,v[3]=n,v[4]=r,v[5]=o,v[6]=a,v[7]=h,v[8]=c,v[9]=l,v[10]=u,v[11]=p,v[12]=d,x.locSamplerBack?m.texParam=t:m.texParam=null,f.length)for(b=m.shaderParams,b.length=f.length,g=0,y=f.length;g<y;g++)b[g]=f[g];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clear=function(t,e,i,s){var n=this.pushBatch();n.type=g,n.startIndex=0,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=s,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.clearRect=function(t,e,i,s){if(!(i<0||s<0)){var n=this.pushBatch();n.type=g,n.startIndex=1,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=s,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clearDepth=function(){var t=this.pushBatch();t.type=g,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var e=this.pushBatch();e.type=x,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},t.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=b,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,w),this.resetModelView(),this.updateModelView();var t=this.width/2,e=this.height/2;this.quad(-t,e,t,e,t,-e,-t,-e),mat4.set(w,this.matMV),this.updateModelView()},t.prototype.setColorFillMode=function(t,e,i,s){this.switchProgram(3);var n=this.pushBatch();n.type=v,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=s,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setTextureFillMode=function(){this.switchProgram(0)},t.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},t.prototype.present=function(){this.endBatch(),this.gl.flush()};var C=[],O={};t.prototype.contextLost=function(){cr.clearArray(C),O={}};var A=1,P=2,k=3,E=4;t.prototype.loadTexture=function(t,e,i,s,n,r){e=!!e,i=!!i;var o=t.src+","+e+","+i+(e?","+n:""),a=null;if(void 0!==t.src&&O.hasOwnProperty(o))return a=O[o],a.c2refcount++,a;this.endBatch();var h=this.gl,c=cr.isPOT(t.width)&&cr.isPOT(t.height);a=h.createTexture(),h.bindTexture(h.TEXTURE_2D,a),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l=h.RGBA,u=h.RGBA,p=h.UNSIGNED_BYTE;if(s&&!this.isIE)switch(s){case A:l=h.RGB,u=h.RGB;break;case P:p=h.UNSIGNED_SHORT_4_4_4_4;break;case k:p=h.UNSIGNED_SHORT_5_5_5_1;break;case E:l=h.RGB,u=h.RGB,p=h.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!c&&e){var d=document.createElement("canvas");d.width=cr.nextHighestPowerOfTwo(t.width),d.height=cr.nextHighestPowerOfTwo(t.height);var f=d.getContext("2d");void 0!==f.imageSmoothingEnabled?f.imageSmoothingEnabled=i:(f.webkitImageSmoothingEnabled=i,f.mozImageSmoothingEnabled=i,f.msImageSmoothingEnabled=i),f.drawImage(t,0,0,t.width,t.height,0,0,d.width,d.height),h.texImage2D(h.TEXTURE_2D,0,l,u,p,d)}else h.texImage2D(h.TEXTURE_2D,0,l,u,p,t);return e?"repeat-x"===n?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)):"repeat-y"===n?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)),i?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),(c||this.version>=2)&&this.enable_mipmaps&&!r?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST)),h.bindTexture(h.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t.width,a.c2height=t.height,a.c2refcount=1,a.c2texkey=o,C.push(a),O[o]=a,a},t.prototype.createEmptyTexture=function(t,e,i,s,n){this.endBatch();var r=this.gl;this.isIE&&(s=!1);var o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,s?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,null),n?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i?r.LINEAR:r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i?r.LINEAR:r.NEAREST),r.bindTexture(r.TEXTURE_2D,null),this.lastTexture0=null,o.c2width=t,o.c2height=e,C.push(o),o},t.prototype.videoToTexture=function(t,e,i){this.endBatch();var s=this.gl;this.isIE&&(i=!1),s.bindTexture(s.TEXTURE_2D,e),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,i?s.UNSIGNED_SHORT_4_4_4_4:s.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}s.bindTexture(s.TEXTURE_2D,null),this.lastTexture0=null},t.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&t.c2refcount>1?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(C,t),void 0!==t.c2texkey&&delete O[t.c2texkey],this.gl.deleteTexture(t)))},t.prototype.estimateVRAM=function(){var t,e,i,s=this.width*this.height*4*2;for(t=0,e=C.length;t<e;t++)i=C[t],s+=i.c2width*i.c2height*4;return s},t.prototype.textureCount=function(){return C.length},t.prototype.setRenderingToTexture=function(t){if(t!==this.renderToTex){var e=this.pushBatch();e.type=f,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=t}(),function(){function t(t){if(t&&(t.getContext||t.dc)&&!t.c2runtime){t.c2runtime=this;var e=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova=this.isCrosswalk||void 0!==window.device&&(void 0!==window.device.cordova||void 0!==window.device.phonegap)||void 0!==window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,
this.isDirectCanvas=!!t.dc,this.isAppMobi=void 0!==window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){e.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){e.setSuspended(!1)})),this.isEjecta&&(document.addEventListener("pagehide",function(){e.setSuspended(!0)}),document.addEventListener("pageshow",function(){e.setSuspended(!1)}),document.addEventListener("resize",function(){e.setSize(window.innerWidth,window.innerHeight)})),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs=void 0!==window.c2nodewebkit||void 0!==window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade=void 0!==window.is_scirra_arcade,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindows8Capable=!(void 0===window.c2isWindows8Capable||!window.c2isWindows8Capable),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),this.httpServer=null,this.httpServerUrl="",this.isWKWebView&&(this.httpServer=cordova&&cordova.plugins&&cordova.plugins.CorHttpd?cordova.plugins.CorHttpd:null),"undefined"==typeof cr_is_preview||this.isNWjs||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent)&&!/nwjs/i.test(navigator.userAgent)||(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&window.location.search.indexOf("debug")>-1,this.canvas=t,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.fullscreenOldMarginCss="",this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()}}function e(t,e){O&&O.width===t&&O.height===e||(O=document.createElement("canvas"),O.width=t,O.height=e,A=O.getContext("2d"))}function i(t,e){return e<=128?t[3]:e<=256?t[2]:e<=512?t[1]:t[0]}function s(){return k.length?k.pop():new cr.ObjectSet}function n(t){t.clear(),k.push(t)}function r(){try{return!!window.indexedDB}catch(t){return!1}}function o(t){var e=t.target.result;e.createObjectStore("saves",{keyPath:"slot"})}function a(t,e,i,s){try{var n=indexedDB.open("_C2SaveStates");n.onupgradeneeded=o,n.onerror=s,n.onsuccess=function(n){var r=n.target.result;r.onerror=s;var o=r.transaction(["saves"],"readwrite"),a=o.objectStore("saves"),h=a.put({slot:t,data:e});h.onsuccess=i}}catch(t){s(t)}}function h(t,e,i){try{var s=indexedDB.open("_C2SaveStates");s.onupgradeneeded=o,s.onerror=i,s.onsuccess=function(s){var n=s.target.result;n.onerror=i;var r=n.transaction(["saves"]),o=r.objectStore("saves"),a=o.get(t);a.onsuccess=function(t){a.result?e(a.result.data):e(null)}}}catch(t){i(t)}}function c(){cr.logexport("Reloading for continuous preview"),window.c2cocoonjs?CocoonJS.App.reload():window.location.search.indexOf("continuous")>-1?window.location.reload(!0):(contLoc=new URL(window.location+"?continuous"),window.location=contLoc)}function l(t){var e,i={};for(e in t)if(t.hasOwnProperty(e)){if(t[e]instanceof cr.ObjectSet)continue;if(t[e]&&void 0!==t[e].c2userdata)continue;if("spriteCreatedDestroyCallback"===e)continue;i[e]=t[e]}return i}var u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;t.prototype.requestProjectData=function(){var t=this;if(this.isWKWebView){var e=function(){t.fetchLocalFileViaCordovaAsText("data.js",function(e){t.loadProject(JSON.parse(e))},function(t){alert("Error fetching data.js")})};this.httpServer?this.httpServer.startServer({port:0,localhost_only:!0},function(i){t.httpServerUrl=i,e()},function(t){console.log("Error starting local server: "+t+". Video playback will not work."),e()}):(console.log("Local server unavailable. Video playback will not work."),e())}else{var i;i=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var s="data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(s="data.json"),i.open("GET",s,!0);var n=!1;if(!this.isDomFree&&"response"in i&&"responseType"in i)try{i.responseType="json",n="json"===i.responseType}catch(t){n=!1}if(!n&&"responseType"in i)try{i.responseType="text"}catch(t){}if("overrideMimeType"in i)try{i.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?i.onreadystatechange=function(){4===i.readyState&&t.loadProject(JSON.parse(i.responseText))}:(i.onload=function(){if(n)t.loadProject(i.response);else if(t.isEjecta){var e=i.responseText;e=e.substr(e.indexOf("{")),t.loadProject(JSON.parse(e))}else t.loadProject(JSON.parse(i.responseText))},i.onerror=function(t){cr.logerror("Error requesting "+s+":"),cr.logerror(t)}),i.send()}},t.prototype.initRendererAndLoader=function(){var t,e,i,s,n,r,o,a,h,c,l,u=this;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio)||1,this.ClearDeathRow(),this.fullscreen_mode>0&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),u.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(t){u.glwrap.initState(),u.glwrap.setSize(u.glwrap.width,u.glwrap.height,!0),u.layer_tex=null,u.layout_tex=null,u.fx_tex[0]=null,u.fx_tex[1]=null,u.onContextRestored(),u.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(l={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.gl=this.canvas.getContext("webgl2",l)||this.canvas.getContext("webgl",l)||this.canvas.getContext("experimental-webgl",l))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var p=this.gl.getExtension("WEBGL_debug_renderer_info");if(p){var d=this.gl.getParameter(p.UNMASKED_VENDOR_WEBGL),f=this.gl.getParameter(p.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=f+" ["+d+"]"}for(this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,t=0,e=this.types_by_index.length;t<e;t++)for(o=this.types_by_index[t],i=0,s=o.effect_types.length;i<s;i++)a=o.effect_types[i],a.shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(h=this.layouts_by_index[t],i=0,s=h.effect_types.length;i<s;i++)a=h.effect_types[i],a.shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,s=h.layers.length;i<s;i++){for(c=h.layers[i],n=0,r=c.effect_types.length;n<r;n++)a=c.effect_types[n],a.shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);c.updateActiveEffects()}}}else{if(this.fullscreen_mode>0&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(t){return!1},document.onselectstart=function(t){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(this.isCocoonJs?(l={antialias:!!this.linearSampling,alpha:!0},this.ctx=this.canvas.getContext("2d",l)):(l={alpha:!0},this.ctx=this.canvas.getContext("2d",l)),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}if(this.tickFunc=function(t){u.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),window.location.search.indexOf("continuous")>-1&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){u.setSuspended(!1)}),jQuery(window).blur(function(){var t=window.parent;t&&t.document.hasFocus()||u.setSuspended(!0)}))),window.addEventListener("blur",function(){u.onWindowBlur()}),!this.isDomFree){var g=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",g):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",g):document.addEventListener("touchstart",g),document.addEventListener("mousedown",g)}0===this.fullscreen_mode&&this.isRetina&&this.devicePixelRatio>1&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)};t.prototype.setSize=function(t,e,i){var s=0,n=0,r=0,o=0,a=0;if(this.lastWindowWidth!==t||this.lastWindowHeight!==e||i){this.lastWindowWidth=t,this.lastWindowHeight=e;var h,c,l=this.fullscreen_mode,u=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova;if(u||0!==this.fullscreen_mode||i){u&&this.fullscreen_scaling>0&&(l=this.fullscreen_scaling);var p=this.devicePixelRatio;l>=4?(h=this.original_width/this.original_height,c=t/e,c>h?(r=e*h,5===l?(a=r*p/this.original_width,a>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),r=this.original_width*a/p,o=this.original_height*a/p,s=(t-r)/2,n=(e-o)/2,t=r,e=o):(s=(t-r)/2,t=r)):(o=t/h,5===l?(a=o*p/this.original_height,a>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),r=this.original_width*a/p,o=this.original_height*a/p,s=(t-r)/2,n=(e-o)/2,t=r,e=o):(n=(e-o)/2,e=o)),u&&!this.isNWjs&&(s=0,n=0)):this.isNWjs&&this.isNodeFullscreen&&0===this.fullscreen_mode_set&&(s=Math.floor((t-this.original_width)/2),n=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),l<2&&(this.aspect_scale=p),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*p),this.height=Math.round(e*p),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===l?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===l?(h=this.original_width/this.original_height,c=this.lastWindowWidth/this.lastWindowHeight,c<h?this.draw_width=this.draw_height*c:c>h&&(this.draw_height=this.draw_width/c)):3===l&&(h=this.original_width/this.original_height,c=this.lastWindowWidth/this.lastWindowHeight,c>h?this.draw_width=this.draw_height*c:c<h&&(this.draw_height=this.draw_width/c))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(t)+"px",height:Math.round(e)+"px","margin-left":Math.floor(s)+"px","margin-top":Math.floor(n)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(t)+"px",height:Math.round(e)+"px"})),this.canvas&&(this.canvas.width=Math.round(t*p),this.canvas.height=Math.round(e*p),this.isEjecta?(this.canvas.style.left=Math.floor(s)+"px",this.canvas.style.top=Math.floor(n)+"px",this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*p),this.overlay_canvas.height=Math.round(e*p),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*p),Math.round(e*p)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(t),this.ctx.height=Math.round(e)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},t.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch(function(){}):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},t.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)i=this.types_by_index[t],i.onLostWebGLContext&&i.onLostWebGLContext()},t.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)i=this.types_by_index[t],i.onRestoreWebGLContext&&i.onRestoreWebGLContext()},t.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova,e=t?jQuery(this.canvas).offset():jQuery(this.canvas).position();e.position="absolute",jQuery(this.overlay_canvas).css(e)}};var p=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;t.prototype.setSuspended=function(t){var e,i;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&p&&p(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!1);this.tick(!1)}},t.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},t.prototype.GetObjectReference=function(t){return this.objectRefTable[t]},t.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,s,n,r,o,a,h,c,l,u,p,d,f=t.project;if(this.name=f[0],this.first_layout=f[1],this.fullscreen_mode=f[12],this.fullscreen_mode_set=f[12],this.original_width=f[10],this.original_height=f[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(f[12]>=4||0===f[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=f[18],this.loaderstyle=f[19],0===this.loaderstyle){var g=new Image;g.crossOrigin="anonymous",this.setImageSrc(g,"../common-resources/loading-logo.png"),this.loaderlogos={logo:g}}else if(4===this.loaderstyle){var y=new Image;y.src="";var m=new Image;m.src="";var _=new Image;_.src="";var v=new Image;v.src="";var b=new Image;b.src="";var x=new Image;x.src="";var w=new Image;w.src="";var S=new Image;S.src="";var T=new Image;T.src="";var C=new Image;C.src="";var O=new Image;O.src="";var A=new Image;A.src="",this.loaderlogos={logo:[y,m,_,v],powered:[b,x,w,S],website:[T,C,O,A]}}for(this.next_uid=f[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),e=0,i=f[2].length;e<i;e++)a=f[2][e],u=this.GetObjectReference(a[0]),cr.add_common_aces(a,u.prototype),p=new u(this),p.singleglobal=a[1],p.is_world=a[2],p.is_rotatable=a[5],p.must_predraw=a[9],p.onCreate&&p.onCreate(),cr.seal(p),this.plugins.push(p);for(this.objectRefTable=cr.getObjectRefTable(),e=0,i=f[3].length;e<i;e++){for(a=f[3][e],d=this.GetObjectReference(a[1]),p=null,s=0,n=this.plugins.length;s<n;s++)if(this.plugins[s]instanceof d){p=this.plugins[s];break}var P=new p.Type(p);for(P.name=a[0],P.is_family=a[2],P.instvar_sids=a[3].slice(0),P.vars_count=a[3].length,P.behs_count=a[4],P.fx_count=a[5],P.sid=a[11],P.is_family?(P.members=[],P.family_index=this.family_count++,P.families=null):(P.members=null,P.family_index=-1,P.families=[]),P.family_var_map=null,P.family_beh_map=null,P.family_fx_map=null,P.is_contained=!1,P.container=null,a[6]?(P.texture_file=a[6][0],P.texture_filesize=a[6][1],P.texture_pixelformat=a[6][2]):(P.texture_file=null,P.texture_filesize=0,P.texture_pixelformat=0),a[7]?P.animations=a[7]:P.animations=null,P.index=e,P.instances=[],P.deadCache=[],P.solstack=[new cr.selection(P)],P.cur_sol=0,P.default_instance=null,P.default_layerindex=0,P.stale_iids=!0,P.updateIIDs=cr.type_updateIIDs,P.getFirstPicked=cr.type_getFirstPicked,P.getPairedInstance=cr.type_getPairedInstance,P.getCurrentSol=cr.type_getCurrentSol,P.pushCleanSol=cr.type_pushCleanSol,P.pushCopySol=cr.type_pushCopySol,P.popSol=cr.type_popSol,P.getBehaviorByName=cr.type_getBehaviorByName,P.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,P.getEffectIndexByName=cr.type_getEffectIndexByName,P.applySolToContainer=cr.type_applySolToContainer,P.getInstanceByIID=cr.type_getInstanceByIID,P.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),P.any_cell_changed=!0,P.any_instance_parallaxed=!1,P.extra={},P.toString=cr.type_toString,P.behaviors=[],s=0,n=a[8].length;s<n;s++){h=a[8][s];var k=this.GetObjectReference(h[1]),E=null;for(r=0,o=this.behaviors.length;r<o;r++)if(this.behaviors[r]instanceof k){E=this.behaviors[r];break}E||(E=new k(this),E.my_types=[],E.my_instances=new cr.ObjectSet,E.onCreate&&E.onCreate(),cr.seal(E),this.behaviors.push(E),cr.behaviors.solid&&E instanceof cr.behaviors.solid&&(this.solidBehavior=E),cr.behaviors.jumpthru&&E instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=E),cr.behaviors.shadowcaster&&E instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=E)),-1===E.my_types.indexOf(P)&&E.my_types.push(P);var I=new E.Type(E,P);I.name=h[0],I.sid=h[2],I.onCreate(),cr.seal(I),P.behaviors.push(I)}for(P.global=a[9],P.isOnLoaderLayout=a[10],P.effect_types=[],s=0,n=a[12].length;s<n;s++)P.effect_types.push({id:a[12][s][0],name:a[12][s][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:s});if(P.tile_poly_data=a[13],this.uses_loader_layout&&!P.is_family&&!P.isOnLoaderLayout&&p.is_world||(P.onCreate(),cr.seal(P)),P.name&&(this.types[P.name]=P),this.types_by_index.push(P),p.singleglobal){var L=new p.Instance(P);L.uid=this.next_uid++,L.puid=this.next_puid++,L.iid=0,L.get_iid=cr.inst_get_iid,L.toString=cr.inst_toString,L.properties=a[14],L.onCreate(),cr.seal(L),P.instances.push(L),this.objectsByUid[L.uid.toString()]=L}}for(e=0,i=f[4].length;e<i;e++){var R,M=f[4][e],F=this.types_by_index[M[0]];for(s=1,n=M.length;s<n;s++)R=this.types_by_index[M[s]],R.families.push(F),F.members.push(R)}for(e=0,i=f[28].length;e<i;e++){var B=f[28][e],N=[];for(s=0,n=B.length;s<n;s++)N.push(this.types_by_index[B[s]]);for(s=0,n=N.length;s<n;s++)N[s].is_contained=!0,N[s].container=N}if(this.family_count>0)for(e=0,i=this.types_by_index.length;e<i;e++)if(c=this.types_by_index[e],!c.is_family&&c.families.length){c.family_var_map=new Array(this.family_count),c.family_beh_map=new Array(this.family_count),c.family_fx_map=new Array(this.family_count);var j=[],D=0,V=0,W=0;for(s=0,n=c.families.length;s<n;s++)for(l=c.families[s],c.family_var_map[l.family_index]=D,D+=l.vars_count,c.family_beh_map[l.family_index]=V,V+=l.behs_count,c.family_fx_map[l.family_index]=W,W+=l.fx_count,r=0,o=l.effect_types.length;r<o;r++)j.push(cr.shallowCopy({},l.effect_types[r]));for(c.effect_types=j.concat(c.effect_types),s=0,n=c.effect_types.length;s<n;s++)c.effect_types[s].index=s}for(e=0,i=f[5].length;e<i;e++){a=f[5][e];var G=new cr.layout(this,a);cr.seal(G),this.layouts[G.name]=G,this.layouts_by_index.push(G)}for(e=0,i=f[6].length;e<i;e++){a=f[6][e];var U=new cr.eventsheet(this,a);cr.seal(U),this.eventsheets[U.name]=U,this.eventsheets_by_index.push(U)}for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].postInit();for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].updateDeepIncludes();for(e=0,i=this.triggers_to_postinit.length;e<i;e++)this.triggers_to_postinit[e].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=f[7],this.files_subfolder=f[8],this.pixel_rounding=f[9],this.aspect_scale=1,this.enableWebGL=f[13],this.linearSampling=f[14],this.clearBackground=f[15],this.versionstr=f[16],this.useHighDpi=f[17],this.orientations=f[20],this.autoLockOrientation=this.orientations>0,this.pauseOnBlur=f[22],this.wantFullscreenScalingQuality=f[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=f[24],this.preloadSounds=f[25],this.projectName=f[26],this.enableFrontToBack=f[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()};var d=!1;t.prototype.waitForImageLoad=function(t,e){t.cocoonLazyLoad=!0,t.onerror=function(e){t.c2error=!0,d=!0,console&&console.error&&console.error("Error loading image '"+t.src+"': ",e)},this.isEjecta?t.src=e:t.src||("undefined"!=typeof XAPKReader?XAPKReader.get(e,function(e){t.src=e},function(i){t.c2error=!0,d=!0,console&&console.error&&console.error("Error extracting image '"+e+"' from expansion file: ",i)}):(t.crossOrigin="anonymous",this.setImageSrc(t,e))),this.wait_for_textures.push(t)},t.prototype.findWaitingTexture=function(t){var e,i;for(e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null};var f=0,g=!1;t.prototype.getready=function(){this.audioInstance&&(f=this.audioInstance.setPreloadList(this.audio_to_preload))},t.prototype.areAllTexturesAndSoundsLoaded=function(){var t,e,i,s=f,n=0,r=0,o=!0;for(t=0,e=this.wait_for_textures.length;t<e;t++){i=this.wait_for_textures[t];var a=i.cr_filesize;(!a||a<=0)&&(a=5e4),s+=a,i.src&&(i.complete||i.loaded)&&!i.c2error?n+=a:o=!1}return o&&this.preloadSounds&&this.audioInstance&&(g||(this.audioInstance.startPreloads(),g=!0),r=this.audioInstance.getPreloadedSize(),n+=r,r<f&&(o=!1)),this.progress=0==s?1:n/s,o};var y=!1;t.prototype.go=function(){if(this.ctx||this.glwrap){var t=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var e=window.innerWidth,i=window.innerHeight;this.lastWindowWidth===e&&this.lastWindowHeight===i||this.setSize(e,i),this.progress=0,this.last_progress=-1;var s=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||y))this.go_loading_finished();else{var n=Date.now()-this.start_time;if(t){var r=this.width,o=this.height,a=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||n>=500&&this.last_progress!=this.progress)){t.clearRect(0,0,r,o);var h,c=r/2,l=o/2,p=0===this.loaderstyle&&this.loaderlogos.logo.complete,f=40*a,g=0,m=80*a;if(p){var _=this.loaderlogos.logo;m=_.width*a,h=_.height*a,f=m/2,g=h/2,t.drawImage(_,cr.floor(c-f),cr.floor(l-g),m,h)}if(this.loaderstyle<=1)l+=g+(p?12*a:0),c-=f,c=cr.floor(c)+.5,l=cr.floor(l)+.5,t.fillStyle=d?"red":"DodgerBlue",t.fillRect(c,l,Math.floor(m*this.progress),6*a),t.strokeStyle="black",t.strokeRect(c,l,m,6*a),t.strokeStyle="white",t.strokeRect(c-1*a,l-1*a,m+2*a,8*a);else if(2===this.loaderstyle){t.font=this.isEjecta?"12pt ArialMT":"12pt Arial",t.fillStyle=d?"#f00":"#999",t.textBaseLine="middle";var v=Math.round(100*this.progress)+"%",b=t.measureText?t.measureText(v):null,x=b?b.width:0;t.fillText(v,c-x/2,l)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(t),void(u?u(function(){s.go()}):setTimeout(function(){s.go()},16))}setTimeout(function(){s.go()},this.isCocoonJs?10:100)}}};var m=-1,_=300,v=300,b="undefined"==typeof cr_is_preview?200:0,x=!0,w=!1,S=0,T=0,C="undefined"==typeof cr_is_preview?3e3:0,O=null,A=null,P=0;t.prototype.draw_c2_splash_loader=function(t){if(!y){for(var s=Math.ceil(this.width),n=Math.ceil(this.height),r=(this.devicePixelRatio,this.loaderlogos.logo),o=this.loaderlogos.powered,a=this.loaderlogos.website,h=0;h<4;++h)if(!r[h].complete||!o[h].complete||!a[h].complete)return;0===P&&(m=Date.now());var c,l,u=Date.now(),p=!1,f=t;x||w?(t.clearRect(0,0,s,n),e(s,n),f=A,p=!0,x&&1===P&&(m=Date.now())):t.globalAlpha=1,f.fillStyle="#333333",f.fillRect(0,0,s,n),this.cssHeight>256?(c=cr.clamp(.22*n,105,.6*s),l=.25*c,f.drawImage(i(o,c),.5*s-c/2,.2*n-l/2,c,l),c=Math.min(.395*n,.95*s),l=c,f.drawImage(i(r,c),.5*s-c/2,.485*n-l/2,c,l),c=cr.clamp(.22*n,105,.6*s),l=.25*c,f.drawImage(i(a,c),.5*s-c/2,.868*n-l/2,c,l),f.fillStyle="#3C3C3C",c=s,l=Math.max(.005*n,2),f.fillRect(0,.8*n-l/2,c,l),f.fillStyle=d?"red":"#E0FF65",c=s*this.progress,f.fillRect(.5*s-c/2,.8*n-l/2,c,l)):(c=.55*n,l=c,f.drawImage(i(r,c),.5*s-c/2,.45*n-l/2,c,l),f.fillStyle="#3C3C3C",c=s,l=Math.max(.005*n,2),f.fillRect(0,.85*n-l/2,c,l),f.fillStyle=d?"red":"#E0FF65",c=s*this.progress,f.fillRect(.5*s-c/2,.85*n-l/2,c,l)),p&&(x?t.globalAlpha=0===P?0:Math.min((u-m)/_,1):w&&(t.globalAlpha=Math.max(1-(u-T)/v,0)),t.drawImage(O,0,0,s,n)),x&&u-m>=_&&P>=2&&(x=!1,S=u),!x&&u-S>=C&&!w&&this.progress>=1&&(w=!0,T=u),
(w&&u-T>=v+b||"undefined"!=typeof cr_is_preview&&this.progress>=1&&Date.now()-m<500)&&(y=!0,x=!1,w=!1,O=null,A=null,this.loaderlogos=null),++P}},t.prototype.go_loading_finished=function(){var t,e,i;if(null==top.stellaHandle?console.log("stella interface handle is null"):(console.log("injecting event for audio auto play"),top.stellaHandle.injectEventForAutoPlay()),this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)i=this.types_by_index[t],i.is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();if(this.fullscreen_mode>=2){var s=this.original_width/this.original_height,n=this.width/this.height;2!==this.fullscreen_mode&&n>s||2===this.fullscreen_mode&&n<s?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width}for(this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)i=this.types_by_index[t],i.onAppBegin&&i.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},t.prototype.tick=function(t,e,i){if(this.running_layout){var s=cr.performance_now(),n=s;if(i||!this.isSuspended||t){t||(u?this.raf_id=u(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var r=e||s,o=this.fullscreen_mode,a=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if((a||this.isNodeFullscreen)&&this.fullscreen_scaling>0&&(o=this.fullscreen_scaling),o>0){var h=window.innerWidth,c=window.innerHeight;this.lastWindowWidth===h&&this.lastWindowHeight===c||this.setSize(h,c)}if(this.isDomFree||(a?(this.firstInFullscreen||(this.fullscreenOldMarginCss=jQuery(this.canvas).css("margin")||"0",this.firstInFullscreen=!0),this.isChrome||this.isNWjs||jQuery(this.canvas).css({"margin-left":Math.floor((screen.width-this.width/this.devicePixelRatio)/2)+"px","margin-top":Math.floor((screen.height-this.height/this.devicePixelRatio)/2)+"px"})):this.firstInFullscreen?(this.isChrome||this.isNWjs||jQuery(this.canvas).css("margin",this.fullscreenOldMarginCss),this.fullscreenOldMarginCss="",this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading){var l=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,l&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())}this.logic(r),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||t||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-n}}},t.prototype.logic=function(t){var e,i,s,n,r,o,a,h;t-this.last_fps_time>=1e3&&(this.last_fps_time+=1e3,t-this.last_fps_time>=1e3&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var c=0;if(0!==this.last_tick_time){var l=t-this.last_tick_time;l<0&&(l=0),c=l/1e3,this.dt1=c,this.dt1>.5?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(c);var u=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;if(this.fullscreen_mode>=2||u&&this.fullscreen_scaling>0){var p=this.original_width/this.original_height,d=this.width/this.height,f=this.fullscreen_mode;u&&this.fullscreen_scaling>0&&(f=this.fullscreen_scaling),this.aspect_scale=2!==f&&d>p||2===f&&d<p?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var g=this.objects_to_pretick.valuesRef();for(e=0,i=g.length;e<i;e++)g[e].pretick();for(e=0,i=this.types_by_index.length;e<i;e++)if(a=this.types_by_index[e],!a.is_family&&(a.behaviors.length||a.families.length))for(s=0,n=a.instances.length;s<n;s++)for(y=a.instances[s],r=0,o=y.behavior_insts.length;r<o;r++)y.behavior_insts[r].tick();for(e=0,i=this.types_by_index.length;e<i;e++)if(a=this.types_by_index[e],!a.is_family&&(a.behaviors.length||a.families.length))for(s=0,n=a.instances.length;s<n;s++)for(y=a.instances[s],r=0,o=y.behavior_insts.length;r<o;r++)h=y.behavior_insts[r],h.posttick&&h.posttick();for(g=this.objects_to_tick.valuesRef(),e=0,i=g.length;e<i;e++)g[e].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),e=0;this.changelayout&&e++<10;)this.doChangeLayout(this.changelayout);for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,e=0,i=this.types_by_index.length;e<i;e++)if(a=this.types_by_index[e],!a.is_family&&(a.behaviors.length||a.families.length))for(s=0,n=a.instances.length;s<n;s++){var y=a.instances[s];for(r=0,o=y.behavior_insts.length;r<o;r++)h=y.behavior_insts[r],h.tick2&&h.tick2()}for(g=this.objects_to_tick2.valuesRef(),e=0,i=g.length;e<i;e++)g[e].tick2();this.isInOnDestroy--},t.prototype.onWindowBlur=function(){var t,e,i,s,n,r,o,a,h;for(t=0,e=this.types_by_index.length;t<e;t++)if(o=this.types_by_index[t],!o.is_family)for(i=0,s=o.instances.length;i<s;i++)if(a=o.instances[i],a.onWindowBlur&&a.onWindowBlur(),a.behavior_insts)for(n=0,r=a.behavior_insts.length;n<r;n++)h=a.behavior_insts[n],h.onWindowBlur&&h.onWindowBlur()},t.prototype.doChangeLayout=function(t){var e,i,s,n=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)s=this.types_by_index[e],s.is_family||!s.unloadTextures||s.global&&0!==s.instances.length||-1!==t.initial_types.indexOf(s)||s.unloadTextures();n==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},t.prototype.runLayoutChangeMethods=function(t){var e,i,s,n,r,o,a,h,c,l;for(e=0,i=this.behaviors.length;e<i;e++)s=this.behaviors[e],t?s.onBeforeLayoutChange&&s.onBeforeLayoutChange():s.onLayoutChange&&s.onLayoutChange();for(e=0,i=this.types_by_index.length;e<i;e++)if(n=this.types_by_index[e],n.global||n.plugin.singleglobal)for(r=0,o=n.instances.length;r<o;r++)if(a=n.instances[r],t?a.onBeforeLayoutChange&&a.onBeforeLayoutChange():a.onLayoutChange&&a.onLayoutChange(),a.behavior_insts)for(h=0,c=a.behavior_insts.length;h<c;h++)l=a.behavior_insts[h],t?l.onBeforeLayoutChange&&l.onBeforeLayoutChange():l.onLayoutChange&&l.onLayoutChange()},t.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},t.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},t.prototype.tickMe=function(t){this.objects_to_tick.add(t)},t.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},t.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},t.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},t.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},t.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},t.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},t.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},t.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},t.prototype.getObjectByUID=function(t){var e=t.toString();return this.objectsByUid.hasOwnProperty(e)?this.objectsByUid[e]:null};var k=[];t.prototype.DestroyInstance=function(t){var e,i,n=t.type,r=n.name,o=this.deathRow.hasOwnProperty(r),a=null;if(o){if(a=this.deathRow[r],a.contains(t))return}else a=s(),this.deathRow[r]=a;if(a.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&a.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},t.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,s,n,r;for(this.isInClearDeathRow=!0,i=0,n=this.createRow.length;i<n;++i)for(t=this.createRow[i],e=t.type,e.instances.push(t),s=0,r=e.families.length;s<r;++s)e.families[s].instances.push(t),e.families[s].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},t.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},t.prototype.ClearDeathRowForType=function(t){var e,i,s,r,o,a,h,c,l=t.valuesRef(),u=l[0].type;for(cr.arrayRemoveAllFromObjectSet(u.instances,t),u.stale_iids=!0,0===u.instances.length&&(u.any_instance_parallaxed=!1),e=0,i=u.families.length;e<i;++e)a=u.families[e],cr.arrayRemoveAllFromObjectSet(a.instances,t),a.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if(o=this.system.waits[e],o.sols.hasOwnProperty(u.index)&&cr.arrayRemoveAllFromObjectSet(o.sols[u.index].insts,t),!u.is_family)for(s=0,r=u.families.length;s<r;++s)a=u.families[s],o.sols.hasOwnProperty(a.index)&&cr.arrayRemoveAllFromObjectSet(o.sols[a.index].insts,t);var p=l[0].layer;if(p){if(p.useRenderCells)for(h=p.instances,e=0,i=h.length;e<i;++e)c=h[e],t.contains(c)&&(c.update_bbox(),p.render_grid.update(c,c.rendercells,null),c.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(p.instances,t),p.setZIndicesStaleFrom(0)}for(e=0;e<l.length;++e)this.ClearDeathRowForSingleInstance(l[e],u);n(t),this.redraw=!0},t.prototype.ClearDeathRowForSingleInstance=function(t,e){var i,s,n;for(i=0,s=this.destroycallbacks.length;i<s;++i)this.destroycallbacks[i](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var r=t.layer;if(r&&r.removeFromInstanceList(t,!0),t.behavior_insts)for(i=0,s=t.behavior_insts.length;i<s;++i)n=t.behavior_insts[i],n.onDestroy&&n.onDestroy(),n.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},t.prototype.createInstance=function(t,e,i,s){if(t.is_family){var n=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[n],e,i,s)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,s,!1):null};var E=[];t.prototype.createInstanceFromInit=function(t,e,i,s,n,r){var o,a,h,c,l;if(!t)return null;var u=this.types_by_index[t[1]],p=u.plugin.is_world;if(this.isloading&&p&&!u.isOnLoaderLayout)return null;if(p&&!this.glwrap&&11===t[0][11])return null;var d,f=e;for(p||(e=null),u.deadCache.length?(d=u.deadCache.pop(),d.recycled=!0,u.plugin.Instance.call(d,u)):(d=new u.plugin.Instance(u),d.recycled=!1),!i||r||this.objectsByUid.hasOwnProperty(t[2].toString())?d.uid=this.next_uid++:d.uid=t[2],this.objectsByUid[d.uid.toString()]=d,d.puid=this.next_puid++,d.iid=u.instances.length,o=0,a=this.createRow.length;o<a;++o)this.createRow[o].type===u&&d.iid++;d.get_iid=cr.inst_get_iid,d.toString=cr.inst_toString;var g,y=t[3];if(d.recycled)cr.wipe(d.extra);else{if(d.extra={},"undefined"!=typeof cr_is_preview)for(d.instance_var_names=[],d.instance_var_names.length=y.length,o=0,a=y.length;o<a;o++)d.instance_var_names[o]=y[o][1];d.instance_vars=[],d.instance_vars.length=y.length}for(o=0,a=y.length;o<a;o++)d.instance_vars[o]=y[o][0];if(p){var m=t[0];if(d.x=cr.is_undefined(s)?m[0]:s,d.y=cr.is_undefined(n)?m[1]:n,d.z=m[2],d.width=m[3],d.height=m[4],d.depth=m[5],d.angle=m[6],d.opacity=m[7],d.hotspotX=m[8],d.hotspotY=m[9],d.blend_mode=m[10],l=m[11],!this.glwrap&&u.effect_types.length&&(d.blend_mode=l),d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.gl&&cr.setGLBlend(d,d.blend_mode,this.gl),d.recycled){for(o=0,a=m[12].length;o<a;o++)for(h=0,c=m[12][o].length;h<c;h++)d.effect_params[o][h]=m[12][o][h];d.bbox.set(0,0,0,0),d.collcells.set(0,0,-1,-1),d.rendercells.set(0,0,-1,-1),d.bquad.set_from_rect(d.bbox),cr.clearArray(d.bbox_changed_callbacks)}else{for(d.effect_params=m[12].slice(0),o=0,a=d.effect_params.length;o<a;o++)d.effect_params[o]=m[12][o].slice(0);d.active_effect_types=[],d.active_effect_flags=[],d.active_effect_flags.length=u.effect_types.length,d.bbox=new cr.rect(0,0,0,0),d.collcells=new cr.rect(0,0,-1,-1),d.rendercells=new cr.rect(0,0,-1,-1),d.bquad=new cr.quad,d.bbox_changed_callbacks=[],d.set_bbox_changed=cr.set_bbox_changed,d.add_bbox_changed_callback=cr.add_bbox_changed_callback,d.contains_pt=cr.inst_contains_pt,d.update_bbox=cr.update_bbox,d.update_render_cell=cr.update_render_cell,d.update_collision_cell=cr.update_collision_cell,d.get_zindex=cr.inst_get_zindex}for(d.tilemap_exists=!1,d.tilemap_width=0,d.tilemap_height=0,d.tilemap_data=null,14===m.length&&(d.tilemap_exists=!0,d.tilemap_width=m[13][0],d.tilemap_height=m[13][1],d.tilemap_data=m[13][2]),o=0,a=u.effect_types.length;o<a;o++)d.active_effect_flags[o]=!0;d.shaders_preserve_opaqueness=!0,d.updateActiveEffects=cr.inst_updateActiveEffects,d.updateActiveEffects(),d.uses_shaders=!!d.active_effect_types.length,d.bbox_changed=!0,d.cell_changed=!0,u.any_cell_changed=!0,d.visible=!0,d.my_timescale=-1,d.layer=e,d.zindex=e.instances.length,d.earlyz_index=0,void 0===d.collision_poly&&(d.collision_poly=null),d.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(E),o=0,a=u.families.length;o<a;o++)E.push.apply(E,u.families[o].behaviors);if(E.push.apply(E,u.behaviors),d.recycled)for(o=0,a=E.length;o<a;o++){var _=E[o];for(v=d.behavior_insts[o],v.recycled=!0,_.behavior.Instance.call(v,_,d),g=t[4][o],h=0,c=g.length;h<c;h++)v.properties[h]=g[h];v.onCreate(),_.behavior.my_instances.add(d)}else for(d.behavior_insts=[],o=0,a=E.length;o<a;o++){_=E[o];var v=new _.behavior.Instance(_,d);v.recycled=!1,v.properties=t[4][o].slice(0),v.onCreate(),cr.seal(v),d.behavior_insts.push(v),_.behavior.my_instances.add(d)}if(g=t[5],d.recycled)for(o=0,a=g.length;o<a;o++)d.properties[o]=g[o];else d.properties=g.slice(0);if(this.createRow.push(d),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(d,!0),1===e.parallaxX&&1===e.parallaxY||(u.any_instance_parallaxed=!0)),this.objectcount++,u.is_contained){if(d.is_contained=!0,d.recycled?cr.clearArray(d.siblings):d.siblings=[],!i&&!r){for(o=0,a=u.container.length;o<a;o++)if(u.container[o]!==u){if(!u.container[o].default_instance)return null;d.siblings.push(this.createInstanceFromInit(u.container[o].default_instance,f,!1,p?d.x:s,p?d.y:n,!0))}for(o=0,a=d.siblings.length;o<a;o++)for(d.siblings[o].siblings.push(d),h=0;h<a;h++)o!==h&&d.siblings[o].siblings.push(d.siblings[h])}}else d.is_contained=!1,d.siblings=null;for(d.onCreate(),d.recycled||cr.seal(d),o=0,a=d.behavior_insts.length;o<a;o++)d.behavior_insts[o].postCreate&&d.behavior_insts[o].postCreate();return d},t.prototype.getLayerByName=function(t){var e,i;for(e=0,i=this.running_layout.layers.length;e<i;e++){var s=this.running_layout.layers[e];if(cr.equals_nocase(s.name,t))return s}return null},t.prototype.getLayerByNumber=function(t){return t=cr.floor(t),t<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},t.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},t.prototype.clearSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},t.prototype.pushCleanSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},t.prototype.pushCopySol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCopySol()},t.prototype.popSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].popSol()},t.prototype.updateAllCells=function(t){if(t.any_cell_changed){var e,i,s=t.instances;for(e=0,i=s.length;e<i;++e)s[e].update_collision_cell();var n=this.createRow;for(e=0,i=n.length;e<i;++e)n[e].type===t&&n[e].update_collision_cell();t.any_cell_changed=!1}},t.prototype.getCollisionCandidates=function(t,e,i,s){var n,r,o,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(n=0,r=e.members.length;n<r;++n)o=e.members[n],a||o.any_instance_parallaxed?cr.appendArray(s,o.instances):(this.updateAllCells(o),o.collision_grid.queryRange(i,s));else a||e.any_instance_parallaxed?cr.appendArray(s,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,s))},t.prototype.getTypesCollisionCandidates=function(t,e,i,s){var n,r;for(n=0,r=e.length;n<r;++n)this.getCollisionCandidates(t,e[n],i,s)},t.prototype.getSolidCollisionCandidates=function(t,e,i){var s=this.getSolidBehavior();if(!s)return null;this.getTypesCollisionCandidates(t,s.my_types,e,i)},t.prototype.getJumpthruCollisionCandidates=function(t,e,i){var s=this.getJumpthruBehavior();if(!s)return null;this.getTypesCollisionCandidates(t,s.my_types,e,i)},t.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,s){var n,r,o,a,h,c,l,u=t.getCurrentSol(),p=this.getCurrentEventStack().current_event.orblock;if(u.select_all)for(s||(u.select_all=!1,cr.clearArray(u.instances)),n=0,a=t.instances.length;n<a;n++)if(o=t.instances[n],o.update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(s)return!1;u.instances.push(o)}else p&&u.else_instances.push(o);else{for(r=0,l=p?u.else_instances:u.instances,n=0,a=l.length;n<a;n++)if(o=l[n],o.update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(s)return!1;p?u.instances.push(o):(u.instances[r]=u.instances[n],r++)}s||(l.length=r)}return t.applySolToContainer(),!!s||u.hasObjects()},t.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,s,n,r,o,a,h,c,l,u,p=t.layer,d=e.layer,f=p!==d&&(p.parallaxX!==d.parallaxX||d.parallaxY!=d.parallaxY||p.scale!==d.scale||p.angle!==d.angle||p.zoomRate!==d.zoomRate);if(f){for(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly,c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly2,i=0,s=l.pts_count;i<s;i++)n=2*i,r=n+1,o=l.pts_cache[n],a=l.pts_cache[r],l.pts_cache[n]=p.layerToCanvas(o+t.x,a+t.y,!0),l.pts_cache[r]=p.layerToCanvas(o+t.x,a+t.y,!1);for(l.update_bbox(),i=0,s=u.pts_count;i<s;i++)n=2*i,r=n+1,o=u.pts_cache[n],a=u.pts_cache[r],u.pts_cache[n]=d.layerToCanvas(o+e.x,a+e.y,!0),u.pts_cache[r]=d.layerToCanvas(o+e.x,a+e.y,!1);return u.update_bbox(),l.intersects_poly(u,0,0)}return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!c||(h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),l=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly),c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),u=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly),l.intersects_poly(u,e.x-t.x,e.y-t.y))))))};var I=new cr.quad,L=new cr.rect(0,0,0,0),R=[];t.prototype.testTilemapOverlap=function(t,e){var i,s,n,r,o=e.bbox,a=t.x,h=t.y;t.getCollisionRectCandidates(o,R);var c=R,l=e.collision_poly&&!e.collision_poly.is_empty();for(i=0,s=c.length;i<s;++i)if(n=c[i],r=n.rc,o.intersects_rect_off(r,a,h)&&(I.set_from_rect(r),I.offset(a,h),I.intersects_quad(e.bquad)))if(l){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),n.poly){if(n.poly.intersects_poly(e.collision_poly,e.x-(a+r.left),e.y-(h+r.top)))return cr.clearArray(R),!0}else if(this.temp_poly.set_from_quad(I,0,0,r.right-r.left,r.bottom-r.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(R),!0}else{if(!n.poly)return cr.clearArray(R),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),n.poly.intersects_poly(this.temp_poly,-(a+r.left),-(h+r.top)))return cr.clearArray(R),!0}return cr.clearArray(R),!1},t.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();var i;e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,R);var s,n,r,o,a=R,h=e.x,c=e.y;for(s=0,n=a.length;s<n;++s)if(r=a[s],o=r.rc,t.intersects_rect_off(o,h,c)){if(!r.poly)return cr.clearArray(R),!0;if(this.temp_poly.set_from_rect(t,0,0),r.poly.intersects_poly(this.temp_poly,-(h+o.left),-(c+o.top)))return cr.clearArray(R),!0}return cr.clearArray(R),!1}return I.set_from_rect(t),!!e.bquad.intersects_quad(I)&&(i=e.collision_poly&&!e.collision_poly.is_empty(),!i||(e.collision_poly.cache_poly(e.width,e.height,e.angle),I.offset(-t.left,-t.top),this.temp_poly.set_from_quad(I,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},t.prototype.testSegmentOverlap=function(t,e,i,s,n){if(!n||!n.collisionsEnabled)return!1;n.update_bbox();var r;n.layer;if(L.set(cr.min(t,i),cr.min(e,s),cr.max(t,i),cr.max(e,s)),!n.bbox.intersects_rect(L))return!1;if(n.tilemap_exists){n.getCollisionRectCandidates(L,R);var o,a,h,c,l=R,u=n.x,p=n.y;for(o=0,a=l.length;o<a;++o)if(h=l[o],c=h.rc,L.intersects_rect_off(c,u,p)&&(I.set_from_rect(c),I.offset(u,p),I.intersects_segment(t,e,i,s))){if(!h.poly)return cr.clearArray(R),!0;if(h.poly.intersects_segment(u+c.left,p+c.top,t,e,i,s))return cr.clearArray(R),!0}return cr.clearArray(R),!1}return!!n.bquad.intersects_segment(t,e,i,s)&&(r=n.collision_poly&&!n.collision_poly.is_empty(),!r||(n.collision_poly.cache_poly(n.width,n.height,n.angle),n.collision_poly.intersects_segment(n.x,n.y,t,e,i,s)))},t.prototype.typeHasBehavior=function(t,e){if(!e)return!1;var i,s,n,r,o;for(i=0,s=t.behaviors.length;i<s;i++)if(t.behaviors[i].behavior instanceof e)return!0;if(!t.is_family)for(i=0,s=t.families.length;i<s;i++)for(o=t.families[i],n=0,r=o.behaviors.length;n<r;n++)if(o.behaviors[n].behavior instanceof e)return!0;return!1},t.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},t.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},t.prototype.getSolidBehavior=function(){return this.solidBehavior},t.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var M=[];t.prototype.testOverlapSolid=function(t){var e,i,s;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,M),e=0,i=M.length;e<i;++e)if(s=M[e],s.extra.solidEnabled&&this.testOverlap(t,s))return cr.clearArray(M),s;return cr.clearArray(M),null},t.prototype.testRectOverlapSolid=function(t){var e,i,s;for(this.getSolidCollisionCandidates(null,t,M),e=0,i=M.length;e<i;++e)if(s=M[e],s.extra.solidEnabled&&this.testRectOverlap(t,s))return cr.clearArray(M),s;return cr.clearArray(M),null};var F=[];t.prototype.testOverlapJumpThru=function(t,e){var i,s,n,r=null;for(e&&(r=F,cr.clearArray(r)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,M),i=0,s=M.length;i<s;++i)if(n=M[i],n.extra.jumpthruEnabled&&this.testOverlap(t,n)){if(!e)return cr.clearArray(M),n;r.push(n)}return cr.clearArray(M),r},t.prototype.pushOutSolid=function(t,e,i,s,n,r){var o,a=s||50,h=t.x,c=t.y,l=null,u=null;for(o=0;o<a;o++)if(t.x=h+e*o,t.y=c+i*o,t.set_bbox_changed(),!this.testOverlap(t,l)&&(l=this.testOverlapSolid(t),l&&(u=l),!l&&(n&&(l=r?this.testOverlap(t,r)?r:null:this.testOverlapJumpThru(t),l&&(u=l)),!l)))return u&&this.pushInFractional(t,e,i,u,16),!0;return t.x=h,t.y=c,t.set_bbox_changed(),!1},t.prototype.pushOut=function(t,e,i,s,n){var r,o=s||50,a=t.x,h=t.y;for(r=0;r<o;r++)if(t.x=a+e*r,t.y=h+i*r,t.set_bbox_changed(),!this.testOverlap(t,n))return!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},t.prototype.pushInFractional=function(t,e,i,s,n){for(var r,o=2,a=!1,h=!1,c=t.x,l=t.y;o<=n;)r=1/o,o*=2,t.x+=e*r*(a?1:-1),t.y+=i*r*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,s)?(a=!0,h=!0):(a=!1,h=!1,c=t.x,l=t.y);h&&(t.x=c,t.y=l,t.set_bbox_changed())},t.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,s=0,n=t.x,r=t.y,o=0,a=0,h=0,c=this.testOverlapSolid(t);if(!c)return!0;for(;s<=i;){switch(o){case 0:a=0,h=-1,s++;break;case 1:a=1,h=-1;break;case 2:a=1,h=0;break;case 3:a=1,h=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:a=-1,h=-1}if(o=(o+1)%8,t.x=cr.floor(n+a*s),t.y=cr.floor(r+h*s),t.set_bbox_changed(),!this.testOverlap(t,c)&&(c=this.testOverlapSolid(t),!c))return!0}return t.x=n,t.y=r,t.set_bbox_changed(),!1},t.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},t.prototype.checkRegisteredCollision=function(t,e){var i,s,n;for(i=0,s=this.registered_collisions.length;i<s;i++)if(n=this.registered_collisions[i],n[0]==t&&n[1]==e||n[0]==e&&n[1]==t)return!0;return!1},t.prototype.calculateSolidBounceAngle=function(t,e,i,s){var n=t.x,r=t.y,o=cr.max(10,cr.distanceTo(e,i,n,r)),a=cr.angleTo(e,i,n,r),h=s||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);var c,l,u,p,d=h,f=cr.to_radians(5);for(c=1;c<36;c++)if(l=a-c*f,t.x=e+Math.cos(l)*o,t.y=i+Math.sin(l)*o,t.set_bbox_changed(),!this.testOverlap(t,d)&&(d=s?null:this.testOverlapSolid(t),!d)){u=l;break}36===c&&(u=cr.clamp_angle(a+cr.PI));d=h;for(c=1;c<36;c++)if(l=a+c*f,t.x=e+Math.cos(l)*o,t.y=i+Math.sin(l)*o,t.set_bbox_changed(),!this.testOverlap(t,d)&&(d=s?null:this.testOverlapSolid(t),!d)){p=l;break}if(36===c&&(p=cr.clamp_angle(a+cr.PI)),t.x=n,t.y=r,t.set_bbox_changed(),p===u)return p;var g,y=cr.angleDiff(p,u)/2;g=cr.angleClockwise(p,u)?cr.clamp_angle(u+y+cr.PI):cr.clamp_angle(p+y);var m=Math.cos(a),_=Math.sin(a),v=Math.cos(g),b=Math.sin(g),x=m*v+_*b,w=m-2*x*v,S=_-2*x*b;return cr.angleTo(0,0,w,S)};var B=-1;t.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var s=this.running_layout.event_sheet;if(!s)return!1;var n,r,o,a=!1;B++;var h=s.deep_includes;for(r=0,o=h.length;r<o;++r)n=this.triggerOnSheet(t,e,h[r],i),a=a||n;return n=this.triggerOnSheet(t,e,s,i),a=a||n,B--,a},t.prototype.triggerOnSheet=function(t,e,i,s){var n,r,o,a,h=!1;if(e)for(o=this.triggerOnSheetForTypeName(t,e,e.type.name,i,s),h=h||o,a=e.type.families,n=0,r=a.length;n<r;++n)o=this.triggerOnSheetForTypeName(t,e,a[n].name,i,s),h=h||o;else o=this.triggerOnSheetForTypeName(t,e,"system",i,s),h=h||o;return h},t.prototype.triggerOnSheetForTypeName=function(t,e,i,s,n){var r,o,a,h,c=!1,l=!1,u=void 0!==n,p=u?s.fasttriggers:s.triggers,d=p[i];if(!d)return c;var f,g=null;for(r=0,o=d.length;r<o;++r)if(d[r].method==t){g=d[r].evs;break}if(!g)return c;if(f=u?g[n]:g,!f)return null;for(r=0,o=f.length;r<o;r++)a=f[r][0],h=f[r][1],l=this.executeSingleTrigger(e,i,a,h),c=c||l;return c},t.prototype.executeSingleTrigger=function(t,e,i,s){var n,r,o=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=this.trigger_depth>1;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var c=this.pushEventStack(i);if(c.current_event=i,t){var l=this.types[e].getCurrentSol();l.select_all=!1,cr.clearArray(l.instances),l.instances[0]=t,this.types[e].applySolToContainer()}var u=!0;if(i.parent){for(var p=c.temp_parents_arr,d=i.parent;d;)p.push(d),d=d.parent;for(p.reverse(),n=0,r=p.length;n<r;n++)if(!p[n].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,i.orblock?i.run_orblocktrigger(s):i.run(),o=o||c.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===B&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,o},t.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},t.prototype.getCurrentConditionObjectType=function(){var t=this.getCurrentCondition();return t.type},t.prototype.isCurrentConditionFirst=function(){var t=this.getCurrentEventStack();return 0===t.cndindex},t.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},t.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},t.prototype.popLocalVarStack=function(){this.localvar_stack_index--},t.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},t.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},t.prototype.popEventStack=function(){this.event_stack_index--},t.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},t.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},t.prototype.popLoopStack=function(){this.loop_stack_index--},t.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},t.prototype.getEventVariableByName=function(t,e){for(var i,s,n,r,o,a;e;){for(i=0,s=e.subevents.length;i<s;i++)if(a=e.subevents[i],a instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,s=this.eventsheets_by_index.length;i<s;i++)for(o=this.eventsheets_by_index[i],n=0,r=o.events.length;n<r;n++)if(a=o.events[n],a instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},t.prototype.getLayoutBySid=function(t){var e,i;for(e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},t.prototype.getObjectTypeBySid=function(t){var e,i;for(e=0,
i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},t.prototype.getGroupBySid=function(t){var e,i;for(e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},t.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},t.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},t.prototype.handleSaveLoad=function(){var t=this,e=this.saveToSlot,i=this.lastSaveJson,s=this.loadFromSlot,n=!1;if(this.signalledContinuousPreview&&(n=!0,e="__c2_continuouspreview",this.signalledContinuousPreview=!1),e.length){if(this.ClearDeathRow(),i=this.saveToJSONString(),r()&&!this.isCocoonJs)a(e,i,function(){cr.logexport("Saved state to IndexedDB storage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",n&&c()},function(s){try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",n&&c()}catch(e){cr.logexport("Failed to save game state: "+s+"; "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",n&&c()}catch(e){cr.logexport("Error saving to WebStorage: "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(s.length){if(r()&&!this.isCocoonJs)h(s,function(e){e?(t.loadFromJson=e,cr.logexport("Loaded state from IndexedDB storage ("+t.loadFromJson.length+" bytes)")):(t.loadFromJson=localStorage.getItem("__c2save_"+s)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)")),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(e){t.loadFromJson=localStorage.getItem("__c2save_"+s)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)"),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+s)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}if(null!==this.loadFromJson){this.ClearDeathRow();var o=this.loadFromJSONString(this.loadFromJson);o?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null}},t.prototype.saveToJSONString=function(){var t,e,i,s,n,r,o,a,h,c,u,p,d={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};for(t=0,e=this.types_by_index.length;t<e;t++)if(n=this.types_by_index[t],!n.is_family&&!this.typeHasNoSaveBehavior(n)){for(o={instances:[]},cr.hasAnyOwnProperty(n.extra)&&(o.ex=l(n.extra)),i=0,s=n.instances.length;i<s;i++)o.instances.push(this.saveInstanceToJSON(n.instances[i]));d.types[n.sid.toString()]=o}for(t=0,e=this.layouts_by_index.length;t<e;t++)r=this.layouts_by_index[t],d.layouts[r.sid.toString()]=r.saveToJSON();var f=d.events.groups;for(t=0,e=this.allGroups.length;t<e;t++)a=this.allGroups[t],f[a.sid.toString()]=this.groups_by_name[a.group_name].group_active;var g=d.events.cnds;for(p in this.cndsBySid)this.cndsBySid.hasOwnProperty(p)&&(h=this.cndsBySid[p],cr.hasAnyOwnProperty(h.extra)&&(g[p]={ex:l(h.extra)}));var y=d.events.acts;for(p in this.actsBySid)this.actsBySid.hasOwnProperty(p)&&(c=this.actsBySid[p],cr.hasAnyOwnProperty(c.extra)&&(y[p]={ex:l(c.extra)}));var m=d.events.vars;for(p in this.varsBySid)this.varsBySid.hasOwnProperty(p)&&(u=this.varsBySid[p],u.is_constant||u.parent&&!u.is_static||(m[p]=u.data));return d.system=this.system.saveToJSON(),JSON.stringify(d)},t.prototype.refreshUidMap=function(){var t,e,i,s,n,r;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(i=this.types_by_index[t],!i.is_family)for(s=0,n=i.instances.length;s<n;s++)r=i.instances[s],this.objectsByUid[r.uid.toString()]=r},t.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(e.version>1)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var s,n,r,o,a,h,c,l,u,p,d,f,g,y,m,_,v,b=i.running_layout;if(b!==this.running_layout.sid){var x=this.getLayoutBySid(b);if(!x)return;this.doChangeLayout(x)}var w=e.types;for(c in w)if(w.hasOwnProperty(c)){if(l=this.getObjectTypeBySid(parseInt(c,10)),!l||l.is_family||this.typeHasNoSaveBehavior(l))continue;for(w[c].ex?l.extra=w[c].ex:cr.wipe(l.extra),u=l.instances,p=w[c].instances,s=0,n=cr.min(u.length,p.length);s<n;s++)this.loadInstanceFromJSON(u[s],p[s]);for(s=p.length,n=u.length;s<n;s++)this.DestroyInstance(u[s]);for(s=u.length,n=p.length;s<n;s++)y=null,l.plugin.is_world&&(y=this.running_layout.getLayerBySid(p[s].w.l),!y)||(d=this.createInstanceFromInit(l.default_instance,y,!1,0,0,!0),this.loadInstanceFromJSON(d,p[s]));l.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var S=e.layouts;for(c in S)if(S.hasOwnProperty(c)){if(g=this.getLayoutBySid(parseInt(c,10)),!g)continue;g.loadFromJSON(S[c])}var T=e.events.groups;for(c in T)T.hasOwnProperty(c)&&(m=this.getGroupBySid(parseInt(c,10)),m&&this.groups_by_name[m.group_name]&&this.groups_by_name[m.group_name].setGroupActive(T[c]));var C=e.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(C.hasOwnProperty(c)?this.cndsBySid[c].extra=C[c].ex:this.cndsBySid[c].extra={});var O=e.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(O.hasOwnProperty(c)?this.actsBySid[c].extra=O[c].ex:this.actsBySid[c].extra={});var A=e.events.vars;for(c in A)A.hasOwnProperty(c)&&this.varsBySid.hasOwnProperty(c)&&(this.varsBySid[c].data=A[c]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,s=0,n=this.fireOnCreateAfterLoad.length;s<n;++s)d=this.fireOnCreateAfterLoad[s],this.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),s=0,n=this.types_by_index.length;s<n;s++)if(l=this.types_by_index[s],!l.is_family&&!this.typeHasNoSaveBehavior(l))for(r=0,o=l.instances.length;r<o;r++){if(d=l.instances[r],l.is_contained)for(_=d.get_iid(),cr.clearArray(d.siblings),a=0,h=l.container.length;a<h;a++)v=l.container[a],l!==v&&d.siblings.push(v.instances[_]);if(d.afterLoad&&d.afterLoad(),d.behavior_insts)for(a=0,h=d.behavior_insts.length;a<h;a++)f=d.behavior_insts[a],f.afterLoad&&f.afterLoad()}return this.redraw=!0,!0},t.prototype.saveInstanceToJSON=function(t,e){var i,s,n,r,o,a=t.type,h=a.plugin,c={};if(e?c.c2=!0:c.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(c.ex=l(t.extra)),t.instance_vars&&t.instance_vars.length)for(c.ivs={},i=0,s=t.instance_vars.length;i<s;i++)c.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(n={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(n.a=t.angle),1!==t.opacity&&(n.o=t.opacity),.5!==t.hotspotX&&(n.hX=t.hotspotX),.5!==t.hotspotY&&(n.hY=t.hotspotY),0!==t.blend_mode&&(n.bm=t.blend_mode),t.visible||(n.v=t.visible),t.collisionsEnabled||(n.ce=t.collisionsEnabled),-1!==t.my_timescale&&(n.mts=t.my_timescale),a.effect_types.length)for(n.fx=[],i=0,s=a.effect_types.length;i<s;i++)o=a.effect_types[i],n.fx.push({name:o.name,active:t.active_effect_flags[o.index],params:t.effect_params[o.index]});c.w=n}if(t.behavior_insts&&t.behavior_insts.length)for(c.behs={},i=0,s=t.behavior_insts.length;i<s;i++)r=t.behavior_insts[i],r.saveToJSON&&(c.behs[r.type.sid.toString()]=r.saveToJSON());return t.saveToJSON&&(c.data=t.saveToJSON()),c},t.prototype.getInstanceVarIndexBySid=function(t,e){var i,s;for(i=0,s=t.instvar_sids.length;i<s;i++)if(t.instvar_sids[i]===e)return i;return-1},t.prototype.getBehaviorIndexBySid=function(t,e){var i,s;for(i=0,s=t.behavior_insts.length;i<s;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},t.prototype.loadInstanceFromJSON=function(t,e,i){var s,n,r,o,a,h,c,l,u,p,d=t.type,f=d.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs,a)for(s in a)if(a.hasOwnProperty(s)){if(o=this.getInstanceVarIndexBySid(d,parseInt(s,10)),o<0||o>=t.instance_vars.length)continue;t.instance_vars[o]=a[s]}if(f.is_world){if(h=e.w,t.layer.sid!==h.l&&(p=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(p.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=p,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(n=0,r=h.fx.length;n<r;n++)c=d.getEffectIndexByName(h.fx[n].name),c<0||(t.active_effect_flags[c]=h.fx[n].active,t.effect_params[c]=h.fx[n].params);t.updateActiveEffects()}if(l=e.behs,l)for(s in l)if(l.hasOwnProperty(s)){if(u=this.getBehaviorIndexBySid(t,parseInt(s,10)),u<0)continue;t.behavior_insts[u].loadFromJSON(l[s])}e.data&&t.loadFromJSON(e.data)},t.prototype.fetchLocalFileViaCordova=function(t,e,i){var s=cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(s,function(t){t.file(e,i)},i)},t.prototype.fetchLocalFileViaCordovaAsText=function(t,e,i){this.fetchLocalFileViaCordova(t,function(t){var s=new FileReader;s.onload=function(t){e(t.target.result)},s.onerror=i,s.readAsText(t)},i)};var N=[],j=0,D=8;t.prototype.maybeStartNextArrayBufferRead=function(){if(N.length&&!(j>=D)){j++;var t=N.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)}},t.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var s=this;N.push({filename:t,successCallback:function(t){j--,s.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){j--,s.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},t.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){this.fetchLocalFileViaCordova(t,function(t){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(t)},i)},t.prototype.fetchLocalFileViaCordovaAsURL=function(t,e,i){this.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){var i=new Blob([t]),s=URL.createObjectURL(i);e(s)},i)},t.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},t.prototype.setImageSrc=function(t,e){this.isWKWebView&&!this.isAbsoluteUrl(e)?this.fetchLocalFileViaCordovaAsURL(e,function(e){t.src=e},function(t){alert("Failed to load image: "+t)}):t.src=e},t.prototype.setCtxImageSmoothingEnabled=function(t,e){void 0!==t.imageSmoothingEnabled?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)},cr.runtime=t,cr.createRuntime=function(e){return new t(document.getElementById(e))},cr.createDCRuntime=function(e,i){return new t({dc:!0,width:e,height:i})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var e=document.createElement("screencanvas")||document.createElement("canvas");e.screencanvas=!0,document.body.appendChild(e);var i=new t(e);return window.c2runtime=i,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),i},window.createEjectaRuntime=function(){var e=document.getElementById("canvas"),i=new t(e);return window.c2runtime=i,window.c2runtime.setSize(window.innerWidth,window.innerHeight),i}}(),window.cr_getC2Runtime=function(){var t=document.getElementById("c2canvas");return t?t.c2runtime:window.c2runtime?window.c2runtime:null},window.cr_getSnapshot=function(t,e){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){if(0!==t&&0!==e){var i=window.cr_getC2Runtime();i&&i.setSize(t,e)}},window.cr_setSuspended=function(t){var e=window.cr_getC2Runtime();e&&e.setSuspended(t)},function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,s,n=e[6];for(this.layers=[],this.initial_types=[],i=0,s=n.length;i<s;i++){var r=new cr.layer(this,n[i]);r.number=i,cr.seal(r),this.layers.push(r)}var o=e[7];for(this.initial_nonworld=[],i=0,s=o.length;i<s;i++){var a=o[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,s=e[8].length;i<s;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}function e(t,e){return t.zindex-e.zindex}function i(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=s(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,n,r=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,n=r.length;i<n;i++){var o=r[i],a=this.runtime.types_by_index[o[1]];a.default_instance||(a.default_instance=o,a.default_layerindex=this.index),this.initial_instances.push(o),-1===this.layout.initial_types.indexOf(a)&&this.layout.initial_types.push(a)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,n=e[15].length;i<n;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}function s(){return u.length?u.pop():[]}function n(t){cr.clearArray(t),u.push(t)}function r(t,e,i){var s,n,r=0,o=0,a=0,h=t.length,c=e.length;for(i.length=h+c;r<h&&o<c;++a)s=t[r],n=e[o],s.zindex<n.zindex?(i[a]=s,++r):(i[a]=n,++o);for(;r<h;++r,++a)i[a]=t[r];for(;o<c;++o,++a)i[a]=e[o]}function o(t,e){var i,o,a,h,c;for(i=0,o=t.length;i<o-1;i+=2)a=t[i],h=t[i+1],c=s(),r(a,h,c),e||(n(a),n(h)),p.push(c);o%2==1&&(e?(a=s(),cr.shallowAssignArray(a,t[o-1]),p.push(a)):p.push(t[o-1])),cr.shallowAssignArray(t,p),cr.clearArray(p)}function a(t){for(var e=!0;t.length>1;)o(t,e),e=!1;return t[0]}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]);var i=this.persist_data[e];i.push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],i.active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){var e,i,s;for(e=0,i=this.effect_types.length;e<i;e++)if(s=this.effect_types[e],s.name===t)return s;return null};var h=[],c=!0;t.prototype.startRunning=function(){var t,i,s,n,r,o,a,l,u,p,d,f,g;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,s=this.runtime.types_by_index.length;t<s;t++)if(r=this.runtime.types_by_index[t],!r.is_family)for(o=r.instances,i=0,n=o.length;i<n;i++)if(a=o[i],a.layer){var y=a.layer.number;y>=this.layers.length&&(y=this.layers.length-1),a.layer=this.layers[y],-1===a.layer.instances.indexOf(a)&&a.layer.instances.push(a),a.layer.zindices_stale=!0}if(!c)for(t=0,s=this.layers.length;t<s;++t)this.layers[t].instances.sort(e);for(cr.clearArray(h),this.boundScrolling(),t=0,s=this.layers.length;t<s;t++)g=this.layers[t],g.createInitialInstances(),g.updateViewport(null);var m=!1;if(!this.first_visit){for(d in this.persist_data)if(this.persist_data.hasOwnProperty(d)){if(r=this.runtime.getObjectTypeBySid(parseInt(d,10)),!r||r.is_family||!this.runtime.typeHasPersistBehavior(r))continue;for(f=this.persist_data[d],t=0,s=f.length;t<s;t++)g=null,r.plugin.is_world&&(g=this.getLayerBySid(f[t].w.l),!g)||(a=this.runtime.createInstanceFromInit(r.default_instance,g,!1,0,0,!0),this.runtime.loadInstanceFromJSON(a,f[t]),m=!0,h.push(a));cr.clearArray(f)}for(t=0,s=this.layers.length;t<s;t++)this.layers[t].instances.sort(e),this.layers[t].zindices_stale=!0}for(m&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),t=0;t<h.length;t++)if(a=h[t],a.type.is_contained)for(l=a.get_iid(),i=0,n=a.type.container.length;i<n;i++)u=a.type.container[i],a.type!==u&&(u.instances.length>l?a.siblings.push(u.instances[l]):u.default_instance&&(p=this.runtime.createInstanceFromInit(u.default_instance,a.layer,!0,a.x,a.y,!0),this.runtime.ClearDeathRow(),u.updateIIDs(),a.siblings.push(p),h.push(p)));for(t=0,s=this.initial_nonworld.length;t<s;t++)a=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0);if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(t=0,s=this.runtime.types_by_index.length;t<s;t++)u=this.runtime.types_by_index[t],!u.is_family&&u.instances.length&&u.preloadCanvas2D&&u.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,h);else for(t=0,s=h.length;t<s;t++)a=h[t],this.runtime.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnCreated,a);cr.clearArray(h),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createGlobalNonWorlds=function(){var t,e,i,s,n;for(t=0,e=0,i=this.initial_nonworld.length;t<i;t++)s=this.initial_nonworld[t],n=this.runtime.types_by_index[s[1]],n.global?n.is_contained||this.runtime.createInstanceFromInit(s,null,!0):(this.initial_nonworld[e]=s,e++);cr.truncateArray(this.initial_nonworld,e)},t.prototype.stopRunning=function(){var t,e,i,s,n,r,o;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),n=this.layers[t].instances,i=0,s=n.length;i<s;i++)r=n[i],r.type.global||this.runtime.typeHasPersistBehavior(r.type)&&this.saveObjectToPersist(r);for(t=0,e=this.layers.length;t<e;t++){for(n=this.layers[t].instances,i=0,s=n.length;i<s;i++)r=n[i],r.type.global||this.runtime.DestroyInstance(r);this.runtime.ClearDeathRow(),cr.clearArray(n),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(o=this.runtime.types_by_index[t],!(o.global||o.plugin.is_world||o.plugin.singleglobal||o.is_family)){for(i=0,s=o.instances.length;i<s;i++)this.runtime.DestroyInstance(o.instances[i]);this.runtime.ClearDeathRow()}c=!1,this.runtime.isEndingLayout=!1};var l=new cr.rect(0,0,0,0);t.prototype.recreateInitialObjects=function(t,e,i,s,n){var r,o;for(l.set(e,i,s,n),r=0,o=this.layers.length;r<o;r++)this.layers[r].recreateInitialObjects(t,l)},t.prototype.draw=function(t){var e,i,s,n,r=t,o=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),e=this.runtime.layout_canvas,e.width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),o=!0),e=this.runtime.layout_canvas,r=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&this.runtime.setCtxImageSmoothingEnabled(r,this.runtime.linearSampling)),r.globalAlpha=1,r.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&r.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,s=this.layers.length;i<s;i++)n=this.layers[i],n.visible&&n.opacity>0&&11!==n.blend_mode&&(n.instances.length||!n.transparent)?n.draw(r):n.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;e>=0;--e)i=this.layers[e],i.visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,s,n=this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(n?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)s=this.layers[e],s.visible&&s.opacity>0&&(s.instances.length||!s.transparent)?s.drawGL(t):s.updateViewport(null);if(n)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var r=this.active_effect_types[0].index;t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[r]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else t.switchProgram(0);this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView();var o=this.runtime.width/2,a=this.runtime.height/2;t.quad(-o,a,o,a,o,-a,-o,-a),t.setTexture(null),t.setDepthTestEnabled(!0)}else this.renderEffectChain(t,null,null,null)},t.prototype.getRenderTarget=function(){return this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){var t,e,i,s=this.layers[0].getScale();for(t=1,e=this.layers.length;t<e;t++)i=this.layers[t],0===i.parallaxX&&0===i.parallaxY||i.getScale()<s&&(s=i.getScale());return s},t.prototype.scrollToX=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_width*(1/this.getMinLayerScale())/2;t>this.width-e&&(t=this.width-e),t<e&&(t=e)}this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_height*(1/this.getMinLayerScale())/2;t>this.height-e&&(t=this.height-e),t<e&&(t=e)}this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.renderEffectChain=function(t,e,i,s){var n=i?i.active_effect_types:e?e.active_effect_types:this.active_effect_types,r=1,o=0,a=0,h=0,c=this.runtime.draw_width,l=this.runtime.draw_height;i?(r=i.layer.getScale(),o=i.layer.getAngle(),a=i.layer.viewLeft,h=i.layer.viewTop,c=i.layer.viewRight,l=i.layer.viewBottom):e&&(r=e.getScale(),o=e.getAngle(),a=e.viewLeft,h=e.viewTop,c=e.viewRight,l=e.viewBottom);var u,p,d,f,g,y=this.runtime.fx_tex,m=0,_=1,v=this.runtime.draw_width,b=this.runtime.draw_height,x=v/2,w=b/2,S=e?e.rcTex:this.rcTex,T=e?e.rcTex2:this.rcTex2,C=0,O=0,A=0,P=0,k=v,E=v,I=b,L=b,R=0,M=0,F=i?i.layer.getAngle():0;if(i){for(u=0,p=n.length;u<p;u++)R+=t.getProgramBoxExtendHorizontal(n[u].shaderindex),M+=t.getProgramBoxExtendVertical(n[u].shaderindex);var B=i.bbox;if(C=e.layerToCanvas(B.left,B.top,!0,!0),A=e.layerToCanvas(B.left,B.top,!1,!0),k=e.layerToCanvas(B.right,B.bottom,!0,!0),I=e.layerToCanvas(B.right,B.bottom,!1,!0),0!==F){var N=e.layerToCanvas(B.right,B.top,!0,!0),j=e.layerToCanvas(B.right,B.top,!1,!0),D=e.layerToCanvas(B.left,B.bottom,!0,!0),V=e.layerToCanvas(B.left,B.bottom,!1,!0);d=Math.min(C,k,N,D),k=Math.max(C,k,N,D),C=d,d=Math.min(A,I,j,V),I=Math.max(A,I,j,V),A=d}C-=R,A-=M,k+=R,I+=M,T.left=C/v,T.top=1-A/b,T.right=k/v,T.bottom=1-I/b,O=C=cr.floor(C),P=A=cr.floor(A),E=k=cr.ceil(k),L=I=cr.ceil(I),O-=R,P-=M,E+=R,L+=M,C<0&&(C=0),A<0&&(A=0),k>v&&(k=v),I>b&&(I=b),O<0&&(O=0),P<0&&(P=0),E>v&&(E=v),L>b&&(L=b),S.left=C/v,S.top=1-A/b,S.right=k/v,S.bottom=1-I/b}else S.left=T.left=0,S.top=T.top=0,S.right=T.right=1,S.bottom=T.bottom=1;var W=i&&(t.programUsesDest(n[0].shaderindex)||0!==R||0!==M||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),W&&(y[m]||(y[m]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),y[m].c2width===v&&y[m].c2height===b||(t.deleteTexture(y[m]),y[m]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(y[m]),g=L-P,f=b-P-g,t.clearRect(O,f,E-O,g),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-x,-w),t.updateModelView(),t.quadTex(C,I,k,I,k,A,C,A,S)),T.left=T.top=0,T.right=T.bottom=1,i&&(d=S.top,S.top=S.bottom,S.bottom=d),m=1,_=0),t.setOpacity(1);var G=n.length-1,U=t.programUsesCrossSampling(n[G].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,z=0;for(u=0,p=n.length;u<p;u++){if(y[m]||(y[m]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),y[m].c2width===v&&y[m].c2height===b||(t.deleteTexture(y[m]),y[m]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),t.switchProgram(n[u].shaderindex),z=n[u].index,t.programIsAnimated(n[u].shaderindex)&&(this.runtime.redraw=!0),0!=u||W)t.setProgramParameters(s,1/v,1/b,T.left,T.top,T.right,T.bottom,r,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i?i.effect_params[z]:e?e.effect_params[z]:this.effect_params[z]),t.setTexture(null),u!==G||U?(t.setRenderingToTexture(y[m]),g=L-P,f=b-P-g,t.clearRect(O,f,E-O,g)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(s)),t.setTexture(y[_]),t.resetModelView(),t.translate(-x,-w),t.updateModelView(),t.quadTex(C,I,k,I,k,A,C,A,S),u!==G||U||t.setTexture(null);else{if(t.setRenderingToTexture(y[m]),g=L-P,f=b-P-g,t.clearRect(O,f,E-O,g),i){var J,H;if(i.curFrame&&i.curFrame.texture_img){var X=i.curFrame.texture_img;J=1/X.width,H=1/X.height}else J=1/i.width,H=1/i.height;t.setProgramParameters(s,J,H,T.left,T.top,T.right,T.bottom,r,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i.effect_params[z]),i.drawGL(t)}else t.setProgramParameters(s,1/v,1/b,0,0,1,1,r,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,e?e.effect_params[z]:this.effect_params[z]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-x,-w),t.updateModelView(),t.quadTex(C,I,k,I,k,A,C,A,S);T.left=T.top=0,T.right=T.bottom=1,i&&!U&&(d=I,I=A,A=d)}m=0===m?1:0,_=0===m?1:0}U&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),x=this.runtime.width/2,w=this.runtime.height/2,C=0,A=0,k=this.runtime.width,I=this.runtime.height),t.setRenderingToTexture(s),t.setTexture(y[_]),t.resetModelView(),t.translate(-x,-w),t.updateModelView(),i&&1===n.length&&!W?t.quadTex(C,A,k,A,k,I,C,I,S):t.quadTex(C,I,k,I,k,A,C,A,S),t.setTexture(null))},t.prototype.getLayerBySid=function(t){var e,i;for(e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){var t,e,i,s,n={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};for(t=0,e=this.effect_types.length;t<e;t++)s=this.effect_types[t],n.fx.push({name:s.name,active:s.active,params:this.effect_params[s.index]});for(t=0,e=this.layers.length;t<e;t++)i=this.layers[t],n.layers[i.sid.toString()]=i.saveToJSON();return n},
t.prototype.loadFromJSON=function(t){var e,i,s,n,r;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);var o=t.fx;for(e=0,i=o.length;e<i;e++)s=this.getEffectByName(o[e].name),s&&(s.active=o[e].active,this.effect_params[s.index]=o[e].params);this.updateActiveEffects();var a=t.layers;for(n in a)if(a.hasOwnProperty(n)){if(r=this.getLayerBySid(parseInt(n,10)),!r)continue;r.loadFromJSON(a[n])}},cr.layout=t,i.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],i.active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},i.prototype.getEffectByName=function(t){var e,i,s;for(e=0,i=this.effect_types.length;e<i;e++)if(s=this.effect_types[e],s.name===t)return s;return null},i.prototype.createInitialInstances=function(){var t,e,i,s,n,r,o,a;for(t=0,e=0,i=this.initial_instances.length;t<i;t++){if(n=this.initial_instances[t],r=this.runtime.types_by_index[n[1]],a=this.runtime.typeHasPersistBehavior(r),o=!0,!a||this.layout.first_visit){if(s=this.runtime.createInstanceFromInit(n,this,!0),!s)continue;h.push(s),s.type.global&&(o=!1,this.created_globals.push(s.uid))}o&&(this.initial_instances[e]=this.initial_instances[t],e++)}this.initial_instances.length=e,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},i.prototype.recreateInitialObjects=function(t,e){var i,s,n,r,o,a,h,c,l,u,p,d=this.runtime.types_by_index,f=t.is_family,g=t.members;for(i=0,s=this.initial_instances.length;i<s;++i)if(n=this.initial_instances[i],o=n[0],a=o[0],h=o[1],e.contains_pt(a,h)){if(r=d[n[1]],r!==t){if(!f)continue;if(g.indexOf(r)<0)continue}if(c=this.runtime.createInstanceFromInit(n,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(r.plugin).cnds.OnCreated,c),c.is_contained)for(l=0,u=c.siblings.length;l<u;l++)p=c.siblings[i],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);this.runtime.isInOnDestroy--}},i.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},i.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},i.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},i.prototype.moveInstanceAdjacent=function(t,e,i){var s=t.get_zindex(),n=e.get_zindex();cr.arrayRemove(this.instances,s),s<n&&n--,i&&n++,n===this.instances.length?this.instances.push(t):this.instances.splice(n,0,t),this.setZIndicesStaleFrom(s<n?s:n)},i.prototype.setZIndicesStaleFrom=function(t){-1===this.zindices_stale_from?this.zindices_stale_from=t:t<this.zindices_stale_from&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},i.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)i=this.instances[t],i.zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},i.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},i.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},i.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var u=[],p=[],d=[];i.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,d),!d.length)return s();if(1===d.length){var t=s();return cr.shallowAssignArray(t,d[0]),cr.clearArray(d),t}var e=a(d);return cr.clearArray(d),e},i.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,s=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),e=this.runtime.layer_canvas,e.width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),s=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,s=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,s=!0),s&&this.runtime.setCtxImageSmoothingEnabled(i,this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var r=this.canvasToLayer(0,0,!0,!0),o=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(r=Math.round(r),o=Math.round(o)),this.rotateViewport(r,o,i);var a,h=this.getScale();i.scale(h,h),i.translate(-r,-o),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(n(this.last_render_list),a=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):a=this.last_render_list):a=this.instances;var c,l,u,p=null;for(c=0,l=a.length;c<l;++c)u=a[c],u!==p&&(this.drawInstance(u,i),p=u);this.useRenderCells&&(this.last_render_list=a),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},i.prototype.drawInstance=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e))}},i.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},i.prototype.rotateViewport=function(t,e,i){var s,n=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/n),this.viewBottom=e+this.runtime.draw_height*(1/n),this.viewLeft>this.viewRight&&(s=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=s),this.viewTop>this.viewBottom&&(s=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=s);var r=this.getAngle();0!==r&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-r),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,r),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},i.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var s,r=this.getScale();t.resetModelView(),t.scale(r,r),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(n(this.last_render_list),s=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):s=this.last_render_list):s=this.instances;var o,a,h=null;for(o=s.length-1;o>=0;--o)a=s[o],a!==h&&(this.drawInstanceGL_earlyZPass(s[o],t),h=a);this.useRenderCells&&(this.last_render_list=s),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},i.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||this.active_effect_types.length>0||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),r=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),r=Math.round(r)),this.rotateViewport(s,r,null);var o,a=this.getScale();t.resetModelView(),t.scale(a,a),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(n(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;var h,c,l,u=null;for(h=0,c=o.length;h<c;++h)l=o[h],l!==u&&(this.drawInstanceGL(o[h],t),u=l);if(this.useRenderCells&&(this.last_render_list=o),this.render_offscreen)if(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity){1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,a,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView();var p=this.runtime.draw_width/2,d=this.runtime.draw_height/2;t.quad(-p,d,p,d,p,-d,-p,-d),t.setTexture(null)}else this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget())},i.prototype.drawInstanceGL=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e)))}},i.prototype.drawInstanceGL_earlyZPass=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e)))}},i.prototype.drawInstanceWithShadersGL=function(t,e){var i=t.active_effect_types[0].shaderindex,s=t.active_effect_types[0].index,n=this.getScale();if(1!==t.active_effect_types.length||e.programUsesCrossSampling(i)||e.programExtendsBox(i)||(t.angle||t.layer.getAngle())&&e.programUsesDest(i)||1!==t.opacity||t.type.plugin.must_predraw)this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(n,n),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();else{e.switchProgram(i),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(i)&&(this.runtime.redraw=!0);var r,o,a=0,h=0,c=0,l=0;if(e.programUsesDest(i)){var u=t.bbox,p=this.layerToCanvas(u.left,u.top,!0,!0),d=this.layerToCanvas(u.left,u.top,!1,!0),f=this.layerToCanvas(u.right,u.bottom,!0,!0),g=this.layerToCanvas(u.right,u.bottom,!1,!0);a=p/windowWidth,h=1-d/windowHeight,c=f/windowWidth,l=1-g/windowHeight}if(t.curFrame&&t.curFrame.texture_img){var y=t.curFrame.texture_img;r=1/y.width,o=1/y.height}else r=1/t.width,o=1/t.height;e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),r,o,a,h,c,l,n,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,t.effect_params[s]),t.drawGL(e)}},i.prototype.canvasToLayer=function(t,e,i,s){var n=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=n,e*=n);var r=this.runtime.parallax_x_origin,o=this.runtime.parallax_y_origin,a=(this.layout.scrollX-r)*this.parallaxX+r,h=(this.layout.scrollY-o)*this.parallaxY+o,c=a,l=h,u=1/this.getScale(!s);s?(c-=this.runtime.draw_width*u/2,l-=this.runtime.draw_height*u/2):(c-=this.runtime.width*u/2,l-=this.runtime.height*u/2),c+=t*u,l+=e*u;var p=this.getAngle();if(0!==p){c-=a,l-=h;var d=Math.cos(p),f=Math.sin(p),g=c*d-l*f;l=l*d+c*f,c=g,c+=a,l+=h}return i?c:l},i.prototype.layerToCanvas=function(t,e,i,s){var n=this.runtime.parallax_x_origin,r=this.runtime.parallax_y_origin,o=(this.layout.scrollX-n)*this.parallaxX+n,a=(this.layout.scrollY-r)*this.parallaxY+r,h=o,c=a,l=this.getAngle();if(0!==l){t-=o,e-=a;var u=Math.cos(-l),p=Math.sin(-l),d=t*u-e*p;e=e*u+t*p,t=d,t+=o,e+=a}var f=1/this.getScale(!s);s?(h-=this.runtime.draw_width*f/2,c-=this.runtime.draw_height*f/2):(h-=this.runtime.width*f/2,c-=this.runtime.height*f/2),h=(t-h)/f,c=(e-c)/f;var g=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!s&&(h/=g,c/=g),i?h:c},i.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var s=this.layerToCanvas(t,e,!0),n=this.layerToCanvas(t,e,!1);this.disableAngle=!0;var r=this.canvasToLayer(s,n,!0),o=this.canvasToLayer(s,n,!0);return this.disableAngle=!1,i?r:o},i.prototype.saveToJSON=function(){var t,e,i,s={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};for(t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],s.fx.push({name:i.name,active:i.active,params:this.effect_params[i.index]});return s},i.prototype.loadFromJSON=function(t){var i,s,n,r;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var o=new cr.ObjectSet;for(i=0,n=this.created_globals.length;i<n;++i)o.add(this.created_globals[i]);for(i=0,s=0,n=this.initial_instances.length;i<n;++i)o.contains(this.initial_instances[i][2])||(this.initial_instances[s]=this.initial_instances[i],++s);cr.truncateArray(this.initial_instances,s);var a=t.fx;for(i=0,n=a.length;i<n;i++)r=this.getEffectByName(a[i].name),r&&(r.active=a[i].active,this.effect_params[r.index]=a[i].params);this.updateActiveEffects(),this.instances.sort(e),this.zindices_stale=!0},cr.layer=i}(),function(){function t(t,e){var i,s=t.length;switch(s){case 0:return!0;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}}function e(t,e){return t.index-e.index}function i(i){var s,n,r,o,a;for(2===i.length?i[0].index>i[1].index&&(o=i[0],i[0]=i[1],i[1]=o):i.length>2&&i.sort(e),i.length>=y.length&&(y.length=i.length+1),y[i.length]||(y[i.length]=[]),a=y[i.length],s=0,n=a.length;s<n;s++)if(r=a[s],t(i,r))return r;return a.push(i),i}function s(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,s,n=e[1];for(this.events=[],i=0,s=n.length;i<s;i++)this.init_event(n[i],null,this.events)}function n(t){return!(!cr.plugins_.Sprite||t!==cr.plugins_.Sprite.prototype.cnds.OnFrameChanged)}function r(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function o(t,e,i){var s,n;this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var r=i[5];for(s=0,n=r.length;s<n;s++){var o=new cr.condition(this,r[s]);o.index=s,cr.seal(o),this.conditions.push(o),this.addSolModifier(o.type)}var a=i[6];for(s=0,n=a.length;s<n;s++){var h=new cr.action(this,a[s]);h.index=s,cr.seal(h),this.actions.push(h)}if(8===i.length){var c=i[7];for(s=0,n=c.length;s<n;s++)this.sheet.init_event(c[s],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function a(t,e){var i,s,n;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,s=t.container.length;i<s;i++)n=t.container[i],t!==n&&-1===e.indexOf(n)&&e.push(n)}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=e[3]>0,this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){var i,s,n=e[9];for(i=0,s=n.length;i<s;i++){var r=new cr.parameter(this,n[i]);cr.seal(r),this.parameters.push(r)}this.results.length=n.length}}function c(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,6===e.length){var i,s,n=e[5];for(i=0,s=n.length;i<s;i++){var r=new cr.parameter(this,n[i]);cr.seal(r),this.parameters.push(r)}this.results.length=n.length}}function l(){return _++,m.length===_&&m.push(new cr.expvalue),m[_]}function u(){_--}function p(t,e){var i,s,n;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,e[0]){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,s=e.length;i<s;i++)n=new cr.parameter(this.owner,e[i]),cr.seal(n),this.subparams.push(n),this.variadicret.push(0)}}function d(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],this.runtime.varsBySid[this.sid.toString()]=this,this.data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function f(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function g(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}var y=[];s.prototype.toString=function(){return this.name},s.prototype.init_event=function(t,e,i){switch(t[0]){case 0:var s,n,r=new cr.eventblock(this,e,t);if(cr.seal(r),r.orblock)for(i.push(r),s=0,n=r.conditions.length;s<n;s++)r.conditions[s].trigger&&this.init_trigger(r,s);else r.is_trigger()?this.init_trigger(r,0):i.push(r);break;case 1:var o=new cr.eventvariable(this,e,t);cr.seal(o),i.push(o);break;case 2:var a=new cr.eventinclude(this,e,t);cr.seal(a),i.push(a)}},s.prototype.postInit=function(){var t,e;for(t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},s.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},s.prototype.addDeepIncludes=function(t){var e,i,s,n,r=t.deep_includes,o=t.already_included_sheets,a=this.includes.valuesRef();for(e=0,i=a.length;e<i;++e)s=a[e],n=s.include_sheet,!s.isActive()||t===n||o.indexOf(n)>-1||(o.push(n),n.addDeepIncludes(t),r.push(n))},s.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var s=this.events[e];s.run(),this.runtime.clearSol(s.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},s.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i,s=t.conditions[e];i=s.type?s.type.name:"system";var r=s.fasttrigger,o=r?this.fasttriggers:this.triggers;o[i]||(o[i]=[]);var a=o[i],h=s.func;if(r){if(!s.parameters.length)return;var c,l=s.parameters[0];if(1!==l.type||2!==l.expression.type)return;var u,p,d=l.expression.value.toLowerCase();for(u=0,p=a.length;u<p;u++)if(a[u].method==h)return c=a[u].evs,void(c[d]?c[d].push([t,e]):c[d]=[[t,e]]);c={},c[d]=[[t,e]],a.push({method:h,evs:c})}else{for(u=0,p=a.length;u<p;u++)if(a[u].method==h)return void a[u].evs.push([t,e]);n(h)?a.unshift({method:h,evs:[[t,e]]}):a.push({method:h,evs:[[t,e]]})}},cr.eventsheet=s,r.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},r.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},r.prototype.pick_one=function(t){if(t)if(t.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1);var e=this.else_instances.indexOf(t);-1!==e&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t},cr.selection=r,window._c2hh_="4015A5FF9B0144D528478E34F3809F0E953B6B78",o.prototype.postInit=function(t){var e,s,n=this.parent;if(this.group)for(this.toplevelgroup=!0;n;){if(!n.group){this.toplevelgroup=!1;break}n=n.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t,this.solModifiersIncludingParents=this.solModifiers.slice(0),n=this.parent;n;){for(e=0,s=n.solModifiers.length;e<s;e++)this.addParentSolModifier(n.solModifiers[e]);n=n.parent}for(this.solModifiers=i(this.solModifiers),this.solModifiersIncludingParents=i(this.solModifiersIncludingParents),e=0,s=this.conditions.length;e<s;e++)this.conditions[e].postInit();for(e=0,s=this.actions.length;e<s;e++)this.actions[e].postInit();for(e=0,s=this.subevents.length;e<s;e++)this.subevents[e].postInit(e<s-1&&this.subevents[e+1].is_else_block)},o.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();i>0&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},o.prototype.addSolModifier=function(t){a(t,this.solModifiers)},o.prototype.addParentSolModifier=function(t){a(t,this.solModifiersIncludingParents)},o.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},o.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},o.prototype.run=function(){var t,e,i,s=!1,n=this.runtime,r=this.runtime.getCurrentEventStack();r.current_event=this;var o=this.conditions;if(this.is_else_block||(r.else_branch_ran=!1),this.orblock){for(0===o.length&&(s=!0),r.cndindex=0,t=o.length;r.cndindex<t;r.cndindex++)e=o[r.cndindex],e.trigger||(i=e.run(),i&&(s=!0));r.last_event_true=s,s&&this.run_actions_and_subevents()}else{for(r.cndindex=0,t=o.length;r.cndindex<t;r.cndindex++)if(i=o[r.cndindex].run(),!i)return r.last_event_true=!1,void(this.toplevelevent&&n.hasPendingInstances&&n.ClearDeathRow());r.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(r)},o.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},o.prototype.run_orblocktrigger=function(t){var e=this.runtime.getCurrentEventStack();e.current_event=this,this.conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},o.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},o.prototype.resume_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},o.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,s,n=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],s=!this.toplevelgroup||!this.group&&t<n,s&&this.runtime.pushCopySol(i.solModifiers),i.run(),s?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},o.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},o.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},
o.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;e>=0;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=o,h.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)i=this.parameters[t],i.postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_true=function(){return!0},h.prototype.run_system=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},h.prototype.run_static=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),i},h.prototype.run_object=function(){var t,e,i,s,n,r,o,a,h,c,l,u,p,d=this.type,f=d.getCurrentSol(),g=this.block.orblock&&!this.trigger,y=0,m=d.is_contained,_=d.is_family,v=d.family_index,b=this.beh_index,x=b>-1,w=this.anyParamVariesPerInstance,S=this.parameters,T=this.results,C=this.inverted,O=this.func;if(w)for(e=0,n=S.length;e<n;++e)r=S[e],r.variesPerInstance||(T[e]=r.get(0));else for(e=0,n=S.length;e<n;++e)T[e]=S[e].get(0);if(f.select_all){for(cr.clearArray(f.instances),cr.clearArray(f.else_instances),u=d.instances,t=0,s=u.length;t<s;++t){if(h=u[t],w)for(e=0,n=S.length;e<n;++e)r=S[e],r.variesPerInstance&&(T[e]=r.get(t));x?(y=0,_&&(y=h.type.family_beh_map[v]),o=O.apply(h.behavior_insts[b+y],T)):o=O.apply(h,T),a=cr.xor(o,C),a?f.instances.push(h):g&&f.else_instances.push(h)}return d.finish&&d.finish(!0),f.select_all=!1,d.applySolToContainer(),f.hasObjects()}i=0;var A=g&&!this.block.isFirstConditionOfType(this);u=A?f.else_instances:f.instances;var P=!1;for(t=0,s=u.length;t<s;++t){if(h=u[t],w)for(e=0,n=S.length;e<n;++e)r=S[e],r.variesPerInstance&&(T[e]=r.get(t));if(x?(y=0,_&&(y=h.type.family_beh_map[v]),o=O.apply(h.behavior_insts[b+y],T)):o=O.apply(h,T),cr.xor(o,C))if(P=!0,A){if(f.instances.push(h),m)for(e=0,n=h.siblings.length;e<n;e++)c=h.siblings[e],c.type.getCurrentSol().instances.push(c)}else{if(u[i]=h,m)for(e=0,n=h.siblings.length;e<n;e++)c=h.siblings[e],c.type.getCurrentSol().instances[i]=c;i++}else if(A){if(u[i]=h,m)for(e=0,n=h.siblings.length;e<n;e++)c=h.siblings[e],c.type.getCurrentSol().else_instances[i]=c;i++}else if(g&&(f.else_instances.push(h),m))for(e=0,n=h.siblings.length;e<n;e++)c=h.siblings[e],c.type.getCurrentSol().else_instances.push(c)}if(cr.truncateArray(u,i),m)for(p=d.container,t=0,s=p.length;t<s;t++)l=p[t].getCurrentSol(),A?cr.truncateArray(l.else_instances,i):cr.truncateArray(l.instances,i);var k=P;if(A&&!P)for(t=0,s=f.instances.length;t<s;t++){if(h=f.instances[t],w)for(e=0,n=S.length;e<n;e++)r=S[e],r.variesPerInstance&&(T[e]=r.get(t));if(o=x?O.apply(h.behavior_insts[b],T):O.apply(h,T),cr.xor(o,C)){P=!0;break}}return d.finish&&d.finish(k||g),g?P:f.hasObjects()},cr.condition=h,c.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)i=this.parameters[t],i.postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},c.prototype.run_system=function(){var t,e,i=this.runtime,s=this.parameters,n=this.results;for(t=0,e=s.length;t<e;++t)n[t]=s[t].get();return this.func.apply(i.system,n)},c.prototype.run_object=function(){var t,e,i,s,n,r,o,a=this.type,h=this.beh_index,c=a.family_index,l=this.anyParamVariesPerInstance,u=this.parameters,p=this.results,d=this.func,f=a.getCurrentSol().getObjects(),g=a.is_family,y=h>-1;if(l)for(e=0,s=u.length;e<s;++e)n=u[e],n.variesPerInstance||(p[e]=n.get(0));else for(e=0,s=u.length;e<s;++e)p[e]=u[e].get(0);for(t=0,i=f.length;t<i;++t){if(r=f[t],l)for(e=0,s=u.length;e<s;++e)n=u[e],n.variesPerInstance&&(p[e]=n.get(t));y?(o=0,g&&(o=r.type.family_beh_map[c]),d.apply(r.behavior_insts[h+o],p)):d.apply(r,p)}return!1},cr.action=c;var m=[],_=-1;p.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},p.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},p.prototype.setVaries=function(){this.variesPerInstance=!0},p.prototype.get_exp=function(t){this.solindex=t||0;var e=l();return this.expression.get(e),u(),e.data},p.prototype.get_exp_str=function(t){this.solindex=t||0;var e=l();return this.expression.get(e),u(),cr.is_string(e.data)?e.data:""},p.prototype.get_object=function(){return this.object},p.prototype.get_combosel=function(){return this.combosel},p.prototype.get_layer=function(t){this.solindex=t||0;var e=l();return this.expression.get(e),u(),e.is_number()?this.runtime.getLayerByNumber(e.data):this.runtime.getLayerByName(e.data)},p.prototype.get_layout=function(){return this.layout},p.prototype.get_key=function(){return this.key},p.prototype.get_instvar=function(){return this.index},p.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,s=null,n=i.getCurrentSol(),r=n.getObjects();if(r.length)s=r[e%r.length].type;else if(n.else_instances.length)s=n.else_instances[e%n.else_instances.length].type;else{if(!i.instances.length)return 0;s=i.instances[e%i.instances.length].type}return this.index+s.family_var_map[i.family_index]},p.prototype.get_eventvar=function(){return this.eventvar},p.prototype.get_audiofile=function(){return this.fileinfo},p.prototype.get_variadic=function(){var t,e;for(t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=p,d.prototype.postInit=function(){this.solModifiers=i(this.solModifiers)},d.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},d.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length?this.initial:void 0===t[this.localIndex]?this.initial:t[this.localIndex]},d.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=d,f.prototype.toString=function(){return"include:"+this.include_sheet.toString()},f.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=i(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},f.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},f.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},f.prototype.isActive=function(){return this.active},cr.eventinclude=f,g.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},g.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=g}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i,s,n=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(n=e[2],this.results.length=n.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(n=e[5],this.results.length=n.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(n=e[6],this.results.length=n.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),this.type>=4&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),n)for(i=0,s=n.length;i<s;i++)this.parameters.push(new cr.expNode(t,n[i]));cr.seal(this)}function e(){return++o,r.length===o&&r.push(new cr.expvalue),r[o]}function i(){--o}function s(t,e,i){var s,n;for(s=0,n=t.length;s<n;++s)t[s].get(i),e[s+1]=i.data}function n(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.postInit=function(){var t,e;if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var r=[],o=-1;t.prototype.eval_system_exp=function(t){var n=this.parameters,r=this.results;r[0]=t;var o=e();s(n,r,o),i(),this.func.apply(this.runtime.system,r)},t.prototype.eval_object_exp=function(t){var n=this.object_type,r=this.results,o=this.parameters,a=this.instance_expr,h=this.func,c=this.owner.solindex,l=n.getCurrentSol(),u=l.getObjects();if(!u.length){if(!l.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));u=l.else_instances}r[0]=t,t.object_class=n;var p=e();s(o,r,p),a&&(a.get(p),p.is_number()&&(c=p.data,u=n.instances)),i();var d=u.length;(c>=d||c<=-d)&&(c%=d),c<0&&(c+=d);h.apply(u[c],r)},t.prototype.eval_behavior_exp=function(t){var n=this.object_type,r=this.results,o=this.parameters,a=this.instance_expr,h=this.beh_index,c=this.func,l=this.owner.solindex,u=n.getCurrentSol(),p=u.getObjects();if(!p.length){if(!u.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));p=u.else_instances}r[0]=t,t.object_class=n;var d=e();s(o,r,d),a&&(a.get(d),d.is_number()&&(l=d.data,p=n.instances)),i();var f=p.length;(l>=f||l<=-f)&&(l%=f),l<0&&(l+=f);var g=p[l],y=0;n.is_family&&(y=g.type.family_beh_map[n.family_index]);c.apply(g.behavior_insts[h+y],r)},t.prototype.eval_instvar_exp=function(t){var s,n=this.instance_expr,r=this.object_type,o=this.varindex,a=this.owner.solindex,h=r.getCurrentSol(),c=h.getObjects();if(!c.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));c=h.else_instances}if(n){var l=e();if(n.get(l),l.is_number()){a=l.data;var u=r.instances;0!==u.length&&(a%=u.length,a<0&&(a+=u.length)),s=r.getInstanceByIID(a);var p=s.instance_vars[o];return cr.is_string(p)?t.set_string(p):t.set_float(p),void i()}i()}var d=c.length;(a>=d||a<=-d)&&(a%=d),a<0&&(a+=d),s=c[a];var f=0;r.is_family&&(f=s.type.family_var_map[r.family_index]);p=s.instance_vars[o+f];cr.is_string(p)?t.set_string(p):t.set_float(p)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data+=s.data,s.is_float()&&t.make_float()),i()},t.prototype.eval_subtract=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data-=s.data,s.is_float()&&t.make_float()),i()},t.prototype.eval_multiply=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data*=s.data,s.is_float()&&t.make_float()),i()},t.prototype.eval_divide=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data/=s.data,t.make_float()),i()},t.prototype.eval_mod=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data%=s.data,s.is_float()&&t.make_float()),i()},t.prototype.eval_power=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data=Math.pow(t.data,s.data),s.is_float()&&t.make_float()),i()},t.prototype.eval_and=function(t){this.first.get(t);var s=e();this.second.get(s),s.is_string()||t.is_string()?this.eval_and_stringconcat(t,s):this.eval_and_logical(t,s),i()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var s=e();this.second.get(s),t.is_number()&&s.is_number()&&(t.data||s.data?t.set_int(1):t.set_int(0)),i()},t.prototype.eval_conditional=function(t){this.first.get(t),t.data?this.second.get(t):this.third.get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var s=e();this.second.get(s),t.set_int(t.data===s.data?1:0),i()},t.prototype.eval_notequal=function(t){this.first.get(t);var s=e();this.second.get(s),t.set_int(t.data!==s.data?1:0),i()},t.prototype.eval_less=function(t){this.first.get(t);var s=e();this.second.get(s),t.set_int(t.data<s.data?1:0),i()},t.prototype.eval_lessequal=function(t){this.first.get(t);var s=e();this.second.get(s),t.set_int(t.data<=s.data?1:0),i()},t.prototype.eval_greater=function(t){this.first.get(t);var s=e();this.second.get(s),t.set_int(t.data>s.data?1:0),i()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var s=e();this.second.get(s),t.set_int(t.data>=s.data?1:0),i()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();cr.is_number(e)?t.set_float(e):t.set_string(e)},cr.expNode=t,n.prototype.is_int=function(){return this.type===cr.exptype.Integer},n.prototype.is_float=function(){return this.type===cr.exptype.Float},n.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},n.prototype.is_string=function(){return this.type===cr.exptype.String},n.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},n.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},n.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},n.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},n.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},n.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},n.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=n,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var t,e,i,s,n,r,o,a,h={};h.waits=[];var c,l=h.waits;for(t=0,e=this.waits.length;t<e;t++){for(r=this.waits[t],c={t:r.time,st:r.signaltag,s:r.signalled,ev:r.ev.sid,sm:[],sols:{}},r.ev.actions[r.actindex]&&(c.act=r.ev.actions[r.actindex].sid),i=0,s=r.solModifiers.length;i<s;i++)c.sm.push(r.solModifiers[i].sid);for(n in r.sols)if(r.sols.hasOwnProperty(n)){for(o=this.runtime.types_by_index[parseInt(n,10)],a={sa:r.sols[n].sa,insts:[]},i=0,s=r.sols[n].insts.length;i<s;i++)a.insts.push(r.sols[n].insts[i].uid);c.sols[o.sid.toString()]=a}l.push(c)}return h},cr.system_object.prototype.loadFromJSON=function(t){var e,i,s,n,r,o,a,h,c,l,u,p,d,f=t.waits;for(cr.clearArray(this.waits),e=0,i=f.length;e<i;e++)if(o=f[e],h=this.runtime.blocksBySid[o.ev.toString()],h){for(c=-1,s=0,n=h.actions.length;s<n;s++)if(h.actions[s].sid===o.act){c=s;break}if(-1!==c){for(a={},a.sols={},a.solModifiers=[],a.deleteme=!1,a.time=o.t,a.signaltag=o.st||"",a.signalled=!!o.s,a.ev=h,a.actindex=c,s=0,n=o.sm.length;s<n;s++)l=this.runtime.getObjectTypeBySid(o.sm[s]),l&&a.solModifiers.push(l);for(r in o.sols)if(o.sols.hasOwnProperty(r)){if(l=this.runtime.getObjectTypeBySid(parseInt(r,10)),!l)continue;for(u=o.sols[r],p={sa:u.sa,insts:[]},s=0,n=u.insts.length;s<n;s++)d=this.runtime.getObjectByUID(u.insts[s]),d&&p.insts.push(d);a.sols[l.index.toString()]=p}this.waits.push(a)}}},function(){function t(){}function e(t,e){var i=t.extra.c2_feo_val,s=e.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(s)?i-s:(i=""+i,s=""+s,i<s?-1:i>s?1:0)}function i(t,e){return g&&t===y&&e===m||(g=new RegExp(t,e),y=t,m=e),g.lastIndex=0,g}function s(){}function n(){var t;return v.length?t=v.pop():(t={},t.sols={},t.solModifiers=[]),t.deleteme=!1,t}function r(t){cr.wipe(t.sols),cr.clearArray(t.solModifiers),v.push(t)}function o(){var t;return b.length?t=b.pop():(t={},t.insts=[]),t.sa=!1,t}function a(t){cr.clearArray(t.insts),b.push(t)}function h(t,e){var i=t[0],s=e[0],n=i-s;if(0!==n)return n;var r=t[1],o=e[1];return r-o}function c(t,e){return t[1]-e[1]}function l(){}function u(t,e,s){if(t!==w||e!==S||s!==T){var n=i(e,s);x=t.match(n),w=t,S=e,T=s}}var p=cr.system_object.prototype;t.prototype.EveryTick=function(){return!0},t.prototype.OnLayoutStart=function(){return!0},t.prototype.OnLayoutEnd=function(){return!0},t.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},t.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0===t){var s=this.runtime.getCurrentCondition();return!s.extra.CompareTime_executed&&i>=e&&(s.extra.CompareTime_executed=!0,!0)}return cr.do_cmp(i,t,e)},t.prototype.LayerVisible=function(t){return!!t&&t.visible},t.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},t.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},t.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),s=i.current_event,n=i.isModifierAfterCnds(),r=this.runtime.pushLoopStack();if(n)for(e=0;e<t&&!r.stopped;e++)this.runtime.pushCopySol(s.solModifiers),r.index=e,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(e=0;e<t&&!r.stopped;e++)r.index=e,s.retrigger();return this.runtime.popLoopStack(),!1},t.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),s=i.current_event,n=i.isModifierAfterCnds(),r=this.runtime.pushLoopStack();if(n)for(e=0;!r.stopped;e++)this.runtime.pushCopySol(s.solModifiers),r.index=e,s.retrigger()||(r.stopped=!0),this.runtime.popSol(s.solModifiers);else for(e=0;!r.stopped;e++)r.index=e,s.retrigger()||(r.stopped=!0);return this.runtime.popLoopStack(),!1},t.prototype.For=function(t,e,i){var s,n=this.runtime.getCurrentEventStack(),r=n.current_event,o=n.isModifierAfterCnds(),a=this.runtime.pushLoopStack(t);if(i<e)if(o)for(s=e;s>=i&&!a.stopped;--s)this.runtime.pushCopySol(r.solModifiers),a.index=s,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(s=e;s>=i&&!a.stopped;--s)a.index=s,r.retrigger();else if(o)for(s=e;s<=i&&!a.stopped;++s)this.runtime.pushCopySol(r.solModifiers),a.index=s,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(s=e;s<=i&&!a.stopped;++s)a.index=s,r.retrigger();return this.runtime.popLoopStack(),!1};var d=[],f=-1;t.prototype.ForEach=function(t){var e=t.getCurrentSol();f++,d.length===f&&d.push([]);var i=d[f];cr.shallowAssignArray(i,e.getObjects());var s,n,r,o,a,h,c,l=this.runtime.getCurrentEventStack(),u=l.current_event,p=l.isModifierAfterCnds(),g=this.runtime.pushLoopStack(),y=t.is_contained;if(p)for(s=0,n=i.length;s<n&&!g.stopped;s++){if(this.runtime.pushCopySol(u.solModifiers),a=i[s],e=t.getCurrentSol(),e.select_all=!1,cr.clearArray(e.instances),e.instances[0]=a,y)for(r=0,o=a.siblings.length;r<o;r++)h=a.siblings[r],c=h.type.getCurrentSol(),c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;g.index=s,u.retrigger(),this.runtime.popSol(u.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),s=0,n=i.length;s<n&&!g.stopped;s++){if(a=i[s],e.instances[0]=a,y)for(r=0,o=a.siblings.length;r<o;r++)h=a.siblings[r],c=h.type.getCurrentSol(),c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;g.index=s,u.retrigger()}return cr.clearArray(i),this.runtime.popLoopStack(),f--,!1},t.prototype.ForEachOrdered=function(t,i,s){var n=t.getCurrentSol();f++,d.length===f&&d.push([]);var r=d[f];cr.shallowAssignArray(r,n.getObjects());var o,a,h,c,l,u,p,g=this.runtime.getCurrentEventStack(),y=g.current_event,m=this.runtime.getCurrentCondition(),_=g.isModifierAfterCnds(),v=this.runtime.pushLoopStack();for(o=0,a=r.length;o<a;o++)r[o].extra.c2_feo_val=m.parameters[1].get(o);r.sort(e),1===s&&r.reverse();var b=t.is_contained;if(_)for(o=0,a=r.length;o<a&&!v.stopped;o++){if(this.runtime.pushCopySol(y.solModifiers),l=r[o],n=t.getCurrentSol(),n.select_all=!1,cr.clearArray(n.instances),n.instances[0]=l,b)for(h=0,c=l.siblings.length;h<c;h++)u=l.siblings[h],p=u.type.getCurrentSol(),p.select_all=!1,cr.clearArray(p.instances),p.instances[0]=u;v.index=o,y.retrigger(),this.runtime.popSol(y.solModifiers)}else for(n.select_all=!1,cr.clearArray(n.instances),o=0,a=r.length;o<a&&!v.stopped;o++){if(l=r[o],n.instances[0]=l,b)for(h=0,c=l.siblings.length;h<c;h++)u=l.siblings[h],p=u.type.getCurrentSol(),p.select_all=!1,cr.clearArray(p.instances),p.instances[0]=u;v.index=o,y.retrigger()}return cr.clearArray(r),this.runtime.popLoopStack(),f--,!1},t.prototype.PickByComparison=function(t,e,i,s){var n,r,o,a;if(t){f++,d.length===f&&d.push([]);var h=d[f],c=t.getCurrentSol();cr.shallowAssignArray(h,c.getObjects()),c.select_all&&cr.clearArray(c.else_instances);var l=this.runtime.getCurrentCondition();for(n=0,o=0,r=h.length;n<r;n++)a=h[n],h[o]=a,e=l.parameters[1].get(n),s=l.parameters[3].get(n),cr.do_cmp(e,i,s)?o++:c.else_instances.push(a);return cr.truncateArray(h,o),c.select_all=!1,cr.shallowAssignArray(c.instances,h),cr.clearArray(h),f--,t.applySolToContainer(),!!c.instances.length}},t.prototype.PickByEvaluate=function(t,e){var i,s,n,r;if(t){f++,d.length===f&&d.push([]);var o=d[f],a=t.getCurrentSol();cr.shallowAssignArray(o,a.getObjects()),a.select_all&&cr.clearArray(a.else_instances);var h=this.runtime.getCurrentCondition();for(i=0,n=0,s=o.length;i<s;i++)r=o[i],o[n]=r,e=h.parameters[1].get(i),e?n++:a.else_instances.push(r);return cr.truncateArray(o,n),a.select_all=!1,cr.shallowAssignArray(a.instances,o),cr.clearArray(o),f--,t.applySolToContainer(),!!a.instances.length}},t.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},t.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,s=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var n=e.extra.Every_seconds;return s>=i+n?(e.extra.Every_lastTime=i+n,s>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=s),e.extra.Every_seconds=t,!0):(s<i-.1&&(e.extra.Every_lastTime=s),!1)},t.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),s=i.getObjects();if(e=cr.floor(e),e<0||e>=s.length)return!1;var n=s[e];return i.pick_one(n),t.applySolToContainer(),!0},t.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),s=cr.floor(Math.random()*i.length);if(s>=i.length)return!1;var n=i[s];return e.pick_one(n),t.applySolToContainer(),!0},t.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},t.prototype.IsGroupActive=function(t){var e=this.runtime.groups_by_name[t.toLowerCase()];return e&&e.group_active},t.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},t.prototype.PickAll=function(t){if(!t)return!1;if(!t.instances.length)return!1;var e=t.getCurrentSol();return e.select_all=!0,t.applySolToContainer(),!0},t.prototype.IsMobile=function(){return this.runtime.isMobile},t.prototype.CompareBetween=function(t,e,i){return t>=e&&t<=i},t.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},t.prototype.OnLoadFinished=function(){return!0},t.prototype.OnCanvasSnapshot=function(){return!0},t.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},t.prototype.OnSaveComplete=function(){return!0},t.prototype.OnSaveFailed=function(){return!0},t.prototype.OnLoadComplete=function(){return!0},t.prototype.OnLoadFailed=function(){return!0},t.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},t.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isDomFree||e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return e.isCocoonJs;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var g=null,y="",m="";t.prototype.RegexTest=function(t,e,s){var n=i(e,s);return n.test(t)};var _=[];t.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var s,n,r,o,a=t.getCurrentSol(),h=a.getObjects(),c=this.runtime.getCurrentEventStack().current_event,l=c.orblock,u=this.runtime.getCurrentCondition();for(a.select_all?(cr.shallowAssignArray(_,h),cr.clearArray(a.else_instances),a.select_all=!1,cr.clearArray(a.instances)):l?(cr.shallowAssignArray(_,a.else_instances),cr.clearArray(a.else_instances)):(cr.shallowAssignArray(_,h),cr.clearArray(a.instances)),s=0,n=_.length;s<n;++s)r=_[s],r.update_bbox(),o=cr.xor(r.contains_pt(e,i),u.inverted),o?a.instances.push(r):a.else_instances.push(r);return t.applySolToContainer(),cr.xor(!!a.instances.length,u.inverted)},t.prototype.IsNaN=function(t){return!!isNaN(t)},t.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},t.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},t.prototype.IsBetweenAngles=function(t,e,i){var s=cr.to_clamped_radians(t),n=cr.to_clamped_radians(e),r=cr.to_clamped_radians(i),o=!cr.angleClockwise(r,n);return o?!(!cr.angleClockwise(s,n)&&cr.angleClockwise(s,r)):cr.angleClockwise(s,n)&&!cr.angleClockwise(s,r)},t.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},p.cnds=new t,s.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},s.prototype.NextPrevLayout=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout){var e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if((!t||0!==e)&&(t||e!==this.runtime.layouts_by_index.length-1)){var i=this.runtime.layouts_by_index[e+(t?-1:1)];this.runtime.changelayout=i}}},s.prototype.CreateObject=function(t,e,i,s){if(e&&t){var n=this.runtime.createInstance(t,e,i,s);if(n){var r,o,a;if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,n),n.is_contained)for(r=0,o=n.siblings.length;r<o;r++)a=n.siblings[r],this.runtime.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnCreated,a);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),h.instances[0]=n,n.is_contained)for(r=0,o=n.siblings.length;r<o;r++)a=n.siblings[r],h=a.type.getCurrentSol(),h.select_all=!1,cr.clearArray(h.instances),h.instances[0]=a}}},s.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},s.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},s.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},s.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},s.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},s.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},s.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},s.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},s.prototype.ScrollToObject=function(t){var e=t.getFirstPicked();e&&(this.runtime.running_layout.scrollToX(e.x),this.runtime.running_layout.scrollToY(e.y))},s.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},s.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},s.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},s.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},s.prototype.SetTimescale=function(t){var e=t;e<0&&(e=0),this.runtime.timescale=e},s.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t){var s,n,r=t.getCurrentSol(),o=r.getObjects();for(s=0,n=o.length;s<n;s++)o[s].my_timescale=i}},s.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;var e,i,s=t.getCurrentSol(),n=s.getObjects();for(e=0,i=n.length;e<i;e++)n[e].my_timescale=-1};var v=[],b=[];s.prototype.Wait=function(t){if(!(t<0)){
var e,i,s,r,a,h=this.runtime.getCurrentEventStack(),c=n();for(c.time=this.runtime.kahanTime.sum+t,c.signaltag="",c.signalled=!1,c.ev=h.current_event,c.actindex=h.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)r=this.runtime.types_by_index[e],s=r.getCurrentSol(),s.select_all&&-1===h.current_event.solModifiers.indexOf(r)||(c.solModifiers.push(r),a=o(),a.sa=s.select_all,cr.shallowAssignArray(a.insts,s.instances),c.sols[e.toString()]=a);return this.waits.push(c),!0}},s.prototype.WaitForSignal=function(t){var e,i,s,r,a,h=this.runtime.getCurrentEventStack(),c=n();for(c.time=-1,c.signaltag=t.toLowerCase(),c.signalled=!1,c.ev=h.current_event,c.actindex=h.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)r=this.runtime.types_by_index[e],s=r.getCurrentSol(),s.select_all&&-1===h.current_event.solModifiers.indexOf(r)||(c.solModifiers.push(r),a=o(),a.sa=s.select_all,cr.shallowAssignArray(a.insts,s.instances),c.sols[e.toString()]=a);return this.waits.push(c),!0},s.prototype.Signal=function(t){var e,i,s,n=t.toLowerCase();for(e=0,i=this.waits.length;e<i;++e)s=this.waits[e],-1===s.time&&s.signaltag===n&&(s.signalled=!0)},s.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},s.prototype.ResetGlobals=function(){var t,e,i;for(t=0,e=this.runtime.all_global_vars.length;t<e;t++)i=this.runtime.all_global_vars[t],i.data=i.initial},s.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},s.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},s.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY){var s,n,r=t.instances;for(s=0,n=r.length;s<n;++s)r[s].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},s.prototype.SetLayerBackground=function(t,e){if(t){var i=cr.GetRValue(e),s=cr.GetGValue(e),n=cr.GetBValue(e);t.background_color[0]===i&&t.background_color[1]===s&&t.background_color[2]===n||(t.background_color[0]=i,t.background_color[1]=s,t.background_color[2]=n,this.runtime.redraw=!0)}},s.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},s.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},s.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},s.prototype.GoToLayoutByName=function(t){var e;if(!this.runtime.isloading&&!this.runtime.changelayout)for(e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},s.prototype.RestartLayout=function(t){var e,i,s;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)s=this.runtime.allGroups[e],s.setGroupActive(s.initially_activated)},s.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},s.prototype.SetCanvasSize=function(t,e){if(!(t<=0||e<=0)){var i=this.runtime.fullscreen_mode,s=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen;s&&this.runtime.fullscreen_scaling>0&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},s.prototype.SetLayoutEffectEnabled=function(t,e){if(this.runtime.running_layout&&this.runtime.glwrap){var i=this.runtime.running_layout.getEffectByName(e);if(i){var s=1===t;i.active!=s&&(i.active=s,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},s.prototype.SetLayerEffectEnabled=function(t,e,i){if(t&&this.runtime.glwrap){var s=t.getEffectByName(i);if(s){var n=1===e;s.active!=n&&(s.active=n,t.updateActiveEffects(),this.runtime.redraw=!0)}}},s.prototype.SetLayoutEffectParam=function(t,e,i){if(this.runtime.running_layout&&this.runtime.glwrap){var s=this.runtime.running_layout.getEffectByName(t);if(s){var n=this.runtime.running_layout.effect_params[s.index];e=Math.floor(e),e<0||e>=n.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,e)&&(i/=100),n[e]!==i&&(n[e]=i,s.active&&(this.runtime.redraw=!0)))}}},s.prototype.SetLayerEffectParam=function(t,e,i,s){if(t&&this.runtime.glwrap){var n=t.getEffectByName(e);if(n){var r=t.effect_params[n.index];i=Math.floor(i),i<0||i>=r.length||(1===this.runtime.glwrap.getProgramParameterType(n.shaderindex,i)&&(s/=100),r[i]!==s&&(r[i]=s,n.active&&(this.runtime.redraw=!0)))}}},s.prototype.SaveState=function(t){this.runtime.saveToSlot=t},s.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},s.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},s.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},s.prototype.SetFullscreenQuality=function(t){var e=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen;(e||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},s.prototype.ResetPersisted=function(){var t,e;for(t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},s.prototype.RecreateInitialObjects=function(t,e,i,s,n){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,s,n)},s.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},s.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),t>120&&(t=120),this.runtime.minimumFramerate=t},s.prototype.SortZOrderByInstVar=function(t,e){if(t){var i,s,n,r,o,a,l=t.getCurrentSol(),u=l.getObjects(),p=[],d=[],f=this.runtime.running_layout,g=t.is_family,y=t.family_index;for(i=0,s=u.length;i<s;++i)n=u[i],n.layer&&(r=g?n.instance_vars[e+n.type.family_var_map[y]]:n.instance_vars[e],p.push([n.layer.index,n.get_zindex()]),d.push([n,r]));if(p.length)for(p.sort(h),d.sort(c),i=0,s=p.length;i<s;++i)n=d[i][0],o=f.layers[p[i][0]],a=p[i][1],o.instances[a]!==n&&(o.instances[a]=n,n.layer=o,o.setZIndicesStaleFrom(a))}},p.acts=new s,l.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},l.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},l.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},l.prototype.len=function(t,e){t.set_int(e.length||0)},l.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},l.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},l.prototype.abs=function(t,e){t.set_float(Math.abs(e))},l.prototype.round=function(t,e){t.set_int(Math.round(e))},l.prototype.floor=function(t,e){t.set_int(Math.floor(e))},l.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},l.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},l.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},l.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},l.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},l.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},l.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},l.prototype.exp=function(t,e){t.set_float(Math.exp(e))},l.prototype.ln=function(t,e){t.set_float(Math.log(e))},l.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},l.prototype.max=function(t){var e,i,s,n=arguments[1];for("number"!=typeof n&&(n=0),e=2,i=arguments.length;e<i;e++)s=arguments[e],"number"==typeof s&&n<s&&(n=s);t.set_float(n)},l.prototype.min=function(t){var e,i,s,n=arguments[1];for("number"!=typeof n&&(n=0),e=2,i=arguments.length;e<i;e++)s=arguments[e],"number"==typeof s&&n>s&&(n=s);t.set_float(n)},l.prototype.dt=function(t){t.set_float(this.runtime.dt)},l.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},l.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},l.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},l.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},l.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},l.prototype.fps=function(t){t.set_int(this.runtime.fps)},l.prototype.loopindex=function(t,e){var i,s;if(this.runtime.loop_stack.length)if(e){for(s=this.runtime.loop_stack_index;s>=0;--s)if(i=this.runtime.loop_stack[s],i.name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},l.prototype.distance=function(t,e,i,s,n){t.set_float(cr.distanceTo(e,i,s,n))},l.prototype.angle=function(t,e,i,s,n){t.set_float(cr.to_degrees(cr.angleTo(e,i,s,n)))},l.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},l.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},l.prototype.newline=function(t){t.set_string("\n")},l.prototype.lerp=function(t,e,i,s){t.set_float(cr.lerp(e,i,s))},l.prototype.qarp=function(t,e,i,s,n){t.set_float(cr.qarp(e,i,s,n))},l.prototype.cubic=function(t,e,i,s,n,r){t.set_float(cr.cubic(e,i,s,n,r))},l.prototype.cosp=function(t,e,i,s){t.set_float(cr.cosp(e,i,s))},l.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},l.prototype.windowheight=function(t){t.set_int(this.runtime.height)},l.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},l.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},l.prototype.clamp=function(t,e,i,s){e<i?t.set_float(i):e>s?t.set_float(s):t.set_float(e)},l.prototype.layerscale=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.scale):t.set_float(0)},l.prototype.layeropacity=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.opacity):t.set_float(0)},l.prototype.layerscalerate=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.zoomRate):t.set_float(0)},l.prototype.layerparallaxx=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxX):t.set_float(0)},l.prototype.layerparallaxy=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxY):t.set_float(0)},l.prototype.layerindex=function(t,e){var i=this.runtime.getLayer(e);i?t.set_int(i.index):t.set_int(-1)},l.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},l.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},l.prototype.layerangle=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(cr.to_degrees(i.angle)):t.set_float(0)},l.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},l.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},l.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},l.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},l.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},l.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},l.prototype.mid=function(t,e,i,s){t.set_string(cr.is_string(e)?e.substr(i,s):"")},l.prototype.tokenat=function(t,e,i,s){if(cr.is_string(e)&&cr.is_string(s)){var n=e.split(s),r=cr.floor(i);r<0||r>=n.length?t.set_string(""):t.set_string(n[r])}else t.set_string("")},l.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},l.prototype.replace=function(t,e,i,s){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(s)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),s)):t.set_string(cr.is_string(e)?e:"")},l.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},l.prototype.pi=function(t){t.set_float(cr.PI)},l.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},l.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},l.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},l.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},l.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},l.prototype.rgb=function(t,e,i,s){t.set_int(cr.RGB(e,i,s))},l.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},l.prototype.projectname=function(t){t.set_string(this.runtime.projectName)},l.prototype.anglelerp=function(t,e,i,s){e=cr.to_radians(e),i=cr.to_radians(i);var n=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+n*s)):t.set_float(cr.to_clamped_degrees(e-n*s))},l.prototype.anglerotate=function(t,e,i,s){e=cr.to_radians(e),i=cr.to_radians(i),s=cr.to_radians(s),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,s)))},l.prototype.zeropad=function(t,e,i){var s=e<0?"-":"";e<0&&(e=-e);for(var n=i-e.toString().length,r=0;r<n;r++)s+="0";t.set_string(s+e.toString())},l.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},l.prototype.viewportleft=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewLeft:0)},l.prototype.viewporttop=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewTop:0)},l.prototype.viewportright=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewRight:0)},l.prototype.viewportbottom=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewBottom:0)},l.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},l.prototype.unlerp=function(t,e,i,s){t.set_float(cr.unlerp(e,i,s))},l.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},l.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},l.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},l.prototype.canvastolayerx=function(t,e,i,s){var n=this.runtime.getLayer(e);t.set_float(n?n.canvasToLayer(i,s,!0):0)},l.prototype.canvastolayery=function(t,e,i,s){var n=this.runtime.getLayer(e);t.set_float(n?n.canvasToLayer(i,s,!1):0)},l.prototype.layertocanvasx=function(t,e,i,s){var n=this.runtime.getLayer(e);t.set_float(n?n.layerToCanvas(i,s,!0):0)},l.prototype.layertocanvasy=function(t,e,i,s){var n=this.runtime.getLayer(e);t.set_float(n?n.layerToCanvas(i,s,!1):0)},l.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},l.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},l.prototype.regexsearch=function(t,e,s,n){var r=i(s,n);t.set_int(e?e.search(r):-1)},l.prototype.regexreplace=function(t,e,s,n,r){var o=i(s,n);t.set_string(e?e.replace(o,r):"")};var x=[],w="",S="",T="";l.prototype.regexmatchcount=function(t,e,s,n){i(s,n);u(e,s,n),t.set_int(x?x.length:0)},l.prototype.regexmatchat=function(t,e,s,n,r){r=Math.floor(r);i(s,n);u(e,s,n),!x||r<0||r>=x.length?t.set_string(""):t.set_string(x[r])},l.prototype.infinity=function(t){t.set_float(1/0)},l.prototype.setbit=function(t,e,i,s){e|=0,i|=0,s=0!==s?1:0,t.set_int(e&~(1<<i)|s<<i)},l.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},l.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},l.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},l.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},p.exps=new l,p.runWaits=function(){var t,e,i,s,n,o,h,c=this.runtime.getCurrentEventStack();for(t=0,i=this.waits.length;t<i;t++){if(s=this.waits[t],-1===s.time){if(!s.signalled)continue}else if(s.time>this.runtime.kahanTime.sum)continue;for(n in c.current_event=s.ev,c.actindex=s.actindex,c.cndindex=0,s.sols)s.sols.hasOwnProperty(n)&&(o=this.runtime.types_by_index[parseInt(n,10)].getCurrentSol(),h=s.sols[n],o.select_all=h.sa,cr.shallowAssignArray(o.instances,h.insts),a(h));s.ev.resume_actions_and_subevents(),this.runtime.clearSol(s.solModifiers),s.deleteme=!0}for(t=0,e=0,i=this.waits.length;t<i;t++)s=this.waits[t],this.waits[e]=s,s.deleteme?r(s):e++;cr.truncateArray(this.waits,e)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],s=t[3],n=t[4],r=t[5],o=t[6],a=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var c=e.cnds,l=e.acts,u=e.exps;s&&(c.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},c.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},c.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},c.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},c.PickDistance=function(t,e,i){var s=this.getCurrentSol(),n=s.getObjects();if(!n.length)return!1;var r,o,a,h=n[0],c=h,l=cr.distanceTo(h.x,h.y,e,i);for(r=1,o=n.length;r<o;r++)h=n[r],a=cr.distanceTo(h.x,h.y,e,i),(0===t&&a<l||1===t&&a>l)&&(l=a,c=h);return s.pick_one(c),!0},l.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},l.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},l.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},l.SetPosToObject=function(t,e){var i,s,n=t.getPairedInstance(this);n&&(n.getImagePoint?(i=n.getImagePoint(e,!0),s=n.getImagePoint(e,!1)):(i=n.x,s=n.y),this.x===i&&this.y===s||(this.x=i,this.y=s,this.set_bbox_changed()))},l.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},l.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},u.X=function(t){t.set_float(this.x)},u.Y=function(t){t.set_float(this.y)},u.dt=function(t){t.set_float(this.runtime.getDt(this))}),n&&(c.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},c.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},l.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},l.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},l.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},u.Width=function(t){t.set_float(this.width)},u.Height=function(t){t.set_float(this.height)},u.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},u.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},u.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},u.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),r&&(c.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},c.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},c.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),s=cr.to_clamped_radians(e),n=cr.clamp_angle(this.angle),r=!cr.angleClockwise(s,i);return r?!(!cr.angleClockwise(n,i)&&cr.angleClockwise(n,s)):cr.angleClockwise(n,i)&&!cr.angleClockwise(n,s)},l.SetAngle=function(t){var e=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(e)||this.angle!==e&&(this.angle=e,this.set_bbox_changed())},l.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateTowardAngle=function(t,e){var i=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},l.RotateTowardPosition=function(t,e,i){var s=e-this.x,n=i-this.y,r=Math.atan2(n,s),o=cr.angleRotate(this.angle,r,cr.to_radians(t));isNaN(o)||this.angle!==o&&(this.angle=o,this.set_bbox_changed())},l.SetTowardPosition=function(t,e){var i=t-this.x,s=e-this.y,n=Math.atan2(s,i);isNaN(n)||this.angle!==n&&(this.angle=n,this.set_bbox_changed())},u.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(c.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},c.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},c.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),s=i.getObjects();if(!s.length)return!1;var n,r,o,a=s[0],h=a,c=a.instance_vars[e];for(n=1,r=s.length;n<r;n++)a=s[n],o=a.instance_vars[e],(0===t&&o<c||1===t&&o>c)&&(c=o,h=a);return i.pick_one(h),!0},c.PickByUID=function(t){var e,i,s,n,r,o,a,h=this.runtime.getCurrentCondition();if(h.inverted){if(a=this.getCurrentSol(),a.select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),o=this.instances,e=0,i=o.length;e<i;e++)n=o[e],n.uid===t?a.else_instances.push(n):a.instances.push(n);return this.applySolToContainer(),!!a.instances.length}for(e=0,s=0,i=a.instances.length;e<i;e++)n=a.instances[e],a.instances[s]=n,n.uid===t?a.else_instances.push(n):s++;return cr.truncateArray(a.instances,s),this.applySolToContainer(),!!a.instances.length}if(n=this.runtime.getObjectByUID(t),!n)return!1;if(a=this.getCurrentSol(),!a.select_all&&-1===a.instances.indexOf(n))return!1;if(this.is_family){for(r=n.type.families,e=0,i=r.length;e<i;e++)if(r[e]===this)return a.pick_one(n),this.applySolToContainer(),!0}else if(n.type===this)return a.pick_one(n),this.applySolToContainer(),!0;return!1},c.OnCreated=function(){return!0},c.OnDestroyed=function(){return!0},l.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},l.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},l.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},l.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},l.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},l.Destroy=function(){this.runtime.DestroyInstance(this)},l.LoadFromJsonString||(l.LoadFromJsonString=function(t){var e,i,s,n;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,s=this.behavior_insts.length;i<s;++i)n=this.behavior_insts[i],n.afterLoad&&n.afterLoad()}),u.Count=function(t){var e,i,s,n=t.object_class.instances.length;for(e=0,i=this.runtime.createRow.length;e<i;e++)s=this.runtime.createRow[e],t.object_class.is_family?s.type.families.indexOf(t.object_class)>=0&&n++:s.type===t.object_class&&n++;t.set_int(n)},u.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},u.UID=function(t){t.set_int(this.uid)},u.IID=function(t){t.set_int(this.get_iid())},u.AsJSON||(u.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),o&&(c.IsVisible=function(){return this.visible},l.SetVisible=function(t){!t!=!this.visible&&(this.visible=!!t,this.runtime.redraw=!0)},c.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},l.SetOpacity=function(t){var e=t/100;e<0?e=0:e>1&&(e=1),e!==this.opacity&&(this.opacity=e,this.runtime.redraw=!0)},u.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(c.IsOnLayer=function(t){return!!t&&this.layer===t},c.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;var s,n,r=i[0],o=r;for(s=1,n=i.length;s<n;s++)r=i[s],0===t?(r.layer.index>o.layer.index||r.layer.index===o.layer.index&&r.get_zindex()>o.get_zindex())&&(o=r):(r.layer.index<o.layer.index||r.layer.index===o.layer.index&&r.get_zindex()<o.get_zindex())&&(o=r);return e.pick_one(o),!0},l.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=t,t.appendToInstanceList(this,!0),this.runtime.redraw=!0)},l.ZMoveToObject=function(t,e){var i=0===t;if(e){var s=e.getFirstPicked(this);s&&s.uid!==this.uid&&(this.layer.index!==s.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=s.layer,s.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,s,i),this.runtime.redraw=!0)}},u.LayerNumber=function(t){t.set_int(this.layer.number)},u.LayerName=function(t){t.set_string(this.layer.name)},u.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(l.SetEffectEnabled=function(t,e){if(this.runtime.glwrap){var i=this.type.getEffectIndexByName(e);if(!(i<0)){var s=1===t;this.active_effect_flags[i]!==s&&(this.active_effect_flags[i]=s,this.updateActiveEffects(),this.runtime.redraw=!0)}}},l.SetEffectParam=function(t,e,i){if(this.runtime.glwrap){var s=this.type.getEffectIndexByName(t);if(!(s<0)){var n=this.type.effect_types[s],r=this.effect_params[s];e=Math.floor(e),e<0||e>=r.length||(1===this.runtime.glwrap.getProgramParameterType(n.shaderindex,e)&&(i/=100),r[e]!==i&&(r[e]=i,n.active&&(this.runtime.redraw=!0)))}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var t,e,i=this.bbox_changed_callbacks;for(t=0,e=i.length;t<e;++t)i[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){if(this.bbox_changed){var t=this.bbox,e=this.bquad;t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var t=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var e=this.layer.render_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.rendercells.equals(t)||(this.rendercells.right<this.rendercells.left?e.update(this,null,t):e.update(this,this.rendercells,t),this.rendercells.copy(t),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var e=this.type.collision_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.collcells.equals(t)||(this.collcells.right<this.collcells.left?e.update(this,null,t):e.update(this,this.collcells,t),this.collcells.copy(t),this.cell_changed=!1)}},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t,e,i;cr.clearArray(this.active_effect_types);var s=!0;for(t=0,e=this.active_effect_flags.length;t<e;t++)this.active_effect_flags[t]&&(i=this.type.effect_types[t],this.active_effect_types.push(i),i.preservesOpaqueness||(s=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=s},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){var e,i,s;if(t&&t.is_contained&&t.type!=this)for(e=0,i=t.siblings.length;e<i;e++)if(s=t.siblings[e],s.type==this)return s;var n=this.getCurrentSol().getObjects();return n.length?n[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var t,e;for(t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,s=this.runtime.createRow;for(t=0,e=s.length;t<e;++t)s[t].type===this&&(s[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;var e,i,s=this.runtime.createRow;for(e=0,i=s.length;e<i;++e)if(s[e].type===this){if(0===t)return s[e];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?(t.select_all=!0,cr.clearArray(t.else_instances)):(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances),cr.shallowAssignArray(t.else_instances,e.else_instances))},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,s,n,r,o=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(r=this.families[e],s=0,n=r.behaviors.length;s<n;s++){if(t===r.behaviors[s].name)return this.extra.lastBehIndex=o,r.behaviors[s];o++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=o,this.behaviors[e];o++}return null},cr.type_getBehaviorIndexByName=function(t){var e=this.getBehaviorByName(t);return e?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){var e,i;for(e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,s,n,r,o;this.updateIIDs(),r=this.getCurrentSol();var a=r.select_all,h=this.runtime.getCurrentEventStack(),c=h&&h.current_event&&h.current_event.orblock;for(t=0,e=this.container.length;t<e;t++)if(n=this.container[t],n!==this&&(n.updateIIDs(),o=n.getCurrentSol(),o.select_all=a,!a)){for(cr.clearArray(o.instances),i=0,s=r.instances.length;i<s;++i)o.instances[i]=n.getInstanceByIID(r.instances[i].iid);if(c)for(cr.clearArray(o.else_instances),i=0,s=r.else_instances.length;i<s;++i)o.else_instances[i]=n.getInstanceByIID(r.else_instances[i].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return t>i;case 5:return t>=i;default:return!1}}}(),cr.shaders={},cr.plugins_.AJAX=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=!1,n=null,r=null,o="",a=cr.plugins_.AJAX.prototype;a.Type=function(t){this.plugin=t,this.runtime=t.runtime};var h=a.Type.prototype;h.onCreate=function(){},
a.Instance=function(t){if(this.type=t,this.runtime=t.runtime,this.lastData="",this.curTag="",this.progress=0,this.timeout=-1,s=this.runtime.isNWjs,s){n=require("path"),r=require("fs");var e=window.process||nw.process;o=n.dirname(e.execPath)+"\\"}};var c=a.Instance.prototype,l=null;window.C2_AJAX_DCSide=function(t,e,i){l&&("success"===t?(l.curTag=e,l.lastData=i,l.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,l),l.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,l)):"error"===t?(l.curTag=e,l.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,l),l.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,l)):"progress"===t&&(l.progress=i,l.curTag=e,l.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,l)))},c.onCreate=function(){l=this},c.saveToJSON=function(){return{lastData:this.lastData}},c.loadFromJSON=function(t){this.lastData=t.lastData,this.curTag="",this.progress=0};var u={},p="";c.doRequest=function(t,e,i,n){if(this.runtime.isDirectCanvas)AppMobi.webview.execute('C2_AJAX_WebSide("'+t+'", "'+e+'", "'+i+'", '+(n?'"'+n+'"':"null")+");");else{var a=this,h=null,c=function(){a.curTag=t,a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,a)},l=function(){if(s){var i=o+e;r.existsSync(i)?r.readFile(i,{encoding:"utf8"},function(e,i){e?c():(a.curTag=t,a.lastData=i.replace(/\r\n/g,"\n"),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,a))}):c()}else c()},d=function(e){e.lengthComputable&&(a.progress=e.loaded/e.total,a.curTag=t,a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,a))};try{h=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,h.onreadystatechange=function(){4===h.readyState&&(a.curTag=t,h.responseText?a.lastData=h.responseText.replace(/\r\n/g,"\n"):a.lastData="",h.status>=400?(a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,a)):s&&!a.lastData.length||!s&&0===h.status&&!a.lastData.length||(a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,a)))},this.runtime.isWindowsPhone8||(h.onerror=l,h.ontimeout=l,h.onabort=l,h.onprogress=d),h.open(i,e),this.runtime.isWindowsPhone8||this.timeout>=0&&void 0!==h.timeout&&(h.timeout=this.timeout);try{h.responseType="text"}catch(t){}if(n&&h.setRequestHeader&&!u.hasOwnProperty("Content-Type")&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.setRequestHeader){var f;for(f in u)if(u.hasOwnProperty(f))try{h.setRequestHeader(f,u[f])}catch(t){}u={}}if(p&&h.overrideMimeType){try{h.overrideMimeType(p)}catch(t){}p=""}n?h.send(n):h.send()}catch(t){l()}}},t.prototype.OnComplete=function(t){return cr.equals_nocase(t,this.curTag)},t.prototype.OnAnyComplete=function(t){return!0},t.prototype.OnError=function(t){return cr.equals_nocase(t,this.curTag)},t.prototype.OnAnyError=function(t){return!0},t.prototype.OnProgress=function(t){return cr.equals_nocase(t,this.curTag)},a.cnds=new t,e.prototype.Request=function(t,e){var i=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(e)?this.runtime.fetchLocalFileViaCordovaAsText(e,function(e){i.curTag=t,i.lastData=e.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(e){i.curTag=t,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(t,e,"GET")},e.prototype.RequestFile=function(t,e){var i=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(e,function(e){i.curTag=t,i.lastData=e.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(e){i.curTag=t,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(t,e,"GET")},e.prototype.Post=function(t,e,i,s){this.doRequest(t,e,s,i)},e.prototype.SetTimeout=function(t){this.timeout=1e3*t},e.prototype.SetHeader=function(t,e){u[t]=e},e.prototype.OverrideMIMEType=function(t){p=t},a.acts=new e,i.prototype.LastData=function(t){t.set_string(this.lastData)},i.prototype.Progress=function(t){t.set_float(this.progress)},i.prototype.Tag=function(t){t.set_string(this.curTag)},a.exps=new i}(),cr.plugins_.Arr=function(t){this.runtime=t},function(){function t(){return c.length?c.pop():[]}function e(t){var i,s;for(i=0,s=t.length;i<s;i++)Array.isArray(t[i])&&e(t[i]);cr.clearArray(t),c.push(t)}function i(){}function s(){}function n(t,e){if(cr.is_number(t)&&cr.is_number(e))return t-e;var i=""+t,s=""+e;return i<s?-1:i>s?1:0}function r(){}var o=cr.plugins_.Arr.prototype;o.Type=function(t){this.plugin=t,this.runtime=t.runtime};var a=o.Type.prototype;a.onCreate=function(){},o.Instance=function(t){this.type=t,this.runtime=t.runtime};var h=o.Instance.prototype,c=[];Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),h.onCreate=function(){this.cx=this.properties[0],this.cy=this.properties[1],this.cz=this.properties[2],this.recycled||(this.arr=t());var e,i,s,n=this.arr;for(n.length=this.cx,e=0;e<this.cx;e++)for(n[e]||(n[e]=t()),n[e].length=this.cy,i=0;i<this.cy;i++)for(n[e][i]||(n[e][i]=t()),n[e][i].length=this.cz,s=0;s<this.cz;s++)n[e][i][s]=0;this.forX=[],this.forY=[],this.forZ=[],this.forDepth=-1},h.onDestroy=function(){var t;for(t=0;t<this.cx;t++)e(this.arr[t]);cr.clearArray(this.arr)},h.at=function(t,e,i){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),isNaN(t)||t<0||t>this.cx-1?0:isNaN(e)||e<0||e>this.cy-1?0:isNaN(i)||i<0||i>this.cz-1?0:this.arr[t][e][i]},h.set=function(t,e,i,s){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),isNaN(t)||t<0||t>this.cx-1||isNaN(e)||e<0||e>this.cy-1||isNaN(i)||i<0||i>this.cz-1||(this.arr[t][e][i]=s)},h.getAsJSON=function(){return JSON.stringify({c2array:!0,size:[this.cx,this.cy,this.cz],data:this.arr})},h.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}},h.loadFromJSON=function(t){var e=t.size;this.cx=e[0],this.cy=e[1],this.cz=e[2],this.arr=t.data},h.setSize=function(e,i,s){if(e<0&&(e=0),i<0&&(i=0),s<0&&(s=0),this.cx!==e||this.cy!==i||this.cz!==s){var n,r,o;this.cx=e,this.cy=i,this.cz=s;var a=this.arr;for(a.length=e,n=0;n<this.cx;n++)for(cr.is_undefined(a[n])&&(a[n]=t()),a[n].length=i,r=0;r<this.cy;r++)for(cr.is_undefined(a[n][r])&&(a[n][r]=t()),a[n][r].length=s,o=0;o<this.cz;o++)cr.is_undefined(a[n][r][o])&&(a[n][r][o]=0)}},h.getForX=function(){return this.forDepth>=0&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0},h.getForY=function(){return this.forDepth>=0&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0},h.getForZ=function(){return this.forDepth>=0&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0},i.prototype.CompareX=function(t,e,i){return cr.do_cmp(this.at(t,0,0),e,i)},i.prototype.CompareXY=function(t,e,i,s){return cr.do_cmp(this.at(t,e,0),i,s)},i.prototype.CompareXYZ=function(t,e,i,s,n){return cr.do_cmp(this.at(t,e,i),s,n)},h.doForEachTrigger=function(t){this.runtime.pushCopySol(t.solModifiers),t.retrigger(),this.runtime.popSol(t.solModifiers)},i.prototype.ArrForEach=function(t){var e=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var i=this.forDepth;switch(i===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[i]=0,this.forY[i]=0,this.forZ[i]=0),t){case 0:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)for(this.forY[i]=0;this.forY[i]<this.cy;this.forY[i]++)for(this.forZ[i]=0;this.forZ[i]<this.cz;this.forZ[i]++)this.doForEachTrigger(e);break;case 1:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)for(this.forY[i]=0;this.forY[i]<this.cy;this.forY[i]++)this.doForEachTrigger(e);break;case 2:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)this.doForEachTrigger(e)}return this.forDepth--,!1},i.prototype.CompareCurrent=function(t,e){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),t,e)},i.prototype.Contains=function(t){var e,i,s;for(e=0;e<this.cx;e++)for(i=0;i<this.cy;i++)for(s=0;s<this.cz;s++)if(this.arr[e][i][s]===t)return!0;return!1},i.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz},i.prototype.CompareSize=function(t,e,i){var s=0;switch(t){case 0:s=this.cx;break;case 1:s=this.cy;break;case 2:s=this.cz}return cr.do_cmp(s,e,i)},o.cnds=new i,s.prototype.Clear=function(){var t,e,i;for(t=0;t<this.cx;t++)for(e=0;e<this.cy;e++)for(i=0;i<this.cz;i++)this.arr[t][e][i]=0},s.prototype.SetSize=function(t,e,i){this.setSize(t,e,i)},s.prototype.SetX=function(t,e){this.set(t,0,0,e)},s.prototype.SetXY=function(t,e,i){this.set(t,e,0,i)},s.prototype.SetXYZ=function(t,e,i,s){this.set(t,e,i,s)},s.prototype.Push=function(e,i,s){var n=0,r=0,o=0,a=this.arr;switch(s){case 0:for(0===e?(n=a.length,a.push(t())):(n=0,a.unshift(t())),a[n].length=this.cy;r<this.cy;r++)for(a[n][r]=t(),a[n][r].length=this.cz,o=0;o<this.cz;o++)a[n][r][o]=i;this.cx++;break;case 1:for(;n<this.cx;n++)for(0===e?(r=a[n].length,a[n].push(t())):(r=0,a[n].unshift(t())),a[n][r].length=this.cz,o=0;o<this.cz;o++)a[n][r][o]=i;this.cy++;break;case 2:for(;n<this.cx;n++)for(r=0;r<this.cy;r++)0===e?a[n][r].push(i):a[n][r].unshift(i);this.cz++}},s.prototype.Pop=function(t,i){var s=0,n=0,r=this.arr;switch(i){case 0:if(0===this.cx)break;e(0===t?r.pop():r.shift()),this.cx--;break;case 1:if(0===this.cy)break;for(;s<this.cx;s++)e(0===t?r[s].pop():r[s].shift());this.cy--;break;case 2:if(0===this.cz)break;for(;s<this.cx;s++)for(n=0;n<this.cy;n++)0===t?r[s][n].pop():r[s][n].shift();this.cz--}},s.prototype.Reverse=function(t){var e=0,i=0,s=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(t){case 0:s.reverse();break;case 1:for(;e<this.cx;e++)s[e].reverse();break;case 2:for(;e<this.cx;e++)for(i=0;i<this.cy;i++)s[e][i].reverse();this.cz--}},s.prototype.Sort=function(t){var e=0,i=0,s=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(t){case 0:s.sort(function(t,e){return n(t[0][0],e[0][0])});break;case 1:for(;e<this.cx;e++)s[e].sort(function(t,e){return n(t[0],e[0])});break;case 2:for(;e<this.cx;e++)for(i=0;i<this.cy;i++)s[e][i].sort(n)}},s.prototype.Delete=function(t,i){var s=0,n=0;t=Math.floor(t);var r=this.arr;if(!(t<0))switch(i){case 0:if(t>=this.cx)break;e(r[t]),r.splice(t,1),this.cx--;break;case 1:if(t>=this.cy)break;for(;s<this.cx;s++)e(r[s][t]),r[s].splice(t,1);this.cy--;break;case 2:if(t>=this.cz)break;for(;s<this.cx;s++)for(n=0;n<this.cy;n++)r[s][n].splice(t,1);this.cz--}},s.prototype.Insert=function(e,i,s){var n=0,r=0,o=0;i=Math.floor(i);var a=this.arr;if(!(i<0))switch(s){case 0:if(i>this.cx)return;for(n=i,a.splice(n,0,t()),a[n].length=this.cy;r<this.cy;r++)for(a[n][r]=t(),a[n][r].length=this.cz,o=0;o<this.cz;o++)a[n][r][o]=e;this.cx++;break;case 1:if(i>this.cy)return;for(;n<this.cx;n++)for(r=i,a[n].splice(r,0,t()),a[n][r].length=this.cz,o=0;o<this.cz;o++)a[n][r][o]=e;this.cy++;break;case 2:if(i>this.cz)return;for(;n<this.cx;n++)for(r=0;r<this.cy;r++)a[n][r].splice(i,0,e);this.cz++}},s.prototype.JSONLoad=function(t){var e;try{e=JSON.parse(t)}catch(t){return}if(e.c2array){var i=e.size;this.cx=i[0],this.cy=i[1],this.cz=i[2],this.arr=e.data}},s.prototype.JSONDownload=function(t){var e=document.createElement("a");if(void 0===e.download){var i="data:text/html,"+encodeURIComponent("<p><a download='"+t+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>');window.open(i)}else{var s=document.getElementsByTagName("body")[0];e.textContent=t,e.href="data:application/json,"+encodeURIComponent(this.getAsJSON()),e.download=t,s.appendChild(e);var n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n),s.removeChild(e)}},o.acts=new s,r.prototype.At=function(t,e,i,s){var n=i||0,r=s||0;t.set_any(this.at(e,n,r))},r.prototype.Width=function(t){t.set_int(this.cx)},r.prototype.Height=function(t){t.set_int(this.cy)},r.prototype.Depth=function(t){t.set_int(this.cz)},r.prototype.CurX=function(t){t.set_int(this.getForX())},r.prototype.CurY=function(t){t.set_int(this.getForY())},r.prototype.CurZ=function(t){t.set_int(this.getForZ())},r.prototype.CurValue=function(t){t.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))},r.prototype.Front=function(t){t.set_any(this.at(0,0,0))},r.prototype.Back=function(t){t.set_any(this.at(this.cx-1,0,0))},r.prototype.IndexOf=function(t,e){for(var i=0;i<this.cx;i++)if(this.arr[i][0][0]===e)return void t.set_int(i);t.set_int(-1)},r.prototype.LastIndexOf=function(t,e){for(var i=this.cx-1;i>=0;i--)if(this.arr[i][0][0]===e)return void t.set_int(i);t.set_int(-1)},r.prototype.AsJSON=function(t){t.set_string(this.getAsJSON())},o.exps=new r}(),window.audioFixAutoPlay=!0,cr.plugins_.Audio=function(t){this.runtime=t},function(){function t(t){var e=ft.indexOf(t);-1===e&&ft.push(t)}function e(e){var i,s=e.instanceObject;try{i=s.play()}catch(i){return void t(e)}i?i.catch(function(i){t(e)}):dt&&!V.isInUserInputEvent&&t(e)}function i(){var e,i,n,r;yt||rt||!Y||(s(),"running"===Y.state&&(yt=!0));var o=ft.slice(0);if(cr.clearArray(ft),!et)for(e=0,i=o.length;e<i;++e)n=o[e],n.stopped||n.is_paused||(r=n.instanceObject.play(),r&&r.catch(function(e){t(n)}))}function s(){if("suspended"===Y.state&&Y.resume&&Y.resume(),Y.createBuffer){var t=Y.createBuffer(1,220,22050),e=Y.createBufferSource();e.buffer=t,e.connect(Y.destination),u(e)}}function n(t){var e=o(t);return isFinite(e)||(e=0),e<0&&(e=0),e>1&&(e=1),e}function r(t){return t<0&&(t=0),t>1&&(t=1),a(t)}function o(t){return Math.pow(10,t/20)}function a(t){return Math.log(t)/Math.log(10)*20}function h(t){return t=t.toLowerCase(),mt.hasOwnProperty(t)&&mt[t].length?mt[t][0].getInputNode():Y.destination}function c(){return Y.createGain?Y.createGain():Y.createGainNode()}function l(t){return Y.createDelay?Y.createDelay(t):Y.createDelayNode(t)}function u(t,e){t.start?t.start(e||0):t.noteOn(e||0)}function p(t,e,i,s){t.start?t.start(s||0,e):t.noteGrainOn(s||0,e,i-e)}function d(t){try{t.stop?t.stop(0):t.noteOff(0)}catch(t){}}function f(t,e,i,s){if(t)if(t.cancelScheduledValues(0),0!==s){var n=Y.currentTime;switch(s+=n,i){case 0:t.setValueAtTime(e,s);break;case 1:t.setValueAtTime(t.value,n),t.linearRampToValueAtTime(e,s);break;case 2:t.setValueAtTime(t.value,n),t.exponentialRampToValueAtTime(e,s)}}else t.value=e}function g(t,e,i,s,n,r){this.type="filter",this.params=[t,e,i,s,n,r],this.inputNode=c(),this.wetNode=c(),this.wetNode.gain.value=r,this.dryNode=c(),this.dryNode.gain.value=1-r,this.filterNode=Y.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=t:this.filterNode.type=_t[t],this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=i),this.filterNode.Q.value=s,this.filterNode.gain.value=n,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function y(t,e,i){this.type="delay",this.params=[t,e,i],this.inputNode=c(),this.wetNode=c(),this.wetNode.gain.value=i,this.dryNode=c(),this.dryNode.gain.value=1-i,this.mainNode=c(),this.delayNode=l(t),this.delayNode.delayTime.value=t,this.delayGainNode=c(),this.delayGainNode.gain.value=e,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function m(t,e,i,s){this.type="convolve",this.params=[e,i,s],this.inputNode=c(),this.wetNode=c(),this.wetNode.gain.value=i,this.dryNode=c(),this.dryNode.gain.value=1-i,this.convolveNode=Y.createConvolver(),t&&(this.convolveNode.normalize=e,this.convolveNode.buffer=t),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function _(t,e,i,s,n){this.type="flanger",this.params=[t,e,i,s,n],this.inputNode=c(),this.dryNode=c(),this.dryNode.gain.value=1-n/2,this.wetNode=c(),this.wetNode.gain.value=n/2,this.feedbackNode=c(),this.feedbackNode.gain.value=s,this.delayNode=l(t+e),this.delayNode.delayTime.value=t,this.oscNode=Y.createOscillator(),this.oscNode.frequency.value=i,this.oscGainNode=c(),this.oscGainNode.gain.value=e,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),u(this.oscNode)}function v(t,e,i,s,n,r){this.type="phaser",this.params=[t,e,i,s,n,r],this.inputNode=c(),this.dryNode=c(),this.dryNode.gain.value=1-r/2,this.wetNode=c(),this.wetNode.gain.value=r/2,this.filterNode=Y.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=7:this.filterNode.type="allpass",this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=e),this.filterNode.Q.value=i,this.oscNode=Y.createOscillator(),this.oscNode.frequency.value=n,this.oscGainNode=c(),this.oscGainNode.gain.value=s,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),u(this.oscNode)}function b(t){this.type="gain",this.params=[t],this.node=c(),this.node.gain.value=t}function x(t,e){this.type="tremolo",this.params=[t,e],this.node=c(),this.node.gain.value=1-e/2,this.oscNode=Y.createOscillator(),this.oscNode.frequency.value=t,this.oscGainNode=c(),this.oscGainNode.gain.value=e/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),u(this.oscNode)}function w(t,e){this.type="ringmod",this.params=[t,e],this.inputNode=c(),this.wetNode=c(),this.wetNode.gain.value=e,this.dryNode=c(),this.dryNode.gain.value=1-e,this.ringNode=c(),this.ringNode.gain.value=0,this.oscNode=Y.createOscillator(),this.oscNode.frequency.value=t,this.oscNode.connect(this.ringNode.gain),u(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function S(t,e,i,s,n){this.type="distortion",this.params=[t,e,i,s,n],this.inputNode=c(),this.preGain=c(),this.postGain=c(),this.setDrive(i,o(s)),this.wetNode=c(),this.wetNode.gain.value=n,this.dryNode=c(),this.dryNode.gain.value=1-n,this.waveShaper=Y.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(t,e),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function T(t,e){return 1-Math.exp(-e*t)}function C(t,e,i,s,n){this.type="compressor",this.params=[t,e,i,s,n],this.node=Y.createDynamicsCompressor();try{this.node.threshold.value=t,this.node.knee.value=e,this.node.ratio.value=i,this.node.attack.value=s,this.node.release.value=n}catch(t){}}function O(t,e){this.type="analyser",this.params=[t,e],this.node=Y.createAnalyser(),this.node.fftSize=t,this.node.smoothingTimeConstant=e,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(t),this.peak=0,this.rms=0}function A(){this.obj=null,this.loadUid=0}function P(t,e){this.src=t,this.myapi=q,this.is_music=e,this.added_end_listener=!1;var i,s=this;switch(this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.wasEverReady=!1,q===J&&e&&!gt&&(this.myapi=z,this.outNode=c()),this.bufferObject=null,this.audioData=null,this.myapi){case z:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",function(){s.wasEverReady=!0}),q===J&&Y.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){!s.mediaSourceNode&&s.bufferObject&&(s.mediaSourceNode=Y.createMediaElementSource(s.bufferObject),s.mediaSourceNode.connect(s.outNode))})),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=t;break;case J:V.isWKWebView?V.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){s.audioData=t,s.decodeAudioBuffer()},function(t){s.failedToLoad=!0}):(i=new XMLHttpRequest,i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){s.audioData=i.response,s.decodeAudioBuffer()},i.onerror=function(){s.failedToLoad=!0},i.send());break;case H:case X:this.bufferObject=!0}}function k(t,e){var i=this;this.tag=e,this.fresh=!0,this.stopped=!0,this.src=t.src,this.buffer=t,this.myapi=q,this.is_music=t.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){if(!i.is_paused&&!i.resume_me){var e=this;e||(e=t.target),e===i.active_buffer&&(i.hasPlaybackEnded=!0,i.stopped=!0,G=i.tag,V.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,W))}},this.active_buffer=null,this.isTimescaled=1===tt&&!this.is_music||2===tt,this.mutevol=1,this.startTime=this.isTimescaled?V.kahanTime.sum:V.wallTime.sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var s=!1;switch(this.myapi!==J||this.buffer.myapi!==z||this.buffer.supportWebAudioAPI||(this.myapi=z),this.myapi){case z:this.is_music?(this.instanceObject=t.bufferObject,s=!t.added_end_listener,t.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=t.bufferObject.src,s=!0),s&&this.instanceObject.addEventListener("ended",function(){G=i.tag,i.stopped=!0,V.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,W)});break;case J:this.gainNode=c(),this.gainNode.connect(h(e)),this.buffer.myapi===J?t.bufferObject&&(this.instanceObject=Y.createBufferSource(),this.instanceObject.buffer=t.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){G=i.tag,i.stopped=!0,V.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,W)})));break;case H:this.instanceObject=new window.Media(U+this.src,null,null,function(t){t===window.Media.MEDIA_STOPPED&&(i.hasPlaybackEnded=!0,i.stopped=!0,G=i.tag,V.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,W))});break;case X:this.instanceObject=!0}}function E(t,e){var i=t.isPlaying()?1:0,s=e.isPlaying()?1:0;return i===s?0:i<s?1:-1}function I(t,e){if(cr.clearArray(wt),!t.length)return!Z||Z.hasEnded()?void 0:(cr.clearArray(wt),void(wt[0]=Z));var i,s,n;for(i=0,s=Q.length;i<s;i++)n=Q[i],cr.equals_nocase(t,n.tag)&&wt.push(n);e&&wt.sort(E)}function L(t){var e,i,s,n,r=Y.destination;if(mt.hasOwnProperty(t)&&(s=mt[t],s.length))for(r=s[0].getInputNode(),e=0,i=s.length;e<i;e++)n=s[e],e+1===i?n.connectTo(Y.destination):n.connectTo(s[e+1].getInputNode());for(I(t),e=0,i=wt.length;e<i;e++)wt[e].reconnect(r);ut&&pt===t&&(ut.disconnect(),ut.connect(r))}function R(t,e){mt.hasOwnProperty(t)?mt[t].push(e):mt[t]=[e],L(t)}function M(){}function F(){}function B(){}function N(t,e){var i=null;return mt.hasOwnProperty(t)&&(i=mt[t]),i&&e>=0&&e<i.length&&i[e].freqBins?i[e]:null}var j=cr.plugins_.Audio.prototype;j.Type=function(t){this.plugin=t,this.runtime=t.runtime};var D=j.Type.prototype;D.onCreate=function(){};var V=null,W=null,G="",U="",z=0,J=1,H=2,X=3,q=z,Y=null,K=[],Q=[],Z=null,$=!1,tt=0,et=!1,it=1,st=0,nt=0,rt=!1,ot=1,at=1,ht=10,ct=1e4,lt=1,ut=null,pt="",dt=!1,ft=[],gt=!1,yt=!1;document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0);var mt={},_t=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];g.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},g.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},g.prototype.getInputNode=function(){return this.inputNode},g.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[5]=e,f(this.wetNode.gain,e,i,s),f(this.dryNode.gain,1-e,i,s);break;case 1:this.params[1]=e,f(this.filterNode.frequency,e,i,s);break;case 2:this.params[2]=e,f(this.filterNode.detune,e,i,s);break;case 3:this.params[3]=e,f(this.filterNode.Q,e,i,s);break;case 4:this.params[4]=e,f(this.filterNode.gain,e,i,s)}},y.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},y.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},y.prototype.getInputNode=function(){return this.inputNode},y.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[2]=e,f(this.wetNode.gain,e,i,s),f(this.dryNode.gain,1-e,i,s);break;case 4:this.params[1]=n(e),f(this.delayGainNode.gain,n(e),i,s);break;case 5:this.params[0]=e,f(this.delayNode.delayTime,e,i,s)}},m.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},m.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},m.prototype.getInputNode=function(){return this.inputNode},m.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[1]=e,f(this.wetNode.gain,e,i,s),f(this.dryNode.gain,1-e,i,s)}},_.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},_.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},_.prototype.getInputNode=function(){return this.inputNode},_.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[4]=e,f(this.wetNode.gain,e/2,i,s),f(this.dryNode.gain,1-e/2,i,s);break;case 6:this.params[1]=e/1e3,f(this.oscGainNode.gain,e/1e3,i,s);break;case 7:this.params[2]=e,f(this.oscNode.frequency,e,i,s);break;case 8:this.params[3]=e/100,f(this.feedbackNode.gain,e/100,i,s)}},v.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},v.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},v.prototype.getInputNode=function(){return this.inputNode},v.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[5]=e,f(this.wetNode.gain,e/2,i,s),f(this.dryNode.gain,1-e/2,i,s);break;case 1:this.params[0]=e,f(this.filterNode.frequency,e,i,s);break;case 2:this.params[1]=e,f(this.filterNode.detune,e,i,s);break;case 3:this.params[2]=e,f(this.filterNode.Q,e,i,s);break;case 6:this.params[3]=e,f(this.oscGainNode.gain,e,i,s);break;case 7:this.params[4]=e,f(this.oscNode.frequency,e,i,s)}},b.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},b.prototype.remove=function(){this.node.disconnect()},b.prototype.getInputNode=function(){return this.node},b.prototype.setParam=function(t,e,i,s){switch(t){case 4:this.params[0]=n(e),f(this.node.gain,n(e),i,s)}},x.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},x.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},x.prototype.getInputNode=function(){return this.node},x.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[1]=e,f(this.node.gain.value,1-e/2,i,s),f(this.oscGainNode.gain.value,e/2,i,s);break;case 7:this.params[0]=e,f(this.oscNode.frequency,e,i,s)}},w.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},w.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},w.prototype.getInputNode=function(){return this.inputNode},w.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[1]=e,f(this.wetNode.gain,e,i,s),f(this.dryNode.gain,1-e,i,s);break;case 7:this.params[0]=e,f(this.oscNode.frequency,e,i,s)}},S.prototype.setDrive=function(t,e){t<.01&&(t=.01),this.preGain.gain.value=t,this.postGain.gain.value=Math.pow(1/t,.6)*e},S.prototype.shape=function(t,e,i){var s=1.05*i*e,n=s-e,r=t<0?-1:1,o=t<0?-t:t,a=o<e?o:e+n*T(o-e,1/n);return a*=r,a},S.prototype.generateColortouchCurve=function(t,e){for(var i=o(t),s=o(e),n=65536,r=n/2,a=0,h=0;h<r;++h)a=h/r,a=this.shape(a,i,s),this.curve[r+h]=a,this.curve[r-h-1]=-a},S.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},S.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},S.prototype.getInputNode=function(){return this.inputNode},S.prototype.setParam=function(t,e,i,s){switch(t){case 0:e/=100,e<0&&(e=0),e>1&&(e=1),this.params[4]=e,f(this.wetNode.gain,e,i,s),f(this.dryNode.gain,1-e,i,s)}},C.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},C.prototype.remove=function(){this.node.disconnect()},C.prototype.getInputNode=function(){return this.node},C.prototype.setParam=function(t,e,i,s){},O.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);var t=this.node.fftSize,e=0;this.peak=0;for(var i=0,s=0;e<t;e++)s=(this.signal[e]-128)/128,s<0&&(s=-s),this.peak<s&&(this.peak=s),i+=s*s;this.peak=r(this.peak),this.rms=r(Math.sqrt(i/t))},O.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},O.prototype.remove=function(){this.node.disconnect()},O.prototype.getInputNode=function(){return this.node},O.prototype.setParam=function(t,e,i,s){},A.prototype.setObject=function(t){this.obj=t},A.prototype.hasObject=function(){return!!this.obj},A.prototype.tick=function(t){},P.prototype.release=function(){var t,e,i,s;for(t=0,i=0,e=Q.length;t<e;++t)s=Q[t],Q[i]=s,s.buffer===this?s.stop():++i;Q.length=i,this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null),this.outNode&&(this.outNode.disconnect(),this.outNode=null),this.bufferObject=null,this.audioData=null},P.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var t=this;if(Y.decodeAudioData)Y.decodeAudioData(this.audioData,function(e){var i,s,n,r;if(t.bufferObject=e,t.audioData=null,cr.is_undefined(t.playTagWhenReady)||et){if(!cr.is_undefined(t.convolveWhenReady)){var o=t.convolveWhenReady.convolveNode;o.normalize=t.normalizeWhenReady,o.buffer=e}}else if(t.panWhenReady.length){for(s=0,n=t.panWhenReady.length;s<n;s++)if(i=t.panWhenReady[s],r=new k(t,i.thistag),r.setPannerEnabled(!0),
void 0===i.objUid||(i.obj=V.getObjectByUID(i.objUid),i.obj)){if(i.obj){var a=cr.rotatePtAround(i.obj.x,i.obj.y,-i.obj.layer.getAngle(),st,nt,!0),h=cr.rotatePtAround(i.obj.x,i.obj.y,-i.obj.layer.getAngle(),st,nt,!1);r.setPan(a,h,cr.to_degrees(i.obj.angle-i.obj.layer.getAngle()),i.ia,i.oa,i.og),r.setObject(i.obj)}else r.setPan(i.x,i.y,i.a,i.ia,i.oa,i.og);r.play(t.loopWhenReady,t.volumeWhenReady,t.seekWhenReady),t.pauseWhenReady&&r.pause(),Q.push(r)}cr.clearArray(t.panWhenReady)}else r=new k(t,t.playTagWhenReady||""),r.play(t.loopWhenReady,t.volumeWhenReady,t.seekWhenReady),t.pauseWhenReady&&r.pause(),Q.push(r)},function(e){t.failedToLoad=!0});else if(this.bufferObject=Y.createBuffer(this.audioData,!1),this.audioData=null,cr.is_undefined(this.playTagWhenReady)||et){if(!cr.is_undefined(this.convolveWhenReady)){var e=this.convolveWhenReady.convolveNode;e.normalize=this.normalizeWhenReady,e.buffer=this.bufferObject}}else{var i=new k(this,this.playTagWhenReady);i.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&i.pause(),Q.push(i)}}},P.prototype.isLoaded=function(){switch(this.myapi){case z:var t=this.bufferObject.readyState>=4;return t&&(this.wasEverReady=!0),t||this.wasEverReady;case J:return!!this.audioData||!!this.bufferObject;case H:case X:return!0}return!1},P.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case z:return this.isLoaded();case J:return!!this.bufferObject;case H:case X:return!0}return!1},P.prototype.hasFailedToLoad=function(){switch(this.myapi){case z:return!!this.bufferObject.error;case J:return this.failedToLoad}return!1},k.prototype.hasEnded=function(){switch(this.myapi){case z:return this.instanceObject.ended;case J:return this.buffer.myapi===J?!(!this.fresh&&!this.stopped&&this.instanceObject.loop)&&(!this.is_paused&&this.hasPlaybackEnded):this.instanceObject.ended;case H:return this.hasPlaybackEnded}return!0},k.prototype.canBeRecycled=function(){return!(!this.fresh&&!this.stopped)||this.hasEnded()},k.prototype.setPannerEnabled=function(t){if(q===J)if(!this.pannerEnabled&&t){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=Y.createPanner(),"number"==typeof this.pannerNode.panningModel?this.pannerNode.panningModel=ot:this.pannerNode.panningModel=["equalpower","HRTF","soundfield"][ot],"number"==typeof this.pannerNode.distanceModel?this.pannerNode.distanceModel=at:this.pannerNode.distanceModel=["linear","inverse","exponential"][at],this.pannerNode.refDistance=ht,this.pannerNode.maxDistance=ct,this.pannerNode.rolloffFactor=lt),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(h(this.tag)),this.pannerEnabled=!0}else if(this.pannerEnabled&&!t){if(!this.gainNode)return;this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(h(this.tag)),this.pannerEnabled=!1}},k.prototype.setPan=function(t,e,i,s,n,r){this.pannerEnabled&&q===J&&(this.pannerNode.setPosition(t,e,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(i)),Math.sin(cr.to_radians(i)),0),this.pannerNode.coneInnerAngle=s,this.pannerNode.coneOuterAngle=n,this.pannerNode.coneOuterGain=r,this.panX=t,this.panY=e,this.panAngle=i,this.panConeInner=s,this.panConeOuter=n,this.panConeOuterGain=r)},k.prototype.setObject=function(t){this.pannerEnabled&&q===J&&(this.objectTracker||(this.objectTracker=new A),this.objectTracker.setObject(t))},k.prototype.tick=function(t){if(this.pannerEnabled&&q===J&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(t);var e=this.objectTracker.obj,i=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),st,nt,!0),s=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),st,nt,!1);this.pannerNode.setPosition(i,s,0);var n=0;void 0!==this.objectTracker.obj.angle&&(n=e.angle-e.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(n),Math.sin(n),0))}},k.prototype.play=function(t,i,s,n){var r=this.instanceObject;this.looping=t,this.volume=i;var o=s||0;switch(n=n||0,this.myapi){case z:if(1!==r.playbackRate&&(r.playbackRate=1),r.volume!==i*it&&(r.volume=i*it),r.loop!==t&&(r.loop=t),r.muted&&(r.muted=!1),r.currentTime!==o)try{r.currentTime=o}catch(t){}e(this);break;case J:if(this.muted=!1,this.mutevol=1,this.buffer.myapi===J)this.gainNode.gain.value=i*it,this.fresh||(this.instanceObject=Y.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=t,this.hasPlaybackEnded=!1,0===o?u(this.instanceObject,n):p(this.instanceObject,o,this.getDuration(),n);else{if(1!==r.playbackRate&&(r.playbackRate=1),r.loop!==t&&(r.loop=t),r.volume=i*it,r.currentTime!==o)try{r.currentTime=o}catch(t){}e(this)}break;case H:(!this.fresh&&this.stopped||0!==o)&&r.seekTo(o),r.play(),this.hasPlaybackEnded=!1;break;case X:V.isDirectCanvas?AppMobi.context.playSound(this.src,t):AppMobi.player.playSound(this.src,t)}this.playbackRate=1,this.startTime=(this.isTimescaled?V.kahanTime.sum:V.wallTime.sum)-o,this.fresh=!1,this.stopped=!1,this.is_paused=!1},k.prototype.stop=function(){switch(this.myapi){case z:this.instanceObject.paused||this.instanceObject.pause();break;case J:this.buffer.myapi===J?d(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case H:this.instanceObject.stop();break;case X:V.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.stopped=!0,this.is_paused=!1},k.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case z:this.instanceObject.paused||this.instanceObject.pause();break;case J:this.buffer.myapi===J?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),this.is_paused=!0,d(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case H:this.instanceObject.pause();break;case X:V.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.is_paused=!0}},k.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case z:e(this);break;case J:this.buffer.myapi===J?(this.instanceObject=Y.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=it*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?V.kahanTime.sum:V.wallTime.sum)-this.resume_position/(this.playbackRate||.001),p(this.instanceObject,this.resume_position,this.getDuration())):e(this);break;case H:this.instanceObject.play();break;case X:V.isDirectCanvas&&AppMobi.context.resumeSound(this.src)}this.is_paused=!1}},k.prototype.seek=function(t){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case z:try{this.instanceObject.currentTime=t}catch(t){}break;case J:if(this.buffer.myapi===J)this.is_paused?this.resume_position=t:(this.pause(),this.resume_position=t,this.resume());else try{this.instanceObject.currentTime=t}catch(t){}break;case H:break;case X:V.isDirectCanvas&&AppMobi.context.seekSound(this.src,t)}},k.prototype.reconnect=function(t){this.myapi===J&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(t)):(this.gainNode.disconnect(),this.gainNode.connect(t)))},k.prototype.getDuration=function(t){var e=0;switch(this.myapi){case z:void 0!==this.instanceObject.duration&&(e=this.instanceObject.duration);break;case J:e=this.buffer.bufferObject.duration;break;case H:e=this.instanceObject.getDuration();break;case X:V.isDirectCanvas&&(e=AppMobi.context.getDurationSound(this.src))}return t&&(e/=this.playbackRate||.001),e},k.prototype.getPlaybackTime=function(t){var e=this.getDuration(),i=0;switch(this.myapi){case z:void 0!==this.instanceObject.currentTime&&(i=this.instanceObject.currentTime);break;case J:if(this.buffer.myapi===J){if(this.is_paused)return this.resume_position;i=(this.isTimescaled?V.kahanTime.sum:V.wallTime.sum)-this.startTime}else void 0!==this.instanceObject.currentTime&&(i=this.instanceObject.currentTime);break;case H:break;case X:V.isDirectCanvas&&(i=AppMobi.context.getPlaybackTimeSound(this.src))}return t&&(i*=this.playbackRate),!this.looping&&i>e&&(i=e),i},k.prototype.isPlaying=function(){return!(this.is_paused||this.fresh||this.stopped||this.hasEnded())},k.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},k.prototype.setVolume=function(t){this.volume=t,this.updateVolume()},k.prototype.updateVolume=function(){var t=this.volume*it;switch(isFinite(t)||(t=0),this.myapi){case z:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t);break;case J:this.buffer.myapi===J?this.gainNode.gain.value=t*this.mutevol:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t)}},k.prototype.getVolume=function(){return this.volume},k.prototype.doSetMuted=function(t){switch(this.myapi){case z:this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t);break;case J:this.buffer.myapi===J?(this.mutevol=t?0:1,this.gainNode.gain.value=it*this.volume*this.mutevol):this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t)}},k.prototype.setMuted=function(t){this.is_muted=!!t,this.doSetMuted(this.is_muted||this.is_silent)},k.prototype.setSilent=function(t){this.is_silent=!!t,this.doSetMuted(this.is_muted||this.is_silent)},k.prototype.setLooping=function(t){switch(this.looping=t,this.myapi){case z:case J:this.instanceObject.loop!==!!t&&(this.instanceObject.loop=!!t);break;case H:break;case X:V.isDirectCanvas&&AppMobi.context.setLoopingSound(this.src,t)}},k.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.updatePlaybackRate()},k.prototype.updatePlaybackRate=function(){var t=this.playbackRate;switch(this.isTimescaled&&(t*=V.timescale),this.myapi){case z:this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t);break;case J:this.buffer.myapi===J?this.instanceObject.playbackRate.value!==t&&(this.instanceObject.playbackRate.value=t):this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t)}},k.prototype.setSuspended=function(t){switch(this.myapi){case z:t?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case J:t?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===J?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),d(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===J?(this.instanceObject=Y.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=it*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?V.kahanTime.sum:V.wallTime.sum)-this.resume_position/(this.playbackRate||.001),p(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case H:t?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}},j.Instance=function(t){if(this.type=t,this.runtime=t.runtime,V=this.runtime,W=this,this.listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(gt=!0),!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||this.runtime.isCrosswalk||this.runtime.isDomFree||this.runtime.isAmazonWebApp||gt||(dt=!0),Y=null,"undefined"!=typeof AudioContext?(q=J,Y=new AudioContext):"undefined"!=typeof webkitAudioContext&&(q=J,Y=new webkitAudioContext),this.runtime.isiOS&&Y&&(Y.close&&Y.close(),"undefined"!=typeof AudioContext?Y=new AudioContext:"undefined"!=typeof webkitAudioContext&&(Y=new webkitAudioContext)),q!==J&&(this.runtime.isCordova&&void 0!==window.Media?q=H:this.runtime.isAppMobi&&(q=X)),q===H){U=location.href;var e=U.lastIndexOf("/");e>-1&&(U=U.substr(0,e+1)),U=U.replace("file://","")}if(this.runtime.isSafari&&this.runtime.isWindows&&"undefined"==typeof Audio)alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)$=this.runtime.isAndroid;else try{$=!!(new Audio).canPlayType('audio/ogg; codecs="vorbis"')}catch(t){$=!1}q,this.runtime.tickMe(this)}};var vt=j.Instance.prototype;vt.onCreate=function(){this.runtime.audioInstance=this,tt=this.properties[0],this.saveload=this.properties[1],this.playinbackground=0!==this.properties[2],this.nextPlayTime=0,ot=this.properties[3],at=this.properties[4],this.listenerZ=-this.properties[5],ht=this.properties[6],ct=this.properties[7],lt=this.properties[8],this.listenerTracker=new A;var t=this.runtime.draw_width||this.runtime.width,e=this.runtime.draw_height||this.runtime.height;q===J&&(Y.listener.setPosition(t/2,e/2,this.listenerZ),Y.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(t,e){ut&&ut.disconnect(),pt=e.toLowerCase(),ut=Y.createMediaStreamSource(t),ut.connect(h(pt))}),this.runtime.addSuspendCallback(function(t){W.onSuspend(t)});var i=this;this.runtime.addDestroyCallback(function(t){i.onInstanceDestroyed(t)})},vt.onInstanceDestroyed=function(t){var e,i,s;for(e=0,i=Q.length;e<i;e++)s=Q[e],s.objectTracker&&s.objectTracker.obj===t&&(s.objectTracker.obj=null,s.pannerEnabled&&s.isPlaying()&&s.looping&&s.stop());this.listenerTracker.obj===t&&(this.listenerTracker.obj=null)},vt.saveToJSON=function(){var t,e,i,s,n,r,o,a={silent:et,masterVolume:it,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},h=a.playing;for(t=0,e=Q.length;t<e;t++)i=Q[t],i.shouldSave()&&3!==this.saveload&&(i.is_music&&1===this.saveload||(i.is_music||2!==this.saveload)&&(o=i.getPlaybackTime(),i.looping&&(o%=i.getDuration()),s={tag:i.tag,buffersrc:i.buffer.src,is_music:i.is_music,playbackTime:o,volume:i.volume,looping:i.looping,muted:i.is_muted,playbackRate:i.playbackRate,paused:i.is_paused,resume_position:i.resume_position},i.pannerEnabled&&(s.pan={},r=s.pan,i.objectTracker&&i.objectTracker.hasObject()?r.objUid=i.objectTracker.obj.uid:(r.x=i.panX,r.y=i.panY,r.a=i.panAngle),r.ia=i.panConeInner,r.oa=i.panConeOuter,r.og=i.panConeOuterGain),h.push(s)));var c,l=a.effects;for(n in mt)if(mt.hasOwnProperty(n)){for(c=[],t=0,e=mt[n].length;t<e;t++)c.push({type:mt[n][t].type,params:mt[n][t].params});l[n]=c}return a};var bt=[];vt.loadFromJSON=function(t){var e=t.silent;it=t.masterVolume,this.listenerZ=t.listenerZ,this.listenerTracker.setObject(null);var i=t.listenerUid;-1!==i&&(this.listenerTracker.loadUid=i,bt.push(this.listenerTracker));var s,n,r,o,a,h,c,l,u,p,d,f,T,P,k,E,I,L,M=t.playing;if(3!==this.saveload)for(s=0,n=Q.length;s<n;s++)d=Q[s],d.is_music&&1===this.saveload||(d.is_music||2!==this.saveload)&&d.stop();for(f in mt)if(mt.hasOwnProperty(f))for(s=0,n=mt[f].length;s<n;s++)mt[f][s].remove();for(f in cr.wipe(mt),t.effects)if(t.effects.hasOwnProperty(f))for(k=t.effects[f],s=0,n=k.length;s<n;s++)switch(E=k[s].type,I=k[s].params,E){case"filter":R(f,new g(I[0],I[1],I[2],I[3],I[4],I[5]));break;case"delay":R(f,new y(I[0],I[1],I[2]));break;case"convolve":o=I[2],p=this.getAudioBuffer(o,!1),p.bufferObject?L=new m(p.bufferObject,I[0],I[1],o):(L=new m(null,I[0],I[1],o),p.normalizeWhenReady=I[0],p.convolveWhenReady=L),R(f,L);break;case"flanger":R(f,new _(I[0],I[1],I[2],I[3],I[4]));break;case"phaser":R(f,new v(I[0],I[1],I[2],I[3],I[4],I[5]));break;case"gain":R(f,new b(I[0]));break;case"tremolo":R(f,new x(I[0],I[1]));break;case"ringmod":R(f,new w(I[0],I[1]));break;case"distortion":R(f,new S(I[0],I[1],I[2],I[3],I[4]));break;case"compressor":R(f,new C(I[0],I[1],I[2],I[3],I[4]));break;case"analyser":R(f,new O(I[0],I[1]))}for(s=0,n=M.length;s<n;s++)3!==this.saveload&&(r=M[s],o=r.buffersrc,a=r.is_music,h=r.tag,c=r.playbackTime,l=r.looping,u=r.volume,T=r.pan,P=T&&T.hasOwnProperty("objUid")?T.objUid:-1,a&&1===this.saveload||(a||2!==this.saveload)&&(d=this.getAudioInstance(o,h,a,l,u),d?(d.resume_position=r.resume_position,d.setPannerEnabled(!!T),d.play(l,u,c),d.updatePlaybackRate(),d.updateVolume(),d.doSetMuted(d.is_muted||d.is_silent),r.paused&&d.pause(),r.muted&&d.setMuted(!0),d.doSetMuted(d.is_muted||d.is_silent),T&&(-1!==P?(d.objectTracker=d.objectTracker||new A,d.objectTracker.loadUid=P,bt.push(d.objectTracker)):d.setPan(T.x,T.y,T.a,T.ia,T.oa,T.og))):(p=this.getAudioBuffer(o,a),p.seekWhenReady=c,p.pauseWhenReady=r.paused,T&&(-1!==P?p.panWhenReady.push({objUid:P,ia:T.ia,oa:T.oa,og:T.og,thistag:h}):p.panWhenReady.push({x:T.x,y:T.y,a:T.a,ia:T.ia,oa:T.oa,og:T.og,thistag:h})))));if(e&&!et){for(s=0,n=Q.length;s<n;s++)Q[s].setSilent(!0);et=!0}else if(!e&&et){for(s=0,n=Q.length;s<n;s++)Q[s].setSilent(!1);et=!1}},vt.afterLoad=function(){var t,e,i,s;for(t=0,e=bt.length;t<e;t++)i=bt[t],s=this.runtime.getObjectByUID(i.loadUid),i.setObject(s),i.loadUid=-1,s&&(st=s.x,nt=s.y);cr.clearArray(bt)},vt.onSuspend=function(t){if(!this.playinbackground){var e,i;for(!t&&Y&&Y.resume&&(Y.resume(),rt=!1),e=0,i=Q.length;e<i;e++)Q[e].setSuspended(t);t&&Y&&Y.suspend&&(Y.suspend(),rt=!0)}},vt.tick=function(){var t,e,i,s,n,r,o=this.runtime.dt;for(t=0,e=Q.length;t<e;t++)i=Q[t],i.tick(o),0!==tt&&i.updatePlaybackRate();for(s in mt)if(mt.hasOwnProperty(s))for(n=mt[s],t=0,e=n.length;t<e;t++)r=n[t],r.tick&&r.tick();q===J&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(o),st=this.listenerTracker.obj.x,nt=this.listenerTracker.obj.y,Y.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var xt=[];vt.setPreloadList=function(t){var e,i,s,n,r,o,a=0;for(e=0,i=t.length;e<i;++e)s=t[e],n=s[0],r=2*s[1],o=n.length>4&&".ogg"===n.substr(n.length-4),(o&&$||!o&&!$)&&(xt.push({filename:n,size:r,obj:null}),a+=r);return a},vt.startPreloads=function(){var t,e,i,s;for(t=0,e=xt.length;t<e;++t)i=xt[t],s=this.runtime.files_subfolder+i.filename,i.obj=this.getAudioBuffer(s,!1)},vt.getPreloadedSize=function(){var t,e,i,s=0;for(t=0,e=xt.length;t<e;++t)i=xt[t],i.obj.isLoadedAndDecoded()||i.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser?s+=i.size:i.obj.isLoaded()&&(s+=Math.floor(i.size/2));return s},vt.releaseAllMusicBuffers=function(){var t,e,i,s;for(t=0,i=0,e=K.length;t<e;++t)s=K[t],K[i]=s,s.is_music?s.release():++i;K.length=i},vt.getAudioBuffer=function(t,e,i){var s,n,r,o=null;for(s=0,n=K.length;s<n;s++)if(r=K[s],r.src===t){o=r;break}return o||i||(gt&&e&&this.releaseAllMusicBuffers(),o=new P(t,e),K.push(o)),o},vt.getAudioInstance=function(t,e,i,s,n){var r,o,a;for(r=0,o=Q.length;r<o;r++)if(a=Q[r],a.src===t&&(a.canBeRecycled()||i))return a.tag=e,a;var h=this.getAudioBuffer(t,i);return h.bufferObject?(a=new k(h,e),Q.push(a),a):("<preload>"!==e&&(h.playTagWhenReady=e,h.loopWhenReady=s,h.volumeWhenReady=n),null)};var wt=[];M.prototype.OnEnded=function(t){return cr.equals_nocase(G,t)},M.prototype.PreloadsComplete=function(){var t,e;for(t=0,e=K.length;t<e;t++)if(!K[t].isLoadedAndDecoded()&&!K[t].hasFailedToLoad())return!1;return!0},M.prototype.AdvancedAudioSupported=function(){return q===J},M.prototype.IsSilent=function(){return et},M.prototype.IsAnyPlaying=function(){var t,e;for(t=0,e=Q.length;t<e;t++)if(Q[t].isPlaying())return!0;return!1},M.prototype.IsTagPlaying=function(t){var e,i;for(I(t),e=0,i=wt.length;e<i;e++)if(wt[e].isPlaying())return!0;return!1},j.cnds=new M,F.prototype.Play=function(t,e,i,s){if(!et){var r=n(i),o=t[1],a=this.runtime.files_subfolder+t[0]+($?".ogg":".m4a");Z=this.getAudioInstance(a,s,o,0!==e,r),Z&&(Z.setPannerEnabled(!1),Z.play(0!==e,r,0,this.nextPlayTime),this.nextPlayTime=0)}},F.prototype.PlayAtPosition=function(t,e,i,s,r,o,a,h,c,l){if(!et){var u=n(i),p=t[1],d=this.runtime.files_subfolder+t[0]+($?".ogg":".m4a");if(Z=this.getAudioInstance(d,l,p,0!==e,u),Z)Z.setPannerEnabled(!0),Z.setPan(s,r,o,a,h,n(c)),Z.play(0!==e,u,0,this.nextPlayTime),this.nextPlayTime=0;else{var f=this.getAudioBuffer(d,p);f.panWhenReady.push({x:s,y:r,a:o,ia:a,oa:h,og:n(c),thistag:l})}}},F.prototype.PlayAtObject=function(t,e,i,s,r,o,a,h){if(!et&&s){var c=s.getFirstPicked();if(c){var l=n(i),u=t[1],p=this.runtime.files_subfolder+t[0]+($?".ogg":".m4a");if(Z=this.getAudioInstance(p,h,u,0!==e,l),Z){Z.setPannerEnabled(!0);var d=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),st,nt,!0),f=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),st,nt,!1);Z.setPan(d,f,cr.to_degrees(c.angle-c.layer.getAngle()),r,o,n(a)),Z.setObject(c),Z.play(0!==e,l,0,this.nextPlayTime),this.nextPlayTime=0}else{var g=this.getAudioBuffer(p,u);g.panWhenReady.push({obj:c,ia:r,oa:o,og:n(a),thistag:h})}}}},F.prototype.PlayByName=function(t,e,i,s,r){if(!et){var o=n(s),a=1===t,h=this.runtime.files_subfolder+e.toLowerCase()+($?".ogg":".m4a");Z=this.getAudioInstance(h,r,a,0!==i,o),Z&&(Z.setPannerEnabled(!1),Z.play(0!==i,o,0,this.nextPlayTime),this.nextPlayTime=0)}},F.prototype.PlayAtPositionByName=function(t,e,i,s,r,o,a,h,c,l,u){if(!et){var p=n(s),d=1===t,f=this.runtime.files_subfolder+e.toLowerCase()+($?".ogg":".m4a");if(Z=this.getAudioInstance(f,u,d,0!==i,p),Z)Z.setPannerEnabled(!0),Z.setPan(r,o,a,h,c,n(l)),Z.play(0!==i,p,0,this.nextPlayTime),this.nextPlayTime=0;else{var g=this.getAudioBuffer(f,d);g.panWhenReady.push({x:r,y:o,a:a,ia:h,oa:c,og:n(l),thistag:u})}}},F.prototype.PlayAtObjectByName=function(t,e,i,s,r,o,a,h,c){if(!et&&r){var l=r.getFirstPicked();if(l){var u=n(s),p=1===t,d=this.runtime.files_subfolder+e.toLowerCase()+($?".ogg":".m4a");if(Z=this.getAudioInstance(d,c,p,0!==i,u),Z){Z.setPannerEnabled(!0);var f=cr.rotatePtAround(l.x,l.y,-l.layer.getAngle(),st,nt,!0),g=cr.rotatePtAround(l.x,l.y,-l.layer.getAngle(),st,nt,!1);Z.setPan(f,g,cr.to_degrees(l.angle-l.layer.getAngle()),o,a,n(h)),Z.setObject(l),Z.play(0!==i,u,0,this.nextPlayTime),this.nextPlayTime=0}else{var y=this.getAudioBuffer(d,p);y.panWhenReady.push({obj:l,ia:o,oa:a,og:n(h),thistag:c})}}}},F.prototype.SetLooping=function(t,e){var i,s;for(I(t),i=0,s=wt.length;i<s;i++)wt[i].setLooping(0===e)},F.prototype.SetMuted=function(t,e){var i,s;for(I(t),i=0,s=wt.length;i<s;i++)wt[i].setMuted(0===e)},F.prototype.SetVolume=function(t,e){I(t);var i,s,r=n(e);for(i=0,s=wt.length;i<s;i++)wt[i].setVolume(r)},F.prototype.Preload=function(t){if(!et){var e=t[1],i=this.runtime.files_subfolder+t[0]+($?".ogg":".m4a");q!==X?q!==H&&this.getAudioInstance(i,"<preload>",e,!1):this.runtime.isDirectCanvas?AppMobi.context.loadSound(i):AppMobi.player.loadSound(i)}},F.prototype.PreloadByName=function(t,e){if(!et){var i=1===t,s=this.runtime.files_subfolder+e.toLowerCase()+($?".ogg":".m4a");q!==X?q!==H&&this.getAudioInstance(s,"<preload>",i,!1):this.runtime.isDirectCanvas?AppMobi.context.loadSound(s):AppMobi.player.loadSound(s)}},F.prototype.SetPlaybackRate=function(t,e){var i,s;for(I(t),e<0&&(e=0),i=0,s=wt.length;i<s;i++)wt[i].setPlaybackRate(e)},F.prototype.Stop=function(t){var e,i;for(I(t),e=0,i=wt.length;e<i;e++)wt[e].stop()},F.prototype.StopAll=function(){var t,e;for(t=0,e=Q.length;t<e;t++)Q[t].stop()},F.prototype.SetPaused=function(t,e){var i,s;for(I(t),i=0,s=wt.length;i<s;i++)0===e?wt[i].pause():wt[i].resume()},F.prototype.Seek=function(t,e){var i,s;for(I(t),i=0,s=wt.length;i<s;i++)wt[i].seek(e)},F.prototype.SetSilent=function(t){var e,i;if(2===t&&(t=et?1:0),0!==t||et){if(1===t&&et){for(e=0,i=Q.length;e<i;e++)Q[e].setSilent(!1);et=!1}}else{for(e=0,i=Q.length;e<i;e++)Q[e].setSilent(!0);et=!0}},F.prototype.SetMasterVolume=function(t){var e,i;for(it=n(t),e=0,i=Q.length;e<i;e++)Q[e].updateVolume()},F.prototype.AddFilterEffect=function(t,e,i,s,n,r,o){q!==J||e<0||e>=_t.length||!Y.createBiquadFilter||(t=t.toLowerCase(),o/=100,o<0&&(o=0),o>1&&(o=1),R(t,new g(e,i,s,n,r,o)))},F.prototype.AddDelayEffect=function(t,e,i,s){q===J&&(t=t.toLowerCase(),s/=100,s<0&&(s=0),s>1&&(s=1),R(t,new y(e,n(i),s)))},F.prototype.AddFlangerEffect=function(t,e,i,s,n,r){q===J&&Y.createOscillator&&(t=t.toLowerCase(),r/=100,r<0&&(r=0),r>1&&(r=1),R(t,new _(e/1e3,i/1e3,s,n/100,r)))},F.prototype.AddPhaserEffect=function(t,e,i,s,n,r,o){q===J&&Y.createOscillator&&(t=t.toLowerCase(),o/=100,o<0&&(o=0),o>1&&(o=1),R(t,new v(e,i,s,n,r,o)))},F.prototype.AddConvolutionEffect=function(t,e,i,s){if(q===J&&Y.createConvolver){var n,r=0===i,o=this.runtime.files_subfolder+e[0]+($?".ogg":".m4a"),a=this.getAudioBuffer(o,!1);t=t.toLowerCase(),s/=100,s<0&&(s=0),s>1&&(s=1),a.bufferObject?n=new m(a.bufferObject,r,s,o):(n=new m(null,r,s,o),a.normalizeWhenReady=r,a.convolveWhenReady=n),R(t,n)}},F.prototype.AddGainEffect=function(t,e){q===J&&(t=t.toLowerCase(),R(t,new b(n(e))))},F.prototype.AddMuteEffect=function(t){q===J&&(t=t.toLowerCase(),R(t,new b(0)))},F.prototype.AddTremoloEffect=function(t,e,i){q===J&&Y.createOscillator&&(t=t.toLowerCase(),i/=100,i<0&&(i=0),i>1&&(i=1),R(t,new x(e,i)))},F.prototype.AddRingModEffect=function(t,e,i){q===J&&Y.createOscillator&&(t=t.toLowerCase(),i/=100,i<0&&(i=0),i>1&&(i=1),R(t,new w(e,i)))},F.prototype.AddDistortionEffect=function(t,e,i,s,n,r){q===J&&Y.createWaveShaper&&(t=t.toLowerCase(),r/=100,r<0&&(r=0),r>1&&(r=1),R(t,new S(e,i,s,n,r)))},F.prototype.AddCompressorEffect=function(t,e,i,s,n,r){q===J&&Y.createDynamicsCompressor&&(t=t.toLowerCase(),R(t,new C(e,i,s,n/1e3,r/1e3)))},F.prototype.AddAnalyserEffect=function(t,e,i){q===J&&(t=t.toLowerCase(),R(t,new O(e,i)))},F.prototype.RemoveEffects=function(t){var e,i,s;if(q===J&&(t=t.toLowerCase(),mt.hasOwnProperty(t)&&(s=mt[t],s.length))){for(e=0,i=s.length;e<i;e++)s[e].remove();cr.clearArray(s),L(t)}},F.prototype.SetEffectParameter=function(t,e,i,s,n,r){var o;q===J&&(t=t.toLowerCase(),e=Math.floor(e),mt.hasOwnProperty(t)&&(o=mt[t],e<0||e>=o.length||o[e].setParam(i,s,n,r)))},F.prototype.SetListenerObject=function(t){if(t&&q===J){var e=t.getFirstPicked();e&&(this.listenerTracker.setObject(e),st=e.x,nt=e.y)}},F.prototype.SetListenerZ=function(t){this.listenerZ=t},F.prototype.ScheduleNextPlay=function(t){Y&&(this.nextPlayTime=t)},F.prototype.UnloadAudio=function(t){var e=t[1],i=this.runtime.files_subfolder+t[0]+($?".ogg":".m4a"),s=this.getAudioBuffer(i,e,!0);s&&(s.release(),cr.arrayFindRemove(K,s))},F.prototype.UnloadAudioByName=function(t,e){var i=1===t,s=this.runtime.files_subfolder+e.toLowerCase()+($?".ogg":".m4a"),n=this.getAudioBuffer(s,i,!0);n&&(n.release(),cr.arrayFindRemove(K,n))},F.prototype.UnloadAll=function(){var t,e;for(t=0,e=K.length;t<e;++t)K[t].release();cr.clearArray(K)},j.acts=new F,B.prototype.Duration=function(t,e){I(e,!0),wt.length?t.set_float(wt[0].getDuration()):t.set_float(0)},B.prototype.PlaybackTime=function(t,e){I(e,!0),wt.length?t.set_float(wt[0].getPlaybackTime(!0)):t.set_float(0)},B.prototype.Volume=function(t,e){if(I(e,!0),wt.length){var i=wt[0].getVolume();t.set_float(r(i))}else t.set_float(0)},B.prototype.MasterVolume=function(t){t.set_float(r(it))},B.prototype.EffectCount=function(t,e){e=e.toLowerCase();var i=null;mt.hasOwnProperty(e)&&(i=mt[e]),t.set_int(i?i.length:0)},B.prototype.AnalyserFreqBinCount=function(t,e,i){e=e.toLowerCase(),i=Math.floor(i);var s=N(e,i);t.set_int(s?s.node.frequencyBinCount:0)},B.prototype.AnalyserFreqBinAt=function(t,e,i,s){e=e.toLowerCase(),i=Math.floor(i),s=Math.floor(s);var n=N(e,i);n?s<0||s>=n.node.frequencyBinCount?t.set_float(0):t.set_float(n.freqBins[s]):t.set_float(0)},B.prototype.AnalyserPeakLevel=function(t,e,i){e=e.toLowerCase(),i=Math.floor(i);var s=N(e,i);s?t.set_float(s.peak):t.set_float(0)},B.prototype.AnalyserRMSLevel=function(t,e,i){e=e.toLowerCase(),i=Math.floor(i);var s=N(e,i);s?t.set_float(s.rms):t.set_float(0)},B.prototype.SampleRate=function(t){t.set_int(Y?Y.sampleRate:0)},B.prototype.CurrentTime=function(t){t.set_float(Y?Y.currentTime:cr.performance_now())},j.exps=new B}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}function maybeLoadBatteryManager(){if(!loadedBatteryManager&&navigator.getBattery){var t=navigator.getBattery();loadedBatteryManager=!0,t&&t.then(function(t){batteryManager=t})}}function Cnds(){}function Acts(){}function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}function Exps(){}var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C2_RegisterSW&&navigator.serviceWorker){var t=document.createElement("script");t.onload=function(){offlineScriptReady=!0,checkReady()},t.src="../common-resources/offlineClient.min.js",document.head.appendChild(t)}});var browserInstance=null;typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var t=this;window.addEventListener("resize",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,t)}),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,t)}),window.addEventListener("offline",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,t)})),void 0!==window.applicationCache&&(window.applicationCache.addEventListener("updateready",function(){t.runtime.loadingprogress=1,t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,t)}),window.applicationCache.addEventListener("progress",function(e){t.runtime.loadingprogress=e.loaded/e.total||0})),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,t)}),document.addEventListener("backbutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),document.addEventListener("menubutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)}),document.addEventListener("searchbutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,t)}),document.addEventListener("tizenhwkey",function(e){var i;switch(e.keyName){case"back":i=t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t),i||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":i=t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t),i||e.preventDefault()}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(e){var i=t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t);i&&(e.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(e){return!!t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),this.runtime.addSuspendCallback(function(e){e?t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,t):t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,t)}),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type
;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return void 0!==window.applicationCache&&window.applicationCache.status===window.applicationCache.DOWNLOADING},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){var e=window.innerWidth<=window.innerHeight?0:1;return e===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var t=this.runtime.canvasdiv||this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){this.runtime.isDomFree||alert(t.toString())},Acts.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||this.runtime.isDomFree||window.close()},Acts.prototype.Focus=function(){if(this.runtime.isNodeWebkit){var t=window.nwgui.Window.get();t.focus()}else this.is_arcade||this.runtime.isDomFree||window.focus()},Acts.prototype.Blur=function(){if(this.runtime.isNodeWebkit){var t=window.nwgui.Window.get();t.blur()}else this.is_arcade||this.runtime.isDomFree||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():this.is_arcade||this.runtime.isDomFree||!window.back||window.back()},Acts.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()},Acts.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||window.open(t,e)},Acts.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;Acts.prototype.RequestFullScreen=function(t){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored");else if(t>=2&&(t+=1),6===t&&(t=2),this.runtime.isNodeWebkit)this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=t>=2?t:0);else{if(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement)return;this.runtime.fullscreen_scaling=t>=2?t:0;var e=this.runtime.canvasdiv||this.runtime.canvas;firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,e.addEventListener("mozfullscreenerror",onFullscreenError),e.addEventListener("webkitfullscreenerror",onFullscreenError),e.addEventListener("MSFullscreenError",onFullscreenError),e.addEventListener("fullscreenerror",onFullscreenError)),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitRequestFullScreen())}},Acts.prototype.CancelFullScreen=function(){this.runtime.isDomFree?cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{var e,i,s=t.split(",");for(e=0,i=s.length;e<i;e++)s[e]=parseInt(s[e],10);navigator.vibrate?navigator.vibrate(s):navigator.mozVibrate?navigator.mozVibrate(s):navigator.webkitVibrate?navigator.webkitVibrate(s):navigator.msVibrate&&navigator.msVibrate(s)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){var i=document.createElement("a");if(void 0===i.download)window.open(t);else{var s=document.getElementsByTagName("body")[0];i.textContent=e,i.href=t,i.download=e,s.appendChild(i);var n=new MouseEvent("click");i.dispatchEvent(n),s.removeChild(i)}},Acts.prototype.InvokeDownloadString=function(t,e,i){var s="data:"+e+","+encodeURIComponent(t),n=document.createElement("a");if(void 0===n.download)window.open(s);else{var r=document.getElementsByTagName("body")[0];n.textContent=i,n.href=s,n.download=i,r.appendChild(n);var o=new MouseEvent("click");n.dispatchEvent(o),r.removeChild(n)}},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];Acts.prototype.LockOrientation=function(t){if(t=Math.floor(t),!(t<0||t>=orientations.length)){this.runtime.autoLockOrientation=!1;var e=orientations[t];screen.orientation&&screen.orientation.lock?screen.orientation.lock(e):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e)}},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(this.runtime.isDomFree?"":window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(this.runtime.isDomFree?"":window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(this.runtime.isDomFree?"":window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(this.runtime.isDomFree?"":document.referrer)},Exps.prototype.Title=function(t){t.set_string(this.runtime.isDomFree?"":document.title)},Exps.prototype.Name=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appName)},Exps.prototype.Version=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appVersion)},Exps.prototype.Language=function(t){if(navigator&&navigator.language)if(null!=top.stellaHandle){var e=top.stellaHandle.getSystemLanguage();console.log("Setting language to system language: "+e),t.set_string(e)}else t.set_string(navigator.language);else t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(this.runtime.isDomFree?"":navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(this.runtime.isDomFree?"":navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(this.runtime.isDomFree?"":window.location.search)},Exps.prototype.QueryParam=function(t,e){if(this.runtime.isDomFree)t.set_string("");else{var i=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);i?t.set_string(decodeURIComponent(i[1].replace(/\+/g," "))):t.set_string("")}},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}"number"==typeof result?ret.set_any(result):"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.CJSAds=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s="",n=[],r=0,o=0,a=!1,h=!1,c=!1,l=cr.plugins_.CJSAds.prototype;l.Type=function(t){this.plugin=t,this.runtime=t.runtime};var u=l.Type.prototype;u.onCreate=function(){},l.Instance=function(t){this.type=t,this.runtime=t.runtime};var p=l.Instance.prototype;p.onCreate=function(){this.isShowingBanner=!1,this.isShowingFullscreen=!1,this.triggerProduct="",this.socialService=null,this.socialServiceAvailable=!1,this.storeServiceAvailable=this.runtime.isCocoonJs&&void 0!==CocoonJS.Store.nativeExtensionObjectAvailable,this.storeManaged=1!==this.properties[0],this.storeSandboxed=0!==this.properties[1],this.onConsumePurchaseFailedTransactionId="",this.onConsumePurchaseCompleted="";var t=this;this.runtime.isCocoonJs&&(CocoonJS.App.onTextDialogFinished.addEventListener(function(e){s=e,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnKeyboardOK,t)}),CocoonJS.App.onTextDialogCancelled.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnKeyboardCancelled,t)}),CocoonJS.Ad.onBannerShown.addEventListener(function(){t.isShowingBanner=!0,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnBannerShown,t)}),CocoonJS.Ad.onBannerReady.addEventListener(function(){h=!0,a||(CocoonJS.Ad.setBannerLayout(o),CocoonJS.Ad.showBanner())}),CocoonJS.Ad.onFullScreenShown.addEventListener(function(){t.isShowingFullscreen=!0,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnFullscreenShown,t)}),CocoonJS.Ad.onFullScreenHidden.addEventListener(function(){t.isShowingFullscreen=!1,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnFullscreenHidden,t)}),CocoonJS.Ad.onFullScreenReady.addEventListener(function(){c=!0,preloadFullScreen||CocoonJS.Ad.showFullScreen()}),this.storeServiceAvailable&&(CocoonJS.Store.onProductPurchaseCompleted.addEventListener(function(e){t.triggerProduct=e.productId,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnPurchaseComplete,t),CocoonJS.Store.addPurchase(e),CocoonJS.Store.consumePurchase(e.transactionId,e.productId),CocoonJS.Store.finishPurchase(e.transactionId)}),CocoonJS.Store.onConsumePurchaseFailed.addEventListener(function(e,i){this.onConsumePurchaseFailedTransactionId=e,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.onConsumePurchaseFailed,t)}),CocoonJS.Store.onConsumePurchaseCompleted.addEventListener(function(e){this.onConsumePurchaseCompleted=e,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.onConsumePurchaseCompleted,t)}),CocoonJS.Store.onProductPurchaseFailed.addEventListener(function(e,i){t.triggerProduct=e,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnPurchaseFail,t)}),CocoonJS.Store.onProductPurchaseStarted.addEventListener(function(e){t.triggerProduct=e.productId,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnPurchaseStart,t)}),CocoonJS.Store.onProductsFetchStarted.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.onProductsFetchStarted,t)}),CocoonJS.Store.onProductsFetchFailed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.onProductsFetchFailed,t)}),CocoonJS.Store.onProductsFetchCompleted.addEventListener(function(e){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.onProductsFetchCompleted,t)}),CocoonJS.Store.requestInitialization({managed:this.storeManaged,sandbox:this.storeSandboxed}),CocoonJS.Store.start()),this.socialService=CocoonJS.SocialGaming.GameCenter,this.socialServiceAvailable=!!this.socialService.nativeExtensionObjectAvailable,this.socialService.onRequestLoginSucceed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCLoginSuccess,t)}),this.socialService.onRequestLoginFailed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCLoginFail,t)}),this.socialService.onLogout.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCLogout,t)}),this.socialService.onRequestUserScoreSucceed.addEventListener(function(e){r=e.score||0,t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCScoreReceived,t)}),this.socialService.onRequestUserScoreFailed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCScoreUnavailable,t)}),this.socialService.onSubmitUserScoreSucceed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCScoreSubmitSuccess,t)}),this.socialService.onSubmitUserScoreFailed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCScoreSubmitFail,t)}),this.socialService.onLeaderboardViewSucceed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCLeaderboardOpen,t)}),this.socialService.onLeaderboardViewClosed.addEventListener(function(){t.runtime.trigger(cr.plugins_.CJSAds.prototype.cnds.OnGCLeaderboardClose,t)}))},t.prototype.IsShowingBanner=function(){return this.isShowingBanner},t.prototype.IsCocoonJS=function(){return this.runtime.isCocoonJs},t.prototype.OnBannerShown=function(){return!0},t.prototype.OnFullscreenShown=function(){return!0},t.prototype.OnFullscreenHidden=function(){return!0},t.prototype.IsShowingFullscreen=function(){return this.isShowingFullscreen},t.prototype.IsStoreAvailable=function(){return!!this.runtime.isCocoonJs&&(this.storeServiceAvailable&&CocoonJS.Store.canPurchase())},t.prototype.OnPurchaseStart=function(t){return this.triggerProduct===t},t.prototype.OnPurchaseComplete=function(t){return this.triggerProduct===t},t.prototype.OnPurchaseFail=function(t){return this.triggerProduct===t},t.prototype.onProductsFetchStarted=function(){return!0},t.prototype.onConsumePurchaseFailed=function(){return!0},t.prototype.onProductsFetchCompleted=function(){return!0},t.prototype.onProductsFetchFailed=function(){return!0},t.prototype.IsProductPurchased=function(t){return!!this.runtime.isCocoonJs&&CocoonJS.Store.isProductPurchased(t)},t.prototype.OnKeyboardCancelled=function(){return!0},t.prototype.OnKeyboardOK=function(){return!0},t.prototype.IsGCAvailable=function(){return this.socialServiceAvailable},t.prototype.IsGCLoggedIn=function(){return!!this.socialServiceAvailable&&this.socialService.isLoggedIn()},t.prototype.OnGCLoginSuccess=function(){return!0},t.prototype.OnGCLoginFail=function(){return!0},t.prototype.OnGCLogout=function(){return!0},t.prototype.OnGCScoreReceived=function(){return!0},t.prototype.OnGCScoreUnavailable=function(){return!0},t.prototype.OnGCScoreSubmitSuccess=function(){return!0},t.prototype.OnGCScoreSubmitFail=function(){return!0},t.prototype.OnGCLeaderboardOpen=function(){return!0},t.prototype.OnGCLeaderboardClose=function(){return!0},l.cnds=new t,e.prototype.ShowBanner=function(t){this.runtime.isCocoonJs&&(o=0===t?CocoonJS.Ad.BannerLayout.TOP_CENTER:CocoonJS.Ad.BannerLayout.BOTTOM_CENTER,a=!1,h?(CocoonJS.Ad.setBannerLayout(o),CocoonJS.Ad.showBanner()):CocoonJS.Ad.preloadBanner())},e.prototype.ShowFullscreen=function(){this.runtime.isCocoonJs&&(!1,c?CocoonJS.Ad.showFullScreen():CocoonJS.Ad.preloadFullScreen())},e.prototype.HideBanner=function(){this.runtime.isCocoonJs&&(CocoonJS.Ad.hideBanner(),this.isShowingBanner=!1)},e.prototype.PreloadBanner=function(){this.runtime.isCocoonJs&&(a=!0,CocoonJS.Ad.preloadBanner())},e.prototype.PreloadFullscreen=function(){this.runtime.isCocoonJs&&(!0,CocoonJS.Ad.preloadFullScreen())},e.prototype.RefreshBanner=function(){this.runtime.isCocoonJs&&CocoonJS.Ad.refreshBanner()},e.prototype.RefreshFullscreen=function(){this.runtime.isCocoonJs&&CocoonJS.Ad.refreshFullScreen()},e.prototype.Purchase=function(t){this.runtime.isCocoonJs&&CocoonJS.Store.purchaseProduct(t)},e.prototype.fetchProductsFromStore=function(t){this.runtime.isCocoonJs&&CocoonJS.Store.fetchProductsFromStore(t.split(","))},e.prototype.restorePurchases=function(){if(this.runtime.isCocoonJs)return CocoonJS.Store.restorePurchases()},e.prototype.PurchasePreview=function(t){this.runtime.isCocoonJs&&CocoonJS.Store.purchaseProductModalWithPreview(t)},e.prototype.RestorePurchases=function(){this.runtime.isCocoonJs&&CocoonJS.Store.restorePurchases()},e.prototype.PromptKeyboard=function(t,e,i,s,n,r){if(this.runtime.isCocoonJs){var o=["text","num","phone","email","url"][s];CocoonJS.App.showTextDialog(t,e,i,o,n,r)}},e.prototype.UpdateProductsList=function(){this.runtime.isCocoonJs&&CocoonJS.Store.canPurchase()&&(n=CocoonJS.Store.getProducts())},e.prototype.GCLogin=function(){this.socialServiceAvailable&&!this.socialService.isLoggedIn()&&this.socialService.requestLogin()},e.prototype.GCLogout=function(){this.socialServiceAvailable&&this.socialService.isLoggedIn()&&this.socialService.requestLogout()},e.prototype.GCSubmitScore=function(t,e){this.socialServiceAvailable&&this.socialService.isLoggedIn()&&this.socialService.submitUserScore(t,e)},e.prototype.GCRequestScore=function(t){this.socialServiceAvailable&&this.socialService.isLoggedIn()&&this.socialService.requestUserScore(t)},e.prototype.GCOpenLeaderboard=function(t){this.socialServiceAvailable&&this.socialService.isLoggedIn()&&this.socialService.showLeaderboardView(t)},l.acts=new e,i.prototype.InputText=function(t){t.set_string(s)},i.prototype.ProductCount=function(t){t.set_int(n.length)},i.prototype.ProductDescription=function(t,e){e=Math.floor(e),e<0||e>=n.length?t.set_string(""):t.set_string(n[e].description)},i.prototype.ProductLocalizedPrice=function(t,e){e=Math.floor(e),e<0||e>=n.length?t.set_string(""):t.set_string(n[e].localizedPrice)},i.prototype.ProductPrice=function(t,e){e=Math.floor(e),e<0||e>=n.length?t.set_string(""):t.set_string(n[e].price)},i.prototype.ProductAlias=function(t,e){e=Math.floor(e),e<0||e>=n.length?t.set_string(""):t.set_string(n[e].productAlias)},i.prototype.ProductID=function(t,e){e=Math.floor(e),e<0||e>=n.length?t.set_string(""):t.set_string(n[e].productId)},i.prototype.ProductTitle=function(t,e){e=Math.floor(e),e<0||e>=n.length?t.set_string(""):t.set_string(n[e].title)},i.prototype.GameCenterScore=function(t){t.set_float(r)},l.exps=new i}(),cr.plugins_.Cookie=function(t){this.runtime=t},function(){var t=cr.plugins_.Cookie.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.value=0};var i=t.Instance.prototype;i.onCreate=function(){},i.draw=function(t){},i.drawGL=function(t){},t.cnds={};var s=t.cnds;s.MyCondition=function(t){return t>=0},t.acts={};var n=t.acts;n.SetCookie=function(t,e,i){if(i){var s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3);var n="; expires="+s.toGMTString()}else n="";document.cookie=t+"="+e+n+"; path=/"},n.DelCookie=function(t){n.SetCookie(t,"",-1)},n.GetCookie=function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0;s<i.length;s++){for(var n=i[s];" "==n.charAt(0);)n=n.substring(1,n.length);0==n.indexOf(e)&&(this.value=n.substring(e.length,n.length))}},t.exps={};var r=t.exps;r.value=function(t){t.set_string(this.value.toString())},r.GetCookie=function(t,e,i){this.value=i||"null";for(var s=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1,o.length);0==o.indexOf(s)&&(this.value=o.substring(s.length,o.length))}t.set_any(this.value)}}(),cr.plugins_.Dictionary=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.Dictionary.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.dictionary={},this.cur_key="",this.key_count=0},r.saveToJSON=function(){return this.dictionary},r.loadFromJSON=function(t){for(var e in this.dictionary=t,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(e)&&this.key_count++},t.prototype.CompareValue=function(t,e,i){return cr.do_cmp(this.dictionary[t],e,i)},t.prototype.ForEachKey=function(){var t=this.runtime.getCurrentEventStack().current_event;for(var e in this.dictionary)this.dictionary.hasOwnProperty(e)&&(this.cur_key=e,this.runtime.pushCopySol(t.solModifiers),t.retrigger(),this.runtime.popSol(t.solModifiers));return this.cur_key="",!1},t.prototype.CompareCurrentValue=function(t,e){return cr.do_cmp(this.dictionary[this.cur_key],t,e)},t.prototype.HasKey=function(t){return this.dictionary.hasOwnProperty(t)},t.prototype.IsEmpty=function(){return 0===this.key_count},s.cnds=new t,e.prototype.AddKey=function(t,e){this.dictionary.hasOwnProperty(t)||this.key_count++,this.dictionary[t]=e},e.prototype.SetKey=function(t,e){this.dictionary.hasOwnProperty(t)&&(this.dictionary[t]=e)},e.prototype.DeleteKey=function(t){this.dictionary.hasOwnProperty(t)&&(delete this.dictionary[t],this.key_count--)},e.prototype.Clear=function(){cr.wipe(this.dictionary),this.key_count=0},e.prototype.JSONLoad=function(t){var e;try{e=JSON.parse(t)}catch(t){return}if(e.c2dictionary)for(var i in this.dictionary=e.data,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(i)&&this.key_count++},e.prototype.JSONDownload=function(t){var e=document.createElement("a");if(void 0===e.download){var i="data:text/html,"+encodeURIComponent("<p><a download='data.json' href=\"data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary}))+'">Download link</a></p>');window.open(i)}else{var s=document.getElementsByTagName("body")[0];e.textContent=t,e.href="data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary})),e.download=t,s.appendChild(e);var n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n),s.removeChild(e)}},s.acts=new e,i.prototype.Get=function(t,e){this.dictionary.hasOwnProperty(e)?t.set_any(this.dictionary[e]):t.set_int(0)},i.prototype.KeyCount=function(t){t.set_int(this.key_count)},i.prototype.CurrentKey=function(t){t.set_string(this.cur_key)},i.prototype.CurrentValue=function(t){this.dictionary.hasOwnProperty(this.cur_key)?t.set_any(this.dictionary[this.cur_key]):t.set_int(0)},i.prototype.AsJSON=function(t){t.set_string(JSON.stringify({c2dictionary:!0,data:this.dictionary}))},s.exps=new i}(),cr.plugins_.Function=function(t){this.runtime=t},function(){function t(){this.name="",this.retVal=0,this.params=[]}function e(){return p++,p===u.length&&u.push(new t),u[p]}function i(){return p<0?null:u[p]}function s(){if(!u.length)return null;var t=p+1;return t>=u.length&&(t=u.length-1),u[t]}function n(){p--}function r(){}function o(){}function a(){}var h=cr.plugins_.Function.prototype;h.Type=function(t){this.plugin=t,this.runtime=t.runtime};var c=h.Type.prototype;c.onCreate=function(){},h.Instance=function(t){this.type=t,this.runtime=t.runtime};var l=h.Instance.prototype,u=[],p=-1;l.onCreate=function(){"undefined"!=typeof cr_is_preview;var t=this;window.c2_callFunction=function(i,s){var r,o,a,h=e();if(h.name=i.toLowerCase(),h.retVal=0,s)for(h.params.length=s.length,r=0,o=s.length;r<o;++r)a=s[r],h.params[r]="number"==typeof a||"string"==typeof a?a:"boolean"==typeof a&&a?1:0;else cr.clearArray(h.params);return t.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,t,h.name),n(),h.retVal}},r.prototype.OnFunction=function(t){var e=i();return!!e&&cr.equals_nocase(t,e.name)},r.prototype.CompareParam=function(t,e,s){var n=i();return!!n&&(t=cr.floor(t),!(t<0||t>=n.params.length)&&cr.do_cmp(n.params[t],e,s))},h.cnds=new r,o.prototype.CallFunction=function(t,i){var s=e();s.name=t.toLowerCase(),s.retVal=0,cr.shallowAssignArray(s.params,i);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,s.name);n()},o.prototype.SetReturnValue=function(t){var e=i();e&&(e.retVal=t)},o.prototype.CallExpression=function(t){},h.acts=new o,a.prototype.ReturnValue=function(t){var e=s();e?t.set_any(e.retVal):t.set_int(0)},a.prototype.ParamCount=function(t){var e=i();e?t.set_int(e.params.length):t.set_int(0)},a.prototype.Param=function(t,e){e=cr.floor(e);var s=i();s&&e>=0&&e<s.params.length?t.set_any(s.params[e]):t.set_int(0)},a.prototype.Call=function(t,i){var s,r,o=e();for(o.name=i.toLowerCase(),o.retVal=0,cr.clearArray(o.params),s=2,r=arguments.length;s<r;s++)o.params.push(arguments[s]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,o.name);n(),t.set_any(o.retVal)},h.exps=new a}(),cr.plugins_.HTML_iFrame_Pode=function(t){this.runtime=t},function(){var t=cr.plugins_.HTML_iFrame_Pode.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=t.Instance.prototype;i.onCreate=function(){this.elem=document.createElement("iframe"),this.elem.src=this.properties[1],this.elem.id=this.uid;var t=this.width>0?1:-1,e=this.height>0?1:-1;this.elem.setAttribute("id",this.properties[3]),this.elem.style.cssText=this.properties[2],this.elem.style.cssText=this.elem.style.cssText+"-webkit-transform:rotate("+this.angle*t*e*180/3.1416+"deg);-moz-transform:rotate("+this.angle*t*e*180/3.1416+"deg);-o-transform:rotate("+this.angle*t*e*180/3.1416+"deg);-ms-transform:rotate("+this.angle*t*e*180/3.1416+"deg);",this.elem.width=Math.round(this.elem.width),this.elem.height=Math.round(this.elem.height),this.elem.x=Math.round(this.elem.x),this.elem.y=Math.round(this.elem.y),jQuery(this.elem).appendTo("body"),0===this.properties[0]&&(jQuery(this.elem).hide(),this.visible=!1),0==this.properties[4]&&(this.elem.scrolling="auto"),1==this.properties[4]&&(this.elem.scrolling="yes"),2==this.properties[4]&&(this.elem.scrolling="no");var i;i=this;this.elem.onclick=function(t){return function(){t.runtime.trigger(cr.plugins_.HTML_iFrame.prototype.cnds.OnClicked,t)}}(this),this.elem.ondblclick=function(t){return function(){t.runtime.trigger(cr.plugins_.HTML_iFrame.prototype.cnds.OnDoubleClicked,t)}}(this),this.updatePosition(),this.runtime.tickMe(this),this.currentURL=this.properties[1]},i.onDestroy=function(){jQuery(this.elem).remove(),this.elem=null},i.tick=function(){this.updatePosition()},i.updatePosition=function(){var t=this.layer.layerToCanvas(this.x,this.y,!0),e=this.layer.layerToCanvas(this.x,this.y,!1),i=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!0),s=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1);if(!this.visible||!this.layer.visible||i<=0||s<=0||t>=this.runtime.width||e>=this.runtime.height)jQuery(this.elem).hide();else{t<1&&(t=1),e<1&&(e=1),i>=this.runtime.width&&(i=this.runtime.width-1),s>=this.runtime.height&&(s=this.runtime.height-1),jQuery(this.elem).show();var n=t+jQuery(this.runtime.canvas).offset().left,r=e+jQuery(this.runtime.canvas).offset().top;jQuery(this.elem).offset({left:n,top:r}),jQuery(this.elem).width(i-t),jQuery(this.elem).height(s-e),this.elem.width=Math.round(this.elem.width),this.elem.height=Math.round(this.elem.height),this.elem.x=Math.round(this.elem.x),this.elem.y=Math.round(this.elem.y)}},i.draw=function(t){},i.drawGL=function(t){},t.cnds={};var s=t.cnds;s.CompareURL=function(t,e){return this.currentURL===t},s.CompareinnerHTML=function(t,e){return this.elem.document.body.innerHTML===t},s.OnClicked=function(){return!0},s.OnDoubleClicked=function(){return!0},s.OnLoaded=function(){return!0},s.isFocused=function(){return this.elem==document.activeElement},t.acts={};var n=t.acts;n.SetURL=function(t){var e;!0,this.elem.src=t,this.currentURL=t,this.elem.onload=(e=this,function(){
e.runtime.trigger(cr.plugins_.HTML_iFrame_Pode.prototype.cnds.OnLoaded,e)})},n.SetVisible=function(t){this.visible=0!==t},n.SetStyle=function(t){this.elem.style.cssText=t},n.GoForward=function(){!0,this.elem.contentWindow.history.forward()},n.GoBackward=function(){!0,this.elem.contentWindow.history.back()},n.Refresh=function(){!0,this.elem.src=this.elem.src+" "},n.setFocus=function(){!0,this.elem.focus()},t.exps={};var r=t.exps;r.innerHTML=function(t){t.set_string(jQuery(this.elem).contents().find("*").html())},r.CurrentURL=function(t){t.set_string(this.currentURL)},r.GetStyle=function(t){t.set_string(this.elem.style.cssText)}}(),cr.plugins_.Keyboard=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}function s(t){switch(t=Math.floor(t),t){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"";case 38:return"";case 39:return"";case 40:return"";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(t)}}var n=cr.plugins_.Keyboard.prototype;n.Type=function(t){this.plugin=t,this.runtime=t.runtime};var r=n.Type.prototype;r.onCreate=function(){},n.Instance=function(t){this.type=t,this.runtime=t.runtime,this.keyMap=new Array(256),this.usedKeys=new Array(256),this.triggerKey=0};var o=n.Instance.prototype;o.onCreate=function(){var t=this;this.runtime.isDomFree||(jQuery(document).keydown(function(e){t.onKeyDown(e)}),jQuery(document).keyup(function(e){t.onKeyUp(e)}))};var a=[32,33,34,35,36,37,38,39,40,44];o.onKeyDown=function(t){var e=!1;if(window!=window.top&&a.indexOf(t.which)>-1&&(t.preventDefault(),e=!0,t.stopPropagation()),this.keyMap[t.which])this.usedKeys[t.which]&&!e&&t.preventDefault();else{this.keyMap[t.which]=!0,this.triggerKey=t.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),s=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=!1,(i||s)&&(this.usedKeys[t.which]=!0,e||t.preventDefault())}},o.onKeyUp=function(t){this.keyMap[t.which]=!1,this.triggerKey=t.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=!1,(e||i||this.usedKeys[t.which])&&(this.usedKeys[t.which]=!0,t.preventDefault())},o.onWindowBlur=function(){var t;for(t=0;t<256;++t)if(this.keyMap[t]){this.keyMap[t]=!1,this.triggerKey=t,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);(e||i)&&(this.usedKeys[t]=!0)}},o.saveToJSON=function(){return{triggerKey:this.triggerKey}},o.loadFromJSON=function(t){this.triggerKey=t.triggerKey},t.prototype.IsKeyDown=function(t){return this.keyMap[t]},t.prototype.OnKey=function(t){return t===this.triggerKey},t.prototype.OnAnyKey=function(t){return!0},t.prototype.OnAnyKeyReleased=function(t){return!0},t.prototype.OnKeyReleased=function(t){return t===this.triggerKey},t.prototype.IsKeyCodeDown=function(t){return t=Math.floor(t),!(t<0||t>=this.keyMap.length)&&this.keyMap[t]},t.prototype.OnKeyCode=function(t){return t===this.triggerKey},t.prototype.OnKeyCodeReleased=function(t){return t===this.triggerKey},n.cnds=new t,n.acts=new e,i.prototype.LastKeyCode=function(t){t.set_int(this.triggerKey)},i.prototype.StringFromKeyCode=function(t,e){t.set_string(s(e))},n.exps=new i}(),cr.plugins_.NinePatch=function(t){this.runtime=t},function(){function t(t,e,i,s,n,r,o,a,h,c){t.save(),t.fillStyle=e;var l=n%i,u=r%s;l<0&&(l+=i),u<0&&(u+=s),t.translate(l+h,u+c),t.fillRect(n-l-h,r-u-c,o,a),t.restore()}function e(){}function i(){}function s(){}var n=cr.plugins_.NinePatch.prototype;n.Type=function(t){this.plugin=t,this.runtime=t.runtime};var r=n.Type.prototype;r.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.fillPattern=null,this.leftPattern=null,this.rightPattern=null,this.topPattern=null,this.bottomPattern=null,this.webGL_texture=null,this.webGL_fillTexture=null,this.webGL_leftTexture=null,this.webGL_rightTexture=null,this.webGL_topTexture=null,this.webGL_bottomTexture=null)},r.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null,this.webGL_fillTexture=null,this.webGL_leftTexture=null,this.webGL_rightTexture=null,this.webGL_topTexture=null,this.webGL_bottomTexture=null)},r.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)))},r.unloadTextures=function(){this.is_family||this.instances.length||this.runtime.glwrap&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.runtime.glwrap.deleteTexture(this.webGL_fillTexture),this.runtime.glwrap.deleteTexture(this.webGL_leftTexture),this.runtime.glwrap.deleteTexture(this.webGL_rightTexture),this.runtime.glwrap.deleteTexture(this.webGL_topTexture),this.runtime.glwrap.deleteTexture(this.webGL_bottomTexture),this.webGL_texture=null,this.webGL_fillTexture=null,this.webGL_leftTexture=null,this.webGL_rightTexture=null,this.webGL_topTexture=null,this.webGL_bottomTexture=null)},r.slicePatch=function(t,e,i,s){var n=document.createElement("canvas"),r=i-t,o=s-e;n.width=r,n.height=o;var a=n.getContext("2d");return a.drawImage(this.texture_img,t,e,r,o,0,0,r,o),n},r.createPatch=function(t,e,i,s){var n=this.texture_img.width,r=this.texture_img.height,o=n-e,a=r-s;if(this.runtime.glwrap){if(this.webGL_fillTexture)return;var h=this.runtime.glwrap,c=this.runtime.linearSampling,l=this.texture_pixelformat;o>t&&a>i&&(this.webGL_fillTexture=h.loadTexture(this.slicePatch(t,i,o,a),!0,c,l)),t>0&&a>i&&(this.webGL_leftTexture=h.loadTexture(this.slicePatch(0,i,t,a),!0,c,l,"repeat-y")),e>0&&a>i&&(this.webGL_rightTexture=h.loadTexture(this.slicePatch(o,i,n,a),!0,c,l,"repeat-y")),i>0&&o>t&&(this.webGL_topTexture=h.loadTexture(this.slicePatch(t,0,o,i),!0,c,l,"repeat-x")),s>0&&o>t&&(this.webGL_bottomTexture=h.loadTexture(this.slicePatch(t,a,o,r),!0,c,l,"repeat-x"))}else{if(this.fillPattern)return;var u=this.runtime.ctx;o>t&&a>i&&(this.fillPattern=u.createPattern(this.slicePatch(t,i,o,a),"repeat")),t>0&&a>i&&(this.leftPattern=u.createPattern(this.slicePatch(0,i,t,a),"repeat")),e>0&&a>i&&(this.rightPattern=u.createPattern(this.slicePatch(o,i,n,a),"repeat")),i>0&&o>t&&(this.topPattern=u.createPattern(this.slicePatch(t,0,o,i),"repeat")),s>0&&o>t&&(this.bottomPattern=u.createPattern(this.slicePatch(t,a,o,r),"repeat"))}},n.Instance=function(t){this.type=t,this.runtime=t.runtime};var o=n.Instance.prototype;o.onCreate=function(){this.leftMargin=this.properties[0],this.rightMargin=this.properties[1],this.topMargin=this.properties[2],this.bottomMargin=this.properties[3],this.edges=this.properties[4],this.fill=this.properties[5],this.visible=0===this.properties[6],this.seamless=0!==this.properties[8],this.recycled?this.rcTex.set(0,0,0,0):this.rcTex=new cr.rect(0,0,0,0),this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat))),this.type.createPatch(this.leftMargin,this.rightMargin,this.topMargin,this.bottomMargin)},o.draw=function(e){var i=this.type.texture_img,s=this.leftMargin,n=this.rightMargin,r=this.topMargin,o=this.bottomMargin,a=i.width,h=i.height,c=a-n,l=h-o;e.globalAlpha=this.opacity,e.save();var u=this.x,p=this.y,d=this.width,f=this.height;this.runtime.pixel_rounding&&(u=Math.round(u),p=Math.round(p));var g=-this.hotspotX*this.width,y=-this.hotspotY*this.height,m=g%a,_=y%h;m<0&&(m+=a),_<0&&(_+=h),e.translate(u+m,p+_);var v=g-m,b=y-_,x=this.seamless?1:0;if(s>0&&r>0&&e.drawImage(i,0,0,s+x,r+x,v,b,s+x,r+x),n>0&&r>0&&e.drawImage(i,c-x,0,n+x,r+x,v+d-n-x,b,n+x,r+x),n>0&&o>0&&e.drawImage(i,c-x,l-x,n+x,o+x,v+d-n-x,b+f-o-x,n+x,o+x),s>0&&o>0&&e.drawImage(i,0,l-x,s+x,o+x,v,b+f-o-x,s+x,o+x),0===this.edges){var w=2===this.fill?0:x;s>0&&l>r&&t(e,this.type.leftPattern,s,l-r,v,b+r,s+w,f-r-o,0,0),n>0&&l>r&&t(e,this.type.rightPattern,n,l-r,v+d-n-w,b+r,n+w,f-r-o,w,0),r>0&&c>s&&t(e,this.type.topPattern,c-s,r,v+s,b,d-s-n,r+w,0,0),o>0&&c>s&&t(e,this.type.bottomPattern,c-s,o,v+s,b+f-o-w,d-s-n,o+w,0,w)}else 1===this.edges&&(s>0&&l>r&&f-r-o>0&&e.drawImage(i,0,r,s,l-r,v,b+r,s,f-r-o),n>0&&l>r&&f-r-o>0&&e.drawImage(i,c,r,n,l-r,v+d-n,b+r,n,f-r-o),r>0&&c>s&&d-s-n>0&&e.drawImage(i,s,0,c-s,r,v+s,b,d-s-n,r),o>0&&c>s&&d-s-n>0&&e.drawImage(i,s,l,c-s,o,v+s,b+f-o,d-s-n,o));l>r&&c>s&&(0===this.fill?t(e,this.type.fillPattern,c-s,l-r,v+s,b+r,d-s-n,f-r-o,0,0):1===this.fill&&d-s-n>0&&f-r-o>0&&e.drawImage(i,s,r,c-s,l-r,v+s,b+r,d-s-n,f-r-o)),e.restore()},o.drawPatch=function(t,e,i,s,n,r,o,a,h,c){t.setTexture(e);var l=this.rcTex;l.left=i/e.c2width,l.top=s/e.c2height,l.right=(i+n)/e.c2width,l.bottom=(s+r)/e.c2height,t.quadTex(o,a,o+h,a,o+h,a+c,o,a+c,l)},o.tilePatch=function(t,e,i,s,n,r,o,a){t.setTexture(e);var h=this.rcTex;h.left=-o/e.c2width,h.top=-a/e.c2height,h.right=(n-o)/e.c2width,h.bottom=(r-a)/e.c2height,t.quadTex(i,s,i+n,s,i+n,s+r,i,s+r,h)},o.drawGL_earlyZPass=function(t){this.drawGL(t)},o.drawGL=function(t){var e=this.leftMargin,i=this.rightMargin,s=this.topMargin,n=this.bottomMargin,r=this.type.texture_img.width,o=this.type.texture_img.height,a=r-i,h=o-n;t.setOpacity(this.opacity);this.rcTex;var c=this.bquad,l=c.tlx,u=c.tly,p=this.width,d=this.height;this.runtime.pixel_rounding&&(l=Math.round(l),u=Math.round(u));var f=this.seamless?1:0;if(e>0&&s>0&&this.drawPatch(t,this.type.webGL_texture,0,0,e+f,s+f,l,u,e+f,s+f),i>0&&s>0&&this.drawPatch(t,this.type.webGL_texture,a-f,0,i+f,s+f,l+p-i-f,u,i+f,s+f),i>0&&n>0&&this.drawPatch(t,this.type.webGL_texture,a-f,h-f,i+f,n+f,l+p-i-f,u+d-n-f,i+f,n+f),e>0&&n>0&&this.drawPatch(t,this.type.webGL_texture,0,h-f,e+f,n+f,l,u+d-n-f,e+f,n+f),0===this.edges){var g=2===this.fill?0:f;e>0&&h>s&&this.tilePatch(t,this.type.webGL_leftTexture,l,u+s,e+g,d-s-n,0,0),i>0&&h>s&&this.tilePatch(t,this.type.webGL_rightTexture,l+p-i-g,u+s,i+g,d-s-n,g,0),s>0&&a>e&&this.tilePatch(t,this.type.webGL_topTexture,l+e,u,p-e-i,s+g,0,0),n>0&&a>e&&this.tilePatch(t,this.type.webGL_bottomTexture,l+e,u+d-n-g,p-e-i,n+g,0,g)}else 1===this.edges&&(e>0&&h>s&&this.drawPatch(t,this.type.webGL_texture,0,s,e,h-s,l,u+s,e,d-s-n),i>0&&h>s&&this.drawPatch(t,this.type.webGL_texture,a,s,i,h-s,l+p-i,u+s,i,d-s-n),s>0&&a>e&&this.drawPatch(t,this.type.webGL_texture,e,0,a-e,s,l+e,u,p-e-i,s),n>0&&a>e&&this.drawPatch(t,this.type.webGL_texture,e,h,a-e,n,l+e,u+d-n,p-e-i,n));h>s&&a>e&&(0===this.fill?this.tilePatch(t,this.type.webGL_fillTexture,l+e,u+s,p-e-i,d-s-n,0,0):1===this.fill&&this.drawPatch(t,this.type.webGL_texture,e,s,a-e,h-s,l+e,u+s,p-e-i,d-s-n))},e.prototype.OnURLLoaded=function(){return!0},n.cnds=new e,i.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},n.acts=new i,n.exps=new s}(),cr.plugins_.Particles=function(t){this.runtime=t},function(){function t(t){this.owner=t,this.active=!1,this.x=0,this.y=0,this.speed=0,this.angle=0,this.opacity=1,this.grow=0,this.size=0,this.gs=0,this.age=0,cr.seal(this)}function e(){}function i(){}function s(){}var n=cr.plugins_.Particles.prototype;n.Type=function(t){this.plugin=t,this.runtime=t.runtime};var r=n.Type.prototype;r.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file))},r.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},r.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)))},r.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},r.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},r.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.prototype.init=function(){var t=this.owner;this.x=t.x-t.xrandom/2+Math.random()*t.xrandom,this.y=t.y-t.yrandom/2+Math.random()*t.yrandom,this.speed=t.initspeed-t.speedrandom/2+Math.random()*t.speedrandom,this.angle=t.angle-t.spraycone/2+Math.random()*t.spraycone,this.opacity=t.initopacity,this.size=t.initsize-t.sizerandom/2+Math.random()*t.sizerandom,this.grow=t.growrate-t.growrandom/2+Math.random()*t.growrandom,this.gs=0,this.age=0},t.prototype.tick=function(t){var e=this.owner;this.x+=Math.cos(this.angle)*this.speed*t,this.y+=Math.sin(this.angle)*this.speed*t,this.y+=this.gs*t,this.speed+=e.acc*t,this.size+=this.grow*t,this.gs+=e.g*t,this.age+=t,this.size<1?this.active=!1:(0!==e.lifeanglerandom&&(this.angle+=Math.random()*e.lifeanglerandom*t-e.lifeanglerandom*t/2),0!==e.lifespeedrandom&&(this.speed+=Math.random()*e.lifespeedrandom*t-e.lifespeedrandom*t/2),0!==e.lifeopacityrandom&&(this.opacity+=Math.random()*e.lifeopacityrandom*t-e.lifeopacityrandom*t/2,this.opacity<0?this.opacity=0:this.opacity>1&&(this.opacity=1)),e.destroymode<=1&&this.age>=e.timeout&&(this.active=!1),2===e.destroymode&&this.speed<=0&&(this.active=!1))},t.prototype.draw=function(t){var e=this.owner.opacity*this.opacity;if(0!==e){0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout),t.globalAlpha=e;var i=this.x-this.size/2,s=this.y-this.size/2;this.owner.runtime.pixel_rounding&&(i=i+.5|0,s=s+.5|0),t.drawImage(this.owner.type.texture_img,i,s,this.size,this.size)}},t.prototype.drawGL=function(t){var e=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout);var i=this.size,s=i*this.owner.particlescale,n=this.x-i/2,r=this.y-i/2;this.owner.runtime.pixel_rounding&&(n=n+.5|0,r=r+.5|0),s<1||0===e||(s<t.minPointSize||s>t.maxPointSize?(t.setOpacity(e),t.quad(n,r,n+i,r,n+i,r+i,n,r+i)):t.point(this.x,this.y,s,e))},t.prototype.left=function(){return this.x-this.size/2},t.prototype.right=function(){return this.x+this.size/2},t.prototype.top=function(){return this.y-this.size/2},t.prototype.bottom=function(){return this.y+this.size/2},n.Instance=function(t){this.type=t,this.runtime=t.runtime};var o=n.Instance.prototype,a=[];o.onCreate=function(){var t=this.properties;if(this.rate=t[0],this.spraycone=cr.to_radians(t[1]),this.spraytype=t[2],this.spraying=!0,this.initspeed=t[3],this.initsize=t[4],this.initopacity=t[5]/100,this.growrate=t[6],this.xrandom=t[7],this.yrandom=t[8],this.speedrandom=t[9],this.sizerandom=t[10],this.growrandom=t[11],this.acc=t[12],this.g=t[13],this.lifeanglerandom=t[14],this.lifespeedrandom=t[15],this.lifeopacityrandom=t[16],this.destroymode=t[17],this.timeout=t[18],this.particleCreateCounter=0,this.particlescale=1,this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,this.add_bbox_changed_callback(function(t){t.bbox.set(t.particleBoxLeft,t.particleBoxTop,t.particleBoxRight,t.particleBoxBottom),t.bquad.set_from_rect(t.bbox),t.bbox_changed=!1,t.update_collision_cell(),t.update_render_cell()}),this.recycled||(this.particles=[]),this.runtime.tickMe(this),this.type.loadTextures(),1===this.spraytype)for(var e=0;e<this.rate;e++)this.allocateParticle().opacity=0;this.first_tick=!0},o.saveToJSON=function(){var t,e,i,s={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},n=s.p;for(t=0,e=this.particles.length;t<e;t++)i=this.particles[t],n.push([i.x,i.y,i.speed,i.angle,i.opacity,i.grow,i.size,i.gs,i.age]);return s},o.loadFromJSON=function(t){var e,i,s,n;this.rate=t.r,this.spraycone=t.sc,this.spraytype=t.st,this.spraying=t.s,this.initspeed=t.isp,this.initsize=t.isz,this.initopacity=t.io,this.growrate=t.gr,this.xrandom=t.xr,this.yrandom=t.yr,this.speedrandom=t.spr,this.sizerandom=t.szr,this.growrandom=t.grnd,this.acc=t.acc,this.g=t.g,this.lifeanglerandom=t.lar,this.lifespeedrandom=t.lsr,this.lifeopacityrandom=t.lor,this.destroymode=t.dm,this.timeout=t.to,this.particleCreateCounter=t.pcc,this.first_tick=t.ft,a.push.apply(a,this.particles),cr.clearArray(this.particles);var r=t.p;for(e=0,i=r.length;e<i;e++)s=this.allocateParticle(),n=r[e],s.x=n[0],s.y=n[1],s.speed=n[2],s.angle=n[3],s.opacity=n[4],s.grow=n[5],s.size=n[6],s.gs=n[7],s.age=n[8]},o.onDestroy=function(){a.push.apply(a,this.particles),cr.clearArray(this.particles)},o.allocateParticle=function(){var e;return a.length?(e=a.pop(),e.owner=this):e=new t(this),this.particles.push(e),e.active=!0,e},o.tick=function(){var t,e,i,s,n,r=this.runtime.getDt(this);if(0===this.spraytype&&this.spraying)for(this.particleCreateCounter+=r*this.rate,s=cr.floor(this.particleCreateCounter),this.particleCreateCounter-=s,t=0;t<s;t++)i=this.allocateParticle(),i.init();for(this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,t=0,n=0,e=this.particles.length;t<e;t++)i=this.particles[t],this.particles[n]=i,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&i.init(),i.tick(r),i.active?(i.left()<this.particleBoxLeft&&(this.particleBoxLeft=i.left()),i.right()>this.particleBoxRight&&(this.particleBoxRight=i.right()),i.top()<this.particleBoxTop&&(this.particleBoxTop=i.top()),i.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=i.bottom()),n++):a.push(i);cr.truncateArray(this.particles,n),this.set_bbox_changed(),this.first_tick=!1,1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)},o.draw=function(t){var e,i,s,n=this.layer;for(e=0,i=this.particles.length;e<i;e++)s=this.particles[e],s.right()>=n.viewLeft&&s.bottom()>=n.viewTop&&s.left()<=n.viewRight&&s.top()<=n.viewBottom&&s.draw(t)},o.drawGL=function(t){this.particlescale=this.layer.getScale(),t.setTexture(this.type.webGL_texture);var e,i,s,n=this.layer;for(e=0,i=this.particles.length;e<i;e++)s=this.particles[e],s.right()>=n.viewLeft&&s.bottom()>=n.viewTop&&s.left()<=n.viewRight&&s.top()<=n.viewBottom&&s.drawGL(t)},e.prototype.IsSpraying=function(){return this.spraying},n.cnds=new e,i.prototype.SetSpraying=function(t){this.spraying=0!==t},i.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},i.prototype.SetRate=function(t){var e,i;if(this.rate=t,1===this.spraytype&&this.first_tick)if(t<this.particles.length)for(e=this.particles.length-t,i=0;i<e;i++)a.push(this.particles.pop());else if(t>this.particles.length)for(e=t-this.particles.length,i=0;i<e;i++)this.allocateParticle().opacity=0},i.prototype.SetSprayCone=function(t){this.spraycone=cr.to_radians(t)},i.prototype.SetInitSpeed=function(t){this.initspeed=t},i.prototype.SetInitSize=function(t){this.initsize=t},i.prototype.SetInitOpacity=function(t){this.initopacity=t/100},i.prototype.SetGrowRate=function(t){this.growrate=t},i.prototype.SetXRandomiser=function(t){this.xrandom=t},i.prototype.SetYRandomiser=function(t){this.yrandom=t},i.prototype.SetSpeedRandomiser=function(t){this.speedrandom=t},i.prototype.SetSizeRandomiser=function(t){this.sizerandom=t},i.prototype.SetGrowRateRandomiser=function(t){this.growrandom=t},i.prototype.SetParticleAcc=function(t){this.acc=t},i.prototype.SetGravity=function(t){this.g=t},i.prototype.SetAngleRandomiser=function(t){this.lifeanglerandom=t},i.prototype.SetLifeSpeedRandomiser=function(t){this.lifespeedrandom=t},i.prototype.SetOpacityRandomiser=function(t){this.lifeopacityrandom=t},i.prototype.SetTimeout=function(t){this.timeout=t},n.acts=new i,s.prototype.ParticleCount=function(t){t.set_int(this.particles.length)},s.prototype.Rate=function(t){t.set_float(this.rate)},s.prototype.SprayCone=function(t){t.set_float(cr.to_degrees(this.spraycone))},s.prototype.InitSpeed=function(t){t.set_float(this.initspeed)},s.prototype.InitSize=function(t){t.set_float(this.initsize)},s.prototype.InitOpacity=function(t){t.set_float(100*this.initopacity)},s.prototype.InitGrowRate=function(t){t.set_float(this.growrate)},s.prototype.XRandom=function(t){t.set_float(this.xrandom)},s.prototype.YRandom=function(t){t.set_float(this.yrandom)},s.prototype.InitSpeedRandom=function(t){t.set_float(this.speedrandom)},s.prototype.InitSizeRandom=function(t){t.set_float(this.sizerandom)},s.prototype.InitGrowRandom=function(t){t.set_float(this.growrandom)},s.prototype.ParticleAcceleration=function(t){t.set_float(this.acc)},s.prototype.Gravity=function(t){t.set_float(this.g)},s.prototype.ParticleAngleRandom=function(t){t.set_float(this.lifeanglerandom)},s.prototype.ParticleSpeedRandom=function(t){t.set_float(this.lifespeedrandom)},s.prototype.ParticleOpacityRandom=function(t){t.set_float(this.lifeopacityrandom)},s.prototype.Timeout=function(t){t.set_float(this.timeout)},n.exps=new s}(),cr.plugins_.Rex_CSV=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.Rex_CSV.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.isInPreview="undefined"!=typeof cr_is_preview,this.strDelimiter=this.properties[0],this._tables={},this.current_page_name=null,this.current_table=null,this.forPage="",this.atCol="",this.atRow="",this.atPage="",this.TurnPage("_"),this.check_name="CSV"},r.TurnPage=function(t){null==this._tables[t]&&(this._tables[t]=new cr.plugins_.Rex_CSV.CSVKlass(this)),this.current_page_name=t,this.current_table=this._tables[t]},r.Get=function(t,e,i){return this.atCol=t,this.atRow=e,null!=i&&this.TurnPage(i),this.atPage=this.current_page_name,this.current_table.At(t,e)},r.Set=function(t,e,i,s){this.atCol=e,this.atRow=i,null!=s&&this.TurnPage(s),this.atPage=this.current_page_name,this.current_table.SetEntry(e,i,t)},r.GetColCnt=function(t){return null!=t&&this.TurnPage(t),this.atPage=this.current_page_name,this.current_table.GetColCnt()},r.GetRowCnt=function(t){return null!=t&&this.TurnPage(t),this.atPage=this.current_page_name,this.current_table.GetRowCnt()},r.TableToString=function(t){return null!=t&&this.TurnPage(t),this.current_table.ToString()},r.saveToJSON=function(){var t,e={};for(t in this._tables)this.TurnPage(t),e[t]={d:this.current_table.table,k:this.current_table.keys,i:this.current_table.items};return{d:e}},r.loadFromJSON=function(t){var e,i,s=t.d;for(i in s)this.TurnPage(i),e=s[i],this.current_table.table=e.d,this.current_table.keys=e.k,this.current_table.items=e.i},s.cnds=new t,t.prototype.ForEachCol=function(){return this.current_table.ForEachCol(),!1},t.prototype.ForEachRowInCol=function(t){return this.current_table.ForEachRowInCol(t),!1},t.prototype.ForEachPage=function(){var t=this.runtime.getCurrentEventStack(),e=t.current_event,i=t.isModifierAfterCnds();this.forPage="";var s,n=this._tables;if(i)for(s in n)this.runtime.pushCopySol(e.solModifiers),this.forPage=s,this.TurnPage(s),e.retrigger(),this.runtime.popSol(e.solModifiers);else for(s in n)this.forPage=s,this.TurnPage(s),e.retrigger();return this.forPage="",!1},t.prototype.ForEachRow=function(){return this.current_table.ForEachRow(),!1},t.prototype.ForEachColInRow=function(t){return this.current_table.ForEachColInRow(t),!1},t.prototype.IsDataInCol=function(t,e){if(-1==this.current_table.keys.indexOf(e))return!1;var i,s=this.current_table.table,n=s[e],r=!1;for(i in n)if(n[i]==t){r=!0;break}return r},t.prototype.IsDataInRow=function(t,e){if(-1==this.current_table.items.indexOf(e))return!1;var i,s=this.current_table.table,n=!1;for(i in s)if(s[i][e]==t){n=!0;break}return n},t.prototype.IsKeyInCol=function(t){return-1!=this.current_table.keys.indexOf(t)},t.prototype.IsKeyInRow=function(t){return-1!=this.current_table.items.indexOf(t)},t.prototype.IsEntryValid=function(t,e){return-1!=this.current_table.keys.indexOf(key)&&-1!=this.current_table.items.indexOf(key)},s.acts=new e,e.prototype.LoadCSV=function(t){this.current_table._parsing(t)},e.prototype.SetEntry=function(t,e,i){this.current_table.SetEntry(t,e,i)},e.prototype.Clear=function(){this.current_table.Clear()},e.prototype.ConvertType=function(t,e){this.current_table.ConvertType(t,e)},e.prototype.TurnPage=function(t){this.TurnPage(t)},e.prototype.StringToPage=function(t){this.current_table.JSONString2Page(t)},e.prototype.StringToPage=function(t){this.current_table.JSONString2Page(t)},e.prototype.AppendCol=function(t,e){this.current_table.AppendCol(t,e)},e.prototype.AppendRow=function(t,e){this.current_table.AppendRow(t,e)},e.prototype.RemoveCol=function(t){this.current_table.RemoveCol(t)},e.prototype.RemoveRow=function(t){this.current_table.RemoveRow(t)},e.prototype.SetDelimiter=function(t){this.strDelimiter=t},e.prototype.StringToAllTables=function(t){var e,i=JSON.parse(t);for(e in i)this.TurnPage(e),this.current_table.JSONString2Page(i[e])},e.prototype.SortCol=function(t,e){this.current_table.SortCol(t,e)},e.prototype.SortRow=function(t,e){this.current_table.SortRow(t,e)},e.prototype.SetEntryAtPage=function(t,e,i,s){this.TurnPage(i),this.current_table.SetEntry(t,e,s)},s.exps=new i,i.prototype.At=function(t,e,i,s,n){var r=this.Get(e,i,s);null==r&&(r=null==n?0:n),t.set_any(r)},i.prototype.CurCol=function(t){t.set_string(this.current_table.forCol)},i.prototype.CurRow=function(t){t.set_string(this.current_table.forRow)},i.prototype.CurValue=function(t){t.set_any(this.current_table.At(this.current_table.forCol,this.current_table.forRow))},i.prototype.AtCol=function(t){t.set_string(this.atCol)},i.prototype.AtRow=function(t){t.set_string(this.atRow)},i.prototype.AtPage=function(t){t.set_string(this.atPage)},i.prototype.CurPage=function(t){t.set_string(this.forPage)},i.prototype.TableToString=function(t,e){t.set_string(this.TableToString(e))},i.prototype.ColCnt=function(t,e){t.set_int(this.GetColCnt(e))},i.prototype.RowCnt=function(t,e){t.set_int(this.GetRowCnt(e))},i.prototype.Delimiter=function(t,e){t.set_string(this.strDelimiter)},i.prototype.AllTalbesToString=function(t){var e,i={};for(e in this._tables)i[e]=this.TableToString(e);t.set_string(JSON.stringify(i))}}(),function(){cr.plugins_.Rex_CSV.CSVKlass=function(t){this.plugin=t,this.table={},this.keys=[],this.items=[],this.forCol="",this.forRow=""};var t=cr.plugins_.Rex_CSV.CSVKlass.prototype;t.Clear=function(){var t;for(t in this.table)delete this.table[t];this.keys.length=0,this.items.length=0},t.ToString=function(){var t={table:this.table,keys:this.keys,items:this.items};return JSON.stringify(t)},t.JSONString2Page=function(t){var e=JSON.parse(t);try{this.table=e.table,this.keys=e.keys,this.items=e.items}catch(t){this.table=e}},t._create_keys=function(){var t,e,i=this.keys,s=this.keys.length;for(t=0;t<s;t++)e=i[t],null==this.table[e]&&(this.table[e]={})},t._create_items=function(t){var e,i=t.shift(),s=this.keys,n=this.keys.length,r=this.table;for(e=0;e<n;e++)r[s[e]][i]=t[e];this.items.push(i)},t._parsing=function(t){if(""!=t){var e=a(t,this.plugin.strDelimiter);this.keys=e.shift(),this._create_keys();var i,s=e.length;for(i=0;i<s;i++)this._create_items(e[i])}},t.At=function(t,e){var i;return i=this.table[t],null==i?null:(i=i[e],null==i?null:i)},t.SetEntry=function(t,e,i){var s;s=this.table[t],null!=s&&(s=s[e],null!=s&&(this.table[t][e]=i))},t.ConvertType=function(t,e){var i,s,n=0==e?parseInt:parseFloat,r=this.keys,o=r.length,a=this.table;for(i=0;i<o;i++)s=a[r[i]][t],a[r[i]][t]=n(s)},t.AppendCol=function(t,e){if(-1==this.keys.indexOf(t)){var i=!1;if(this.keys.length>0){var s=this.table[this.keys[0]];i=!0}var n,r={},o=this.items,a=o.length;for(n=0;n<a;n++)i?"number"==typeof s[o[n]]?r[o[n]]=0:r[o[n]]="":r[o[n]]=e;this.table[t]=r,this.keys.push(t)}},t.AppendRow=function(t,e){if(-1==this.items.indexOf(t)){var i,s=this.keys,n=s.length,r=this.table;for(i=0;i<n;i++)r[s[i]][t]=e;this.items.push(t)}},t.RemoveCol=function(t){var e=this.keys.indexOf(t);-1!=e&&(delete this.table[t],this.keys.splice(e,1))},t.RemoveRow=function(t){var e=this.items.indexOf(t);if(-1!=e){var i,s=this.keys,n=s.length,r=this.table;for(i=0;i<n;i++)delete r[s[i]][t];this.items.splice(e,1)}},t.ForEachCol=function(){var t=this.plugin.runtime.getCurrentEventStack(),e=t.current_event,i=t.isModifierAfterCnds();this.forCol="";var s,n=this.keys,r=n.length;if(i)for(s=0;s<r;s++)this.plugin.runtime.pushCopySol(e.solModifiers),this.forCol=n[s],e.retrigger(),this.plugin.runtime.popSol(e.solModifiers);else for(s=0;s<r;s++)this.forCol=n[s],e.retrigger();this.forCol=""},t.ForEachRowInCol=function(t){var e=-1!=this.keys.indexOf(t);if(e){var i=this.plugin.runtime.getCurrentEventStack(),s=i.current_event,n=i.isModifierAfterCnds();this.forRow="";var r,o=this.items,a=o.length;if(n)for(r=0;r<a;r++)this.plugin.runtime.pushCopySol(s.solModifiers),this.forRow=o[r],s.retrigger(),this.plugin.runtime.popSol(s.solModifiers);else for(r=0;r<a;r++)this.forRow=o[r],s.retrigger();this.forRow=""}},t.ForEachRow=function(){var t=this.plugin.runtime.getCurrentEventStack(),e=t.current_event,i=t.isModifierAfterCnds();this.forRow="";var s,n=this.items,r=n.length;if(i)for(s=0;s<r;s++)this.plugin.runtime.pushCopySol(e.solModifiers),this.forRow=n[s],e.retrigger(),this.plugin.runtime.popSol(e.solModifiers);else for(s=0;s<r;s++)this.forRow=n[s],e.retrigger();this.forRow=""},t.ForEachColInRow=function(t){var e=-1!=this.items.indexOf(t);if(e){var i=this.plugin.runtime.getCurrentEventStack(),s=i.current_event,n=i.isModifierAfterCnds();this.forCol="";var r,o=this.keys,a=o.length;if(n)for(r=0;r<a;r++)this.plugin.runtime.pushCopySol(s.solModifiers),this.forCol=o[r],s.retrigger(),this.plugin.runtime.popSol(s.solModifiers);else for(r=0;r<a;r++)this.forCol=o[r],s.retrigger();this.forCol=""}},t.GetColCnt=function(){return this.keys.length},t.GetRowCnt=function(){return this.items.length};var e=null,i="",s="",n=!0,r=function(t,s){
var r=e[i][t],o=e[i][s];return r>o?n?1:-1:r<o?n?-1:1:0},o=function(t,i){var r=e[t][s],o=e[i][s];return r>o?n?1:-1:r<o?n?-1:1:0};t.SortCol=function(t,s){var o=-1!=this.keys.indexOf(t);o&&(e=this.table,i=t,n=0==s,this.items.sort(r))},t.SortRow=function(t,i){var r=-1!=this.items.indexOf(t);r&&(e=this.table,s=t,n=0==i,this.keys.sort(o))};var a=function(t,e){e=e||",";for(var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),s=[[]],n=null;n=i.exec(t);){var r=n[1];if(r.length&&r!=e&&s.push([]),n[2])var o=n[2].replace(new RegExp('""',"g"),'"');else o=n[3];s[s.length-1].push(o)}return s}}(),cr.plugins_.Rex_CSV2Array=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.Rex_CSV2Array.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.exp_CurX=0,this.exp_CurY=0,this.exp_CurValue=""};var o=function(t,e){e=e||",";for(var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),s=[[]],n=null;n=i.exec(t);){var r=n[1];if(r.length&&r!=e&&s.push([]),n[2])var o=n[2].replace(new RegExp('""',"g"),'"');else o=n[3];s[s.length-1].push(o)}return s};s.cnds=new t,t.prototype.ForEachCell=function(t){var e,i,s=o(t),n=s.length,r=s[0].length,a=this.runtime.getCurrentEventStack(),h=a.current_event,c=a.isModifierAfterCnds();if(this.forCol="",c)for(i=0;i<n;i++)for(this.exp_CurY=i,e=0;e<r;e++)this.runtime.pushCopySol(h.solModifiers),this.exp_CurX=e,this.exp_CurValue=s[i][e],h.retrigger(),this.runtime.popSol(h.solModifiers);else for(i=0;i<n;i++)for(this.exp_CurY=i,e=0;e<r;e++)this.exp_CurX=e,this.exp_CurValue=s[i][e],h.retrigger();return this.forCol="",!1},s.acts=new e,e.prototype.CSV2Array=function(t,e,i){var s=e.getFirstPicked();if(null!=s.arr){var n,r,a=o(t),h=a.length,c=a[0].length;0==i?cr.plugins_.Arr.prototype.acts.SetSize.apply(s,[h,c,1]):cr.plugins_.Arr.prototype.acts.SetSize.apply(s,[c,h,1]);var l=cr.plugins_.Arr.prototype.acts.SetXYZ;if(0==i)for(r=0;r<c;r++)for(n=0;n<h;n++)l.apply(s,[n,r,0,a[n][r]]);else for(r=0;r<c;r++)for(n=0;n<h;n++)l.apply(s,[r,n,0,a[n][r]])}else alert("CSV2Array need an array object.")},s.exps=new i,i.prototype.CurX=function(t){t.set_int(this.exp_CurX)},i.prototype.CurY=function(t){t.set_int(this.exp_CurY)},i.prototype.CurValue=function(t){t.set_string(this.exp_CurValue)}}(),cr.plugins_.Rex_Hash=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.Rex_Hash.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){var t=this.properties[0];this.hashtable=""!=t?JSON.parse(t):{},this._current_entry=this.hashtable,this.exp_CurKey="",this.exp_CurValue=0},r._clean_all=function(){var t;for(t in this.hashtable)delete this.hashtable[t];this._current_entry=this.hashtable},r._set_entry_byKeys=function(t){var e,i,s=t.length,n=this.hashtable;for(e=0;e<s;e++)i=t[e],null!=n[i]&&"object"==typeof n[i]||(n[i]={}),n=n[i];this._current_entry=n},r._set_current_entey=function(t){if(this._current_key=t,""!=t){var e=t.split(".");this._set_entry_byKeys(e)}else this._current_entry=this.hashtable},r._sortNumerically=function(t,e){var i,s,n,r,o,a=0,h=/(\d+)|(\D+)/g,c=/\d/;if(isFinite(t)&&isFinite(e))return t-e;if(i=String(t).toLowerCase(),s=String(e).toLowerCase(),i===s)return 0;if(!c.test(i)||!c.test(s))return i>s?1:-1;for(i=i.match(h),s=s.match(h),o=i.length>s.length?s.length:i.length;a<o;)if(n=i[a],r=s[a++],n!==r)return isFinite(n)&&isFinite(r)?("0"===n.charAt(0)&&(n="."+n),"0"===r.charAt(0)&&(r="."+r),n-r):n>r?1:-1;return i.length-s.length},r._get_data=function(t){if(1==t.length&&""==t[0])return this.hashtable;var e,i=t.length,s=this.hashtable;for(e=0;e<i;e++)if(s=s[t[e]],null==s||"object"!=typeof s&&e!=i-1)return null;return s};var o=function(t){if(null==t)return-1;if("number"==typeof t||"string"==typeof t)return 0;if(null!=t.length)return t.length;var e,i=0;for(e in t)i+=1;return i};r.saveToJSON=function(){return{d:this.hashtable}},r.loadFromJSON=function(t){this.hashtable=t.d},s.cnds=new t,t.prototype.ForEachKey=function(t){this._set_current_entey(t);var e,i=this.runtime.getCurrentEventStack(),s=i.current_event,n=i.isModifierAfterCnds();if(n)for(t in this._current_entry)e=this._current_entry[t],this.runtime.pushCopySol(s.solModifiers),this.exp_CurKey=t,this.exp_CurValue=e,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(t in this._current_entry)e=this._current_entry[t],this.exp_CurKey=t,this.exp_CurValue=e,s.retrigger();return this.exp_CurKey="",this.exp_CurValue=0,!1},t.prototype.ForEachKeyOrdered=function(t,e){this._set_current_entey(t);var i,s=this.runtime.getCurrentEventStack(),n=s.current_event,r=s.isModifierAfterCnds(),o=Object.keys(this._current_entry);switch(e){case 3:o.sort(this._sortNumerically),o.reverse();break;case 2:o.sort(this._sortNumerically);break;case 1:o.sort(),o.reverse();break;case 0:default:o.sort()}if(r)for(t in o)i=this._current_entry[o[t]],this.runtime.pushCopySol(n.solModifiers),this.exp_CurKey=o[t],this.exp_CurValue=i,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(t in o)i=this._current_entry[o[t]],this.exp_CurKey=o[t],this.exp_CurValue=i,n.retrigger();return this.exp_CurKey="",this.exp_CurValue=0,!1},t.prototype.KeyExists=function(t){if(""==t)return!1;var e=this._get_data(t.split("."));return null!=e},s.acts=new e,e.prototype.SetByKeyString=function(t,e){if(""!=t){var i=t.split("."),s=i.splice(i.length-1,1);this._set_entry_byKeys(i),this._current_entry[s]=e}},e.prototype.SetCurHashEntey=function(t){this._set_current_entey(t)},e.prototype.SetValueInCurHashEntey=function(t,e){if(key=t?this._current_key+"."+t:this._current_key,""!=t){var i=key.split("."),s=i.splice(i.length-1,1);this._set_entry_byKeys(i),this._current_entry[s]=e}},e.prototype.CleanAll=function(){this._clean_all()},e.prototype.StringToHashTable=function(t){""!=t?this.hashtable=JSON.parse(t):this._clean_all()},e.prototype.InjectToKeyString=function(t,e){if(""!=t){var i=t.split("."),s=i.splice(i.length-1,1);this._set_entry_byKeys(i),this._current_entry[s]=JSON.parse(e)}},e.prototype.RemoveByKeyString=function(t){if(""!=t){var e=t.split("."),i=e.splice(e.length-1,1);this._set_entry_byKeys(e),delete this._current_entry[i]}},e.prototype.PickKeysToArray=function(t,e){if(i){var i=e.getFirstPicked();for(t in cr.plugins_.Arr.prototype.acts.SetSize.apply(i,[0,1,1]),this._set_current_entey(t),this._current_entry)cr.plugins_.Arr.prototype.acts.Push.apply(i,[0,t,0])}};var a=function(t,e){var i=[];return cr.shallowAssignArray(i,t),i.push(e),i};e.prototype.MergeTwoHashTable=function(t,e){if(t){var i,s,n,r,o,h=t.getFirstPicked(),c=[];switch(2==e&&(this._clean_all(),e=0),e){case 0:for(c.push({table:h.hashtable,entry:[]});0!=c.length;)for(r in i=c.shift(),s=i.table,n=i.entry,s)o=s[r],"object"!=typeof o?(this._set_entry_byKeys(n),this._current_entry[r]=o):c.push({table:o,entry:a(n,r)});break;case 1:for(c.push({table:h.hashtable,entry:[]});0!=c.length;)for(r in i=c.shift(),s=i.table,n=i.entry,s)if(o=s[r],"object"!=typeof o){var l=this._get_data(a(n,r));null==l&&(this._set_entry_byKeys(n),this._current_entry[r]=o)}else c.push({table:o,entry:a(n,r)})}}},s.exps=new i,i.prototype.Hash=function(t,e,i){var s=e.split("."),n=this._get_data(s);"object"==typeof n?n=JSON.stringify(n):"number"!=typeof n&&"string"!=typeof n&&(n=i),t.set_any(n)},i.prototype.At=function(t,e,i){void 0===i&&(i="null");var s=e.split("."),n=this._get_data(s);"object"==typeof n?n=null==n?i:JSON.stringify(n):"number"!=typeof n&&"string"!=typeof n&&(n=i),t.set_any(n)},i.prototype.AtKeys=function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,1):[e],s=this._get_data(i);"object"==typeof s&&(s=JSON.stringify(s)),t.set_any(s)},i.prototype.Entry=function(t,e){if(key=e?this._current_key+"."+e:this._current_key,""!=key){var i=key.split("."),s=i.splice(i.length-1,1);this._set_entry_byKeys(i),t.set_any(this._current_entry[s])}},i.prototype.HashTableToString=function(t){var e=JSON.stringify(this.hashtable);t.set_string(e)},i.prototype.CurKey=function(t){t.set_string(this.exp_CurKey)},i.prototype.CurValue=function(t){t.set_any(this.exp_CurValue)},i.prototype.ItemCnt=function(t,e){var i=e.split("."),s=o(this._get_data(i));t.set_int(s)},i.prototype.Keys2ItemCnt=function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,1):[e],s=o(this._get_data(i));t.set_int(s)},i.prototype.ToString=function(t){var e;if(1==arguments.length)e=this.hashtable;else{var i,s=arguments.length;for(e={},i=1;i<s;i+=2)e[arguments[i]]=arguments[i+1]}t.set_string(JSON.stringify(e))}}(),cr.plugins_.Rex_Nickname=function(t){this.runtime=t},cr.plugins_.Rex_Nickname.nickname2objtype={},cr.plugins_.Rex_Nickname.sid2nickname={},cr.plugins_.Rex_Nickname.AddNickname=function(t,e){cr.plugins_.Rex_Nickname.nickname2objtype[t]={sid:e.sid,index:-1},cr.plugins_.Rex_Nickname.sid2nickname[e.sid.toString()]=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.Rex_Nickname.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.nickname2objtype=cr.plugins_.Rex_Nickname.nickname2objtype,this.sid2nickname=cr.plugins_.Rex_Nickname.sid2nickname,this.exp_LastCreatedInstUID=-1},r.Nickname2Type=function(t){var e=this.nickname2objtype[t];if(null==e)return null;var i=e.sid,s=this.runtime.types_by_index,n=s[e.index];if(null!=n&&n.sid===i)return n;var r,o=s.length;for(r=0;r<o;r++)if(n=s[r],n.sid===i)return e.index=r,n;return null},r.CreateInst=function(t,e,i,s,n,r){var o="string"==typeof t?this.Nickname2Type(t):t;if(null==o)return null;var a=window.RexC2CreateObject.call(this,o,s,e,i,n,r);return a};var o=function(t,e){return!(!t||!e)&&(t.is_family?-1!=t.members.indexOf(e):t===e)},a=function(t){var e=t.getCurrentSol();e.select_all=!1,e.instances.length=0},h=function(t,e){var i=t.getCurrentSol(),s=i.instances;s.push.apply(s,e),i.select_all=!1},c=function(t){return t.getCurrentSol().instances.length>0};r.PickAll=function(t,e){var i=this.Nickname2Type(t);if(o(e,i))if(e.is_family){var s=i.getCurrentSol(),n=s.select_all;s.select_all=!0,a(e),h(e,s.getObjects()),s.select_all=n}else{s=e.getCurrentSol();s.select_all=!0}else a(e);return c(e)},r.PickMatched=function(t,e){if(e.is_family){var i,s;for(n in a(e),this.nickname2objtype)null!=n.match(t)&&(i=this.Nickname2Type(n),o(e,i)&&(r=i.getCurrentSol(),s=r.select_all,r.select_all=!0,h(e,r.getObjects()),r.select_all=s))}else{var n=this.sid2nickname[e.sid];if(null!=n&&null!=n.match(t)){var r=e.getCurrentSol();r.select_all=!0}else a(e)}return c(e)},r.saveToJSON=function(){return{sid2name:this.sid2nickname}},r.loadFromJSON=function(t){var e,i,s=t.sid2name;for(e in this.sid2nickname=s,s)i=s[e],this.nickname2objtype[i]={sid:parseInt(e,10),index:-1}},s.cnds=new t,t.prototype.IsNicknameValid=function(t){return null!=this.nickname2objtype[t]},t.prototype.Pick=function(t,e){return this.PickAll(t,e)},t.prototype.PickMatched=function(t,e){return this.PickMatched(t,e)},s.acts=new e,e.prototype.AssignNickname=function(t,e){null!=e&&cr.plugins_.Rex_Nickname.AddNickname(t,e)},e.prototype.CreateInst=function(t,e,i,s,n){var r=this.CreateInst(t,e,i,s,null,!0);this.exp_LastCreatedInstUID=r?r.uid:-1,n&&(null!=r&&o(n,r.type)?(n.getCurrentSol().pick_one(r),n.applySolToContainer()):a(n))},e.prototype.Pick=function(t,e){this.PickAll(t,e)},e.prototype.PickMatched=function(t,e){this.PickMatched(t,e)},s.exps=new i,i.prototype.LastCreatedInstUID=function(t){t.set_int(this.exp_LastCreatedInstUID)}}(),function(){if(null==window.RexC2CreateObject){var t=function(t,e,i,s,n,r){if(e&&t){var o=this.runtime.createInstance(t,e,i,s);if(o){var a,h,c;if(this.runtime.isInOnDestroy++,n&&n(o),this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,o),o.is_contained)for(a=0,h=o.siblings.length;a<h;a++)c=o.siblings[a],this.runtime.trigger(Object.getPrototypeOf(c.type.plugin).cnds.OnCreated,c);if(this.runtime.isInOnDestroy--,!0!==r){var l=t.getCurrentSol();if(l.select_all=!1,l.instances.length=1,l.instances[0]=o,o.is_contained)for(a=0,h=o.siblings.length;a<h;a++)c=o.siblings[a],l=c.type.getCurrentSol(),l.select_all=!1,l.instances.length=1,l.instances[0]=c}return o}}};window.RexC2CreateObject=t}}(),cr.plugins_.Sprite=function(t){this.runtime=t},function(){function t(){if(0===this.datauri.length){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var e=t.getContext("2d");this.spritesheeted?e.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):e.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=t.toDataURL("image/png")}return this.datauri}function e(){}function i(){return y.length?y.pop():[0,0,0]}function s(t){t[0]=0,t[1]=0,t[2]=0,y.push(t)}function n(t,e){return t<e?t+","+e:e+","+t}function r(t,e,s,r){var o=e.uid,a=s.uid,h=n(o,a);if(t.hasOwnProperty(h))t[h][2]=r;else{var c=i();c[0]=o,c[1]=a,c[2]=r,t[h]=c}}function o(t,e,i){var r=n(e.uid,i.uid);t.hasOwnProperty(r)&&(s(t[r]),delete t[r])}function a(t,e){var i,n,r=e.uid;for(i in t)t.hasOwnProperty(i)&&(n=t[i],n[0]!==r&&n[1]!==r||(s(t[i]),delete t[i]))}function h(t,e,i){var s=n(e.uid,i.uid);return t.hasOwnProperty(s)?(m=t[s][2],!0):(m=-2,!1)}function c(t,e,i){if(!t)return!1;var s,n,r,o,a,h,c=0!==e||0!==i,l=!1,u=this.runtime.getCurrentCondition(),p=u.type,d=u.inverted,f=t.getCurrentSol(),g=this.runtime.getCurrentEventStack().current_event.orblock;for(f.select_all?(this.update_bbox(),S.copy(this.bbox),S.offset(e,i),this.runtime.getCollisionCandidates(this.layer,t,S,w),h=w):h=g?this.runtime.isCurrentConditionFirst()&&!f.else_instances.length&&f.instances.length?f.instances:f.else_instances:f.instances,v=t,x=p!==t&&!d,c&&(s=this.x,n=this.y,this.x+=e,this.y+=i,this.set_bbox_changed()),r=0,o=h.length;r<o;r++)if(a=h[r],this.runtime.testOverlap(this,a)){if(l=!0,d)break;p!==t&&b.add(a)}return c&&(this.x=s,this.y=n,this.set_bbox_changed()),cr.clearArray(w),l}function l(){}function u(){}var p=cr.plugins_.Sprite.prototype;p.Type=function(t){this.plugin=t,this.runtime=t.runtime};var d=p.Type.prototype;d.onCreate=function(){var e,i,s,n,r,o,a,h,c,l;if(!this.is_family)for(this.all_frames=[],this.has_loaded_textures=!1,e=0,i=this.animations.length;e<i;e++){for(r=this.animations[e],a={},a.name=r[0],a.speed=r[1],a.loop=r[2],a.repeatcount=r[3],a.repeatto=r[4],a.pingpong=r[5],a.sid=r[6],a.frames=[],s=0,n=r[7].length;s<n;s++)o=r[7][s],h={},h.texture_file=o[0],h.texture_filesize=o[1],h.offx=o[2],h.offy=o[3],h.width=o[4],h.height=o[5],h.duration=o[6],h.hotspotX=o[7],h.hotspotY=o[8],h.image_points=o[9],h.poly_pts=o[10],h.pixelformat=o[11],h.spritesheeted=0!==h.width,h.datauri="",h.getDataUri=t,l={},l.left=0,l.top=0,l.right=1,l.bottom=1,h.sheetTex=l,h.webGL_texture=null,c=this.runtime.findWaitingTexture(o[0]),c?h.texture_img=c:(h.texture_img=new Image,h.texture_img.cr_src=o[0],h.texture_img.cr_filesize=o[1],h.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(h.texture_img,o[0])),cr.seal(h),a.frames.push(h),this.all_frames.push(h);cr.seal(a),this.animations[e]=a}},d.updateAllCurrentTexture=function(){var t,e,i;for(t=0,e=this.instances.length;t<e;t++)i=this.instances[t],i.curWebGLTexture=i.curFrame.webGL_texture},d.onLostWebGLContext=function(){if(!this.is_family){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)i=this.all_frames[t],i.texture_img.c2webGL_texture=null,i.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},d.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)i=this.all_frames[t],i.webGL_texture=this.runtime.glwrap.loadTexture(i.texture_img,!1,this.runtime.linearSampling,i.pixelformat);this.updateAllCurrentTexture()}},d.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)i=this.all_frames[t],i.webGL_texture=this.runtime.glwrap.loadTexture(i.texture_img,!1,this.runtime.linearSampling,i.pixelformat);this.has_loaded_textures=!0}},d.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)i=this.all_frames[t],this.runtime.glwrap.deleteTexture(i.webGL_texture),i.webGL_texture=null;this.has_loaded_textures=!1}};var f=[];d.preloadCanvas2D=function(t){var e,i,s;for(cr.clearArray(f),e=0,i=this.all_frames.length;e<i;++e)s=this.all_frames[e].texture_img,-1===f.indexOf(s)&&(t.drawImage(s,0,0),f.push(s))},p.Instance=function(t){this.type=t,this.runtime=t.runtime;var e=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(e):this.collision_poly=new cr.CollisionPoly(e)};var g=p.Instance.prototype;g.onCreate=function(){this.visible=0===this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=0!==this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var t,e,i,s,n,r,o,a,h=this.cur_animation.frames[this.cur_frame];for(this.collision_poly.set_pts(h.poly_pts),this.hotspotX=h.hotspotX,this.hotspotY=h.hotspotY,this.cur_anim_speed=this.cur_animation.speed,this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animForwards=!0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),t=0,e=this.type.animations.length;t<e;t++)for(n=this.type.animations[t],i=0,s=n.frames.length;i<s;i++)r=n.frames[i],0===r.width&&(r.width=r.texture_img.width,r.height=r.texture_img.height),r.spritesheeted&&(a=r.texture_img,o=r.sheetTex,o.left=r.offx/a.width,o.top=r.offy/a.height,o.right=(r.offx+r.width)/a.width,o.bottom=(r.offy+r.height)/a.height,0===r.offx&&0===r.offy&&r.width===a.width&&r.height===a.height&&(r.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},g.saveToJSON=function(){var t={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(t.ap=this.animPlaying),this.animForwards||(t.af=this.animForwards),t},g.loadFromJSON=function(t){var e=this.getAnimationBySid(t.a);e&&(this.cur_animation=e),this.cur_frame=t.f,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=t.cas,this.frameStart=t.fs,this.animRepeats=t.ar,this.animTimer.reset(),this.animTimer.sum=t.at,this.animPlaying=!t.hasOwnProperty("ap")||t.ap,this.animForwards=!t.hasOwnProperty("af")||t.af,t.hasOwnProperty("rt")?this.cur_anim_repeatto=t.rt:this.cur_anim_repeatto=this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},g.animationFinish=function(t){this.cur_frame=t?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},g.getNowTime=function(){return this.animTimer.sum},g.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),this.changeAnimFrame>=0&&this.doChangeAnimFrame();var t,e=this.getNowTime(),i=this.cur_animation,s=i.frames[this.cur_frame],n=s.duration/this.cur_anim_speed;this.animPlaying&&e>=this.frameStart+n&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=n,this.cur_frame>=i.frames.length&&(i.pingpong?(this.animForwards=!1,this.cur_frame=i.frames.length-2):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(i.pingpong?(this.cur_frame=1,this.animForwards=!0,i.loop||(this.animRepeats++,this.animRepeats>=i.repeatcount&&this.animationFinish(!0))):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=i.frames.length&&(this.cur_frame=i.frames.length-1),e>this.frameStart+i.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=e),t=i.frames[this.cur_frame],this.OnFrameChanged(s,t),this.runtime.redraw=!0)},g.getAnimationByName=function(t){var e,i,s;for(e=0,i=this.type.animations.length;e<i;e++)if(s=this.type.animations[e],cr.equals_nocase(s.name,t))return s;return null},g.getAnimationBySid=function(t){var e,i,s;for(e=0,i=this.type.animations.length;e<i;e++)if(s=this.type.animations[e],s.sid===t)return s;return null},g.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.getAnimationByName(this.changeAnimName);this.changeAnimName="",e&&(cr.equals_nocase(e.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=e,this.cur_anim_speed=e.speed,this.cur_anim_repeatto=e.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.animForwards=!0,this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))},g.doChangeAnimFrame=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),e!==this.cur_frame&&(this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},g.OnFrameChanged=function(t,e){var i,s,n,r=t.width,o=t.height,a=e.width,h=e.height;for(r!=a&&(this.width*=a/r),o!=h&&(this.height*=h/o),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.collision_poly.set_pts(e.poly_pts),this.set_bbox_changed(),this.curFrame=e,this.curWebGLTexture=e.webGL_texture,i=0,s=this.behavior_insts.length;i<s;i++)n=this.behavior_insts[i],n.onSpriteFrameChanged&&n.onSpriteFrameChanged(t,e);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},g.draw=function(t){t.globalAlpha=this.opacity;var e=this.curFrame,i=e.spritesheeted,s=e.texture_img,n=this.x,r=this.y,o=this.width,a=this.height;if(0===this.angle&&o>=0&&a>=0)n-=this.hotspotX*o,r-=this.hotspotY*a,this.runtime.pixel_rounding&&(n=Math.round(n),r=Math.round(r)),i?t.drawImage(s,e.offx,e.offy,e.width,e.height,n,r,o,a):t.drawImage(s,n,r,o,a);else{this.runtime.pixel_rounding&&(n=Math.round(n),r=Math.round(r)),t.save();var h=o>0?1:-1,c=a>0?1:-1;t.translate(n,r),1===h&&1===c||t.scale(h,c),t.rotate(this.angle*h*c);var l=0-this.hotspotX*cr.abs(o),u=0-this.hotspotY*cr.abs(a);i?t.drawImage(s,e.offx,e.offy,e.width,e.height,l,u,cr.abs(o),cr.abs(a)):t.drawImage(s,l,u,cr.abs(o),cr.abs(a)),t.restore()}},g.drawGL_earlyZPass=function(t){this.drawGL(t)},g.drawGL=function(t){t.setTexture(this.curWebGLTexture),t.setOpacity(this.opacity);var e=this.curFrame,i=this.bquad;if(this.runtime.pixel_rounding){var s=Math.round(this.x)-this.x,n=Math.round(this.y)-this.y;e.spritesheeted?t.quadTex(i.tlx+s,i.tly+n,i.trx+s,i.try_+n,i.brx+s,i.bry+n,i.blx+s,i.bly+n,e.sheetTex):t.quad(i.tlx+s,i.tly+n,i.trx+s,i.try_+n,i.brx+s,i.bry+n,i.blx+s,i.bly+n)}else e.spritesheeted?t.quadTex(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly,e.sheetTex):t.quad(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly)},g.getImagePointIndexByName=function(t){var e,i,s=this.curFrame;for(e=0,i=s.image_points.length;e<i;e++)if(cr.equals_nocase(t,s.image_points[e][0]))return e;return-1},g.getImagePoint=function(t,e){var i,s=this.curFrame,n=s.image_points;if(i=cr.is_string(t)?this.getImagePointIndexByName(t):t-1,i=cr.floor(i),i<0||i>=n.length)return e?this.x:this.y;var r=(n[i][1]-s.hotspotX)*this.width,o=n[i][2];o=(o-s.hotspotY)*this.height;var a=Math.cos(this.angle),h=Math.sin(this.angle),c=r*a-o*h;return o=o*a+r*h,r=c,r+=this.x,o+=this.y,e?r:o};var y=[],m=-2,_=[];e.prototype.OnCollision=function(t){if(!t)return!1;var e=this.runtime,i=e.getCurrentCondition(),s=i.type,n=null;i.extra.collmemory?n=i.extra.collmemory:(n={},i.extra.collmemory=n),i.extra.spriteCreatedDestroyCallback||(i.extra.spriteCreatedDestroyCallback=!0,e.addDestroyCallback(function(t){a(i.extra.collmemory,t)}));var c,l,u,p,d,f,g,y,v,b=s.getCurrentSol(),x=t.getCurrentSol(),w=b.getObjects(),S=this.runtime.tickcount,T=S-1,C=e.getCurrentEventStack().current_event;C.orblock;for(l=0;l<w.length;l++){for(u=w[l],x.select_all?(u.update_bbox(),this.runtime.getCollisionCandidates(u.layer,t,u.bbox,_),c=_):c=x.getObjects(),p=0;p<c.length;p++)d=c[p],e.testOverlap(u,d)||e.checkRegisteredCollision(u,d)?(y=h(n,u,d),v=!y||m<T,r(n,u,d,S),v&&(e.pushCopySol(C.solModifiers),f=s.getCurrentSol(),g=t.getCurrentSol(),f.select_all=!1,g.select_all=!1,s===t?(f.instances.length=2,f.instances[0]=u,f.instances[1]=d,s.applySolToContainer()):(f.instances.length=1,g.instances.length=1,f.instances[0]=u,g.instances[0]=d,s.applySolToContainer(),t.applySolToContainer()),C.retrigger(),e.popSol(C.solModifiers))):o(n,u,d);cr.clearArray(_)}return!1};var v=null,b=new cr.ObjectSet,x=!1,w=[],S=new cr.rect(0,0,0,0);d.finish=function(t){if(x){if(t){var e,i,s,n=this.runtime.getCurrentEventStack().current_event.orblock,r=v.getCurrentSol(),o=b.valuesRef();if(r.select_all){for(r.select_all=!1,cr.clearArray(r.instances),e=0,i=o.length;e<i;++e)r.instances[e]=o[e];if(n)for(cr.clearArray(r.else_instances),e=0,i=v.instances.length;e<i;++e)s=v.instances[e],b.contains(s)||r.else_instances.push(s)}else if(n){var a=r.instances.length;for(e=0,i=o.length;e<i;++e)r.instances[a+e]=o[e],cr.arrayFindRemove(r.else_instances,o[e])}else cr.shallowAssignArray(r.instances,o);v.applySolToContainer()}b.clear(),x=!1}},e.prototype.IsOverlapping=function(t){return c.call(this,t,0,0)},e.prototype.IsOverlappingOffset=function(t,e,i){return c.call(this,t,e,i)},e.prototype.IsAnimPlaying=function(t){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,t):cr.equals_nocase(this.cur_animation.name,t)},e.prototype.CompareFrame=function(t,e){return cr.do_cmp(this.cur_frame,t,e)},e.prototype.CompareAnimSpeed=function(t,e){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,t,e)},e.prototype.OnAnimFinished=function(t){return cr.equals_nocase(this.animTriggerName,t)},e.prototype.OnAnyAnimFinished=function(){return!0},e.prototype.OnFrameChanged=function(){return!0},e.prototype.IsMirrored=function(){return this.width<0},e.prototype.IsFlipped=function(){return this.height<0},e.prototype.OnURLLoaded=function(){return!0},e.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},p.cnds=new e,l.prototype.Spawn=function(t,e,i){if(t&&e){var s=this.runtime.createInstance(t,e,this.getImagePoint(i,!0),this.getImagePoint(i,!1));if(s){var n,r,o;if(void 0!==s.angle&&(s.angle=this.angle,s.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,s),s.is_contained)for(n=0,r=s.siblings.length;n<r;n++)o=s.siblings[n],this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated,o);this.runtime.isInOnDestroy--;var a,h=this.runtime.getCurrentAction(),c=!1;if((cr.is_undefined(h.extra.Spawn_LastExec)||h.extra.Spawn_LastExec<this.runtime.execcount)&&(c=!0,h.extra.Spawn_LastExec=this.runtime.execcount),t!=this.type&&(a=t.getCurrentSol(),a.select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=s):a.instances.push(s),s.is_contained))for(n=0,r=s.siblings.length;n<r;n++)o=s.siblings[n],a=o.type.getCurrentSol(),a.select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=o):a.instances.push(o)}}},l.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},l.prototype.StopAnim=function(){this.animPlaying=!1},l.prototype.StartAnim=function(t){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===t&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},l.prototype.SetAnim=function(t,e){this.changeAnimName=t,this.changeAnimFrom=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},l.prototype.SetAnimFrame=function(t){this.changeAnimFrame=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},l.prototype.SetAnimSpeed=function(t){this.cur_anim_speed=cr.abs(t),this.animForwards=t>=0,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},l.prototype.SetAnimRepeatToFrame=function(t){t=Math.floor(t),t<0&&(t=0),t>=this.cur_animation.frames.length&&(t=this.cur_animation.frames.length-1),this.cur_anim_repeatto=t},l.prototype.SetMirrored=function(t){var e=cr.abs(this.width)*(0===t?-1:1);this.width!==e&&(this.width=e,this.set_bbox_changed())},l.prototype.SetFlipped=function(t){var e=cr.abs(this.height)*(0===t?-1:1);this.height!==e&&(this.height=e,this.set_bbox_changed())},l.prototype.SetScale=function(t){var e=this.curFrame,i=this.width<0?-1:1,s=this.height<0?-1:1,n=e.width*t*i,r=e.height*t*s;this.width===n&&this.height===r||(this.width=n,this.height=r,this.set_bbox_changed())},l.prototype.LoadURL=function(t,e,i){var s=new Image,n=this,r=this.curFrame;s.onload=function(){if(r.texture_img.src===s.src)return n.runtime.glwrap&&n.curFrame===r&&(n.curWebGLTexture=r.webGL_texture),0===e&&(n.width=s.width,n.height=s.height,n.set_bbox_changed()),n.runtime.redraw=!0,void n.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,n);r.texture_img=s,r.offx=0,r.offy=0,r.width=s.width,r.height=s.height,r.spritesheeted=!1,r.datauri="",r.pixelformat=0,n.runtime.glwrap&&(r.webGL_texture&&n.runtime.glwrap.deleteTexture(r.webGL_texture),r.webGL_texture=n.runtime.glwrap.loadTexture(s,!1,n.runtime.linearSampling),n.curFrame===r&&(n.curWebGLTexture=r.webGL_texture),n.type.updateAllCurrentTexture()),0===e&&(n.width=s.width,n.height=s.height,n.set_bbox_changed()),n.runtime.redraw=!0,n.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,n)},"data:"!==t.substr(0,5)&&0===i&&(s.crossOrigin="anonymous"),this.runtime.setImageSrc(s,t)},l.prototype.SetCollisions=function(t){this.collisionsEnabled!==(0!==t)&&(this.collisionsEnabled=0!==t,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},p.acts=new l,u.prototype.AnimationFrame=function(t){t.set_int(this.cur_frame)},u.prototype.AnimationFrameCount=function(t){t.set_int(this.cur_animation.frames.length)},u.prototype.AnimationName=function(t){
t.set_string(this.cur_animation.name)},u.prototype.AnimationSpeed=function(t){t.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},u.prototype.ImagePointX=function(t,e){t.set_float(this.getImagePoint(e,!0))},u.prototype.ImagePointY=function(t,e){t.set_float(this.getImagePoint(e,!1))},u.prototype.ImagePointCount=function(t){t.set_int(this.curFrame.image_points.length)},u.prototype.ImageWidth=function(t){t.set_float(this.curFrame.width)},u.prototype.ImageHeight=function(t){t.set_float(this.curFrame.height)},p.exps=new u}(),cr.plugins_.Spritefont2=function(t){this.runtime=t},function(){function t(t){return t.replace(/\s\s*$/,"")}function e(t,e){return t.length?t.pop():new e}function i(t,e){t.length<v&&t.push(e)}function s(t,e,s){if(s){var n,r;for(n=0,r=e.length;n<r;n++)i(t,e[n]);cr.clearArray(e)}else{var o;for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(i(t,e[o]),delete e[o])}}function n(e,i,s){var n,o=e.lines;s=t(s),i>=o.length&&o.push(r()),n=o[i],n.text=s,n.width=e.measureWidth(s),e.textWidth=cr.max(e.textWidth,n.width)}function r(){return e(b,Object)}function o(t){i(b,t)}function a(t){s(b,t,!0)}function h(t,i,s,n,r,o){void 0===t[i]&&(t[i]=e(x,Object)),t[i].x=s,t[i].y=n,t[i].w=r,t[i].h=o}function c(t){s(x,t,!1)}function l(t,i,s,n,r,o){void 0===t[i]&&(t[i]=e(w,cr.rect)),t[i].left=s,t[i].top=n,t[i].right=r,t[i].bottom=o}function u(t){s(w,t,!1)}function p(t,e,i){var s;s=t.tlx*e-t.tly*i,t.tly=t.tly*e+t.tlx*i,t.tlx=s,s=t.trx*e-t.try_*i,t.try_=t.try_*e+t.trx*i,t.trx=s,s=t.blx*e-t.bly*i,t.bly=t.bly*e+t.blx*i,t.blx=s,s=t.brx*e-t.bry*i,t.bry=t.bry*e+t.brx*i,t.brx=s}function d(){}function f(){}function g(){}var y=cr.plugins_.Spritefont2.prototype;y.onCreate=function(){},y.Type=function(t){this.plugin=t,this.runtime=t.runtime};var m=y.Type.prototype;m.onCreate=function(){this.is_family||(this.texture_img=new Image,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.webGL_texture=null)},m.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},m.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},m.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},m.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},y.Instance=function(t){this.type=t,this.runtime=t.runtime};var _=y.Instance.prototype;_.onDestroy=function(){a(this.lines),c(this.clipList),u(this.clipUV),cr.wipe(this.characterWidthList)},_.onCreate=function(){this.texture_img=this.type.texture_img,this.characterWidth=this.properties[0],this.characterHeight=this.properties[1],this.characterSet=this.properties[2],this.text=this.properties[3],this.characterScale=this.properties[4],this.visible=0===this.properties[5],this.halign=this.properties[6]/2,this.valign=this.properties[7]/2,this.wrapbyword=0===this.properties[9],this.characterSpacing=this.properties[10],this.lineHeight=this.properties[11],this.textWidth=0,this.textHeight=0,this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={}),this.text_changed=!0,this.lastwrapwidth=this.width,this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture),this.SplitSheet()},_.saveToJSON=function(){var t={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(var e in this.characterWidthList)t.cw[e]=this.characterWidthList[e];return t},_.loadFromJSON=function(t){for(var e in this.text=t.t,this.characterScale=t.csc,this.characterSpacing=t.csp,this.lineHeight=t.lh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,t.hasOwnProperty("ha")&&(this.halign=t.ha),t.hasOwnProperty("va")&&(this.valign=t.va),t.cw)this.characterWidthList[e]=t.cw[e];this.text_changed=!0,this.lastwrapwidth=this.width};var v=1e3,b=[],x=[],w=[];_.SplitSheet=function(){for(var t=this.texture_img,e=t.width,i=t.height,s=this.characterWidth,n=this.characterHeight,r=s/e,o=n/i,a=this.characterSet,c=Math.floor(e/s),u=Math.floor(i/n),p=0;p<a.length&&!(p>=c*u);p++){var d=p%c,f=Math.floor(p/c),g=a.charAt(p);this.runtime.glwrap?l(this.clipUV,g,d*r,f*o,(d+1)*r,(f+1)*o):h(this.clipList,g,d*s,f*n,s,n)}};var S=[];y.TokeniseWords=function(t){cr.clearArray(S);for(var e,i="",s=0;s<t.length;)if(e=t.charAt(s),"\n"===e)i.length&&(S.push(i),i=""),S.push("\n"),++s;else if(" "===e||"\t"===e||"-"===e){do{i+=t.charAt(s),s++}while(s<t.length&&(" "===t.charAt(s)||"\t"===t.charAt(s)));S.push(i),i=""}else s<t.length&&(i+=e,s++);i.length&&S.push(i)},y.WordWrap=function(t){var e=t.text,i=t.lines;if(e&&e.length){var s=t.width;if(s<=2)a(i);else{var n=t.characterWidth,o=t.characterScale,h=t.characterSpacing;if(e.length*(n*o+h)-h<=s&&-1===e.indexOf("\n")){var c=t.measureWidth(e);if(c<=s)return a(i),i.push(r()),i[0].text=e,i[0].width=c,t.textWidth=c,void(t.textHeight=t.characterHeight*o+t.lineHeight)}t.wrapbyword;this.WrapText(t),t.textHeight=i.length*(t.characterHeight*o+t.lineHeight)}}else a(i)},y.WrapText=function(e){var i,s=e.wrapbyword,r=e.text,a=e.lines,h=e.width;s?(this.TokeniseWords(r),i=S):i=r;var c,l,u,p="",d=0,f=!1;for(u=0;u<i.length;u++)"\n"!==i[u]?(f=!1,c=p,p+=i[u],l=e.measureWidth(t(p)),l>h&&(""===c?(n(e,d,p),p="",f=!0):(n(e,d,c),p=i[u]),d++,s||" "!==p||(p=""))):(!0===f?f=!1:(n(e,d,p),d++),p="");for(t(p).length&&(n(e,d,p),d++),u=d;u<a.length;u++)o(a[u]);a.length=d},_.measureWidth=function(t){for(var e=this.characterSpacing,i=t.length,s=0,n=0;n<i;n++)s+=this.getCharacterWidth(t.charAt(n))*this.characterScale+e;return s-=s>0?e:0,s},_.getCharacterWidth=function(t){var e=this.characterWidthList;return void 0!==e[t]?e[t]:this.characterWidth},_.rebuildText=function(){(this.text_changed||this.width!==this.lastwrapwidth)&&(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)};var T=1e-5;_.draw=function(t,e){var i=this.texture_img;if(""!==this.text&&null!=i){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;t.globalAlpha=this.opacity;var s=this.x,n=this.y;this.runtime.pixel_rounding&&(s=Math.round(s),n=Math.round(n));var r=this.layer.viewLeft,o=this.layer.viewTop,a=this.layer.viewRight,h=this.layer.viewBottom;t.save(),t.translate(s,n),t.rotate(this.angle);var c,l,u,p=this.angle,d=this.halign,f=this.valign,g=this.characterScale,y=this.characterHeight*g,m=this.lineHeight,_=this.characterSpacing,v=this.lines,b=this.textHeight,x=f*cr.max(0,this.height-b),w=-this.hotspotX*this.width,S=-this.hotspotY*this.height;S+=x;for(var C,O,A=S,P=0;P<v.length;P++){var k=v[P].text,E=v[P].width;if(l=d*cr.max(0,this.width-E),u=w+l,A+=m,0===p&&n+A+y<o)A+=y;else{for(var I=0;I<k.length;I++){var L=k.charAt(I);c=this.getCharacterWidth(L);var R=this.clipList[L];if(0===p&&s+u+c*g+_<r)u+=c*g+_;else{if(u+c*g>this.width+T)break;if(void 0!==R&&(C=u,O=A,0===p&&1===g&&(C=Math.round(C),O=Math.round(O)),t.drawImage(this.texture_img,R.x,R.y,R.w,R.h,C,O,R.w*g,R.h*g)),u+=c*g+_,0===p&&s+u>a)break}}if(A+=y,0===p&&(A+y+m>this.height||n+A>h))break}}t.restore()}};var C=new cr.quad;_.drawGL=function(t){if(t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var e=this.bquad,i=0,s=0;this.runtime.pixel_rounding&&(i=Math.round(this.x)-this.x,s=Math.round(this.y)-this.y);var n,r,o,a,h=this.layer.viewLeft,c=this.layer.viewTop,l=this.layer.viewRight,u=this.layer.viewBottom,d=this.angle,f=this.halign,g=this.valign,y=this.characterScale,m=this.characterHeight*y,_=this.lineHeight,v=this.characterSpacing,b=this.lines,x=this.textHeight;0!==d&&(r=Math.cos(d),o=Math.sin(d));for(var w,S,O,A=g*cr.max(0,this.height-x),P=e.tlx+i,k=e.tly+s,E=A,I=0;I<b.length;I++){var L=b[I].text,R=b[I].width;if(a=f*cr.max(0,this.width-R),w=a,E+=_,0===d&&k+E+m<c)E+=m;else{for(var M=0;M<L.length;M++){var F=L.charAt(M);n=this.getCharacterWidth(F);var B=this.clipUV[F];if(0===d&&P+w+n*y+v<h)w+=n*y+v;else{if(w+n*y>this.width+T)break;if(void 0!==B){var N=this.characterWidth*y,j=this.characterHeight*y;S=w,O=E,0===d&&1===y&&(S=Math.round(S),O=Math.round(O)),C.tlx=S,C.tly=O,C.trx=S+N,C.try_=O,C.blx=S,C.bly=O+j,C.brx=S+N,C.bry=O+j,0!==d&&p(C,r,o),C.offset(P,k),t.quadTex(C.tlx,C.tly,C.trx,C.try_,C.brx,C.bry,C.blx,C.bly,B)}if(w+=n*y+v,0===d&&P+w>l)break}}if(E+=m,0===d&&(E+m+_>this.height||k+E>u))break}}}},d.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},y.cnds=new d,f.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);var e=t.toString();this.text!==e&&(this.text=e,this.text_changed=!0,this.runtime.redraw=!0)},f.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);var e=t.toString();e&&(this.text+=e,this.text_changed=!0,this.runtime.redraw=!0)},f.prototype.SetScale=function(t){t!==this.characterScale&&(this.characterScale=t,this.text_changed=!0,this.runtime.redraw=!0)},f.prototype.SetCharacterSpacing=function(t){t!==this.CharacterSpacing&&(this.characterSpacing=t,this.text_changed=!0,this.runtime.redraw=!0)},f.prototype.SetLineHeight=function(t){t!==this.lineHeight&&(this.lineHeight=t,this.text_changed=!0,this.runtime.redraw=!0)},_.SetCharWidth=function(t,e){var i=parseInt(e,10);this.characterWidthList[t]!==i&&(this.characterWidthList[t]=i,this.text_changed=!0,this.runtime.redraw=!0)},f.prototype.SetCharacterWidth=function(t,e){if(""!==t)for(var i=0;i<t.length;i++)this.SetCharWidth(t.charAt(i),e)},f.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},f.prototype.SetHAlign=function(t){this.halign=t/2,this.text_changed=!0,this.runtime.redraw=!0},f.prototype.SetVAlign=function(t){this.valign=t/2,this.text_changed=!0,this.runtime.redraw=!0},y.acts=new f,g.prototype.CharacterWidth=function(t,e){t.set_int(this.getCharacterWidth(e))},g.prototype.CharacterHeight=function(t){t.set_int(this.characterHeight)},g.prototype.CharacterScale=function(t){t.set_float(this.characterScale)},g.prototype.CharacterSpacing=function(t){t.set_int(this.characterSpacing)},g.prototype.LineHeight=function(t){t.set_int(this.lineHeight)},g.prototype.Text=function(t){t.set_string(this.text)},g.prototype.TextWidth=function(t){this.rebuildText(),t.set_float(this.textWidth)},g.prototype.TextHeight=function(t){this.rebuildText(),t.set_float(this.textHeight)},y.exps=new g}(),cr.plugins_.Text=function(t){this.runtime=t},function(){function t(){return p.length?p.pop():{}}function e(t){p.push(t)}function i(t){var i,s;for(i=0,s=t.length;i<s;i++)e(t[i]);cr.clearArray(t)}function s(t){return t.length&&" "===t.charAt(t.length-1)?t.substring(0,t.length-1):t}function n(){}function r(){}function o(){}var a=cr.plugins_.Text.prototype;a.onCreate=function(){a.acts.SetWidth=function(t){this.width!==t&&(this.width=t,this.text_changed=!0,this.set_bbox_changed())}},a.Type=function(t){this.plugin=t,this.runtime=t.runtime};var h=a.Type.prototype;h.onCreate=function(){},h.onLostWebGLContext=function(){var t,e,i;if(!this.is_family)for(t=0,e=this.instances.length;t<e;t++)i=this.instances[t],i.mycanvas=null,i.myctx=null,i.mytex=null},a.Instance=function(t){this.type=t,this.runtime=t.runtime,this.recycled?cr.clearArray(this.lines):this.lines=[],this.text_changed=!0};var c=a.Instance.prototype,l={};c.onCreate=function(){this.text=this.properties[0],this.visible=0===this.properties[1],this.font=this.properties[2],this.color=this.properties[3],this.halign=this.properties[4],this.valign=this.properties[5],this.wrapbyword=0===this.properties[7],this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height,this.line_height_offset=this.properties[8],this.facename="",this.fontstyle="",this.ptSize=0,this.textWidth=0,this.textHeight=0,this.parseFont(),this.mycanvas=null,this.myctx=null,this.mytex=null,this.need_text_redraw=!1,this.last_render_tick=this.runtime.tickcount,this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1),this.runtime.glwrap&&this.runtime.tickMe(this)},c.parseFont=function(){var t,e=this.font.split(" ");for(t=0;t<e.length;t++)if("pt"===e[t].substr(e[t].length-2,2)){for(this.ptSize=parseInt(e[t].substr(0,e[t].length-2)),this.pxHeight=Math.ceil(this.ptSize/72*96)+4,t>0&&(this.fontstyle=e[t-1]),this.facename=e[t+1],t+=2;t<e.length;t++)this.facename+=" "+e[t];break}},c.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}},c.loadFromJSON=function(t){this.text=t.t,this.font=t.f,this.color=t.c,this.halign=t.ha,this.valign=t.va,this.wrapbyword=t.wr,this.line_height_offset=t.lho,this.facename=t.fn,this.fontstyle=t.fs,this.ptSize=t.ps,this.pxHeight=t.pxh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,this.text_changed=!0,this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height},c.tick=function(){if(this.runtime.glwrap&&this.mytex&&this.runtime.tickcount-this.last_render_tick>=300){var t=this.layer;this.update_bbox();var e=this.bbox;(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)&&(this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null,this.myctx=null,this.mycanvas=null)}},c.onDestroy=function(){this.myctx=null,this.mycanvas=null,this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null},c.updateFont=function(){this.font=this.fontstyle+" "+this.ptSize.toString()+"pt "+this.facename,this.text_changed=!0,this.runtime.redraw=!0},c.draw=function(t,e){t.font=this.font,t.textBaseline="top",t.fillStyle=this.color,t.globalAlpha=e?1:this.opacity;var i=1;e&&(i=Math.abs(this.layer.getScale()),t.save(),t.scale(i,i)),(this.text_changed||this.width!==this.lastwrapwidth)&&(this.type.plugin.WordWrap(this.text,this.lines,t,this.width,this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width),this.update_bbox();var s=e?0:this.bquad.tlx,n=e?0:this.bquad.tly;this.runtime.pixel_rounding&&(s=s+.5|0,n=n+.5|0),0===this.angle||e||(t.save(),t.translate(s,n),t.rotate(this.angle),s=0,n=0);var r,o,a=n+this.height,h=this.pxHeight;for(h+=this.line_height_offset,1===this.valign?n+=Math.max(this.height/2-this.lines.length*h/2,0):2===this.valign&&(n+=Math.max(this.height-this.lines.length*h-2,0)),o=0;o<this.lines.length&&(r=s,1===this.halign?r=s+(this.width-this.lines[o].width)/2:2===this.halign&&(r=s+(this.width-this.lines[o].width)),t.fillText(this.lines[o].text,r,n),n+=h,!(n>=a-h));o++);(0!==this.angle||e)&&t.restore(),this.last_render_tick=this.runtime.tickcount},c.drawGL=function(t){if(!(this.width<1||this.height<1)){var e=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var i=this.layer.getScale(),s=this.layer.getAngle(),n=this.rcTex,r=i*this.width,o=i*this.height,a=Math.ceil(r),h=Math.ceil(o),c=Math.abs(a),l=Math.abs(h),u=this.runtime.draw_width/2,p=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=c,this.mycanvas.height=l,this.lastwidth=c,this.lastheight=l,e=!0,this.myctx=this.mycanvas.getContext("2d")),c===this.lastwidth&&l===this.lastheight||(this.mycanvas.width=c,this.mycanvas.height=l,this.mytex&&(t.deleteTexture(this.mytex),this.mytex=null),e=!0),e&&(this.myctx.clearRect(0,0,c,l),this.draw(this.myctx,!0),this.mytex||(this.mytex=t.createEmptyTexture(c,l,this.runtime.linearSampling,this.runtime.isMobile)),t.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile)),this.lastwidth=c,this.lastheight=l,t.setTexture(this.mytex),t.setOpacity(this.opacity),t.resetModelView(),t.translate(-u,-p),t.updateModelView();var d=this.bquad,f=this.layer.layerToCanvas(d.tlx,d.tly,!0,!0),g=this.layer.layerToCanvas(d.tlx,d.tly,!1,!0),y=this.layer.layerToCanvas(d.trx,d.try_,!0,!0),m=this.layer.layerToCanvas(d.trx,d.try_,!1,!0),_=this.layer.layerToCanvas(d.brx,d.bry,!0,!0),v=this.layer.layerToCanvas(d.brx,d.bry,!1,!0),b=this.layer.layerToCanvas(d.blx,d.bly,!0,!0),x=this.layer.layerToCanvas(d.blx,d.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===s){var w=(f+.5|0)-f,S=(g+.5|0)-g;f+=w,g+=S,y+=w,m+=S,_+=w,v+=S,b+=w,x+=S}0===this.angle&&0===s?(y=f+a,m=g,_=y,v=g+h,b=f,x=v,n.right=1,n.bottom=1):(n.right=r/a,n.bottom=o/h),t.quadTex(f,g,y,m,_,v,b,x,n),t.resetModelView(),t.scale(i,i),t.rotateZ(-this.layer.getAngle()),t.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2),t.updateModelView(),this.last_render_tick=this.runtime.tickcount}};var u=[];a.TokeniseWords=function(t){cr.clearArray(u);for(var e,i="",s=0;s<t.length;)if(e=t.charAt(s),"\n"===e)i.length&&(u.push(i),i=""),u.push("\n"),++s;else if(" "===e||"\t"===e||"-"===e){do{i+=t.charAt(s),s++}while(s<t.length&&(" "===t.charAt(s)||"\t"===t.charAt(s)));u.push(i),i=""}else s<t.length&&(i+=e,s++);i.length&&u.push(i)};var p=[];a.WordWrap=function(e,s,n,r,o){if(e&&e.length)if(r<=2)i(s);else{if(e.length<=100&&-1===e.indexOf("\n")){var a=n.measureText(e).width;if(a<=r)return i(s),s.push(t()),s[0].text=e,void(s[0].width=a)}this.WrapText(e,s,n,r,o)}else i(s)},a.WrapText=function(i,n,r,o,a){var h;a?(this.TokeniseWords(i),h=u):h=i;var c,l,p,d,f="",g=0;for(p=0;p<h.length;p++)"\n"!==h[p]?(c=f,f+=h[p],l=r.measureText(f).width,l>=o&&(g>=n.length&&n.push(t()),c=s(c),d=n[g],d.text=c,d.width=r.measureText(c).width,g++,f=h[p],a||" "!==f||(f=""))):(g>=n.length&&n.push(t()),f=s(f),d=n[g],d.text=f,d.width=r.measureText(f).width,g++,f="");for(f.length&&(g>=n.length&&n.push(t()),f=s(f),d=n[g],d.text=f,d.width=r.measureText(f).width,g++),p=g;p<n.length;p++)e(n[p]);n.length=g},n.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},a.cnds=new n,r.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);var e=t.toString();this.text!==e&&(this.text=e,this.text_changed=!0,this.runtime.redraw=!0)},r.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);var e=t.toString();e&&(this.text+=e,this.text_changed=!0,this.runtime.redraw=!0)},r.prototype.SetFontFace=function(t,e){var i="";switch(e){case 1:i="bold";break;case 2:i="italic";break;case 3:i="bold italic"}t===this.facename&&i===this.fontstyle||(this.facename=t,this.fontstyle=i,this.updateFont())},r.prototype.SetFontSize=function(t){this.ptSize!==t&&(this.ptSize=t,this.pxHeight=Math.ceil(this.ptSize/72*96)+4,this.updateFont())},r.prototype.SetFontColor=function(t){var e="rgb("+cr.GetRValue(t).toString()+","+cr.GetGValue(t).toString()+","+cr.GetBValue(t).toString()+")";e!==this.color&&(this.color=e,this.need_text_redraw=!0,this.runtime.redraw=!0)},r.prototype.SetWebFont=function(t,e){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");else{var i=this,s=function(){i.runtime.redraw=!0,i.text_changed=!0};if(l.hasOwnProperty(e)){var n="'"+t+"'";if(this.facename===n)return;this.facename=n,this.updateFont();for(var r=1;r<10;r++)setTimeout(s,100*r),setTimeout(s,1e3*r)}else{var o=document.createElement("link");o.href=e,o.rel="stylesheet",o.type="text/css",o.onload=s,document.getElementsByTagName("head")[0].appendChild(o),l[e]=!0,this.facename="'"+t+"'",this.updateFont();for(r=1;r<10;r++)setTimeout(s,100*r),setTimeout(s,1e3*r)}}},r.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},a.acts=new r,o.prototype.Text=function(t){t.set_string(this.text)},o.prototype.FaceName=function(t){t.set_string(this.facename)},o.prototype.FaceSize=function(t){t.set_int(this.ptSize)},o.prototype.TextWidth=function(t){var e,i,s,n=0;for(e=0,i=this.lines.length;e<i;e++)s=this.lines[e].width,n<s&&(n=s);t.set_int(n)},o.prototype.TextHeight=function(t){t.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)},a.exps=new o}(),cr.plugins_.TiledBg=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.TiledBg.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.pattern=null,this.webGL_texture=null)},n.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},n.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},n.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},n.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},n.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.visible=0===this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},r.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},r.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},r.draw=function(t){t.globalAlpha=this.opacity,t.save(),t.fillStyle=this.pattern;var e=this.x,i=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i));var s=-this.hotspotX*this.width,n=-this.hotspotY*this.height,r=s%this.texture_img.width,o=n%this.texture_img.height;r<0&&(r+=this.texture_img.width),o<0&&(o+=this.texture_img.height),t.translate(e,i),t.rotate(this.angle),t.translate(r,o),t.fillRect(s-r,n-o,this.width,this.height),t.restore()},r.drawGL_earlyZPass=function(t){this.drawGL(t)},r.drawGL=function(t){t.setTexture(this.webGL_texture),t.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width,e.bottom=this.height/this.texture_img.height;var i=this.bquad;if(this.runtime.pixel_rounding){var s=Math.round(this.x)-this.x,n=Math.round(this.y)-this.y;t.quadTex(i.tlx+s,i.tly+n,i.trx+s,i.try_+n,i.brx+s,i.bry+n,i.blx+s,i.bly+n,e)}else t.quadTex(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly,e)},t.prototype.OnURLLoaded=function(){return!0},s.cnds=new t,e.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},e.prototype.LoadURL=function(t,e){var i=new Image,s=this;i.onload=function(){s.texture_img=i,s.runtime.glwrap?(s.has_own_texture&&s.webGL_texture&&s.runtime.glwrap.deleteTexture(s.webGL_texture),s.webGL_texture=s.runtime.glwrap.loadTexture(i,!0,s.runtime.linearSampling)):s.pattern=s.runtime.ctx.createPattern(i,"repeat"),s.has_own_texture=!0,s.runtime.redraw=!0,s.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,s)},"data:"!==t.substr(0,5)&&0===e&&(i.crossOrigin="anonymous"),this.runtime.setImageSrc(i,t)},s.acts=new e,i.prototype.ImageWidth=function(t){t.set_float(this.texture_img.width)},i.prototype.ImageHeight=function(t){t.set_float(this.texture_img.height)},s.exps=new i}(),cr.plugins_.Touch=function(t){this.runtime=t},function(){function t(t){l=t.x,u=t.y,p=t.z}function e(t,e,i,n){var r;return r=d.length?d.pop():new s,r.init(t,e,i,n),r}function i(t){d.length<100&&d.push(t)}function s(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}function n(){}function r(){}var o=cr.plugins_.Touch.prototype;o.Type=function(t){this.plugin=t,this.runtime=t.runtime};var a=o.Type.prototype;a.onCreate=function(){},o.Instance=function(t){this.type=t,this.runtime=t.runtime,this.touches=[],this.mouseDown=!1};var h=o.Instance.prototype,c={left:0,top:0};h.findTouch=function(t){var e,i;for(e=0,i=this.touches.length;e<i;e++)if(this.touches[e].id===t)return e;return-1};var l=0,u=0,p=0,d=[],f=15,g=500,y=333,m=25;s.prototype.init=function(t,e,i,s){var n=cr.performance_now();this.time=n,this.lasttime=n,this.starttime=n,this.startx=t,this.starty=e,this.x=t,this.y=e,this.lastx=t,this.lasty=e,this.width=0,this.height=0,this.pressure=0,this.id=i,this.startindex=s,this.triggeredHold=!1,this.tooFarForHold=!1},s.prototype.update=function(t,e,i,s,n,r){this.lasttime=this.time,this.time=t,this.lastx=this.x,this.lasty=this.y,this.x=e,this.y=i,this.width=s,this.height=n,this.pressure=r,!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=f&&(this.tooFarForHold=!0)},s.prototype.maybeTriggerHold=function(t,e){if(!this.triggeredHold){var i=cr.performance_now();i-this.starttime>=g&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<f&&(this.triggeredHold=!0,t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,t),t.getTouchIndex=0)}};var _=-1e3,v=-1e3,b=-1e4;s.prototype.maybeTriggerTap=function(t,e){if(!this.triggeredHold){var i=cr.performance_now();i-this.starttime<=y&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<f&&(t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,i-b<=2*y&&cr.distanceTo(_,v,this.x,this.y)<m?(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,t),_=-1e3,v=-1e3,b=-1e4):(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,t),_=this.x,v=this.y,b=i),t.getTouchIndex=0)}},h.onCreate=function(){this,this.isWindows8=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.getTouchIndex=0,this.useMouseInput=0!==this.properties[0];var e=this.runtime.fullscreen_mode>0?document:this.runtime.canvas,i=document;this.runtime.isDirectCanvas?i=e=window.Canvas:this.runtime.isCocoonJs&&(i=e=window);var s=this;if("undefined"!=typeof PointerEvent?(e.addEventListener("pointerdown",function(t){s.onPointerStart(t)},!1),e.addEventListener("pointermove",function(t){s.onPointerMove(t)},!1),i.addEventListener("pointerup",function(t){s.onPointerEnd(t,!1)},!1),i.addEventListener("pointercancel",function(t){s.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))):window.navigator.msPointerEnabled?(e.addEventListener("MSPointerDown",function(t){s.onPointerStart(t)},!1),e.addEventListener("MSPointerMove",function(t){s.onPointerMove(t)},!1),i.addEventListener("MSPointerUp",function(t){s.onPointerEnd(t,!1)},!1),i.addEventListener("MSPointerCancel",function(t){s.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(e.addEventListener("touchstart",function(t){s.onTouchStart(t)},!1),e.addEventListener("touchmove",function(t){s.onTouchMove(t)},!1),i.addEventListener("touchend",function(t){s.onTouchEnd(t,!1)},!1),i.addEventListener("touchcancel",function(t){s.onTouchEnd(t,!0)},!1)),this.isWindows8){var n=function(t){var e=t.reading;s.acc_x=e.accelerationX,s.acc_y=e.accelerationY,s.acc_z=e.accelerationZ},r=function(t){var e=t.reading;s.orient_alpha=e.yawDegrees,s.orient_beta=e.pitchDegrees,s.orient_gamma=e.rollDegrees},o=Windows.Devices.Sensors.Accelerometer.getDefault();o&&(o.reportInterval=Math.max(o.minimumReportInterval,16),o.addEventListener("readingchanged",n));var a=Windows.Devices.Sensors.Inclinometer.getDefault();a&&(a.reportInterval=Math.max(a.minimumReportInterval,16),a.addEventListener("readingchanged",r)),document.addEventListener("visibilitychange",function(t){document.hidden||document.msHidden?(o&&o.removeEventListener("readingchanged",n),a&&a.removeEventListener("readingchanged",r)):(o&&o.addEventListener("readingchanged",n),a&&a.addEventListener("readingchanged",r))},!1)}else window.addEventListener("deviceorientation",function(t){s.orient_alpha=t.alpha||0,s.orient_beta=t.beta||0,s.orient_gamma=t.gamma||0},!1),window.addEventListener("devicemotion",function(t){t.accelerationIncludingGravity&&(s.acc_g_x=t.accelerationIncludingGravity.x||0,s.acc_g_y=t.accelerationIncludingGravity.y||0,s.acc_g_z=t.accelerationIncludingGravity.z||0),t.acceleration&&(s.acc_x=t.acceleration.x||0,s.acc_y=t.acceleration.y||0,s.acc_z=t.acceleration.z||0)},!1);this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(t){s.onMouseMove(t)}),jQuery(document).mousedown(function(t){s.onMouseDown(t)}),jQuery(document).mouseup(function(t){s.onMouseUp(t)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(t,null,{frequency:40}),this.runtime.tick2Me(this)},h.onPointerMove=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&t.preventDefault();var e=this.findTouch(t.pointerId),i=cr.performance_now();if(e>=0){var s=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset(),n=this.touches[e];if(i-n.time<2)return;n.update(i,t.pageX-s.left,t.pageY-s.top,t.width||0,t.height||0,t.pressure||0)}}},h.onPointerStart=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var i=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset(),s=t.pageX-i.left,n=t.pageY-i.top;cr.performance_now();this.trigger_index=this.touches.length,this.trigger_id=t.pointerId,this.touches.push(e(s,n,t.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),
this.curTouchX=s,this.curTouchY=n,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1}},h.onPointerEnd=function(t,e){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var s=this.findTouch(t.pointerId);this.trigger_index=s>=0?this.touches[s].startindex:-1,this.trigger_id=s>=0?this.touches[s].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),s>=0&&(e||this.touches[s].maybeTriggerTap(this,s),i(this.touches[s]),this.touches.splice(s,1)),this.runtime.isInUserInputEvent=!1}},h.onTouchMove=function(t){t.preventDefault&&t.preventDefault();var e,i,s,n,r=cr.performance_now();for(e=0,i=t.changedTouches.length;e<i;e++){s=t.changedTouches[e];var o=this.findTouch(s.identifier);if(o>=0){var a=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset();if(n=this.touches[o],r-n.time<2)continue;var h=2*(s.radiusX||s.webkitRadiusX||s.mozRadiusX||s.msRadiusX||0),l=2*(s.radiusY||s.webkitRadiusY||s.mozRadiusY||s.msRadiusY||0),u=s.force||s.webkitForce||s.mozForce||s.msForce||0;n.update(r,s.pageX-a.left,s.pageY-a.top,h,l,u)}}},h.onTouchStart=function(t){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var i,s,n,r,o=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset();cr.performance_now();for(this.runtime.isInUserInputEvent=!0,i=0,s=t.changedTouches.length;i<s;i++)if(n=t.changedTouches[i],r=this.findTouch(n.identifier),-1===r){var a=n.pageX-o.left,h=n.pageY-o.top;this.trigger_index=this.touches.length,this.trigger_id=n.identifier,this.touches.push(e(a,h,n.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=a,this.curTouchY=h,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}this.runtime.isInUserInputEvent=!1},h.onTouchEnd=function(t,e){var s,n,r,o;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.runtime.isInUserInputEvent=!0,s=0,n=t.changedTouches.length;s<n;s++)r=t.changedTouches[s],o=this.findTouch(r.identifier),o>=0&&(this.trigger_index=this.touches[o].startindex,this.trigger_id=this.touches[o].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),e||this.touches[o].maybeTriggerTap(this,o),i(this.touches[o]),this.touches.splice(o,1));this.runtime.isInUserInputEvent=!1},h.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==p?90*p:this.orient_alpha},h.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==u?90*u:this.orient_beta},h.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==l?90*l:this.orient_gamma};h.onMouseDown=function(t){var e={pageX:t.pageX,pageY:t.pageY,identifier:0},i={changedTouches:[e]};this.onTouchStart(i),this.mouseDown=!0},h.onMouseMove=function(t){if(this.mouseDown){var e={pageX:t.pageX,pageY:t.pageY,identifier:0},i={changedTouches:[e]};this.onTouchMove(i)}},h.onMouseUp=function(t){t.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0;var e={pageX:t.pageX,pageY:t.pageY,identifier:0},i={changedTouches:[e]};this.onTouchEnd(i),this.mouseDown=!1},h.tick2=function(){var t,e,i,s=cr.performance_now();for(t=0,e=this.touches.length;t<e;++t)i=this.touches[t],i.time<=s-50&&(i.lasttime=s),i.maybeTriggerHold(this,t)},n.prototype.OnTouchStart=function(){return!0},n.prototype.OnTouchEnd=function(){return!0},n.prototype.IsInTouch=function(){return this.touches.length},n.prototype.OnTouchObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)};var x=[];n.prototype.IsTouchingObject=function(t){if(!t)return!1;var e,i,s,n,r,o,a=t.getCurrentSol(),h=a.getObjects();for(s=0,n=h.length;s<n;s++){var c=h[s];for(c.update_bbox(),r=0,o=this.touches.length;r<o;r++){var l=this.touches[r];if(e=c.layer.canvasToLayer(l.x,l.y,!0),i=c.layer.canvasToLayer(l.x,l.y,!1),c.contains_pt(e,i)){x.push(c);break}}}return!!x.length&&(a.select_all=!1,cr.shallowAssignArray(a.instances,x),t.applySolToContainer(),cr.clearArray(x),!0)},n.prototype.CompareTouchSpeed=function(t,e,i){if(t=Math.floor(t),t<0||t>=this.touches.length)return!1;var s=this.touches[t],n=cr.distanceTo(s.x,s.y,s.lastx,s.lasty),r=(s.time-s.lasttime)/1e3,o=0;return r>0&&(o=n/r),cr.do_cmp(o,e,i)},n.prototype.OrientationSupported=function(){return void 0!==window.DeviceOrientationEvent},n.prototype.MotionSupported=function(){return void 0!==window.DeviceMotionEvent},n.prototype.CompareOrientation=function(t,e,i){var s=0;return s=0===t?this.getAlpha():1===t?this.getBeta():this.getGamma(),cr.do_cmp(s,e,i)},n.prototype.CompareAcceleration=function(t,e,i){var s=0;return 0===t?s=this.acc_g_x:1===t?s=this.acc_g_y:2===t?s=this.acc_g_z:3===t?s=this.acc_x:4===t?s=this.acc_y:5===t&&(s=this.acc_z),cr.do_cmp(s,e,i)},n.prototype.OnNthTouchStart=function(t){return t=Math.floor(t),t===this.trigger_index},n.prototype.OnNthTouchEnd=function(t){return t=Math.floor(t),t===this.trigger_index},n.prototype.HasNthTouch=function(t){return t=Math.floor(t),this.touches.length>=t+1},n.prototype.OnHoldGesture=function(){return!0},n.prototype.OnTapGesture=function(){return!0},n.prototype.OnDoubleTapGesture=function(){return!0},n.prototype.OnHoldGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},n.prototype.OnTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},n.prototype.OnDoubleTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},o.cnds=new n,r.prototype.TouchCount=function(t){t.set_int(this.touches.length)},r.prototype.X=function(t,e){var i,s,n,r,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(i=this.runtime.getLayerByNumber(0),s=i.scale,n=i.zoomRate,r=i.parallaxX,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)),i.scale=s,i.zoomRate=n,i.parallaxX=r,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e),i?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)):t.set_float(0))},r.prototype.XAt=function(t,e,i){var s,n,r,o,a;(e=Math.floor(e),e<0||e>=this.touches.length)?t.set_float(0):cr.is_undefined(i)?(s=this.runtime.getLayerByNumber(0),n=s.scale,r=s.zoomRate,o=s.parallaxX,a=s.angle,s.scale=1,s.zoomRate=1,s.parallaxX=1,s.angle=0,t.set_float(s.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)),s.scale=n,s.zoomRate=r,s.parallaxX=o,s.angle=a):(s=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),s?t.set_float(s.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)):t.set_float(0))},r.prototype.XForID=function(t,e,i){var s=this.findTouch(e);if(s<0)t.set_float(0);else{var n,r,o,a,h,c=this.touches[s];cr.is_undefined(i)?(n=this.runtime.getLayerByNumber(0),r=n.scale,o=n.zoomRate,a=n.parallaxX,h=n.angle,n.scale=1,n.zoomRate=1,n.parallaxX=1,n.angle=0,t.set_float(n.canvasToLayer(c.x,c.y,!0)),n.scale=r,n.zoomRate=o,n.parallaxX=a,n.angle=h):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),n?t.set_float(n.canvasToLayer(c.x,c.y,!0)):t.set_float(0))}},r.prototype.Y=function(t,e){var i,s,n,r,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(i=this.runtime.getLayerByNumber(0),s=i.scale,n=i.zoomRate,r=i.parallaxY,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)),i.scale=s,i.zoomRate=n,i.parallaxY=r,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e),i?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)):t.set_float(0))},r.prototype.YAt=function(t,e,i){var s,n,r,o,a;(e=Math.floor(e),e<0||e>=this.touches.length)?t.set_float(0):cr.is_undefined(i)?(s=this.runtime.getLayerByNumber(0),n=s.scale,r=s.zoomRate,o=s.parallaxY,a=s.angle,s.scale=1,s.zoomRate=1,s.parallaxY=1,s.angle=0,t.set_float(s.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)),s.scale=n,s.zoomRate=r,s.parallaxY=o,s.angle=a):(s=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),s?t.set_float(s.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)):t.set_float(0))},r.prototype.YForID=function(t,e,i){var s=this.findTouch(e);if(s<0)t.set_float(0);else{var n,r,o,a,h,c=this.touches[s];cr.is_undefined(i)?(n=this.runtime.getLayerByNumber(0),r=n.scale,o=n.zoomRate,a=n.parallaxY,h=n.angle,n.scale=1,n.zoomRate=1,n.parallaxY=1,n.angle=0,t.set_float(n.canvasToLayer(c.x,c.y,!1)),n.scale=r,n.zoomRate=o,n.parallaxY=a,n.angle=h):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),n?t.set_float(n.canvasToLayer(c.x,c.y,!1)):t.set_float(0))}},r.prototype.AbsoluteX=function(t){this.touches.length?t.set_float(this.touches[0].x):t.set_float(0)},r.prototype.AbsoluteXAt=function(t,e){e=Math.floor(e),e<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].x)},r.prototype.AbsoluteXForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i];t.set_float(s.x)}},r.prototype.AbsoluteY=function(t){this.touches.length?t.set_float(this.touches[0].y):t.set_float(0)},r.prototype.AbsoluteYAt=function(t,e){e=Math.floor(e),e<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].y)},r.prototype.AbsoluteYForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i];t.set_float(s.y)}},r.prototype.SpeedAt=function(t,e){if(e=Math.floor(e),e<0||e>=this.touches.length)t.set_float(0);else{var i=this.touches[e],s=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),n=(i.time-i.lasttime)/1e3;0===n?t.set_float(0):t.set_float(s/n)}},r.prototype.SpeedForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i],n=cr.distanceTo(s.x,s.y,s.lastx,s.lasty),r=(s.time-s.lasttime)/1e3;0===r?t.set_float(0):t.set_float(n/r)}},r.prototype.AngleAt=function(t,e){if(e=Math.floor(e),e<0||e>=this.touches.length)t.set_float(0);else{var i=this.touches[e];t.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y)))}},r.prototype.AngleForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i];t.set_float(cr.to_degrees(cr.angleTo(s.lastx,s.lasty,s.x,s.y)))}},r.prototype.Alpha=function(t){t.set_float(this.getAlpha())},r.prototype.Beta=function(t){t.set_float(this.getBeta())},r.prototype.Gamma=function(t){t.set_float(this.getGamma())},r.prototype.AccelerationXWithG=function(t){t.set_float(this.acc_g_x)},r.prototype.AccelerationYWithG=function(t){t.set_float(this.acc_g_y)},r.prototype.AccelerationZWithG=function(t){t.set_float(this.acc_g_z)},r.prototype.AccelerationX=function(t){t.set_float(this.acc_x)},r.prototype.AccelerationY=function(t){t.set_float(this.acc_y)},r.prototype.AccelerationZ=function(t){t.set_float(this.acc_z)},r.prototype.TouchIndex=function(t){t.set_int(this.trigger_index)},r.prototype.TouchID=function(t){t.set_float(this.trigger_id)},r.prototype.WidthForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i];t.set_float(s.width)}},r.prototype.HeightForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i];t.set_float(s.height)}},r.prototype.PressureForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var s=this.touches[i];t.set_float(s.pressure)}},o.exps=new r}(),cr.plugins_.TouchEnhanced=function(t){this.runtime=t},function(){function t(t,e,i,s){(!i||s.pointerType!==s.MSPOINTER_TYPE_MOUSE&&"mouse"!==s.pointerType)&&(t.touchCount>=t.touchMaxBySecond||(t.touchCount++,setTimeout(function(){this.touchCount--}.bind(t),1e3),e.apply(this,[].slice.call(arguments,3))))}function e(t,e){for(var i in e.objectsByUid)if(e.objectsByUid[i].type.plugin instanceof cr.plugins_[t])return e.objectsByUid[i];return!1}function i(t){this.touchPlugin&&this.enabledFlushOnResume&&(this.touchPlugin.touches=[])}function s(){}function n(){}function r(){}var o=cr.plugins_.TouchEnhanced.prototype;o.Type=function(t){this.plugin=t,this.runtime=t.runtime};var a=o.Type.prototype;a.onCreate=function(){},o.Instance=function(t){this.type=t,this.runtime=t.runtime};var h=o.Instance.prototype;h.onCreate=function(){this.runtime.touchEnhanced=this,this.touchPlugin=!1,this.touchCount=0,this.enabledFlushOnResume=1!==this.properties[0],this.enabledFlushOnTimer=1!==this.properties[1],this.timeBeforeDestroyTouch=1e3*this.properties[2],this.enabledCapingTouch=1!==this.properties[3],this.touchMaxBySecond=this.properties[4],document.addEventListener("resume",i.bind(this,"resume"),!1),document.addEventListener("pause",i.bind(this,"pause"),!1),document.addEventListener("visibilitychange",i.bind(this,"visibilitychange"),!1),document.addEventListener("mozvisibilitychange",i.bind(this,"mozvisibilitychange"),!1),document.addEventListener("webkitvisibilitychange",i.bind(this,"webkitvisibilitychange"),!1),document.addEventListener("msvisibilitychange",i.bind(this,"msvisibilitychange"),!1),this.runtime.tick2Me(this)},h.onPointerMove=function(t){},h.onPointerStart=function(t){},h.onPointerEnd=function(t,e){},h.onTouchMove=function(t){},h.onTouchStart=function(t){},h.onTouchEnd=function(t,e){},h.tick2=function(){if(this.touchPlugin){if(this.enabledFlushOnTimer)for(var t=1e3*this.runtime.getDt(),e=this.touchPlugin.touches.length-1;e>=0;e--){var i=this.touchPlugin.touches[e];if(i.TouchEnhanced||(i.TouchEnhanced={timerBase:this.timeBeforeDestroyTouch,timer:this.timeBeforeDestroyTouch,lastX:i.x,lastY:i.y}),i.x==i.TouchEnhanced.lastX&&i.y==i.TouchEnhanced.lastY){if(i.TouchEnhanced.timer-=t,0==i.pressure&&i.TouchEnhanced.timer<0){this.touchPlugin.touches.splice(e,1);continue}}else i.TouchEnhanced.timer=i.TouchEnhanced.timerBase;i.TouchEnhanced.lastX=i.x,i.TouchEnhanced.lastY=i.y}}else this.checkPluginTouch()},h.checkPluginTouch=function(){var t=e("Touch",this.runtime);t&&(this.touchPlugin=t,this.updateFunctionTouch())},h.updateFunctionTouch=function(){this.touchPlugin.onPointerStart_old=this.touchPlugin.onPointerStart,this.touchPlugin.onPointerStart=t.bind(this.touchPlugin,this,this.touchPlugin.onPointerStart_old,!0),this.touchPlugin.onTouchStart_old=this.touchPlugin.onTouchStart,this.touchPlugin.onTouchStart=t.bind(this.touchPlugin,this,this.touchPlugin.onTouchStart_old,!1)},s.prototype.setActiveFlushOnResume=function(t){this.enabledFlushOnResume=1!==t},s.prototype.setActiveFlushOnTimer=function(t){this.enabledFlushOnTimer=1!==t},s.prototype.setFlushOnTimerSecond=function(t){this.timeBeforeDestroyTouch=1e3*t},s.prototype.setActiveCapTouchBySecond=function(t){this.enabledCapingTouch=1!==t},s.prototype.setCapTouchBySecond=function(t){this.touchMaxBySecond=t},s.prototype.clearAllTouches=function(){this.touchPlugin&&(this.touchPlugin.touches=[])},o.acts=new s,n.prototype.isFlushOnResumeActive=function(){return this.enabledFlushOnResume},n.prototype.isFlushOnTimerActive=function(){return this.enabledFlushOnTimer},n.prototype.isCapTouchBySecondActive=function(){return this.enabledCapingTouch},o.cnds=new n,r.prototype.flushOnResumeIsActive=function(t){t.set_int(this.enabledFlushOnResume?1:0)},r.prototype.flushOnTimerIsActive=function(t){t.set_int(this.enabledFlushOnTimer?1:0)},r.prototype.flushOnTimerSecond=function(t){t.set_float(this.timeBeforeDestroyTouch/1e3)},r.prototype.capTouchBySecondIsActive=function(t){t.set_int(this.enabledCapingTouch?1:0)},r.prototype.capTouchBySecond=function(t){t.set_int(this.touchMaxBySecond)},o.exps=new r}(),cr.plugins_.WebStorage=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.plugins_.WebStorage.prototype;s.Type=function(t){this.plugin=t,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=s.Instance.prototype,o="",a=void 0!==window.is_scirra_arcade;a&&(o="arcade"+window.scirra_arcade_id);var h=!1;try{localStorage.getItem("test"),h=!0}catch(t){h=!1}r.onCreate=function(){h||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")},t.prototype.LocalStorageEnabled=function(){return h},t.prototype.SessionStorageEnabled=function(){return h},t.prototype.LocalStorageExists=function(t){return!!h&&null!=localStorage.getItem(o+t)},t.prototype.SessionStorageExists=function(t){return!!h&&null!=sessionStorage.getItem(o+t)},t.prototype.OnQuotaExceeded=function(){return!0},t.prototype.CompareKeyText=function(t,e,i){if(!h)return!1;var s=localStorage.getItem(o+t)||"";return i?s==e:cr.equals_nocase(s,e)},t.prototype.CompareKeyNumber=function(t,e,i){if(!h)return!1;var s=localStorage.getItem(o+t)||"";return cr.do_cmp(parseFloat(s),e,i)},s.cnds=new t,e.prototype.StoreLocal=function(t,e){if(h)try{localStorage.setItem(o+t,e)}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}},e.prototype.StoreSession=function(t,e){if(h)try{sessionStorage.setItem(o+t,e)}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}},e.prototype.RemoveLocal=function(t){h&&localStorage.removeItem(o+t)},e.prototype.RemoveSession=function(t){h&&sessionStorage.removeItem(o+t)},e.prototype.ClearLocal=function(){h&&(a||localStorage.clear())},e.prototype.ClearSession=function(){h&&(a||sessionStorage.clear())},e.prototype.JSONLoad=function(t,e){if(h){var i;try{i=JSON.parse(t)}catch(t){return}if(i.c2dictionary){var s,n=i.data;for(s in 0!==e||a||localStorage.clear(),n)if(n.hasOwnProperty(s))try{localStorage.setItem(o+s,n[s])}catch(t){return void this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}}}},s.acts=new e,i.prototype.LocalValue=function(t,e){h?t.set_string(localStorage.getItem(o+e)||""):t.set_string("")},i.prototype.SessionValue=function(t,e){h?t.set_string(sessionStorage.getItem(o+e)||""):t.set_string("")},i.prototype.LocalCount=function(t){h?t.set_int(a?0:localStorage.length):t.set_int(0)},i.prototype.SessionCount=function(t){h?t.set_int(a?0:sessionStorage.length):t.set_int(0)},i.prototype.LocalAt=function(t,e){a||!h?t.set_string(""):t.set_string(localStorage.getItem(localStorage.key(e))||"")},i.prototype.SessionAt=function(t,e){a||!h?t.set_string(""):t.set_string(sessionStorage.getItem(sessionStorage.key(e))||"")},i.prototype.LocalKeyAt=function(t,e){a||!h?t.set_string(""):t.set_string(localStorage.key(e)||"")},i.prototype.SessionKeyAt=function(t,e){a||!h?t.set_string(""):t.set_string(sessionStorage.key(e)||"")},i.prototype.AsJSON=function(t){if(h){var e,i,s,n={};for(e=0,i=localStorage.length;e<i;e++)s=localStorage.key(e),a?s.substr(0,o.length)===o&&(n[s.substr(o.length)]=localStorage.getItem(s)):n[s]=localStorage.getItem(s);t.set_string(JSON.stringify({c2dictionary:!0,data:n}))}else t.set_string("")},s.exps=new i}(),cr.plugins_.c2canvas=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.c2canvas.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){this.texture_img=new Image,this.texture_img.crossOrigin="anonymous",this.runtime.setImageSrc(this.texture_img,this.texture_file),this.texture_img.cr_filesize=this.texture_filesize,this.runtime.wait_for_textures.push(this.texture_img)},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype,fxNames=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];instanceProto.effectToCompositeOp=function(t){return t<=0||t>=11?"source-over":fxNames[t-1]},instanceProto.updateBlend=function(t){var e=this.runtime.gl;if(e)switch(this.srcBlend=e.ONE,this.destBlend=e.ONE_MINUS_SRC_ALPHA,t){case 1:this.srcBlend=e.ONE,this.destBlend=e.ONE;break;case 2:break;case 3:this.srcBlend=e.ONE,this.destBlend=e.ZERO;break;case 4:this.srcBlend=e.ONE_MINUS_DST_ALPHA,this.destBlend=e.ONE;break;case 5:this.srcBlend=e.DST_ALPHA,this.destBlend=e.ZERO;break;case 6:this.srcBlend=e.ZERO,this.destBlend=e.SRC_ALPHA;break;case 7:this.srcBlend=e.ONE_MINUS_DST_ALPHA,this.destBlend=e.ZERO;break;case 8:this.srcBlend=e.ZERO,this.destBlend=e.ONE_MINUS_SRC_ALPHA;break;case 9:this.srcBlend=e.DST_ALPHA,this.destBlend=e.ONE_MINUS_SRC_ALPHA;break;case 10:this.srcBlend=e.ONE_MINUS_DST_ALPHA,this.destBlend=e.SRC_ALPHA}},instanceProto.onCreate=function(){this.visible=0===this.properties[0],this.compositeOp=this.effectToCompositeOp(this.properties[1]),this.updateBlend(this.properties[1]),this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(this.type.texture_img,0,0,this.width,this.height),this.tCanvas=document.createElement("canvas"),this.tCtx=this.tCanvas.getContext("2d"),this.update_tex=!0,this.rcTex=new cr.rect(0,0,0,0)},instanceProto.onDestroy=function(){},instanceProto.saveToJSON=function(){return{canvas_w:this.canvas.width,canvas_h:this.canvas.height,image:this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data}},instanceProto.loadFromJSON=function(t){for(var e=this.canvas.width=t.canvas_w,i=this.canvas.height=t.canvas_h,s=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data,n=0;n<i;++n)for(var r=0;r<e;++r)for(var o=4*(n*e+r),a=0;a<4;++a)s[o+a]=t.image[o+a]},instanceProto.draw_instances=function(t,e){for(var i in t)0==t[i].visible&&0==this.runtime.testOverlap(this,t[i])||(e.save(),e.scale(this.canvas.width/this.width,this.canvas.height/this.height),e.rotate(-this.angle),e.translate(-this.bquad.tlx,-this.bquad.tly),e.globalCompositeOperation=t[i].compositeOp,t[i].draw(e),e.restore())},instanceProto.draw=function(t){t.save(),t.globalAlpha=this.opacity,t.globalCompositeOperation=this.compositeOp;var e=this.x,i=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),t.translate(e,i),t.rotate(this.angle),t.drawImage(this.canvas,0-this.hotspotX*this.width,0-this.hotspotY*this.height,this.width,this.height),t.restore()},instanceProto.drawGL=function(t){t.setBlend(this.srcBlend,this.destBlend),this.update_tex&&(this.tex&&t.deleteTexture(this.tex),this.tex=t.loadTexture(this.canvas,!1,this.runtime.linearSampling),this.update_tex=!1),t.setTexture(this.tex),t.setOpacity(this.opacity);var e=this.bquad;if(this.runtime.pixel_rounding){var i=Math.round(this.x)-this.x,s=Math.round(this.y)-this.y;t.quad(e.tlx+i,e.tly+s,e.trx+i,e.try_+s,e.brx+i,e.bry+s,e.blx+i,e.bly+s)}else t.quad(e.tlx,e.tly,e.trx,e.try_,e.brx,e.bry,e.blx,e.bly)},pluginProto.cnds={};var cnds=pluginProto.cnds;pluginProto.acts={};var acts=pluginProto.acts;acts.SetEffect=function(t){this.compositeOp=this.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0,this.update_tex=!0},acts.DrawPoint=function(t,e,i){var s=this.ctx;s.fillStyle=i,s.fillRect(t,e,1,1),this.runtime.redraw=!0,this.update_tex=!0},acts.ResizeCanvas=function(t,e){this.canvas.width=t,this.canvas.height=e,this.runtime.redraw=!0,this.update_tex=!0},acts.PasteObject=function(t){var e=this.ctx;this.update_bbox();var i,s=t.getCurrentSol();i=s.select_all?s.type.instances:s.instances,this.draw_instances(i,e),this.runtime.redraw=!0,this.update_tex=!0},acts.PasteLayer=function(t){if(!t||!t.visible)return!1;var e=this.ctx;this.update_bbox(),this.tCanvas.width=this.canvas.width,this.tCanvas.height=this.canvas.height;var i=this.tCtx;i.clearRect(0,0,this.tCanvas.width,this.tCanvas.height),this.draw_instances(t.instances,i),e.drawImage(this.tCanvas,0,0,this.width,this.height),this.runtime.redraw=!0,this.update_tex=!0},acts.DrawBox=function(t,e,i,s,n){this.ctx.fillStyle=n,this.ctx.fillRect(t,e,i,s),this.runtime.redraw=!0,this.update_tex=!0},acts.DrawLine=function(t,e,i,s,n,r){var o=this.ctx;o.strokeStyle=n,o.lineWidth=r,o.beginPath(),o.moveTo(t,e),o.lineTo(i,s),o.stroke(),this.runtime.redraw=!0,this.update_tex=!0},acts.ClearCanvas=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.runtime.redraw=!0,this.update_tex=!0},acts.FillColor=function(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.runtime.redraw=!0,this.update_tex=!0},acts.fillGradient=function(t,e,i){var s,n=this.ctx,r=this.canvas.width,o=this.canvas.height;switch(t){case 0:s=n.createLinearGradient(0,0,r,0);break;case 1:s=n.createLinearGradient(0,0,0,o);break;case 2:s=n.createLinearGradient(0,0,r,o);break;case 3:s=n.createLinearGradient(r,0,0,o);break;case 4:s=n.createRadialGradient(r/2,o/2,0,r/2,o/2,Math.sqrt(r*r+o*o)/2)}try{s.addColorStop(0,e)}catch(t){s.addColorStop(0,"black")}try{s.addColorStop(1,i)}catch(t){s.addColorStop(1,"black")}this.ctx.fillStyle=s,this.ctx.fillRect(0,0,r,o),this.runtime.redraw=!0,this.update_tex=!0},acts.beginPath=function(){this.ctx.beginPath()},acts.drawPath=function(t,e){var i=this.ctx;i.strokeStyle=t,i.lineWidth=e,i.stroke(),this.runtime.redraw=!0,this.update_tex=!0},acts.setLineSettings=function(t,e){var i=this.ctx;i.lineCap=["butt","round","square"][t],i.lineJoin=["round","bevel","milet"][e]},acts.fillPath=function(t){this.ctx.fillStyle=t,this.ctx.fill(),this.runtime.redraw=!0,this.update_tex=!0},acts.moveTo=function(t,e){this.ctx.moveTo(t,e)},acts.lineTo=function(t,e){this.ctx.lineTo(t,e)},acts.arc=function(t,e,i,s,n,r){this.ctx.arc(t,e,i,cr.to_radians(s),cr.to_radians(n),1==r)},acts.drawCircle=function(t,e,i,s,n){var r=this.ctx;r.strokeStyle=s,r.lineWidth=n,r.beginPath(),r.arc(t,e,i,0,cr.to_radians(360),!0),r.stroke(),this.runtime.redraw=!0,this.update_tex=!0},acts.bezierCurveTo=function(t,e,i,s,n,r){this.ctx.bezierCurveTo(t,e,i,s,n,r)},acts.quadraticCurveTo=function(t,e,i,s){this.ctx.quadraticCurveTo(t,e,i,s)},acts.arcTo=function(t,e,i,s,n){this.ctx.arcTo(t,e,i,s,n)},acts.rectPath=function(t,e,i,s){this.ctx.rect(t,e,i,s)},acts.FloodFill=function(t,e,i){var s=this.ctx,n=s.getImageData(0,0,this.canvas.width,this.canvas.height);flood_fill(n.data,this.canvas.width,this.canvas.height,t,e,i),s.putImageData(n,0,0),this.runtime.redraw=!0,this.update_tex=!0},acts.clearRect=function(t,e,i,s){this.ctx.clearRect(t,e,i,s),this.runtime.redraw=!0,this.update_tex=!0},acts.evalCanvas=function(str){var ctx=this.ctx,context=this.ctx;eval(str)},pluginProto.exps={};var exps=pluginProto.exps;exps.rgbaAt=function(t,e,i){var s=this.ctx.getImageData(e,i,1,1),n=s.data;t.set_string("rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]/255+")")},exps.redAt=function(t,e,i){var s=this.ctx.getImageData(e,i,1,1),n=s.data;t.set_int(n[0])},exps.greenAt=function(t,e,i){var s=this.ctx.getImageData(e,i,1,1),n=s.data;t.set_int(n[1])},exps.blueAt=function(t,e,i){var s=this.ctx.getImageData(e,i,1,1),n=s.data;t.set_int(n[2])},exps.alphaAt=function(t,e,i){var s=this.ctx.getImageData(e,i,1,1),n=s.data;t.set_int(n[0]/255)},exps.imageUrl=function(t){t.set_string(this.canvas.toDataURL())},exps.AsJSON=function(t){t.set_string(JSON.stringify({c2array:!0,size:[1,1,this.canvas.width*this.canvas.height*4],data:[[this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data]]}))}}(),cr.plugins_.cjs=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.cjs.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){this.nameOfExternalScript=this.properties[0],this.returnValue="";var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",this.nameOfExternalScript),void 0!==t&&document.getElementsByTagName("head")[0].appendChild(t)},instanceProto.draw=function(t){},pluginProto.cnds={};var cnds=pluginProto.cnds;pluginProto.acts={};var acts=pluginProto.acts;acts.ExecuteJS=function(myparam){this.returnValue="";try{this.returnValue=eval(myparam)}catch(t){this.returnValue=t}},pluginProto.exps={};var exps=pluginProto.exps;exps.ReadExecutionReturn=function(t){t.set_string(this.returnValue)}}(),cr.plugins_.listScroll=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}function s(t,e,i){return Math.min(i,Math.max(e,t))}function n(t,e){return Math.round(t/e)*e}function r(t,e){return Math.floor(t/e)*e}function o(t,e){return Math.ceil(t/e)*e}var a={VERTICAL:"vertical",HORIZONTAL:"horizontal",idToname:function(t){return 0==t?this.VERTICAL:1==t?this.HORIZONTAL:void 0}},h=cr.plugins_.listScroll.prototype;h.Type=function(t){this.plugin=t,this.runtime=t.runtime};var c=h.Type.prototype;c.onCreate=function(){},h.Instance=function(t){this.type=t,this.runtime=t.runtime};var l=h.Instance.prototype;l.onCreate=function(){this.activated=!this.properties[0],this.orientation=a.idToname(this.properties[1]),this.offset=this.properties[2],this.saveLastState(!0),this.runtime.listScroll||(this.runtime.listScroll={id:0,list:{}}),this.id=this.runtime.listScroll.id++,this.runtime.listScroll.list[this.id]=this,this.waitList=(new u).create(this.id,this.orientation,this.orientation==a.VERTICAL?this.x:this.y,this.orientation==a.HORIZONTAL?this.x+this.width/2:this.y+this.height/2,this.offset),this.waitList.setOffsetStart(this.orientation==a.HORIZONTAL?this.x-this.width/2:this.y-this.height/2),this.waitList.setActivated(this.activated),this.runtime.tick2Me(this)},l.onDestroy=function(){delete this.runtime.listScroll.list[this.id]},l.tick2=function(){this.x==this.savedState.x&&this.y==this.savedState.y&&this.width==this.savedState.width&&this.height==this.savedState.height||(this.waitList.setStartPos(this.orientation==a.VERTICAL?this.x:this.y),this.waitList.setHeight(this.orientation==a.HORIZONTAL?this.x+this.width/2:this.y+this.height/2),this.waitList.setOffsetStart(this.orientation==a.HORIZONTAL?this.x-this.width/2:this.y-this.height/2)),this.waitList.update(this.runtime.getDt(this)),this.saveLastState()},l.saveLastState=function(t){this.savedState={x:t?0:this.x,y:t?0:this.y,width:t?0:this.width,height:t?0:this.height}},l.saveToJSON=function(){return{}},l.loadFromJSON=function(t){},l.draw=function(t){},l.drawGL=function(t){},t.prototype.objectIsOnList=function(t){},t.prototype.isOnMovement=function(){return this.waitList.isOnMovement()},t.prototype.isOnOrientation=function(t){return t==this.orientation},h.cnds=new t,e.prototype.setActivated=function(t){this.waitList.setActivated(!t)},e.prototype.setOrientation=function(t){t=a.idToname(t),this.waitList.setOrientation(t===a.HORIZONTAL||t===a.VERTICAL?t:a.VERTICAL)},e.prototype.setOffset=function(t){this.waitList.setOffset(t)},e.prototype.setRoundScroll=function(t,e,i){this.waitList.setRoundScroll(!!t,!!e,i)},e.prototype.setClampObject=function(t,e,i){this.waitList.setClampObject(t,e,i)},e.prototype.setCanMoveObject=function(t,e){var i=t.getCurrentSol();if(i.hasObjects()>0)for(var s=i.getObjects(),n=0;n<s.length;n++)this.waitList.setCanMoveByUid(s[n].uid,!!e)},e.prototype.setVisibleObject=function(t,e){var i=t.getCurrentSol();if(i.hasObjects()>0)for(var s=i.getObjects(),n=0;n<s.length;n++)this.waitList.setVisibleObject(s[n].uid,!!e)},e.prototype.setTemporaryPosDrop=function(t){this.waitList.setTemporaryPosDrop(t)},e.prototype.endMove=function(){this.waitList.endMove()},e.prototype.resetMove=function(){this.waitList.resetMove()},e.prototype.move=function(t){this.waitList.addScroll(t)},e.prototype.moveTo=function(t){this.waitList.setScroll(t)},e.prototype.movePercent=function(t){this.waitList.setScrollPercent(t)},
e.prototype.moveToPercent=function(t){this.waitList.addScrollPercent(t)},e.prototype.addImpulsion=function(t){this.waitList.addImpulsion(t)},e.prototype.stopImpulsion=function(){this.waitList.stopImpulsion()},e.prototype.addToList=function(t,e){var i=t.getCurrentSol();if(i.hasObjects()>0)for(var s=i.getObjects(),n=0;n<s.length;n++)this.waitList.addToList(s[n].uid,s[n],e)},e.prototype.removeToList=function(t){var e=t.getCurrentSol();if(e.hasObjects()>0)for(var i=e.getObjects(),s=0;s<i.length;s++)this.waitList.removeToList(i[s].uid)},e.prototype.removeAllToList=function(){this.waitList.removeAll()},h.acts=new e,i.prototype.getPercentScrollList=function(t){t.set_float(this.waitList.getPercentScrollList())},i.prototype.getPercentObjectOnList=function(t,e){t.set_float(this.waitList.getPercentObjectOnList(e))},i.prototype.getVisibleObjectCount=function(t){t.set_int(this.waitList.getVisibleObject())},i.prototype.getObjectCount=function(t){t.set_int(this.waitList.getObjectCount())},i.prototype.getPosObjectByUid=function(t,e){t.set_int(this.waitList.getPosObjectByUid(e))},i.prototype.uidIsOnList=function(t,e){t.set_int(this.waitList.uidIsOnList(e))},i.prototype.getRandomUidOnList=function(t){t.set_int(this.waitList.getRandomObjectOnList())},i.prototype.getRandomUidVisibleOnList=function(t){t.set_int(this.waitList.getRandomObjectVisibleOnList())},i.prototype.isOnMovement=function(t){t.set_int(this.waitList.isOnMovement())},i.prototype.getOrientation=function(t){t.set_string(this.orientation)},h.exps=new i;var u=function(){};u.prototype.create=function(t,e,i,s,n){return this.activated=!0,this.updateVisibility=!0,this.listName=t,this.orientation=e,this.startPos=i,this.offset=n,this.offsetScroll=this.offset/2,this.offsetStart=0,this.roundScroll=!1,this.listOfObjectVisible=0,this.temporaryPos=-1,this.actualDirection=0,this.activeCallback={objListMoved:!1,objListRemoved:!1,listEndMoved:!1},this.roundScroll_smoothScrollToMove=0,this.roundScroll_smoothSpeed=10,this.roundScroll_THRESHOLD=2,this.roundScroll_activeSmooth=!1,this.INERTIA_SCROLL_FACTOR=.9,this.INERTIA_ACCELERATION=.97,this.INERTIA_THRESHOLD=20,this.inertialVelocity=0,this.clampMinPosObject=null,this.clampMaxPosObject=null,this.offsetBetweenClamp=0,this.setHeight(s),this.maxScroll=0,this.listOfObject=[],this.listOfObjectUid={},this},u.prototype.isObjectOnListExist=function(t){return void 0!==this.listOfObjectUid[t]},u.prototype.setActivated=function(t){this.activated=t},u.prototype.setStartPos=function(t){this.startPos=t},u.prototype.setOrientation=function(t){this.orientation=t},u.prototype.setOffset=function(t){this.offset=t},u.prototype.setHeight=function(t){this.baseHeight=t,this.height=this.baseHeight-this.offsetStart},u.prototype.setOffsetStart=function(t){this.offsetStart=t,this.setHeight(this.baseHeight),this.calculMaxScroll()},u.prototype.setRoundScroll=function(t,e,i){this.roundScroll=t,this.roundScroll_activeSmooth=e,this.roundScroll_smoothSpeed=i},u.prototype.setClampObject=function(t,e,i){this.clampMinPosObject=t,this.clampMaxPosObject=e,this.offsetBetweenClamp=i},u.prototype.setCanMoveByUid=function(t,e){return!!this.isObjectOnListExist(t)&&this.listOfObjectUid[t].setCanMove(e)},u.prototype.setVisibleObject=function(t,e){if(!this.isObjectOnListExist(t))return!1;var i=this.listOfObjectUid[t].setVisible(e);i&&(this.updateVisibility=!0)},u.prototype.setTemporaryPosDrop=function(t){this.temporaryPos=t},u.prototype.setActiveCallbackByName=function(t,e){this.activeCallback[t]=e},u.prototype.getPercentScrollList=function(){var t=this.offset/2;return 100*(this.offsetScroll-t)/(this.maxScroll-t)},u.prototype.getPercentObjectOnList=function(t){return!!this.isObjectOnListExist(t)&&this.listOfObjectUid[t].getPercentOnList()},u.prototype.getVisibleObject=function(){return this.listOfObjectVisible},u.prototype.getObjectCount=function(){return this.listOfObject.length},u.prototype.getPosObjectByUid=function(t){return this.isObjectOnListExist(t)?this.listOfObjectUid[t].posToShow:-1},u.prototype.uidIsOnList=function(t){return this.isObjectOnListExist(t)},u.prototype.getRandomObjectOnList=function(){return this.listOfObject.length<=0?-1:this.listOfObject[Math.floor(Math.random()*this.listOfObject.length)].uid},u.prototype.getRandomObjectVisibleOnList=function(){if(this.listOfObject.length<=0)return-1;for(var t=[],e=0;e<this.listOfObject.length;e++)this.listOfObject[e].visible&&t.push(this.listOfObject[e]);return t.length>0?t[Math.floor(Math.random()*t.length)].uid:-1},u.prototype.isOnMovement=function(){return!(this.listOfObject.length<=0)&&(0!=this.inertialVelocity||0!=this.roundScroll_smoothScrollToMove)},u.prototype.setActualPos=function(t){t>this.offsetScroll?this.actualDirection=-1:t<this.offsetScroll&&(this.actualDirection=1)},u.prototype.resetMove=function(){this.actualDirection=0,this.stopImpulsion(),this.stopMoveRoundScroll()},u.prototype.setScroll=function(t){this.listOfObjectVisible*this.offset<=this.height||(this.setActualPos(t),this.offsetScroll=t,this.clampScroll())},u.prototype.addScroll=function(t){this.setScroll(t+this.offsetScroll)},u.prototype.setScrollPercent=function(t){this.setScroll(this.getScrollByPercent(t))},u.prototype.addScrollPercent=function(t){this.setScrollPercent(t+this.getScrollPercent())},u.prototype.endMove=function(){if(this.roundScroll)if(this.roundScroll_activeSmooth){if(this.listOfObjectVisible>1){var t=this.offsetScroll;this.actualDirection<0?t=this.getScrollByPercent(r(this.getScrollPercent(),100/(this.listOfObjectVisible-1))):this.actualDirection>0&&(t=this.getScrollByPercent(o(this.getScrollPercent(),100/(this.listOfObjectVisible-1))));var e=t-this.offsetScroll;this.roundScroll_smoothScrollToMove=e,0==e&&this.endMoveRoundScroll()}}else this.endMoveRoundScroll();else this.activeCallback.listEndMoved&&c2_callFunction(C2FUNC.listEndMoved,[this.listName])},u.prototype.endMoveRoundScroll=function(){this.roundScroll&&(this.listOfObjectVisible>1&&this.setScroll(this.getScrollByPercent(n(this.getScrollPercent(),100/(this.listOfObjectVisible-1)))),this.activeCallback.listEndMoved&&c2_callFunction(C2FUNC.listEndMoved,[this.listName],"scrollList"))},u.prototype.stopMoveRoundScroll=function(){this.roundScroll_smoothScrollToMove=0},u.prototype.getScrollPercent=function(){return Math.abs(100*(this.offsetScroll-this.offset/2)/(this.maxScroll-this.offset/2))},u.prototype.getScrollByPercent=function(t){return(this.maxScroll-this.offset/2)*t/100+this.offset/2},u.prototype.addImpulsion=function(t){this.inertialVelocity=t},u.prototype.stopImpulsion=function(){this.inertialVelocity=0},u.prototype.clampScroll=function(){this.offsetScroll=s(this.offsetScroll,this.maxScroll,this.offset/2)},u.prototype.calculMaxScroll=function(){this.maxScroll=this.height+this.offset/2-this.offset*this.listOfObjectVisible},u.prototype.addToList=function(t,e,i){if(this.isObjectOnListExist(t))return this.listOfObjectUid[t].update(),!1;i=void 0===i||-1==i?this.listOfObject.length:s(i,0,this.listOfObject.length);for(var n=0;n<this.listOfObject.length;n++)this.listOfObject[n].pos>=i&&this.listOfObject[n].moveCaseByLogic(1);var r=(new p).create(this,e,i,!0);this.listOfObjectUid[t]=r,this.listOfObject.push(r),this.updateVisibility=!0,this.calculMaxScroll(),this.clampScroll()},u.prototype.removeToList=function(t){if(!this.isObjectOnListExist(t))return!1;for(var e,i,s=0;s<this.listOfObject.length;s++)if(this.listOfObject[s].uid===t){e=s,i=this.listOfObject[s].pos;break}if(void 0!==i){for(s=0;s<this.listOfObject.length;s++)this.listOfObject[s].pos>i&&this.listOfObject[s].moveCaseByLogic(-1);this.listOfObject[e].visible&&this.listOfObjectVisible--;var n=this.listOfObject[e];delete this.listOfObjectUid[t],this.listOfObject.splice(e,1),n.removeIt(),n=void 0,this.updateVisibility=!0,this.calculMaxScroll(),this.clampScroll()}else console.log("NEW CASE TO REMOVE FROM THE LIST IS NOT FOUND")},u.prototype.removeAll=function(){for(var t in this.listOfObjectUid)this.removeToList(parseInt(t))},u.prototype.update=function(t){if(this.activated){if(this.updateVisibility&&this.updateObjVisibility(),0!=this.inertialVelocity){this.addScroll(this.inertialVelocity*this.INERTIA_SCROLL_FACTOR*t),this.inertialVelocity=this.inertialVelocity*(1-this.INERTIA_ACCELERATION*t);var e=this.offsetScroll;(Math.abs(this.inertialVelocity)<this.INERTIA_THRESHOLD||e!=this.offsetScroll)&&(this.inertialVelocity=0,this.endMove())}if(0!=this.roundScroll_smoothScrollToMove){var i=this.roundScroll_smoothScrollToMove*this.roundScroll_smoothSpeed*t;this.addScroll(i),this.roundScroll_smoothScrollToMove-=i,Math.abs(this.roundScroll_smoothScrollToMove)<this.roundScroll_THRESHOLD&&(this.roundScroll_smoothScrollToMove=0,this.endMoveRoundScroll())}for(var s=0;s<this.listOfObject.length;s++)this.listOfObject[s].update(t)}},u.prototype.updateObjVisibility=function(){var t=0;this.listOfObject.sort(function(t,e){return t.pos-e.pos});for(var e=0;e<this.listOfObject.length;e++)this.listOfObject[e].posToShow=this.listOfObject[e].visible?t++:-1;this.listOfObjectVisible=t,this.updateVisibility=!1,this.calculMaxScroll(),this.clampScroll()};var p=function(){};p.prototype.create=function(t,e,i,s){return this.list=t,this.object=e,this.pos=void 0!==i?i:-1,this.posToShow=this.pos,this.visible=void 0===s||s,this.uid=this.object.uid,this.canMove=!0,this.update(),this},p.prototype.removeIt=function(){this.list.activeCallback.objListRemoved&&c2_callFunction(C2FUNC.objListRemoved,[this.uid],"scrollList")},p.prototype.setCanMove=function(t){this.canMove=t},p.prototype.moveCaseByLogic=function(t){this.pos+=t,this.visible&&(this.posToShow+=t,this.update())},p.prototype.update=function(){if(this.list.activated&&this.canMove&&-2!=this.posToShow){var t=this.list.orientation==a.VERTICAL?this.list.startPos:this.getPosObject(),e=this.list.orientation==a.HORIZONTAL?this.list.startPos:this.getPosObject();if(null!=this.list.clampMinPosObject&&null!=this.list.clampMaxPosObject){var i=this.list.clampMinPosObject+this.posToShow*this.list.offsetBetweenClamp,n=this.list.clampMaxPosObject-(this.list.listOfObjectVisible-1-this.posToShow)*this.list.offsetBetweenClamp;this.list.orientation==a.HORIZONTAL&&(t=s(t,i,n)),this.list.orientation==a.VERTICAL&&(e=s(e,i,n))}t==this.object.x&&e==this.object.y||(this.object.x=t,this.object.y=e,this.object.set_bbox_changed(),this.list.activeCallback.objListMoved&&c2_callFunction(C2FUNC.objListMoved,[this.object.uid],"scrollList")),-1==this.posToShow&&this.posToShow}},p.prototype.setVisible=function(t){return this.visible!=t&&(this.visible=t,!0)},p.prototype.getPosObject=function(){return this.list.offsetStart+this.list.offsetScroll+(this.posToShow+(-1!=this.list.temporaryPos&&this.posToShow>=this.list.temporaryPos?1:0))*this.list.offset},p.prototype.getPercentOnList=function(){var t=this.getPosObject()-this.list.offsetStart,e=this.list.maxScroll,i=this.list.height,n=0;if(null!=this.list.clampMinPosObject&&null!=this.list.clampMaxPosObject){n=this.list.clampMinPosObject+this.posToShow*this.list.offsetBetweenClamp-this.list.offsetStart;var r=this.list.clampMaxPosObject-(this.list.listOfObjectVisible-1-this.posToShow)*this.list.offsetBetweenClamp-this.list.offsetStart;this.list.orientation==a.HORIZONTAL&&(t=s(t,n,r)),this.list.orientation==a.VERTICAL&&(t=s(t,n,r)),e=n,i=r}return t<0||n<0?100*(t-e)/(i-e):Math.abs(100*t/(i-e))}}(),cr.plugins_.playtouch_textEnhanced=function(t){this.runtime=t},function(){function t(){return m.length?m.pop():{}}function e(t){m.push(t)}function i(t){var i,s;for(i=0,s=t.length;i<s;i++)e(t[i]);cr.clearArray(t)}function s(t){return t.length&&" "===t.charAt(t.length-1)?t.substring(0,t.length-1):t}function n(){}function r(){}function o(){}var a=cr.plugins_.playtouch_textEnhanced.prototype;a.onCreate=function(){a.acts.SetWidth=function(t){this.width!==t&&(this.width=t,this.text_changed=!0,this.set_bbox_changed())}},a.Type=function(t){this.plugin=t,this.runtime=t.runtime};var h=a.Type.prototype;h.onCreate=function(){},h.onLostWebGLContext=function(){var t,e,i;if(!this.is_family)for(t=0,e=this.instances.length;t<e;t++)i=this.instances[t],i.mycanvas=null,i.myctx=null,i.mytex=null},a.Instance=function(t){this.type=t,this.runtime=t.runtime,this.recycled?cr.clearArray(this.lines):this.lines=[],this.text_changed=!0};var c=a.Instance.prototype,l={},u={word:0,character:1,noWrap:2},p=["butt","round","square"],d={butt:0,round:1,square:2},f=["round","bevel","miter"],g={round:0,bevel:1,miter:2};c.onCreate=function(){this.text=this.properties[0],this.visible=0===this.properties[1],this.font=this.properties[2],this.color=this.properties[3],this.halign=this.properties[4],this.valign=this.properties[5],this.wrapType=this.properties[7],this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height,this.line_height_offset=this.properties[8],this.fixSameDisplay=!this.properties[9],this.fixVAlignCenter=!this.properties[10],this.hasStroke=!this.properties[11],this.strokeStyle=this.properties[12],this.lineWidth=this.properties[13],this.lineCap=this.properties[14],this.lineJoin=this.properties[15],this.hasShadow=!this.properties[16],this.shadowColor=this.properties[17],this.shadowBlur=this.properties[18],this.shadowOffsetX=this.properties[19],this.shadowOffsetY=this.properties[20],this.facename="",this.fontstyle="",this.ptSize=0,this.textWidth=0,this.textHeight=0,this.parseFont(),this.mycanvas=null,this.myctx=null,this.mytex=null,this.need_text_redraw=!1,this.last_render_tick=this.runtime.tickcount,this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1),this.runtime.glwrap&&this.runtime.tickMe(this)},c.parseFont=function(){var t,e=this.font.split(" ");for(t=0;t<e.length;t++)if("pt"===e[t].substr(e[t].length-2,2)){for(this.ptSize=parseInt(e[t].substr(0,e[t].length-2)),this.pxHeight=Math.ceil(this.ptSize/72*96)+4,t>0&&(this.fontstyle=e[t-1]),this.facename=e[t+1],t+=2;t<e.length;t++)this.facename+=" "+e[t];break}},c.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapType,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}},c.loadFromJSON=function(t){this.text=t.t,this.font=t.f,this.color=t.c,this.halign=t.ha,this.valign=t.va,this.wrapType=t.wr,this.line_height_offset=t.lho,this.facename=t.fn,this.fontstyle=t.fs,this.ptSize=t.ps,this.pxHeight=t.pxh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,this.text_changed=!0,this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height},c.tick=function(){if(this.runtime.glwrap&&this.mytex&&this.runtime.tickcount-this.last_render_tick>=300){var t=this.layer;this.update_bbox();var e=this.bbox;(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)&&(this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null,this.myctx=null,this.mycanvas=null)}},c.onDestroy=function(){this.myctx=null,this.mycanvas=null,this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null},c.updateFont=function(){this.font=this.fontstyle+" "+this.ptSize.toString()+"pt "+this.facename,this.text_changed=!0,this.runtime.redraw=!0},c.draw=function(t,e){t.font=this.font,this.fixSameDisplay?t.textBaseline="alphabetic":t.textBaseline="top",t.fillStyle=this.color,t.globalAlpha=e?1:this.opacity;var i=1;e&&(i=Math.abs(this.layer.getScale()),t.save(),t.scale(i,i)),(this.text_changed||this.width!==this.lastwrapwidth)&&(this.WordWrap(this.text,this.lines,t,this.width,this.wrapType),this.text_changed=!1,this.lastwrapwidth=this.width),this.update_bbox();var s=(e?0:this.bquad.tlx)+(this.hasStroke?this.lineWidth:0)+(this.hasShadow?Math.abs(this.shadowOffsetX):0),n=(e?0:this.bquad.tly)+(this.hasStroke?this.lineWidth:0)+(this.hasShadow?Math.abs(this.shadowOffsetY):0);this.runtime.pixel_rounding&&(s=s+.5|0,n=n+.5|0),0===this.angle||e||(t.save(),t.translate(s,n),t.rotate(this.angle),s=0+(this.hasStroke?this.lineWidth:0)+(this.hasShadow?Math.abs(this.shadowOffsetX):0),n=0+(this.hasStroke?this.lineWidth:0)+(this.hasShadow?Math.abs(this.shadowOffsetY):0));var r,o,a,h=n+this.height+(this.hasStroke?this.lineWidth:0)+(this.hasShadow?Math.abs(this.shadowOffsetY):0),c=this.pxHeight;for(c+=this.line_height_offset,0===this.valign&&(t.textBaseline="top",this.fixSameDisplay&&(t.textBaseline="alphabetic",n+=Math.max(c/2+2,0)),this.fixVAlignCenter&&(n+=this.ptSize/2)),1===this.valign?(n+=Math.max(this.height/2-this.lines.length*c/2,0),this.fixSameDisplay&&(t.textBaseline="alphabetic"),this.fixVAlignCenter&&(n+=this.ptSize)):2===this.valign&&(t.textBaseline="top",n+=Math.max(this.height-this.lines.length*c-2,0),this.fixSameDisplay&&(t.textBaseline="alphabetic"),this.fixVAlignCenter&&(n+=this.ptSize)),a=0;a<this.lines.length&&(r=s,o=n,1===this.halign?r=s+(this.width-this.lines[a].width)/2:2===this.halign&&(r=s+(this.width-this.lines[a].width)),this.hasStroke&&t.save(),this.hasShadow&&(t.save(),t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.fillText(this.lines[a].text,r,o),t.restore()),this.hasStroke&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=p[this.lineCap],t.lineJoin=f[this.lineJoin],t.strokeText(this.lines[a].text,r,o),t.restore()),t.fillText(this.lines[a].text,r,o),this.hasStroke&&this.hasShadow&&t.restore(),n+=c,!(n>=h-c));a++);(0!==this.angle||e)&&t.restore(),this.last_render_tick=this.runtime.tickcount},c.drawGL=function(t){if(!(this.width<1||this.height<1)){var e=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var i=this.layer.getScale(),s=this.layer.getAngle(),n=this.rcTex,r=i*(this.width+(this.hasStroke?2*this.lineWidth:0)+(this.hasShadow?2*Math.abs(this.shadowOffsetX):0)),o=i*(this.height+(this.hasStroke?2*this.lineWidth:0)+(this.hasShadow?2*Math.abs(this.shadowOffsetY):0)),a=Math.ceil(r),h=Math.ceil(o),c=Math.abs(a),l=Math.abs(h),u=this.runtime.draw_width/2+(this.hasStroke?2*this.lineWidth:0)+(this.hasShadow?2*Math.abs(this.shadowOffsetX):0),p=this.runtime.draw_height/2+(this.hasStroke?2*this.lineWidth:0)+(this.hasShadow?2*Math.abs(this.shadowOffsetY):0);this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=c,this.mycanvas.height=l,this.lastwidth=c,this.lastheight=l,e=!0,this.myctx=this.mycanvas.getContext("2d")),c===this.lastwidth&&l===this.lastheight||(this.mycanvas.width=c,this.mycanvas.height=l,this.mytex&&(t.deleteTexture(this.mytex),this.mytex=null),e=!0),e&&(this.myctx.clearRect(0,0,c,l),this.draw(this.myctx,!0),this.mytex||(this.mytex=t.createEmptyTexture(c,l,this.runtime.linearSampling,this.runtime.isMobile)),t.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile)),this.lastwidth=c,this.lastheight=l,t.setTexture(this.mytex),t.setOpacity(this.opacity),t.resetModelView(),t.translate(-u,-p),t.updateModelView();var d=this.bquad,f=this.layer.layerToCanvas(d.tlx,d.tly,!0,!0),g=this.layer.layerToCanvas(d.tlx,d.tly,!1,!0),y=this.layer.layerToCanvas(d.trx,d.try_,!0,!0),m=this.layer.layerToCanvas(d.trx,d.try_,!1,!0),_=this.layer.layerToCanvas(d.brx,d.bry,!0,!0),v=this.layer.layerToCanvas(d.brx,d.bry,!1,!0),b=this.layer.layerToCanvas(d.blx,d.bly,!0,!0),x=this.layer.layerToCanvas(d.blx,d.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===s){var w=(f+.5|0)-f,S=(g+.5|0)-g;f+=w,g+=S,y+=w,m+=S,_+=w,v+=S,b+=w,x+=S}0===this.angle&&0===s?(y=f+a,m=g,_=y,v=g+h,b=f,x=v,n.right=1,n.bottom=1):(n.right=r/a,n.bottom=o/h),t.quadTex(f,g,y,m,_,v,b,x,n),t.resetModelView(),t.scale(i,i),t.rotateZ(-this.layer.getAngle()),t.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2),t.updateModelView(),this.last_render_tick=this.runtime.tickcount}};var y=[];c.TokeniseWords=function(t){cr.clearArray(y);for(var e,i="",s=0;s<t.length;)if(e=t.charAt(s),"\n"===e)i.length&&(y.push(i),i=""),y.push("\n"),++s;else if(" "===e||"\t"===e||"-"===e){do{i+=t.charAt(s),s++}while(s<t.length&&(" "===t.charAt(s)||"\t"===t.charAt(s)));y.push(i),i=""}else s<t.length&&(i+=e,s++);i.length&&y.push(i)};var m=[];c.WordWrap=function(e,s,n,r,o){if(e&&e.length)if(r<=2)i(s);else{if(e.length<=100&&-1===e.indexOf("\n")){var a=n.measureText(e).width;if(a<=r)return i(s),s.push(t()),s[0].text=e,void(s[0].width=a)}this.WrapText(e,s,n,r,o)}else i(s)},c.WrapText=function(n,r,o,a,h){if(this.wrapType==u.noWrap)return i(r),r.push(t()),r[0].text=n,void(r[0].width=o.measureText(n).width);var c;h==u.word?(this.TokeniseWords(n),c=y):c=n;var l,p,d,f,g="",m=0;for(d=0;d<c.length;d++)"\n"!==c[d]?(l=g,g+=c[d],p=o.measureText(g).width,p>=a&&(m>=r.length&&r.push(t()),l=s(l),f=r[m],f.text=l,f.width=o.measureText(l).width,m++,g=c[d],h==u.character&&" "===g&&(g=""))):(m>=r.length&&r.push(t()),g=s(g),f=r[m],f.text=g,f.width=o.measureText(g).width,m++,g="");for(g.length&&(m>=r.length&&r.push(t()),g=s(g),f=r[m],f.text=g,f.width=o.measureText(g).width,m++),d=m;d<r.length;d++)e(r[d]);r.length=m},c.getTextPtByWidth=function(t,e,i,s){var n=1;for(s=void 0===s?100:s,i=void 0===i?1:i;e>this.type.plugin.getTextWidth(t,this.fontstyle+" "+(n+i)+"pt "+this.facename);)if(n+=i,n>s){n=s;break}return parseInt(10*n)/10},a.getTextWidth=function(t,e){var i=this.canvas||(this.canvas=document.createElement("canvas")),s=i.getContext("2d");s.font=e;var n=s.measureText(t);return n.width},n.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},a.cnds=new n,r.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);var e=t.toString();this.text!==e&&(this.text=e,this.text_changed=!0,this.runtime.redraw=!0)},r.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);var e=t.toString();e&&(this.text+=e,this.text_changed=!0,this.runtime.redraw=!0)},r.prototype.SetFontFace=function(t,e){var i="";switch(e){case 1:i="bold";break;case 2:i="italic";break;case 3:i="bold italic"}t===this.facename&&i===this.fontstyle||(this.facename=t,this.fontstyle=i,this.updateFont())},r.prototype.SetFontSize=function(t){this.ptSize!==t&&(this.ptSize=t,this.pxHeight=Math.ceil(this.ptSize/72*96)+4,this.updateFont())},r.prototype.SetFontColor=function(t){var e="rgb("+cr.GetRValue(t).toString()+","+cr.GetGValue(t).toString()+","+cr.GetBValue(t).toString()+")";e!==this.color&&(this.color=e,this.need_text_redraw=!0,this.runtime.redraw=!0)},r.prototype.SetWebFont=function(t,e){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");else{var i=this,s=function(){i.runtime.redraw=!0,i.text_changed=!0};if(l.hasOwnProperty(e)){var n="'"+t+"'";if(this.facename===n)return;this.facename=n,this.updateFont();for(var r=1;r<10;r++)setTimeout(s,100*r),setTimeout(s,1e3*r)}else{var o=document.createElement("link");o.href=e,o.rel="stylesheet",o.type="text/css",o.onload=s,document.getElementsByTagName("head")[0].appendChild(o),l[e]=!0,this.facename="'"+t+"'",this.updateFont();for(r=1;r<10;r++)setTimeout(s,100*r),setTimeout(s,1e3*r)}}},r.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},r.prototype.SetWrapingMode=function(t){this.wrapType=t,this.updateFont()},r.prototype.SetTextToBoxSize=function(t,e){this.type.plugin.acts.SetFontSize.call(this,this.getTextPtByWidth(this.text,this.width,t,e))},r.prototype.setHorizontalAlign=function(t){this.halign=t,this.need_text_redraw=!0},r.prototype.setVerticalAlign=function(t){this.valign=t,this.need_text_redraw=!0},r.prototype.setLineHeight=function(t){this.line_height_offset=t,this.need_text_redraw=!0},r.prototype.setSameDisplay=function(t){this.fixSameDisplay=!t},r.prototype.setVAlignCenter=function(t){this.fixVAlignCenter=!t},r.prototype.preloadWebFont=function(t,e){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");else{-1!=t.lastIndexOf("&")&&(e=t.split("&")[0],t=t.split("&")[1]);var i=function(t){"undefined"!=typeof document&&void 0!==document.fonts&&void 0!==document.fonts.load&&document.fonts.load("10pt "+t)}.bind(this,"'"+t+"'");if(l.hasOwnProperty(e)){i();for(var s=1;s<10;s++)setTimeout(i,100*s),setTimeout(i,1e3*s)}else{var n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=i;for(s=1;s<10;s++)setTimeout(i,100*s),setTimeout(i,1e3*s);document.getElementsByTagName("head")[0].appendChild(n),l[e]=!0}}};var _={toLower:function(t){return(t+"").toLocaleLowerCase()},toUpper:function(t){return(t+"").toLocaleUpperCase()},UCFirst:function(t){return(t+"").charAt(0).toLocaleUpperCase()+(t+"").slice(1)}};_.Capitalize=_.UCFirst,_.UCWords=function(t){return(t+"").replace(/^(.)|\s+(.)/g,function(t){return(t+"").toLocaleUpperCase()})};var v=function(t,e){var i=e.split("|"),s=i.pop();for(s="string"==typeof this[s]?this[s]:"string"==typeof this.__defaultValue?this.__defaultValue:t;i.length;){var n=i.pop();"function"==typeof _[n]&&(s=_[n](s))}return s};_.parse=function(t,e,i){return"string"!=typeof t&&(t=""),"object"!=typeof e&&(e={}),i="string"==typeof i?new RegExp(i,"g"):new RegExp(/{([a-zA-Z0-9\_\|]+)}/,"g"),t.replace(i,v.bind(e))},r.prototype.parseText=function(t,e,i,s,n){try{e=JSON.parse(e)}catch(t){console.error("Parsing object is not a valid JSON",t),e={}}for(i.map(function(t,i){try{t=JSON.parse(t)}catch(e){console.error("Additional parsing object #"+i+" is not a valid JSON",e),t={}}e=Object.assign(e,t)});s-- >0;)t=_.parse(t,e,n);this.type.plugin.acts.SetText.call(this,t)},r.prototype.parseCurrentText=function(t,e,i,s){var n=this.text;try{t=JSON.parse(t)}catch(e){console.error("Parsing object is not a valid JSON",e),t={}}for(e.map(function(e,i){try{e=JSON.parse(e)}catch(t){console.error("Additional parsing object #"+i+" is not a valid JSON",t),e={}}t=Object.assign(t,e)});i-- >0;)n=_.parse(n,t,s);this.type.plugin.acts.SetText.call(this,n)},r.prototype.setStroke=function(t,e,i,s,n){this.hasStroke=!t,this.strokeStyle=e,this.lineWidth=i,this.lineCap=s,this.lineJoin=n,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setStrokeColor=function(t){this.strokeStyle=t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setStrokeWidth=function(t){this.lineWidth=t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.activeStroke=function(t){this.hasStroke=!t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setStrokeJoin=function(t){this.lineJoin=t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setStrokeCap=function(t){this.lineCap=t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setStrokeJoinAsString=function(t){void 0===g[t]&&(t=f[0]),this.lineJoin=g[t],this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setStrokeCapAsString=function(t){void 0===d[t]&&(t=p[0]),this.lineCap=d[t],this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setShadow=function(t,e,i,s,n){this.hasShadow=!t,this.shadowColor=e,this.shadowBlur=i,this.shadowOffsetX=s,this.shadowOffsetX=n,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.activeShadow=function(t){this.hasShadow=!t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setShadowColor=function(t){this.shadowColor=t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setShadowBlur=function(t){this.shadowBlur=t,this.need_text_redraw=!0,this.runtime.redraw=!0},r.prototype.setShadowOffsets=function(t,e){this.shadowOffsetX=t,this.shadowOffsetY=e,this.need_text_redraw=!0,this.runtime.redraw=!0},a.acts=new r,o.prototype.Text=function(t){t.set_string(this.text)},o.prototype.FaceName=function(t){t.set_string(this.facename)},o.prototype.FaceSize=function(t){t.set_float(this.ptSize)},o.prototype.TextWidth=function(t){var e,i,s,n=0;for(e=0,i=this.lines.length;e<i;e++)s=this.lines[e].width,n<s&&(n=s);t.set_int(n)},o.prototype.TextHeight=function(t){t.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)},o.prototype.getTextWidthByPt=function(t,e,i,s,n){t.set_int(this.type.plugin.getTextWidth(e,this.fontstyle+" "+i+"pt "+this.facename,s,n))},o.prototype.getTextPtByWidth=function(t,e,i,s,n){t.set_float(this.getTextPtByWidth(e,i,s,n))},o.prototype.getLineHeight=function(t){t.set_float(this.line_height_offset)},o.prototype.getParsedText=function(t){if(arguments.length<2)throw"getParsedText must have the following arguments : (text to parse, parseObj1 [, parseObjN...], passes, regex)";for(var e=1,i=arguments[e++],s=arguments.length>2?arguments[e++]:"{}",n=[];e<arguments.length&&"string"==typeof arguments[e];)n.push(arguments[e++]);var r=e<arguments.length?arguments[e++]:1,o=e<arguments.length&&"string"==typeof arguments[e]?new RegExp(arguments[e],"g"):new RegExp(/{([a-zA-Z0-9\_\|]+)}/,"g");try{s=JSON.parse(s)}catch(t){console.error("Parsing object is not a valid JSON",t),s={}}for(n.map(function(t,e){try{t=JSON.parse(t)}catch(i){console.error("Additional parsing object #"+e+" is not a valid JSON",i),t={}}s=Object.assign(s,t)});r-- >0;)i=_.parse(i,s,o);t.set_string(i)},o.prototype.strokeColor=function(t){t.set_string(this.strokeStyle)},o.prototype.strokeWidth=function(t){t.set_float(this.lineWidth)},o.prototype.strokeCap=function(t){t.set_string(p[this.lineCap])},o.prototype.strokeJoin=function(t){t.set_string(f[this.lineJoin])},o.prototype.shadowColor=function(t){t.set_string(this.shadowColor)},o.prototype.shadowBlur=function(t){t.set_float(this.shadowBlur)},o.prototype.shadowOffsetX=function(t){t.set_float(this.shadowOffsetX)},o.prototype.shadowOffsetY=function(t){t.set_float(this.shadowOffsetY)},a.exps=new o}(),cr.behaviors.Anchor=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Anchor.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.anch_left=this.properties[0],this.anch_top=this.properties[1],this.anch_right=this.properties[2],this.anch_bottom=this.properties[3],this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=0!==this.properties[4]},r.saveToJSON=function(){return{xleft:this.xleft,ytop:this.ytop,xright:this.xright,ybottom:this.ybottom,rdiff:this.rdiff,bdiff:this.bdiff,enabled:this.enabled}},r.loadFromJSON=function(t){this.xleft=t.xleft,this.ytop=t.ytop,this.xright=t.xright,this.ybottom=t.ybottom,this.rdiff=t.rdiff,this.bdiff=t.bdiff,this.enabled=t.enabled},r.tick=function(){if(this.enabled){var t,e=this.inst.layer,i=this.inst,s=this.inst.bbox;0===this.anch_left?(i.update_bbox(),t=e.viewLeft+this.xleft-s.left,0!==t&&(i.x+=t,i.set_bbox_changed())):1===this.anch_left&&(i.update_bbox(),t=e.viewRight-this.xright-s.left,0!==t&&(i.x+=t,i.set_bbox_changed())),0===this.anch_top?(i.update_bbox(),t=e.viewTop+this.ytop-s.top,0!==t&&(i.y+=t,i.set_bbox_changed())):1===this.anch_top&&(i.update_bbox(),t=e.viewBottom-this.ybottom-s.top,0!==t&&(i.y+=t,i.set_bbox_changed())),1===this.anch_right&&(i.update_bbox(),t=e.viewRight-this.rdiff-s.right,0!==t&&(i.width+=t,i.width<0&&(i.width=0),i.set_bbox_changed())),1===this.anch_bottom&&(i.update_bbox(),t=e.viewBottom-this.bdiff-s.bottom,0!==t&&(i.height+=t,i.height<0&&(i.height=0),i.set_bbox_changed()))}},s.cnds=new t,e.prototype.SetEnabled=function(t){this.enabled&&0===t?this.enabled=!1:this.enabled||0===t||(this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,
this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=!0)},s.acts=new e,s.exps=new i}(),cr.behaviors.Bullet=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Bullet.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){var t=this.properties[0];this.acc=this.properties[1],this.g=this.properties[2],this.bounceOffSolid=0!==this.properties[3],this.setAngle=0!==this.properties[4],this.dx=Math.cos(this.inst.angle)*t,this.dy=Math.sin(this.inst.angle)*t,this.lastx=this.inst.x,this.lasty=this.inst.y,this.lastKnownAngle=this.inst.angle,this.travelled=0,this.enabled=0!==this.properties[5]},r.saveToJSON=function(){return{acc:this.acc,g:this.g,dx:this.dx,dy:this.dy,lx:this.lastx,ly:this.lasty,lka:this.lastKnownAngle,t:this.travelled,e:this.enabled}},r.loadFromJSON=function(t){this.acc=t.acc,this.g=t.g,this.dx=t.dx,this.dy=t.dy,this.lastx=t.lx,this.lasty=t.ly,this.lastKnownAngle=t.lka,this.travelled=t.t,this.enabled=t.e},r.tick=function(){if(this.enabled){var t,e,i,s,n=this.runtime.getDt(this.inst);this.inst.angle!==this.lastKnownAngle&&(this.setAngle&&(t=cr.distanceTo(0,0,this.dx,this.dy),this.dx=Math.cos(this.inst.angle)*t,this.dy=Math.sin(this.inst.angle)*t),this.lastKnownAngle=this.inst.angle),0!==this.acc&&(t=cr.distanceTo(0,0,this.dx,this.dy),e=0===this.dx&&0===this.dy?this.inst.angle:cr.angleTo(0,0,this.dx,this.dy),t+=this.acc*n,t<0&&(t=0),this.dx=Math.cos(e)*t,this.dy=Math.sin(e)*t),0!==this.g&&(this.dy+=this.g*n),this.lastx=this.inst.x,this.lasty=this.inst.y,0===this.dx&&0===this.dy||(this.inst.x+=this.dx*n,this.inst.y+=this.dy*n,this.travelled+=cr.distanceTo(0,0,this.dx*n,this.dy*n),this.setAngle&&(this.inst.angle=cr.angleTo(0,0,this.dx,this.dy),this.inst.set_bbox_changed(),this.lastKnownAngle=this.inst.angle),this.inst.set_bbox_changed(),this.bounceOffSolid&&(i=this.runtime.testOverlapSolid(this.inst),i&&(this.runtime.registerCollision(this.inst,i),t=cr.distanceTo(0,0,this.dx,this.dy),s=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty),this.dx=Math.cos(s)*t,this.dy=Math.sin(s)*t,this.inst.x+=this.dx*n,this.inst.y+=this.dy*n,this.inst.set_bbox_changed(),this.setAngle&&(this.inst.angle=s,this.lastKnownAngle=s,this.inst.set_bbox_changed()),this.runtime.pushOutSolid(this.inst,this.dx/t,this.dy/t,Math.max(2.5*t*n,30))||this.runtime.pushOutSolidNearest(this.inst,100))))}},t.prototype.CompareSpeed=function(t,e){return cr.do_cmp(cr.distanceTo(0,0,this.dx,this.dy),t,e)},t.prototype.CompareTravelled=function(t,e){return cr.do_cmp(this.travelled,t,e)},s.cnds=new t,e.prototype.SetSpeed=function(t){var e=cr.angleTo(0,0,this.dx,this.dy);this.dx=Math.cos(e)*t,this.dy=Math.sin(e)*t},e.prototype.SetAcceleration=function(t){this.acc=t},e.prototype.SetGravity=function(t){this.g=t},e.prototype.SetAngleOfMotion=function(t){t=cr.to_radians(t);var e=cr.distanceTo(0,0,this.dx,this.dy);this.dx=Math.cos(t)*e,this.dy=Math.sin(t)*e},e.prototype.Bounce=function(t){if(t){var e=t.getFirstPicked(this.inst);if(e){var i=this.runtime.getDt(this.inst),s=cr.distanceTo(0,0,this.dx,this.dy),n=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty,e);this.dx=Math.cos(n)*s,this.dy=Math.sin(n)*s,this.inst.x+=this.dx*i,this.inst.y+=this.dy*i,this.inst.set_bbox_changed(),this.setAngle&&(this.inst.angle=n,this.lastKnownAngle=n,this.inst.set_bbox_changed()),this.bounceOffSolid?this.runtime.pushOutSolid(this.inst,this.dx/s,this.dy/s,Math.max(2.5*s*i,30))||this.runtime.pushOutSolidNearest(this.inst,100):0!==s&&this.runtime.pushOut(this.inst,this.dx/s,this.dy/s,Math.max(2.5*s*i,30),e)}}},e.prototype.SetDistanceTravelled=function(t){this.travelled=t},e.prototype.SetEnabled=function(t){this.enabled=1===t},s.acts=new e,i.prototype.Speed=function(t){var e=cr.distanceTo(0,0,this.dx,this.dy);e=cr.round6dp(e),t.set_float(e)},i.prototype.Acceleration=function(t){t.set_float(this.acc)},i.prototype.AngleOfMotion=function(t){t.set_float(cr.to_degrees(cr.angleTo(0,0,this.dx,this.dy)))},i.prototype.DistanceTravelled=function(t){t.set_float(this.travelled)},i.prototype.Gravity=function(t){t.set_float(this.g)},s.exps=new i}(),cr.behaviors.DragnDrop=function(t){this.runtime=t;var e=this;this.runtime.isDomFree||(jQuery(document).mousemove(function(t){e.onMouseMove(t)}),jQuery(document).mousedown(function(t){e.onMouseDown(t)}),jQuery(document).mouseup(function(t){e.onMouseUp(t)}));var i=this.runtime.fullscreen_mode>0?document:this.runtime.canvas;this.runtime.isDirectCanvas?i=window.Canvas:this.runtime.isCocoonJs&&(i=window),"undefined"!=typeof PointerEvent?(i.addEventListener("pointerdown",function(t){e.onPointerStart(t)},!1),i.addEventListener("pointermove",function(t){e.onPointerMove(t)},!1),i.addEventListener("pointerup",function(t){e.onPointerEnd(t)},!1),i.addEventListener("pointercancel",function(t){e.onPointerEnd(t)},!1)):window.navigator.msPointerEnabled?(i.addEventListener("MSPointerDown",function(t){e.onPointerStart(t)},!1),i.addEventListener("MSPointerMove",function(t){e.onPointerMove(t)},!1),i.addEventListener("MSPointerUp",function(t){e.onPointerEnd(t)},!1),i.addEventListener("MSPointerCancel",function(t){e.onPointerEnd(t)},!1)):(i.addEventListener("touchstart",function(t){e.onTouchStart(t)},!1),i.addEventListener("touchmove",function(t){e.onTouchMove(t)},!1),i.addEventListener("touchend",function(t){e.onTouchEnd(t)},!1),i.addEventListener("touchcancel",function(t){e.onTouchEnd(t)},!1))},function(){function t(t){var e,i;for(e=0,i=t.behavior_insts.length;e<i;e++)if(t.behavior_insts[e]instanceof n.Instance)return t.behavior_insts[e];return null}function e(){}function i(){}function s(){}var n=cr.behaviors.DragnDrop.prototype,r={left:0,top:0};n.onMouseDown=function(t){1===t.which&&this.onInputDown("leftmouse",t.pageX,t.pageY)},n.onMouseMove=function(t){1===t.which&&this.onInputMove("leftmouse",t.pageX,t.pageY)},n.onMouseUp=function(t){1===t.which&&this.onInputUp("leftmouse")},n.onTouchStart=function(t){var e,i,s,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)s=t.changedTouches[e],n=s.identifier,this.onInputDown(n?n.toString():"<none>",s.pageX,s.pageY)},n.onTouchMove=function(t){var e,i,s,n;for(t.preventDefault&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)s=t.changedTouches[e],n=s.identifier,this.onInputMove(n?n.toString():"<none>",s.pageX,s.pageY)},n.onTouchEnd=function(t){var e,i,s,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)s=t.changedTouches[e],n=s.identifier,this.onInputUp(n?n.toString():"<none>")},n.onPointerStart=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.onInputDown(t.pointerId.toString(),t.pageX,t.pageY))},n.onPointerMove=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&t.preventDefault(),this.onInputMove(t.pointerId.toString(),t.pageX,t.pageY))},n.onPointerEnd=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.onInputUp(t.pointerId.toString()))},n.onInputDown=function(e,i,s){var n,o,a,h,c,l,u,p,d=this.runtime.isDomFree?r:jQuery(this.runtime.canvas).offset(),f=i-d.left,g=s-d.top,y=this.my_instances.valuesRef(),m=null;for(c=0,l=y.length;c<l;c++)p=y[c],u=t(p),u.enabled&&!u.dragging&&(n=p.layer.canvasToLayer(f,g,!0),o=p.layer.canvasToLayer(f,g,!1),p.update_bbox(),p.contains_pt(n,o)&&(m?p.layer.index>m.layer.index?(m=p,a=n,h=o):p.layer.index===m.layer.index&&p.get_zindex()>m.get_zindex()&&(m=p,a=n,h=o):(m=p,a=n,h=o)));m&&t(m).onDown(e,a,h)},n.onInputMove=function(e,i,s){var n,o,a,h,c,l,u=this.runtime.isDomFree?r:jQuery(this.runtime.canvas).offset(),p=i-u.left,d=s-u.top,f=this.my_instances.valuesRef();for(a=0,h=f.length;a<h;a++)l=f[a],c=t(l),!c.enabled||!c.dragging||c.dragging&&c.dragsource!==e||(n=l.layer.canvasToLayer(p,d,!0),o=l.layer.canvasToLayer(p,d,!1),c.onMove(n,o))},n.onInputUp=function(e){var i,s,n,r,o=this.my_instances.valuesRef();for(i=0,s=o.length;i<s;i++)r=o[i],n=t(r),n.dragging&&n.dragsource===e&&n.onUp()},n.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var a=n.Instance.prototype;a.onCreate=function(){this.dragging=!1,this.dx=0,this.dy=0,this.dragsource="<none>",this.axes=this.properties[0],this.enabled=0!==this.properties[1]},a.saveToJSON=function(){return{enabled:this.enabled}},a.loadFromJSON=function(t){this.enabled=t.enabled,this.dragging=!1},a.onDown=function(t,e,i){this.dx=e-this.inst.x,this.dy=i-this.inst.y,this.dragging=!0,this.dragsource=t,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,this.inst),this.runtime.isInUserInputEvent=!1},a.onMove=function(t,e){var i=t-this.dx,s=e-this.dy;0===this.axes?this.inst.x===i&&this.inst.y===s||(this.inst.x=i,this.inst.y=s,this.inst.set_bbox_changed()):1===this.axes?this.inst.x!==i&&(this.inst.x=i,this.inst.set_bbox_changed()):2===this.axes&&this.inst.y!==s&&(this.inst.y=s,this.inst.set_bbox_changed())},a.onUp=function(){this.dragging=!1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDrop,this.inst),this.runtime.isInUserInputEvent=!1},a.tick=function(){},e.prototype.IsDragging=function(){return this.dragging},e.prototype.OnDragStart=function(){return!0},e.prototype.OnDrop=function(){return!0},e.prototype.IsEnabled=function(){return!!this.enabled},n.cnds=new e,i.prototype.SetEnabled=function(t){this.enabled=0!==t,this.enabled||(this.dragging=!1)},i.prototype.Drop=function(){this.dragging&&this.onUp()},n.acts=new i,n.exps=new s}(),cr.behaviors.Fade=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Fade.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.activeAtStart=1===this.properties[0],this.setMaxOpacity=!1,this.fadeInTime=this.properties[1],this.waitTime=this.properties[2],this.fadeOutTime=this.properties[3],this.destroy=this.properties[4],this.stage=this.activeAtStart?0:3,this.recycled?this.stageTime.reset():this.stageTime=new cr.KahanAdder,this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.activeAtStart&&(0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0))},r.saveToJSON=function(){return{fit:this.fadeInTime,wt:this.waitTime,fot:this.fadeOutTime,s:this.stage,st:this.stageTime.sum,mo:this.maxOpacity}},r.loadFromJSON=function(t){this.fadeInTime=t.fit,this.waitTime=t.wt,this.fadeOutTime=t.fot,this.stage=t.s,this.stageTime.reset(),this.stageTime.sum=t.st,this.maxOpacity=t.mo},r.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst)),0===this.stage&&(this.inst.opacity=this.stageTime.sum/this.fadeInTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity>=this.maxOpacity&&(this.inst.opacity=this.maxOpacity,this.stage=1,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst))),1===this.stage&&this.stageTime.sum>=this.waitTime&&(this.stage=2,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst)),2===this.stage&&0!==this.fadeOutTime&&(this.inst.opacity=this.maxOpacity-this.stageTime.sum/this.fadeOutTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity<0&&(this.inst.opacity=0,this.stage=3,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst),1===this.destroy&&this.runtime.DestroyInstance(this.inst)))},r.doStart=function(){this.stage=0,this.stageTime.reset(),0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0)},t.prototype.OnFadeOutEnd=function(){return!0},t.prototype.OnFadeInEnd=function(){return!0},t.prototype.OnWaitEnd=function(){return!0},s.cnds=new t,e.prototype.StartFade=function(){this.activeAtStart||this.setMaxOpacity||(this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.setMaxOpacity=!0),3===this.stage&&this.doStart()},e.prototype.RestartFade=function(){this.doStart()},e.prototype.SetFadeInTime=function(t){t<0&&(t=0),this.fadeInTime=t},e.prototype.SetWaitTime=function(t){t<0&&(t=0),this.waitTime=t},e.prototype.SetFadeOutTime=function(t){t<0&&(t=0),this.fadeOutTime=t},s.acts=new e,i.prototype.FadeInTime=function(t){t.set_float(this.fadeInTime)},i.prototype.WaitTime=function(t){t.set_float(this.waitTime)},i.prototype.FadeOutTime=function(t){t.set_float(this.fadeOutTime)},s.exps=new i}(),cr.behaviors.Flash=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Flash.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.ontime=0,this.offtime=0,this.stage=0,this.stagetimeleft=0,this.timeleft=0},r.saveToJSON=function(){return{ontime:this.ontime,offtime:this.offtime,stage:this.stage,stagetimeleft:this.stagetimeleft,timeleft:this.timeleft}},r.loadFromJSON=function(t){this.ontime=t.ontime,this.offtime=t.offtime,this.stage=t.stage,this.stagetimeleft=t.stagetimeleft,this.timeleft=t.timeleft,null===this.timeleft&&(this.timeleft=1/0)},r.tick=function(){if(!(this.timeleft<=0)){var t=this.runtime.getDt(this.inst);if(this.timeleft-=t,this.timeleft<=0)return this.timeleft=0,this.inst.visible=!0,this.runtime.redraw=!0,void this.runtime.trigger(cr.behaviors.Flash.prototype.cnds.OnFlashEnded,this.inst);this.stagetimeleft-=t,this.stagetimeleft<=0&&(0===this.stage?(this.inst.visible=!1,this.stage=1,this.stagetimeleft+=this.offtime):(this.inst.visible=!0,this.stage=0,this.stagetimeleft+=this.ontime),this.runtime.redraw=!0)}},t.prototype.IsFlashing=function(){return this.timeleft>0},t.prototype.OnFlashEnded=function(){return!0},s.cnds=new t,e.prototype.Flash=function(t,e,i){this.ontime=t,this.offtime=e,this.stage=1,this.stagetimeleft=e,this.timeleft=i,this.inst.visible=!1,this.runtime.redraw=!0},e.prototype.StopFlashing=function(){this.timeleft=0,this.inst.visible=!0,this.runtime.redraw=!0},s.acts=new e,s.exps=new i}(),cr.behaviors.Pin=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Pin.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.pinObject=null,this.pinObjectUid=-1,this.pinAngle=0,this.pinDist=0,this.myStartAngle=0,this.theirStartAngle=0,this.lastKnownAngle=0,this.mode=0;var t=this;this.recycled||(this.myDestroyCallback=function(e){t.onInstanceDestroyed(e)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},r.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}},r.loadFromJSON=function(t){this.pinObjectUid=t.uid,this.pinAngle=t.pa,this.pinDist=t.pd,this.myStartAngle=t.msa,this.theirStartAngle=t.tsa,this.lastKnownAngle=t.lka,this.mode=t.m},r.afterLoad=function(){-1===this.pinObjectUid?this.pinObject=null:this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid),this.pinObjectUid=-1},r.onInstanceDestroyed=function(t){this.pinObject==t&&(this.pinObject=null)},r.onDestroy=function(){this.pinObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},r.tick=function(){},r.tick2=function(){if(this.pinObject){this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle)));var t=this.inst.x,e=this.inst.y;if(3===this.mode||4===this.mode){var i=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if(i>this.pinDist||4===this.mode&&i<this.pinDist){var s=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y);t=this.pinObject.x+Math.cos(s)*this.pinDist,e=this.pinObject.y+Math.sin(s)*this.pinDist}}else t=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,e=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist;var n=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));this.lastKnownAngle=n,0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===t&&this.inst.y===e||(this.inst.x=t,this.inst.y=e,this.inst.set_bbox_changed()),0!==this.mode&&2!==this.mode||this.inst.angle===n||(this.inst.angle=n,this.inst.set_bbox_changed())}},t.prototype.IsPinned=function(){return!!this.pinObject},s.cnds=new t,e.prototype.Pin=function(t,e){if(t){var i=t.getFirstPicked(this.inst);i&&(this.pinObject=i,this.pinAngle=cr.angleTo(i.x,i.y,this.inst.x,this.inst.y)-i.angle,this.pinDist=cr.distanceTo(i.x,i.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=i.angle,this.mode=e)}},e.prototype.Unpin=function(){this.pinObject=null},s.acts=new e,i.prototype.PinnedUID=function(t){t.set_int(this.pinObject?this.pinObject.uid:-1)},s.exps=new i}(),cr.behaviors.Rex_MoveTo=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Rex_MoveTo.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.activated=1==this.properties[0],this.move={max:this.properties[1],acc:this.properties[2],dec:this.properties[3]},this.target={x:0,y:0,a:0},this.is_moving=!1,this.current_speed=0,this.remain_distance=0,this.is_hit_target=!1,this._pre_pos={x:0,y:0},this._moving_angle_info={x:0,y:0,a:-1},this._last_tick=null,this.is_my_call=!1},r.tick=function(){if(this.is_hit_target&&(this.is_my_call=!0,this.runtime.trigger(cr.behaviors.Rex_MoveTo.prototype.cnds.OnHitTarget,this.inst),this.is_my_call=!1,this.is_hit_target=!1),this.activated&&this.is_moving){var t=this.runtime.getDt(this.inst);if(0!=t){this._pre_pos.x==this.inst.x&&this._pre_pos.y==this.inst.y||this._reset_current_pos();var e=!1;if(0!=this.move.dec){var i=this.current_speed,s=i*i/(2*this.move.dec);e=s>=this.remain_distance}var n=e?-this.move.dec:this.move.acc;0!=n&&this.SetCurrentSpeed(this.current_speed+n*t);var r=this.current_speed*t;if(this.remain_distance-=r,this.remain_distance<=0||this.current_speed<=0)this.is_moving=!1,this.inst.x=this.target.x,this.inst.y=this.target.y,this.SetCurrentSpeed(0),this.moving_angle_get(),this.is_hit_target=!0;else{var o=this.target.a;this.inst.x+=r*Math.cos(o),this.inst.y+=r*Math.sin(o)}this.inst.set_bbox_changed(),this._pre_pos.x=this.inst.x,this._pre_pos.y=this.inst.y}}},r.tick2=function(){this._moving_angle_info.x=this.inst.x,this._moving_angle_info.y=this.inst.y},r.SetCurrentSpeed=function(t){null!=t?this.current_speed=t>this.move.max?this.move.max:t:0==this.move.acc&&(this.current_speed=this.move.max)},r._reset_current_pos=function(){var t=this.target.x-this.inst.x,e=this.target.y-this.inst.y;this.target.a=Math.atan2(e,t),this.remain_distance=Math.sqrt(t*t+e*e),this._pre_pos.x=this.inst.x,this._pre_pos.y=this.inst.y},r.SetTargetPos=function(t,e){this.is_moving=!0,this.target.x=t,this.target.y=e,this._reset_current_pos(),this.SetCurrentSpeed(null),this._moving_angle_info.x=this.inst.x,this._moving_angle_info.y=this.inst.y},r.is_tick_changed=function(){var t=this.runtime.tickcount,e=this._last_tick!=t;return this._last_tick=t,e},r.moving_angle_get=function(t){if(this.is_tick_changed()){var e=this.inst.x-this._moving_angle_info.x,i=this.inst.y-this._moving_angle_info.y;0==e&&0==i||(this._moving_angle_info.a=cr.to_clamped_degrees(Math.atan2(i,e)))}return this._moving_angle_info.a},r.saveToJSON=function(){return{en:this.activated,v:this.move,t:this.target,is_m:this.is_moving,c_spd:this.current_speed,rd:this.remain_distance,is_ht:this.is_hit_target,pp:this._pre_pos,ma:this._moving_angle_info,lt:this._last_tick}},r.loadFromJSON=function(t){this.activated=t.en,this.move=t.v,this.target=t.t,this.is_moving=t.is_m,this.current_speed=t.c_spd,this.remain_distance=t.rd,this.is_hit_target=t.is_ht,this._pre_pos=t.pp,this._moving_angle_info=t.ma,this._last_tick=t.lt},s.cnds=new t,t.prototype.OnHitTarget=function(){return this.is_my_call},t.prototype.CompareSpeed=function(t,e){return cr.do_cmp(this.current_speed,t,e)},t.prototype.OnMoving=function(){return!1},t.prototype.IsMoving=function(){return this.activated&&this.is_moving},t.prototype.CompareMovingAngle=function(t,e){var i=this.moving_angle_get();return-1!=i&&cr.do_cmp(this.moving_angle_get(),t,e)},s.acts=new e,e.prototype.SetActivated=function(t){this.activated=1==t},e.prototype.SetMaxSpeed=function(t){this.move.max=t,this.SetCurrentSpeed(null)},e.prototype.SetAcceleration=function(t){this.move.acc=t,this.SetCurrentSpeed(null)},e.prototype.SetDeceleration=function(t){this.move.dec=t},e.prototype.SetTargetPos=function(t,e){this.SetTargetPos(t,e)},e.prototype.SetCurrentSpeed=function(t){this.SetCurrentSpeed(t)},e.prototype.SetTargetPosOnObject=function(t){if(t){var e=t.getFirstPicked();null!=e&&this.SetTargetPos(e.x,e.y)}},e.prototype.SetTargetPosByDeltaXY=function(t,e){this.SetTargetPos(this.inst.x+t,this.inst.y+e)},e.prototype.SetTargetPosByDistanceAngle=function(t,e){var i=cr.to_clamped_radians(e),s=t*Math.cos(i),n=t*Math.sin(i);this.SetTargetPos(this.inst.x+s,this.inst.y+n)},e.prototype.Stop=function(){this.is_moving=!1},s.exps=new i,i.prototype.Activated=function(t){t.set_int(this.activated?1:0)},i.prototype.Speed=function(t){t.set_float(this.current_speed)},i.prototype.MaxSpeed=function(t){t.set_float(this.move.max)},i.prototype.Acc=function(t){t.set_float(this.move.acc)},i.prototype.Dec=function(t){t.set_float(this.move.dec)},i.prototype.TargetX=function(t){t.set_float(this.target.x)},i.prototype.TargetY=function(t){t.set_float(this.target.y)},i.prototype.MovingAngle=function(t){t.set_float(this.moving_angle_get())}}(),cr.behaviors.Rex_Rotate=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Rex_Rotate.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.activated=1==this.properties[0],this.direction=this.properties[1],this.speed=this.properties[2],this.acc=this.properties[3]},r.tick=function(){if(this.activated){var t=this.runtime.getDt(this.inst);if(this.speed+=this.acc*t,0!=this.speed){var e=this.speed*t;0==this.direction&&(e=-e),this.inst.angle+=cr.to_clamped_radians(e),this.inst.set_bbox_changed()}}},r.saveToJSON=function(){return{en:this.activated,d:this.direction,s:this.speed,a:this.acc}},r.loadFromJSON=function(t){this.activated=t.en,this.direction=t.d,this.speed=t.s,this.acc=t.a},s.cnds=new t,t.prototype.CompareSpeed=function(t,e){return cr.do_cmp(this.speed,t,e)},s.acts=new e,e.prototype.SetActivated=function(t){this.activated=1==t},e.prototype.SetDirection=function(t){this.direction=t},e.prototype.SetSpeed=function(t){this.speed=t},e.prototype.SetAcceleration=function(t){this.acc=t},s.exps=new i,i.prototype.Speed=function(t){t.set_float(this.speed)},i.prototype.Acceleration=function(t){t.set_float(this.acc)},i.prototype.Activated=function(t){t.set_int(this.activated)}}(),cr.behaviors.Sin=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.Sin.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var r=s.Instance.prototype,o=2*Math.PI,a=Math.PI/2,h=3*Math.PI/2;r.onCreate=function(){this.active=1===this.properties[0],this.movement=this.properties[1],this.wave=this.properties[2],this.period=this.properties[3],this.period+=Math.random()*this.properties[4],0===this.period?this.i=0:(this.i=this.properties[5]/this.period*o,this.i+=Math.random()*this.properties[6]/this.period*o),this.mag=this.properties[7],this.mag+=Math.random()*this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,this.init()},r.saveToJSON=function(){return{i:this.i,a:this.active,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},r.loadFromJSON=function(t){this.i=t.i,this.active=t.a,this.movement=t.mv,this.wave=t.w,this.period=t.p,this.mag=t.mag,this.initialValue=t.iv,this.initialValue2=t.iv2||0,this.ratio=t.r,this.lastKnownValue=t.lkv,this.lastKnownValue2=t.lkv2||0},r.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle,this.mag=cr.to_radians(this.mag);break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},r.waveFunc=function(t){switch(t%=o,this.wave){case 0:return Math.sin(t);case 1:return t<=a?t/a:t<=h?1-2*(t-a)/Math.PI:(t-h)/a-1;case 2:return 2*t/o-1;case 3:return-2*t/o+1;case 4:return t<Math.PI?-1:1}return 0},r.tick=function(){var t=this.runtime.getDt(this.inst);this.active&&0!==t&&(0===this.period?this.i=0:(this.i+=t/this.period*o,this.i=this.i%o),this.updateFromPhase())},r.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,this.inst.opacity<0?this.inst.opacity=0:this.inst.opacity>1&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()},r.onSpriteFrameChanged=function(t,e){switch(this.movement){case 2:this.initialValue*=e.width/t.width,this.ratio=e.height/e.width;break;case 3:this.initialValue*=e.width/t.width;break;case 4:this.initialValue*=e.height/t.height}},t.prototype.IsActive=function(){return this.active},t.prototype.CompareMovement=function(t){return this.movement===t},t.prototype.ComparePeriod=function(t,e){return cr.do_cmp(this.period,t,e)},t.prototype.CompareMagnitude=function(t,e){return 5===this.movement?cr.do_cmp(this.mag,t,cr.to_radians(e)):cr.do_cmp(this.mag,t,e)},t.prototype.CompareWave=function(t){return this.wave===t},s.cnds=new t,e.prototype.SetActive=function(t){this.active=1===t},e.prototype.SetPeriod=function(t){this.period=t},e.prototype.SetMagnitude=function(t){this.mag=t,5===this.movement&&(this.mag=cr.to_radians(this.mag))},e.prototype.SetMovement=function(t){5===this.movement&&(this.mag=cr.to_degrees(this.mag)),this.movement=t,this.init()},e.prototype.SetWave=function(t){this.wave=t},e.prototype.SetPhase=function(t){this.i=t*o%o,this.updateFromPhase()},e.prototype.UpdateInitialState=function(){this.init()},s.acts=new e,i.prototype.CyclePosition=function(t){t.set_float(this.i/o)},i.prototype.Period=function(t){t.set_float(this.period)},i.prototype.Magnitude=function(t){5===this.movement?t.set_float(cr.to_degrees(this.mag)):t.set_float(this.mag)},i.prototype.Value=function(t){t.set_float(this.waveFunc(this.i)*this.mag)},s.exps=new i}(),cr.behaviors.jumpthru=function(t){this.runtime=t},function(){function t(){}function e(){}var i=cr.behaviors.jumpthru.prototype;i.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var s=i.Type.prototype;s.onCreate=function(){},i.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var n=i.Instance.prototype;n.onCreate=function(){this.inst.extra.jumpthruEnabled=0!==this.properties[0]},n.tick=function(){},t.prototype.IsEnabled=function(){return this.inst.extra.jumpthruEnabled},i.cnds=new t,e.prototype.SetEnabled=function(t){this.inst.extra.jumpthruEnabled=!!t},i.acts=new e}(),cr.behaviors.maf_Tween=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=["x","y","size","width","height","angle","opacity"],n=["linear","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"],r=["in","out","inOut"],o=cr.behaviors.maf_Tween.prototype;o.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var a=o.Type.prototype;a.onCreate=function(){},o.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var h=o.Instance.prototype;h.onCreate=function(){this.properties[0];this.movement=s[this.properties[0]],this.type=n[this.properties[1]],this.type2=r[this.properties[2]],this.baseDuration=this.properties[3],this.durationRandom=this.properties[4],this.baseMagnitude=this.properties[5],this.magnitudeRandom=this.properties[6],this.duration=this.baseDuration+Math.random()*this.durationRandom,this.magnitude=this.baseMagnitude+Math.random()*this.magnitudeRandom,this.startX=this.inst.x,this.startY=this.inst.y,this.startRatio=this.inst.height/this.inst.width,this.startWidth=this.inst.width,void 0!==this.inst.characterScale&&(this.startCharacterScale=this.inst.characterScale),this.startHeight=this.inst.height,this.startAngle=this.inst.angle,this.startOpacity=this.inst.opacity,this.is_my_call=!1,this.timeElapsed=0,this.tweenFunction=function(){},o.acts.stopTween.call(this),this.enabled=1!==this.properties[7],this.enabled&&o.acts.startTween.call(this)
},h.saveToJSON=function(){return{null:0}},h.loadFromJSON=function(t){},h.tick=function(){if(this.enabled){var t=this.runtime.getDt(this.inst);switch(this.timeElapsed=Math.min(this.duration,this.timeElapsed+t),this.movement){case s[0]:this.inst.x=this.tweenFunction(this.timeElapsed,this.startX,this.magnitude,this.duration);break;case s[1]:this.inst.y=this.tweenFunction(this.timeElapsed,this.startY,this.magnitude,this.duration);break;case s[2]:void 0!==this.inst.characterScale?(this.inst.characterScale=this.tweenFunction(this.timeElapsed,this.startCharacterScale,this.magnitude,this.duration),this.inst.text_changed=!0):(this.inst.width=this.tweenFunction(this.timeElapsed,this.startWidth,this.magnitude,this.duration),this.inst.height=this.inst.width*this.startRatio);break;case s[3]:this.inst.width=this.tweenFunction(this.timeElapsed,this.startWidth,this.magnitude,this.duration);break;case s[4]:this.inst.height=this.tweenFunction(this.timeElapsed,this.startHeight,this.magnitude,this.duration);break;case s[5]:this.inst.angle=this.tweenFunction(this.timeElapsed,this.startAngle,cr.to_radians(this.magnitude),this.duration);break;case s[6]:this.inst.opacity=this.tweenFunction(this.timeElapsed,this.startOpacity,this.magnitude/100,this.duration),this.inst.opacity<0?this.inst.opacity=0:this.inst.opacity>1&&(this.inst.opacity=1)}this.inst.set_bbox_changed(),this.timeElapsed>=this.duration&&(o.acts.stopTween.call(this),this.is_my_call=!0,this.runtime.trigger(cr.behaviors.maf_Tween.prototype.cnds.tweenIsEnd,this.inst),this.is_my_call=!1)}},t.prototype.isOnTween=function(){return this.enabled},t.prototype.tweenIsEnd=function(){return this.is_my_call},o.cnds=new t,e.prototype.setMovement=function(t){this.movement=s[t]},e.prototype.setType=function(t){this.type=n[t]},e.prototype.setType2=function(t){this.type2=r[t]},e.prototype.setValueEasing=function(t,e){switch(t){case 0:this.baseDuration=e;break;case 1:this.durationRandom=e;break;case 2:this.baseMagnitude=e;break;case 3:this.magnitudeRandom=e}},e.prototype.startTween=function(){this.timeElapsed=0,this.startX=this.inst.x,this.startY=this.inst.y,this.startRatio=this.inst.height/this.inst.width,this.startWidth=this.inst.width,this.startHeight=this.inst.height,this.startAngle=this.inst.angle,this.startOpacity=this.inst.opacity,void 0!==this.inst.characterScale&&(this.startCharacterScale=this.inst.characterScale),this.duration=this.baseDuration+Math.random()*this.durationRandom,this.magnitude=this.baseMagnitude+Math.random()*this.magnitudeRandom,this.tweenFunction=c.getFunctionEasing.call(this),this.enabled=!0},e.prototype.stopTween=function(){this.enabled=!1},e.prototype.prepareNewTween=function(t,e,i,s,n,r,a,h){o.acts.setMovement.call(this,t),o.acts.setType.call(this,e),o.acts.setType2.call(this,i),o.acts.setValueEasing.call(this,0,s),o.acts.setValueEasing.call(this,1,n),o.acts.setValueEasing.call(this,2,r),o.acts.setValueEasing.call(this,3,a),0===h?o.acts.startTween.call(this):o.acts.stopTween.call(this)},o.acts=new e,i.prototype.getMovement=function(t){t.set_string(this.movement)},i.prototype.getType=function(t){t.set_string(this.type)},i.prototype.gettype2=function(t){t.set_string(this.type2)},i.prototype.getDuration=function(t){t.set_float(this.baseDuration)},i.prototype.getDurationRandom=function(t){t.set_float(this.durationRandom)},i.prototype.getMagnitude=function(t){t.set_float(this.baseMagnitude)},i.prototype.getMagnitudeRandom=function(t){t.set_float(this.magnitudeRandom)},i.prototype.getTimeElapsed=function(t){t.set_float(this.timeElapsed)},o.exps=new i;var c={getFunctionEasing:function(){switch(this.type){case n[0]:return c.linear.bind(this);case n[1]:return this.type2==r[0]?c.easeInQuad.bind(c):this.type2==r[1]?c.easeOutQuad.bind(c):this.type2==r[2]?c.easeInOutQuad.bind(c):function(){};case n[2]:if(this.type2==r[0])return c.easeInCubic.bind(c);if(this.type2==r[1])return c.easeOutCubic.bind(c);if(this.type2==r[2])return c.easeInOutCubic.bind(c);break;case n[3]:if(this.type2==r[0])return c.easeInQuart.bind(c);if(this.type2==r[1])return c.easeOutQuart.bind(c);if(this.type2==r[2])return c.easeInOutQuart.bind(c);break;case n[4]:if(this.type2==r[0])return c.easeInQuint.bind(c);if(this.type2==r[1])return c.easeOutQuint.bind(c);if(this.type2==r[2])return c.easeInOutQuint.bind(c);break;case n[5]:if(this.type2==r[0])return c.easeInSine.bind(c);if(this.type2==r[1])return c.easeOutSine.bind(c);if(this.type2==r[2])return c.easeInOutSine.bind(c);break;case n[6]:if(this.type2==r[0])return c.easeInExpo.bind(c);if(this.type2==r[1])return c.easeOutExpo.bind(c);if(this.type2==r[2])return c.easeInOutExpo.bind(c);break;case n[7]:if(this.type2==r[0])return c.easeInCirc.bind(c);if(this.type2==r[1])return c.easeOutCirc.bind(c);if(this.type2==r[2])return c.easeInOutCirc.bind(c);break;case n[8]:if(this.type2==r[0])return c.easeInElastic.bind(c);if(this.type2==r[1])return c.easeOutElastic.bind(c);if(this.type2==r[2])return c.easeInOutElastic.bind(c);break;case n[9]:if(this.type2==r[0])return c.easeInBack.bind(c);if(this.type2==r[1])return c.easeOutBack.bind(c);if(this.type2==r[2])return c.easeInOutBack.bind(c);break;case n[10]:if(this.type2==r[0])return c.easeInBounce.bind(c);if(this.type2==r[1])return c.easeOutBounce.bind(c);if(this.type2==r[2])return c.easeInOutBounce.bind(c)}},linear:function(t,e,i,s){return i*(t/=s)+e},easeInQuad:function(t,e,i,s){return i*(t/=s)*t+e},easeOutQuad:function(t,e,i,s){return-i*(t/=s)*(t-2)+e},easeInOutQuad:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,s){return i*(t/=s)*t*t+e},easeOutCubic:function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,s){return i*(t/=s)*t*t*t+e},easeOutQuart:function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},easeOutQuint:function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},easeInOutSine:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},easeInExpo:function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e},easeOutExpo:function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},easeInOutExpo:function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},easeOutCirc:function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},easeInOutCirc:function(t,e,i,s){return(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,i,s){var n=1.70158,r=0,o=i;if(0==t)return e;if(1==(t/=s))return e+i;if(r||(r=.3*s),o<Math.abs(i)){o=i;n=r/4}else n=r/(2*Math.PI)*Math.asin(i/o);return-o*Math.pow(2,10*(t-=1))*Math.sin((t*s-n)*(2*Math.PI)/r)+e},easeOutElastic:function(t,e,i,s){var n=1.70158,r=0,o=i;if(0==t)return e;if(1==(t/=s))return e+i;if(r||(r=.3*s),o<Math.abs(i)){o=i;n=r/4}else n=r/(2*Math.PI)*Math.asin(i/o);return o*Math.pow(2,-10*t)*Math.sin((t*s-n)*(2*Math.PI)/r)+i+e},easeInOutElastic:function(t,e,i,s){var n=1.70158,r=0,o=i;if(0==t)return e;if(2==(t/=s/2))return e+i;if(r||(r=s*(.3*1.5)),o<Math.abs(i)){o=i;n=r/4}else n=r/(2*Math.PI)*Math.asin(i/o);return t<1?o*Math.pow(2,10*(t-=1))*Math.sin((t*s-n)*(2*Math.PI)/r)*-.5+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*s-n)*(2*Math.PI)/r)*.5+i+e},easeInBack:function(t,e,i,s,n){return null==n&&(n=1.70158),i*(t/=s)*t*((n+1)*t-n)+e},easeOutBack:function(t,e,i,s,n){return null==n&&(n=1.70158),i*((t=t/s-1)*t*((n+1)*t+n)+1)+e},easeInOutBack:function(t,e,i,s,n){return null==n&&(n=1.70158),(t/=s/2)<1?i/2*(t*t*((1+(n*=1.525))*t-n))+e:i/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInBounce:function(t,e,i,s){return i-this.easeOutBounce(s-t,0,i,s)+e},easeOutBounce:function(t,e,i,s){return(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,i,s){return t<s/2?.5*this.easeInBounce(2*t,0,i,s)+e:.5*this.easeOutBounce(2*t-s,0,i,s)+.5*i+e}}}(),cr.behaviors.maf_destroyclean=function(t){this.runtime=t},function(){function t(){}function e(){}function i(){}var s=cr.behaviors.maf_destroyclean.prototype;s.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var n=s.Type.prototype;n.onCreate=function(){},s.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var r=s.Instance.prototype;r.onCreate=function(){this.autoClean=1==this.properties[0]},r.onDestroy=function(){this.autoClean&&this.cleanMemory()},r.saveToJSON=function(){return{null:0}},r.loadFromJSON=function(t){},r.tick=function(){},r.cleanMemory=function(){if(void 0===this.inst||void 0===this.inst.type||void 0===this.inst.type.unloadTextures)return!1;setTimeout(function(){this.inst.type.unloadTextures()}.bind(this),1)},t.prototype.isAutoClean=function(){return this.autoClean},s.cnds=new t,e.prototype.destroyAndClean=function(){this.runtime.DestroyInstance(this.inst),this.cleanMemory()},e.prototype.setAutoClean=function(t){this.autoClean=1==t},s.acts=new e,i.prototype.getAutoClean=function(t){t.set_int(this.autoClean?1:0)},s.exps=new i}(),cr.behaviors.scrollto=function(t){this.runtime=t,this.shakeMag=0,this.shakeStart=0,this.shakeEnd=0,this.shakeMode=0},function(){function t(t){var e,i,s;for(e=0,i=t.behavior_insts.length;e<i;++e)if(s=t.behavior_insts[e],s.behavior instanceof cr.behaviors.scrollto)return s;return null}function e(){}var i=cr.behaviors.scrollto.prototype;i.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime};var s=i.Type.prototype;s.onCreate=function(){},i.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var n=i.Instance.prototype;n.onCreate=function(){this.enabled=0!==this.properties[0]},n.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}},n.loadFromJSON=function(t){this.behavior.shakeMag=t.smg,this.behavior.shakeStart=t.ss,this.behavior.shakeEnd=t.se,this.behavior.shakeMode=t.smd},n.tick=function(){},n.tick2=function(){if(this.enabled){var e,i,s,n=this.behavior.my_instances.valuesRef(),r=0,o=0,a=0;for(e=0,i=n.length;e<i;e++)s=t(n[e]),s&&s.enabled&&(r+=n[e].x,o+=n[e].y,++a);var h=this.inst.layer.layout,c=this.runtime.kahanTime.sum,l=0,u=0;if(c>=this.behavior.shakeStart&&c<this.behavior.shakeEnd){var p=this.behavior.shakeMag*Math.min(this.runtime.timescale,1);0===this.behavior.shakeMode&&(p*=1-(c-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart));var d=Math.random()*Math.PI*2,f=Math.random()*p;l=Math.cos(d)*f,u=Math.sin(d)*f}h.scrollToX(r/a+l),h.scrollToY(o/a+u)}},e.prototype.Shake=function(t,e,i){this.behavior.shakeMag=t,this.behavior.shakeStart=this.runtime.kahanTime.sum,this.behavior.shakeEnd=this.behavior.shakeStart+e,this.behavior.shakeMode=i},e.prototype.SetEnabled=function(t){this.enabled=0!==t},i.acts=new e}(),cr.getObjectRefTable=function(){return[cr.plugins_.NinePatch,cr.plugins_.AJAX,cr.plugins_.Arr,cr.plugins_.Audio,cr.plugins_.cjs,cr.plugins_.c2canvas,cr.plugins_.Browser,cr.plugins_.CJSAds,cr.plugins_.Dictionary,cr.plugins_.Function,cr.plugins_.Keyboard,cr.plugins_.Rex_CSV,cr.plugins_.HTML_iFrame_Pode,cr.plugins_.Particles,cr.plugins_.TouchEnhanced,cr.plugins_.Sprite,cr.plugins_.Spritefont2,cr.plugins_.Text,cr.plugins_.playtouch_textEnhanced,cr.plugins_.listScroll,cr.plugins_.Rex_CSV2Array,cr.plugins_.Rex_Nickname,cr.plugins_.Rex_Hash,cr.plugins_.TiledBg,cr.plugins_.Touch,cr.plugins_.WebStorage,cr.plugins_.Cookie,cr.behaviors.Anchor,cr.behaviors.jumpthru,cr.behaviors.Pin,cr.behaviors.Fade,cr.behaviors.Bullet,cr.behaviors.maf_Tween,cr.behaviors.maf_destroyclean,cr.behaviors.Rex_Rotate,cr.behaviors.Rex_MoveTo,cr.behaviors.DragnDrop,cr.behaviors.scrollto,cr.behaviors.Sin,cr.behaviors.Flash,cr.system_object.prototype.cnds.IsGroupActive,cr.system_object.prototype.cnds.OnLayoutStart,cr.system_object.prototype.acts.SetLayerVisible,cr.plugins_.Function.prototype.acts.CallFunction,cr.system_object.prototype.cnds.CompareVar,cr.system_object.prototype.acts.Wait,cr.plugins_.cjs.prototype.acts.ExecuteJS,cr.system_object.prototype.acts.SetVar,cr.plugins_.cjs.prototype.exps.ReadExecutionReturn,cr.system_object.prototype.cnds.Else,cr.plugins_.Browser.prototype.cnds.IsOnline,cr.system_object.prototype.cnds.LayerVisible,cr.plugins_.Browser.prototype.acts.ConsoleLog,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.exps.int,cr.plugins_.Rex_Hash.prototype.exps.At,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.plugins_.Arr.prototype.acts.Clear,cr.plugins_.Arr.prototype.acts.SetSize,cr.plugins_.WebStorage.prototype.acts.ClearLocal,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.plugins_.Spritefont2.prototype.exps.Text,cr.plugins_.Arr.prototype.acts.JSONLoad,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.plugins_.Function.prototype.cnds.OnFunction,cr.plugins_.Function.prototype.exps.Call,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.plugins_.Function.prototype.exps.Param,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.plugins_.Sprite.prototype.exps.AnimationFrameCount,cr.plugins_.Dictionary.prototype.cnds.ForEachKey,cr.system_object.prototype.exps.left,cr.plugins_.Dictionary.prototype.exps.CurrentKey,cr.plugins_.Dictionary.prototype.cnds.CompareCurrentValue,cr.system_object.prototype.exps.right,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.playtouch_textEnhanced.prototype.cnds.CompareText,cr.plugins_.Browser.prototype.acts.ExecJs,cr.system_object.prototype.cnds.TriggerOnce,cr.plugins_.Sprite.prototype.cnds.IsOnLayer,cr.plugins_.Sprite.prototype.acts.SetSize,cr.system_object.prototype.cnds.IsMobile,cr.plugins_.CJSAds.prototype.cnds.IsCocoonJS,cr.plugins_.Audio.prototype.acts.PlayByName,cr.plugins_.Audio.prototype.acts.PreloadByName,cr.plugins_.Touch.prototype.cnds.OnTouchEnd,cr.plugins_.Audio.prototype.acts.Stop,cr.plugins_.Audio.prototype.cnds.IsTagPlaying,cr.behaviors.Fade.prototype.exps.FadeInTime,cr.system_object.prototype.acts.RestartLayout,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.system_object.prototype.acts.SetTimescale,cr.plugins_.Spritefont2.prototype.cnds.IsBoolInstanceVarSet,cr.plugins_.Spritefont2.prototype.cnds.CompareInstanceVar,cr.plugins_.Spritefont2.prototype.acts.SetScale,cr.plugins_.Particles.prototype.acts.SetSpraying,cr.system_object.prototype.cnds.PickAll,cr.plugins_.playtouch_textEnhanced.prototype.cnds.IsVisible,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetFontColor,cr.system_object.prototype.exps.rgb,cr.plugins_.Sprite.prototype.acts.MoveToLayer,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.plugins_.Sprite.prototype.acts.ZMoveToObject,cr.plugins_.Browser.prototype.exps.ExecJS,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.plugins_.Function.prototype.exps.ParamCount,cr.system_object.prototype.cnds.OnLayoutEnd,cr.system_object.prototype.cnds.ForEach,cr.system_object.prototype.cnds.Every,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.system_object.prototype.exps.dt,cr.plugins_.Rex_Hash.prototype.acts.CleanAll,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.Rex_Hash.prototype.acts.StringToHashTable,cr.plugins_.Rex_Hash.prototype.acts.SetByKeyString,cr.plugins_.Function.prototype.cnds.CompareParam,cr.plugins_.Sprite.prototype.exps.UID,cr.system_object.prototype.acts.AddVar,cr.behaviors.maf_Tween.prototype.acts.prepareNewTween,cr.plugins_.Sprite.prototype.exps.X,cr.system_object.prototype.exps.tokenat,cr.plugins_.Sprite.prototype.exps.LayerName,cr.plugins_.Sprite.prototype.acts.SetHeight,cr.behaviors.Fade.prototype.acts.RestartFade,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.Sprite.prototype.exps.Y,cr.plugins_.Sprite.prototype.acts.SetY,cr.plugins_.Sprite.prototype.exps.Height,cr.plugins_.playtouch_textEnhanced.prototype.cnds.IsBoolInstanceVarSet,cr.system_object.prototype.exps.find,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetText,cr.plugins_.playtouch_textEnhanced.prototype.cnds.CompareInstanceVar,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.TiledBg.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.behaviors.maf_Tween.prototype.cnds.isOnTween,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.behaviors.Pin.prototype.exps.PinnedUID,cr.plugins_.Sprite.prototype.acts.SetX,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetInstanceVar,cr.plugins_.playtouch_textEnhanced.prototype.exps.Y,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetX,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetFontSize,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetY,cr.plugins_.Sprite.prototype.exps.BBoxBottom,cr.behaviors.maf_Tween.prototype.cnds.tweenIsEnd,cr.behaviors.maf_Tween.prototype.exps.getMovement,cr.plugins_.Sprite.prototype.cnds.CompareOpacity,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetOpacity,cr.plugins_.TiledBg.prototype.acts.SetOpacity,cr.behaviors.Fade.prototype.acts.StartFade,cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,cr.behaviors.maf_Tween.prototype.acts.stopTween,cr.behaviors.Pin.prototype.acts.Unpin,cr.plugins_.playtouch_textEnhanced.prototype.acts.AddInstanceVar,cr.system_object.prototype.exps.round,cr.plugins_.Rex_Hash.prototype.cnds.ForEachKey,cr.plugins_.Rex_Hash.prototype.exps.CurKey,cr.plugins_.Rex_Hash.prototype.acts.RemoveByKeyString,cr.system_object.prototype.exps.str,cr.system_object.prototype.acts.CreateObject,cr.plugins_.Sprite.prototype.acts.SetScale,cr.system_object.prototype.cnds.For,cr.system_object.prototype.exps.loopindex,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.plugins_.Particles.prototype.acts.Destroy,cr.plugins_.playtouch_textEnhanced.prototype.acts.Destroy,cr.plugins_.Function.prototype.acts.SetReturnValue,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.Arr.prototype.cnds.CompareXY,cr.plugins_.TiledBg.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.StopAnim,cr.plugins_.HTML_iFrame_Pode.prototype.acts.Destroy,cr.system_object.prototype.acts.SetGroupActive,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.plugins_.Cookie.prototype.acts.GetCookie,cr.plugins_.Cookie.prototype.exps.value,cr.plugins_.Cookie.prototype.acts.SetCookie,cr.system_object.prototype.exps.max,cr.plugins_.Arr.prototype.acts.SetXY,cr.plugins_.Dictionary.prototype.cnds.CompareValue,cr.plugins_.CJSAds.prototype.cnds.IsShowingBanner,cr.system_object.prototype.exps.layoutname,cr.plugins_.Dictionary.prototype.cnds.HasKey,cr.plugins_.Dictionary.prototype.exps.Get,cr.plugins_.CJSAds.prototype.acts.ShowBanner,cr.plugins_.CJSAds.prototype.acts.HideBanner,cr.plugins_.HTML_iFrame_Pode.prototype.acts.SetVisible,cr.plugins_.HTML_iFrame_Pode.prototype.acts.SetURL,cr.system_object.prototype.exps.windowheight,cr.plugins_.Browser.prototype.exps.DevicePixelRatio,cr.system_object.prototype.exps.windowwidth,cr.plugins_.Browser.prototype.acts.GoToURLWindow,cr.plugins_.TiledBg.prototype.acts.SetSize,cr.plugins_.HTML_iFrame_Pode.prototype.exps.Width,cr.plugins_.HTML_iFrame_Pode.prototype.exps.Height,cr.plugins_.TiledBg.prototype.acts.SetPosToObject,cr.plugins_.AJAX.prototype.acts.Request,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.plugins_.Rex_CSV.prototype.acts.LoadCSV,cr.plugins_.AJAX.prototype.exps.LastData,cr.system_object.prototype.cnds.Repeat,cr.system_object.prototype.exps.len,cr.system_object.prototype.exps.tokencount,cr.plugins_.Cookie.prototype.acts.DelCookie,cr.plugins_.Arr.prototype.exps.Width,cr.plugins_.Arr.prototype.exps.At,cr.system_object.prototype.acts.StopLoop,cr.plugins_.Spritefont2.prototype.acts.SetInstanceVar,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.system_object.prototype.acts.GoToLayoutByName,cr.plugins_.CJSAds.prototype.acts.ShowFullscreen,cr.plugins_.CJSAds.prototype.cnds.IsShowingFullscreen,cr.plugins_.CJSAds.prototype.cnds.OnFullscreenHidden,cr.plugins_.Spritefont2.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying,cr.plugins_.CJSAds.prototype.acts.RefreshFullscreen,cr.system_object.prototype.exps.abs,cr.plugins_.Spritefont2.prototype.acts.Destroy,cr.plugins_.TiledBg.prototype.acts.Destroy,cr.plugins_.HTML_iFrame_Pode.prototype.cnds.CompareInstanceVar,cr.system_object.prototype.exps.layoutwidth,cr.system_object.prototype.exps.layoutheight,cr.behaviors.maf_destroyclean.prototype.acts.setAutoClean,cr.system_object.prototype.acts.GoToLayout,cr.system_object.prototype.acts.SubVar,cr.plugins_.Dictionary.prototype.acts.AddKey,cr.system_object.prototype.exps.replace,cr.plugins_.Dictionary.prototype.acts.SetKey,cr.plugins_.CJSAds.prototype.cnds.OnBannerShown,cr.plugins_.Browser.prototype.exps.Language,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,cr.system_object.prototype.cnds.OnLoadFinished,cr.plugins_.AJAX.prototype.acts.RequestFile,cr.plugins_.Function.prototype.exps.ReturnValue,cr.system_object.prototype.acts.SetLayerParallax,cr.system_object.prototype.acts.SetLayerScaleRate,cr.system_object.prototype.exps.viewporttop,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.system_object.prototype.exps.viewportleft,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Audio.prototype.acts.SetSilent,cr.plugins_.Audio.prototype.acts.StopAll,cr.plugins_.Audio.prototype.cnds.IsSilent,cr.plugins_.Browser.prototype.cnds.OnPageVisible,cr.system_object.prototype.exps.viewportright,cr.plugins_.Touch.prototype.cnds.OnTouchStart,cr.plugins_.Arr.prototype.cnds.ArrForEach,cr.plugins_.Arr.prototype.exps.CurX,cr.plugins_.TiledBg.prototype.acts.MoveToLayer,cr.plugins_.TiledBg.prototype.acts.MoveToBottom,cr.plugins_.TiledBg.prototype.acts.SetPos,cr.plugins_.TiledBg.prototype.acts.SetWidth,cr.plugins_.TiledBg.prototype.acts.SetHeight,cr.system_object.prototype.exps.viewportbottom,cr.plugins_.Rex_Hash.prototype.cnds.KeyExists,cr.plugins_.Rex_Hash.prototype.exps.CurValue,cr.plugins_.AJAX.prototype.cnds.OnError,cr.plugins_.Rex_Hash.prototype.exps.ToString,cr.plugins_.Cookie.prototype.exps.GetCookie,cr.system_object.prototype.exps.time,cr.system_object.prototype.exps.min,cr.system_object.prototype.exps.wallclocktime,cr.system_object.prototype.exps.timescale,cr.plugins_.Arr.prototype.exps.AsJSON,cr.system_object.prototype.exps.fps,cr.system_object.prototype.exps.cpuutilisation,cr.system_object.prototype.exps.imagememoryusage,cr.plugins_.Dictionary.prototype.exps.AsJSON,cr.behaviors.Sin.prototype.cnds.IsActive,cr.behaviors.Sin.prototype.acts.SetActive,cr.system_object.prototype.cnds.PickByComparison,cr.system_object.prototype.cnds.ForEachOrdered,cr.plugins_.Sprite.prototype.exps.LayerNumber,cr.plugins_.Sprite.prototype.exps.ZIndex,cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,cr.plugins_.NinePatch.prototype.acts.SetVisible,cr.plugins_.NinePatch.prototype.acts.MoveToLayer,cr.plugins_.NinePatch.prototype.acts.MoveToTop,cr.plugins_.Sprite.prototype.exps.PickedCount,cr.plugins_.NinePatch.prototype.acts.SetPosToObject,cr.plugins_.NinePatch.prototype.acts.SetSize,cr.plugins_.NinePatch.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsOnScreen,cr.plugins_.Sprite.prototype.cnds.PickDistance,cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.plugins_.NinePatch.prototype.exps.Y,cr.plugins_.NinePatch.prototype.exps.X,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,cr.plugins_.Sprite.prototype.cnds.OnDestroyed,cr.system_object.prototype.exps.float,cr.system_object.prototype.exps.lowercase,cr.behaviors.Anchor.prototype.acts.SetEnabled,cr.plugins_.Sprite.prototype.exps.BBoxLeft,cr.plugins_.Sprite.prototype.exps.BBoxRight,cr.plugins_.Browser.prototype.cnds.OnResize,cr.plugins_.Text.prototype.acts.SetPos,cr.plugins_.Text.prototype.acts.SetText,cr.plugins_.Text.prototype.acts.SetVisible,cr.plugins_.TiledBg.prototype.cnds.IsOnLayer,cr.system_object.prototype.exps.originalwindowwidth,cr.system_object.prototype.exps.originalwindowheight,cr.system_object.prototype.exps.random,cr.plugins_.WebStorage.prototype.acts.RemoveLocal,cr.plugins_.TouchEnhanced.prototype.acts.clearAllTouches,cr.behaviors.Rex_Rotate.prototype.acts.SetActivated,cr.plugins_.playtouch_textEnhanced.prototype.acts.preloadWebFont,cr.plugins_.Sprite.prototype.acts.SetPos,cr.system_object.prototype.exps.ceil,cr.behaviors.DragnDrop.prototype.acts.SetEnabled,cr.plugins_.Rex_Hash.prototype.acts.InjectToKeyString,cr.plugins_.TiledBg.prototype.exps.UID,cr.plugins_.TiledBg.prototype.cnds.PickByUID,cr.plugins_.TiledBg.prototype.exps.Y,cr.plugins_.TiledBg.prototype.exps.X,cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,cr.plugins_.TiledBg.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.exps.Opacity,cr.plugins_.TiledBg.prototype.acts.SetX,cr.plugins_.TiledBg.prototype.exps.PickedCount,cr.behaviors.Sin.prototype.acts.SetPhase,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetTextToBoxSize,cr.plugins_.NinePatch.prototype.acts.ZMoveToObject,cr.plugins_.NinePatch.prototype.acts.SetPos,cr.plugins_.NinePatch.prototype.cnds.CompareInstanceVar,cr.plugins_.TiledBg.prototype.exps.Width,cr.plugins_.TiledBg.prototype.exps.Height,cr.behaviors.Fade.prototype.acts.SetFadeInTime,cr.plugins_.NinePatch.prototype.acts.SetOpacity,cr.plugins_.NinePatch.prototype.acts.SetHeight,cr.behaviors.Flash.prototype.acts.Flash,cr.plugins_.TiledBg.prototype.exps.LayerName,cr.system_object.prototype.exps.floor,cr.behaviors.Pin.prototype.cnds.IsPinned,cr.behaviors.DragnDrop.prototype.cnds.IsDragging,cr.plugins_.Rex_Nickname.prototype.acts.CreateInst,cr.plugins_.Rex_Nickname.prototype.exps.LastCreatedInstUID,cr.behaviors.DragnDrop.prototype.cnds.OnDrop,cr.plugins_.Sprite.prototype.exps.Count,cr.behaviors.DragnDrop.prototype.cnds.IsEnabled,cr.system_object.prototype.cnds.CompareBetween,cr.behaviors.Bullet.prototype.acts.SetEnabled,cr.system_object.prototype.exps.choose,cr.plugins_.TiledBg.prototype.exps.Count,cr.plugins_.c2canvas.prototype.acts.PasteObject,cr.system_object.prototype.cnds.PickRandom,cr.behaviors.Rex_Rotate.prototype.acts.SetDirection,cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,cr.plugins_.Sprite.prototype.acts.AddInstanceVar,cr.plugins_.Browser.prototype.acts.Alert,cr.plugins_.Audio.prototype.acts.SetPaused,cr.plugins_.Rex_CSV.prototype.exps.At,cr.plugins_.Spritefont2.prototype.exps.X,cr.plugins_.Spritefont2.prototype.exps.TextWidth,cr.plugins_.Spritefont2.prototype.exps.Y,cr.plugins_.Spritefont2.prototype.acts.SetCharacterSpacing,cr.plugins_.Rex_Hash.prototype.exps.ItemCnt,cr.plugins_.Sprite.prototype.acts.StartAnim,cr.plugins_.Sprite.prototype.exps.AnimationName,cr.plugins_.Spritefont2.prototype.exps.Height,cr.plugins_.Spritefont2.prototype.exps.LayerName,cr.system_object.prototype.cnds.While,cr.plugins_.Spritefont2.prototype.acts.SetSize,cr.plugins_.playtouch_textEnhanced.prototype.cnds.OnCreated,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetWebFont,cr.system_object.prototype.exps.uppercase,cr.plugins_.Spritefont2.prototype.cnds.OnCreated,cr.plugins_.Spritefont2.prototype.acts.SetCharacterWidth,cr.plugins_.Arr.prototype.exps.Height,cr.plugins_.Touch.prototype.exps.XAt,cr.plugins_.Touch.prototype.exps.TouchCount,cr.plugins_.Touch.prototype.exps.YAt,cr.system_object.prototype.exps.distance,cr.system_object.prototype.exps.angle,cr.system_object.prototype.cnds.IsNaN,cr.plugins_.TiledBg.prototype.exps.Opacity,cr.plugins_.playtouch_textEnhanced.prototype.exps.Text,cr.plugins_.Particles.prototype.acts.SetPos,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetVisible,cr.plugins_.playtouch_textEnhanced.prototype.acts.SetSize,cr.plugins_.playtouch_textEnhanced.prototype.acts.setLineHeight,cr.plugins_.Rex_Hash.prototype.exps.HashTableToString,cr.plugins_.Sprite.prototype.acts.SetAnimSpeed,cr.plugins_.Rex_Nickname.prototype.acts.AssignNickname,cr.plugins_.TiledBg.prototype.acts.MoveToTop,cr.plugins_.TiledBg.prototype.acts.ZMoveToObject,cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,cr.plugins_.playtouch_textEnhanced.prototype.cnds.IsOnLayer,cr.plugins_.playtouch_textEnhanced.prototype.exps.X,cr.system_object.prototype.exps.objectcount,cr.plugins_.listScroll.prototype.acts.SetSize,cr.plugins_.listScroll.prototype.acts.setOrientation,cr.plugins_.listScroll.prototype.acts.setOffset,cr.plugins_.playtouch_textEnhanced.prototype.acts.MoveToTop,cr.plugins_.Sprite.prototype.acts.SetEffect,cr.plugins_.Sprite.prototype.acts.SetWidth,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.plugins_.playtouch_textEnhanced.prototype.acts.setHorizontalAlign,cr.plugins_.playtouch_textEnhanced.prototype.acts.setVerticalAlign,cr.plugins_.Sprite.prototype.exps.BBoxTop,cr.plugins_.listScroll.prototype.acts.addToList,cr.plugins_.listScroll.prototype.acts.setActivated,cr.plugins_.NinePatch.prototype.cnds.IsOnLayer,cr.plugins_.NinePatch.prototype.acts.Destroy,cr.plugins_.listScroll.prototype.acts.Destroy,cr.system_object.prototype.exps.canvastolayerx,cr.system_object.prototype.exps.layertocanvasx,cr.system_object.prototype.exps.layertocanvasy,cr.system_object.prototype.exps.canvastolayery,cr.plugins_.listScroll.prototype.acts.move,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.listScroll.prototype.acts.stopImpulsion,cr.plugins_.listScroll.prototype.acts.addImpulsion]};