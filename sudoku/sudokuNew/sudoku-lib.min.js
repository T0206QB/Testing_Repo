(function(r){function n(){t=a._cross(e,i),f=a._get_all_units(e,i),u=a._get_square_units_map(t,f),o=a._get_square_peers_map(t,u)}var a=r.sudoku={};a.DIGITS="123456789";var e="ABCDEFGHI",i=a.DIGITS,t=null,f=null,u=null,o=null,_=10,v=81,s={debug:71,easy:62,medium:53,hard:44,"very hard":35,insane:26,inhuman:17};a.BLANK_CHAR=".",a.BLANK_BOARD=".................................................................................",a.generate=function(r,n){"string"!=typeof r&&void 0!==r||(r=s[r]||s.easy),r=a._force_range(r,v+1,_),n=n||!0;for(var e="",i=0;i<v;++i)e+=".";var f=a._get_candidates_map(e),u=a._shuffle(t);for(var o in u){var g=u[o],l=a._rand_range(f[g].length),h=f[g][l];if(!a._assign(f,g,h))break;var d=[];for(var o in t){g=t[o];1==f[g].length&&d.push(f[g])}if(d.length>=r&&a._strip_dups(d).length>=8){var c="",p=[];for(var i in t){g=t[i];1==f[g].length?(c+=f[g],p.push(i)):c+=a.BLANK_CHAR}var m=p.length;if(m>r){p=a._shuffle(p);for(i=0;i<m-r;++i){var I=parseInt(p[i]);c=c.substr(0,I)+a.BLANK_CHAR+c.substr(I+1)}}if(a.solve(c))return c}}return a.generate(r)},a.solve=function(r,n){var e=a.validate_board(r);if(!0!==e)throw e;var i=0;for(var t in r)r[t]!==a.BLANK_CHAR&&a._in(r[t],a.DIGITS)&&++i;if(i<_)throw"Too few givens. Minimum givens is "+_;n=n||!1;var f=a._get_candidates_map(r),u=a._search(f,n);if(u){var o="";for(var v in u)o+=u[v];return o}return!1},a.get_candidates=function(r){var n=a.validate_board(r);if(!0!==n)throw n;var e=a._get_candidates_map(r);if(!e)return!1;var i=[],t=[],f=0;for(var u in e){var o=e[u];t.push(o),f%9==8&&(i.push(t),t=[]),++f}return i},a._get_candidates_map=function(r){var n=a.validate_board(r);if(!0!==n)throw n;var e={},i=a._get_square_vals_map(r);for(var f in t)e[t[f]]=a.DIGITS;for(var u in i){var o=i[u];if(a._in(o,a.DIGITS)){var _=a._assign(e,u,o);if(!_)return!1}}return e},a._search=function(r,n){if(!r)return!1;n=n||!1;var e=0;for(var i in t){var f=t[i],u=r[f].length;u>e&&(e=u,f)}if(1===e)return r;var o=10,_=null;for(i in t){f=t[i],u=r[f].length;u<o&&u>1&&(o=u,_=f)}var v=r[_];if(n)for(s=v.length-1;s>=0;--s){g=v[s],l=JSON.parse(JSON.stringify(r)),h=a._search(a._assign(l,_,g),n);if(h)return h}else for(var s in v){var g=v[s],l=JSON.parse(JSON.stringify(r)),h=a._search(a._assign(l,_,g));if(h)return h}return!1},a._assign=function(r,n,e){var i=r[n].replace(e,"");for(var t in i){var f=i[t],u=a._eliminate(r,n,f);if(!u)return!1}return r},a._eliminate=function(r,n,e){if(!a._in(e,r[n]))return r;r[n]=r[n].replace(e,"");var i=r[n].length;if(1===i){var t=r[n];for(var f in o[n]){var _=o[n][f],v=a._eliminate(r,_,t);if(!v)return!1}}if(0===i)return!1;for(var s in u[n]){var g=u[n][s],l=[];for(var h in g){var d=g[h];a._in(e,r[d])&&l.push(d)}if(0===l.length)return!1;if(1===l.length){v=a._assign(r,l[0],e);if(!v)return!1}}return r},a._get_square_vals_map=function(r){var n={};if(r.length!=t.length)throw"Board/squares length mismatch.";for(var a in t)n[t[a]]=r[a];return n},a._get_square_units_map=function(r,n){var a={};for(var e in r){var i=r[e],t=[];for(var f in n){var u=n[f];-1!==u.indexOf(i)&&t.push(u)}a[i]=t}return a},a._get_square_peers_map=function(r,n){var a={};for(var e in r){var i=r[e],t=n[i],f=[];for(var u in t){var o=t[u];for(var _ in o){var v=o[_];-1===f.indexOf(v)&&v!==i&&f.push(v)}}a[i]=f}return a},a._get_all_units=function(r,n){var e=[];for(var i in r)e.push(a._cross(r[i],n));for(var t in n)e.push(a._cross(r,n[t]));var f=["ABC","DEF","GHI"],u=["123","456","789"];for(var o in f)for(var _ in u)e.push(a._cross(f[o],u[_]));return e},a.board_string_to_grid=function(r){var n=[],a=[];for(var e in r)a.push(r[e]),e%9==8&&(n.push(a),a=[]);return n},a.board_grid_to_string=function(r){for(var n="",a=0;a<9;++a)for(var e=0;e<9;++e)n+=r[a][e];return n},a.print_board=function(r){var n=a.validate_board(r);if(!0!==n)throw n;var e=" ",i="\n",t="  ",f="\n",u="";for(var o in r){var _=r[o];u+=_+e,o%3==2&&(u+=t),o%9==8&&(u+=i),o%27==26&&(u+=f)}console.log(u)},a.validate_board=function(r){if(!r)return"Empty board";if(r.length!==v)return"Invalid board size. Board must be exactly "+v+" squares.";for(var n in r)if(!a._in(r[n],a.DIGITS)&&r[n]!==a.BLANK_CHAR)return"Invalid board character encountered at index "+n+": "+r[n];return!0},a._cross=function(r,n){var a=[];for(var e in r)for(var i in n)a.push(r[e]+n[i]);return a},a._in=function(r,n){return-1!==n.indexOf(r)},a._first_true=function(r){for(var n in r)if(r[n])return r[n];return!1},a._shuffle=function(r){for(var n=[],e=0;e<r.length;++e)n.push(!1);for(var e in r){for(var i=a._rand_range(r.length);n[i];)i=i+1>r.length-1?0:i+1;n[i]=r[e]}return n},a._rand_range=function(r,n){if(n=n||0,r)return Math.floor(Math.random()*(r-n))+n;throw"Range undefined"},a._strip_dups=function(r){var n=[],a={};for(var e in r){var i=r[e];a[i]||(n.push(i),a[i]=!0)}return n},a._force_range=function(r,n,a){return a=a||0,r=r||0,r<a?a:r>n?n:r},n()})(window);